(function(window){var admin={};admin.init=function(){$("#mc-back").hide();$('.call-to-action').hide();$('.call-to-action-multi').hide();$("#mainSection").addClass('move-main');$(".nav-top-level").removeClass("brand-current");$("#dvAdmin .tool-tabs").hide();var sc=new sd.ServerCall("GetAdminDetails");sc.go({onSuccess:admin.displayAdmin,onError:admin.onError});$(".admin-close-btn").bind("click",function(){LoadSection("mccann",true);});}
admin.displayAdmin=function(myData,status){var access=myData[0];sd.Configuration.csAccess=access.accessLevel;var modules=sd.Configuration.adminModules;for(var i=0;i<modules.length;i++){switch(modules[i]){case"USERS":if(admin.superAdmin()==true){$("#adminUsers_btn").toggle();$("#adminUsers_btn").bind("click",function(){LoadSection("adminUsers",true);});}
break;case"GROUPS":if(admin.adminUser()==true){$("#adminGroups_btn").toggle();$("#adminGroups_btn").bind("click",function(){LoadSection("adminGroups",true);});}
break;case"COLLAB":if(admin.adminUser()==true){$("#adminCollab_btn").toggle();$("#adminCollab_btn").bind("click",function(){LoadSection("adminCollabSpaces",true);});}
break;case"METRICS":if(admin.adminUser()==true){$("#adminMetrics_btn").toggle();$("#adminMetrics_btn").bind("click",function(){LoadSection("adminMetrics",false);});}
break;case"META":if(admin.adminUser()==true){$("#adminMeta_btn").toggle();$("#adminMeta_btn").bind("click",function(){LoadSection("adminMetaAttributes",true);});}
break;case"SECTIONMETA":if(admin.adminUser()==true){$("#adminSectionMeta_btn").toggle();$("#adminSectionMeta_btn").bind("click",function(){LoadSection("adminSectionMetaAttributes",true);});}
case"FOLDERS":if(admin.adminUser()==true){$("#adminFolders_btn").toggle();$("#adminFolders_btn").bind("click",function(){collabList.init({container:"#movearea",rootInode:sd.Configuration.siteRoot});});}
break;case"LINKS":if(admin.adminUser()==true){$("#adminLinks_btn").toggle();$("#adminLinks_btn").bind("click",function(){LoadSection("adminLinks",true);});}
break;case"ANNOUNCEMENTS":if(admin.adminUser()==true){$("#adminAnnouncements_btn").toggle();$("#adminAnnouncements_btn").bind("click",function(){LoadSection("adminAnnouncements",true);});}
break;case"MENU":if(admin.adminUser()==true){$("#adminMenu_btn").toggle();$("#adminMenu_btn").bind("click",function(){LoadSection("adminMenu",true);});}
break;case"SECTION ADMINS":if(admin.adminUser()==true){$("#adminSA_btn").toggle();$("#adminSA_btn").bind("click",function(){LoadSection("adminSA",true);});}
break;case"TRAINING OVERLAYS":if(admin.adminUser()==true){$("#adminTO_btn").toggle();$("#adminTO_btn").bind("click",function(){LoadSection("adminTO",true);});}
break;case"EMAIL":if(admin.adminUser()==true){$("#adminEmail_btn").toggle();$("#adminEmail_btn").bind("click",function(){LoadSection("adminEmail",true);});}
break;case"USERSETTINGS":$("#adminUserSettings_btn").toggle();$("#adminUserSettings_btn").bind("click",function(){LoadSection("adminUserSettings",true);});break;case"DISCLAIMERS":if(admin.adminUser()==true){$("#adminDisclaimers_btn").toggle();$("#adminDisclaimers_btn").bind("click",function(){LoadSection("adminDisclaimers",true);});}
break;case"IFRAME":if(admin.adminUser()==true){$("#adminIFrame_btn").toggle();$("#adminIFrame_btn").bind("click",function(){LoadSection("adminIFrame",true);});}
break;default:}}}
admin.adminUser=function(){if(sd.Session.user.superAdmin||sd.Configuration.csAccess==3)
return true;else
return false;}
admin.superAdmin=function(){if(sd.Session.user.superAdmin)
return true;else
return false;}
window.admin=admin;}(window));﻿(function(window){var adminEmail={};adminEmail.init=function(){adminEmail.sending=false;adminEmail.addEventListeners();adminEmail.loadForm();}
adminEmail.loadForm=function(){var sc=new sd.ServerCall("ListAllUsersAndGroups",0);sc.go({onSuccess:adminEmail.displayGroupsUsers,onError:adminEmail.handleError});}
adminEmail.displayGroupsUsers=function(myData,status){var item;for(i=0;i<myData.length;i++){item=myData[i];$('#lstUsers').append('<option data-type ="'+item.t+'"  value="'+item.i+'">'+item.n+'</option>');}
$('#searchable-form').multiSelect({selectableHeader:'<input class="box-sizing" placeholder="Select Users and Groups" style="width:100%;" type="text" id="search" value="" autocomplete = "off"/>',backgroundHeight:200,selBackgroundHeight:200,height:168,selHeight:198,applyIcons:true});$('input#search').quicksearch('#ms-searchable-form .ms-selectable li');$('#searchable-form').multiSelect();$('#search').focus();CKEDITOR.replace('txtBody');}
adminEmail.sendSiteEmail_Send=function(){var emailSubject=$.trim($("#dvSendSiteEmail input[name=txtSubject]").val());var emailBody=CKEDITOR.instances.txtBody.getData();var recipientUsers=[];var recipientGroups=[];$('.ms-elem-selected').each(function(){if(($(this).attr('data-type')!=undefined)&&(($(this).attr('ms-value')!=undefined))){if($(this).attr('data-type')=="user")
recipientUsers.push($(this).attr("ms-value"));else
recipientGroups.push($(this).attr("ms-value"));}});if((emailSubject=="")||(emailBody=="")||(recipientGroups.length<1&&recipientUsers.length<1)){var errStr="<span class='errMsg'>";errStr+="Required Field(s) *, 'Subject', 'Body' and at least one 'Recipient' must be entered.";errStr+="</span>";$("#dvValidationError").show();$("#dvValidationError").html(errStr);adminEmail.sending=false;}
else{var obj={};obj.subject=emailSubject;obj.body=emailBody;obj.recipientUsers=recipientUsers;obj.recipientGroups=recipientGroups;obj.emailFrom="";obj.source="admin";var sc=new sd.ServerCall("SendEmail",0);sc.data(obj);sc.go({onSuccess:adminEmail.sendSiteEmail_EmailSent,onError:adminEmail.handleError});}}
adminEmail.sendSiteEmail_EmailSent=function(myData,status){sd.component.messageBox.action({title:"Sending Email",height:150,text:"Your email is currently processing and will be added to the queue. It will be sent shortly.",btn1:"Ok"});adminEmail.sending=false;LoadSection("admin",false);}
adminEmail.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
adminEmail.addEventListeners=function(){$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});$("#send-mail-cancel").bind("click",function(){LoadSection("admin",false);});$("#send-site-email").bind("click",function(){if(!adminEmail.sending){adminEmail.sending=true;adminEmail.sendSiteEmail_Send();}});}
window.adminEmail=adminEmail;}(window));(function(window){var adminMenu={};var adminMenuInode;var adminMenuFnode;var adminMenuCrumb;var adminMenuTitle;var adminMenuObj;var adminMenuDepth;var adminMenuPermissions_obj;var adminMenuDeleteType;var container;adminMenu.selectedItem=null;adminMenu.currentSortDirection="";adminMenu.currentSortBy="";adminMenu.currentList=[];adminMenu.templates=[];adminMenu.init=function(){adminMenuFnode=sd.Configuration.libraryInode;adminMenuDepth="shallow";adminMenuTitle="Menu Root";container="#menuBreadCrumb";adminMenu.selectedItem=null;adminMenu.currentSortDirection="ASC";adminMenu.currentSortBy="name";adminMenu.currentList=[];$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleName').click(function(){adminMenu.displayList("name")});$('#menuFilterText').on('input',function(){adminMenu.displayList(adminMenu.currentSortBy,adminMenu.currentSortDirection);});adminMenu.addEventListeners();adminMenu.loadMenuItems(adminMenuFnode,adminMenuDepth,adminMenuTitle);}
adminMenu.loadMenuItems=function(fnode,depth,title){adminMenuFnode=fnode;adminMenuDepth=depth;adminMenuTitle=title;adminMenuObj=new Object();adminMenuObj.fnode=fnode;adminMenuObj.depth=depth;var sc=new sd.ServerCall("ListMenuFolders",0);sc.data(adminMenuObj);sc.go({onSuccess:adminMenu.handleList,onError:adminMenu.handleError});}
adminMenu.refreshList=function(error){sd.component.messageBox.close();adminMenuObj=new Object();adminMenuObj.fnode=adminMenuFnode;adminMenuObj.depth=adminMenuDepth;var sc=new sd.ServerCall("ListMenuFolders");sc.data(adminMenuObj);sc.go({onSuccess:adminMenu.handleList,onError:adminMenu.handleError});}
adminMenu.handleList=function(myData,status){if(myData.length>0)
{adminMenuCrumb=myData[0].FilePath;adminMenuCrumb=adminMenuCrumb.slice(0,-1);}
adminMenu.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.inode=myData[idx].i_node;item.fnode=myData[idx].f_node;item.name=myData[idx].item;item.desc=myData[idx].description;item.cbn=myData[idx].createdBy;item.cbd=sd.Utils.formatDate(new Date(parseFloat(myData[idx].createdTime.substr(6))),"dd mmm yy");item.tmpl=myData[idx].template;item.inherit=myData[idx].inheritPermission;item.sectionDescription=myData[idx].sectionDescription;item.displaySectionDescription=myData[idx].displaySectionDescription;adminMenu.currentList.push(item);}
adminMenu.displayList(adminMenu.currentSortBy,adminMenu.currentSortDirection);adminMenu.loadBreadCrumb(container);header.loadTopNavigation();}
adminMenu.displayList=function(sortBy,sortDirection){if(adminMenu.currentSortBy==sortBy){if(sortDirection!=adminMenu.currentSortDirection){if(adminMenu.currentSortDirection=="ASC")adminMenu.currentSortDirection="DESC";else adminMenu.currentSortDirection="ASC";}}
else{adminMenu.currentSortBy=sortBy;adminMenu.currentSortDirection=sortDirection||"ASC";if(adminMenu.currentSortBy=="name")sd.Utils.sortArrayByString(adminMenu.currentList,"name");}
$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-up";if(adminMenu.currentSortDirection=="DESC")sortArrow="icon-chevron-down";if(adminMenu.currentSortBy=="name")$('#sectionContainer .sectionTitleName > .'+sortArrow).show();var htmlOut="";var listCount=adminMenu.currentList.length;var filterText=$('#menuFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=adminMenu.currentList[idx];if(adminMenu.currentSortDirection=="DESC")item=adminMenu.currentList[listCount-(idx+1)];if(filterText!=""&&item.name.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<div class='row grid' data-tmpl='"+item.tmpl+"' data-name='"+item.name+"' data-id='"+item.inode+"' data-inherit='"+item.inherit+"'>   \
                            <div class='yui3-u-1-5'><div class='item-name brand-text pa-l-1'>"+item.name+"</div></div> \
                            <div class='yui3-u-1-5'><div>"+item.cbd+"</div></div> \
                            <div class='yui3-u-1-5'><div>"+item.cbn+"</div></div> \
                            <div class='yui3-u-1-5'><div>"+item.tmpl+"</div></div> \
                            <div class='yui3-u-1-5'><div> \
                            <button class='editAdminMenuItem adm-general-btn small-rnd brand ma-r-half'><i class=\"icon-cog\"></i></button>";if(item.inherit==item.inode)
htmlOut+="<button class='editMenuPermissions adm-general-btn small-rnd brand ma-r-half'><i class=\"icon-lock\" style=\"color:red\"></i>  Permission</button>";else
htmlOut+="<button class='editMenuPermissions adm-general-btn small-rnd brand ma-r-half'><i class=\"icon-lock\"></i></button>";htmlOut+="<button class='delAdminMenuItem adm-general-btn small-rnd brand ma-r-half'><i class=\"icon-trash\"></i></button> \
                            </div></div> \
                        </div>";}
$('#dvMenuList').html(htmlOut);$(".editAdminMenuItem").unbind("click");$(".editAdminMenuItem").click(function(){var inode=$(this).closest(".row").data('id');var sc=new sd.ServerCall("GetFolderDetails");sc.data({inode:inode});sc.go({onSuccess:adminMenu.editMenuItem,onError:adminMenu.handleError});});$(".delAdminMenuItem").unbind("click");$(".delAdminMenuItem").click(function(){var menuID=$(this).parent().parent().parent().data('id');var menuName=$(this).parent().parent().parent().data('name');adminMenu.deleteMenuItem({id:menuID,name:menuName});});$(".item-name").unbind("click");$(".item-name").click(function(){var menuID=$(this).parent().parent().data('id');var menuName=$(this).parent().parent().data('name');adminMenu.loadMenuItems(menuID,"shallow",menuName);});$(".editMenuPermissions").unbind("click");$(".editMenuPermissions").click(function(){var menuID=$(this).parent().parent().parent().data('id');var menuName=$(this).parent().parent().parent().data('name');var menuInherit=$(this).parent().parent().parent().data('inherit');adminMenu.setFolderPermissions({id:menuID,name:menuName,inherit:menuInherit});});$('#loader').hide();}
adminMenu.setFolderPermissions=function(objMenuItem){var inode=objMenuItem.id;var name=objMenuItem.name;var specify=false;if(objMenuItem.inherit==inode)
specify=true;sd.component.permissionsForm.action({title:"MENU - MANAGE ACCESS to "+name+"",inode:inode,useDialog:true,height:400,width:760,showEdit:false,adminLabel:"Edit Access",allowReset:true,isSpecify:specify,populateNoAccess:false,saveCallback:$.proxy(this.refreshList,this)});}
adminMenu.addNewDialog=function(){sd.component.messageBox.action({title:"Add New Menu Item",loadCallback:function(){sd.Utils.sortArrayByString(sd.Configuration.folderTemplates,"label");var i=0;for(i=0;i<sd.Configuration.folderTemplates.length;i++)
{var item=sd.Configuration.folderTemplates[i];if(item.type=="folder")
{$('#menuTemplatesList').append("<option value='"+item.type+"' selected>'"+item.label+"'</option>");}
else
{$('#menuTemplatesList').append("<option value='"+item.type+"'>'"+item.label+"'</option>");}}
$('#parentID').val(adminMenuFnode);$('#menuLocation').html(adminMenuTitle);$('#messageBox .sectionDisplay').hide();$('#messageBox .globalCompanyDisplay').hide();$('#messageBox .js_wysiwyg').hide();$("#menuTemplatesList").unbind("change");$("#menuTemplatesList").change(function(e){var option=$(this).find('option:selected').val();if(option=="team"||option=="bestcase"){$('#messageBox .sectionDisplay').show();}
else{$('#messageBox .sectionDisplay').hide();}
if(option=="team"){$('#messageBox .globalCompanyDisplay').show();}
else{$('#messageBox .globalCompanyDisplay').hide();}
if(option=="article")
$('#messageBox .js_wysiwyg').show();else
$('#messageBox .js_wysiwyg').hide();});CKEDITOR.replace('txtSectionDescription',{customConfig:'/ckeditor/configSimple.js'});$('#messageBox .chkDisplayDescription').prop('checked',false);$('#messageBox .chkDisplayGlobalCompanyDisplay').prop('checked',false);CKEDITOR.replace('txtWYSIWYG',{customConfig:'/ckeditor/configWYSIWYG.js',filebrowserImageUploadUrl:sd.Configuration.ws+'/ckEditorUpload.ashx'});},template:sd.Configuration.templates.adminMenuDetails,width:600,height:250,btn1:"Save",icon1:"icon-save",btn1callback:$.proxy(this.saveMenuItem,this),btn2:"Cancel",icon2:"icon-ban-circle"});}
adminMenu.editMenuItem=function(myData,status){var objMenuItem=myData[0];sd.component.messageBox.action({title:"Edit Menu Item",width:800,height:500,loadCallback:function(){$('#messageBox .js_wysiwyg').hide();var i=0;for(i=0;i<sd.Configuration.folderTemplates.length;i++)
{var item=sd.Configuration.folderTemplates[i];if(objMenuItem.template==item.type)
{$('#menuTemplatesList').append("<option value='"+item.type+"' selected>'"+item.label+"'</option>");}
else
{$('#menuTemplatesList').append("<option value='"+item.type+"'>'"+item.label+"'</option>");}}
$('#menuName').val(objMenuItem.item);$('#menuID').val(objMenuItem.i_node);$('#parentID').val(adminMenuFnode);$('#menuLocation').html(adminMenuTitle);$('#menuTemplatesList').prop('disabled',true);if(objMenuItem.template!="team"&&objMenuItem.template!="bestcase"){$('#messageBox .sectionDisplay').hide();}
if(objMenuItem.template!="team"){$('#messageBox .globalCompanyDisplay').hide();}
CKEDITOR.replace('txtSectionDescription',{customConfig:'/ckeditor/configSimple.js'});CKEDITOR.instances.txtSectionDescription.setData(objMenuItem.sd);if(objMenuItem.template=="article"){$('#messageBox .js_wysiwyg').show();CKEDITOR.replace('txtWYSIWYG',{customConfig:'/ckeditor/configWYSIWYG.js',filebrowserImageUploadUrl:sd.Configuration.ws+'/ckEditorUpload.ashx'});CKEDITOR.instances.txtWYSIWYG.setData(objMenuItem.c);}
$('#messageBox .chkDisplayDescription').prop('checked',objMenuItem.dsd);$('#messageBox .chkDisplayGlobalCompanyDisplay').prop('checked',objMenuItem.dgc);},template:sd.Configuration.templates.adminMenuDetails,btn1:"Save",icon1:"icon-save",btn1callback:adminMenu.saveMenuItem,btn2:"Cancel",icon2:"icon-ban-circle"});}
adminMenu.saveMenuItem=function(){if($("#menuName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}
else{var action="CreateMenuFolder";var obj={};obj.name=$("#menuName").val();obj.inode=$("#parentID").val();obj.template=$("#menuTemplatesList").val();obj.groupid=0;if($("#menuID").val()!=""){action="EditMenuFolder";obj.inode=$("#menuID").val();}
if($('#messageBox .chkDisplayDescription').prop("checked")==true)
obj.displaySectionDescription=1;else
obj.displaySectionDescription=0;if($('#messageBox .chkDisplayGlobalCompanyDisplay').prop("checked")==true)
obj.displayAllCompany=1;else
obj.displayAllCompany=0;obj.sectionDescription=CKEDITOR.instances.txtSectionDescription.getData();obj.content=(obj.template=="article")?CKEDITOR.instances.txtWYSIWYG.getData():"";var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:adminMenu.refreshList,onError:adminMenu.handleError});}}
adminMenu.deleteMenuItem=function(objMenuItem){adminMenu.selectedItem=objMenuItem;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(adminMenu.deleteConfirmed,this),icon2:"icon-ban-circle",btn2:"No",height:171});}
adminMenu.deleteConfirmed=function(){var obj={};obj.inode=adminMenu.selectedItem.id;var sc=new sd.ServerCall("DeleteFolder");sc.data(obj);sc.go({onSuccess:adminMenu.refreshList,onError:adminMenu.handleError});}
adminMenu.addEventListeners=function(){$("#menuAdminRefresh_btn").on("click",function(){adminMenu.loadMenuItems(adminMenuFnode,adminMenuDepth,adminMenuTitle);});$("#menuAdminEditOrder_btn").on("click",function(){adminMenu.editDisplayOrderDialog();});$("#menuAddNew_btn").on("click",function(){adminMenu.addNewDialog();});$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});}
adminMenu.editDisplayOrderDialog=function(){sd.component.messageBox.action({title:"Edit Display Order",loadCallback:function(){var sc=new sd.ServerCall("ListMenuFolders",0);sc.data(adminMenuObj);sc.go({onSuccess:adminMenu.displaySortMenu,onError:adminMenu.handleError});},width:500,height:375,template:sd.Configuration.templates.adminMenuDisplayOrder,btn1:"Save",icon1:"icon-save",btn1callback:$.proxy(this.saveDisplayOrder,this),btn2:"Cancel",icon2:"icon-ban-circle"});}
adminMenu.displaySortMenu=function(myData,status){var item;var htmlOut;for(i=0;i<myData.length;i++){item=myData[i];htmlOut="<li id = '"+item.i_node+"'>"+item.item;$('#sortable').append(htmlOut);}
$('#sortable').sortable();}
adminMenu.saveDisplayOrder=function(){var displayObject="";var count=1;$('#sortable li').each(function(){displayObject+=this.id+";"+count+":";count++;});if(displayObject!="")
displayObject=displayObject.slice(0,-1);var sc=new sd.ServerCall("UpdateFolderDisplayOrder",0);var objTemp=new Object();objTemp.fnode=adminMenuFnode;objTemp.depth=adminMenuDepth;objTemp.displayObject=displayObject;sc.data(objTemp);sc.go({onSuccess:adminMenu.handleList,onError:adminMenu.handleError});sd.component.messageBox.close();}
adminMenu.loadBreadCrumb=function(container){$(container).empty();var n=adminMenuCrumb.split(";");var i;var htmlOut="";for(i=1;i<n.length;i++)
{var s=n[i].split(":");var name=s[0].replace("ID","");var id=s[1];if(id!=adminMenuFnode)
{htmlOut+='<a onclick="adminMenu.loadMenuItems(\''+id+'\', \'shallow\', \''+name+'\');">'+name+'</a>';htmlOut+=' / ';}}
htmlOut+=adminMenuTitle;$(container).append(htmlOut);}
window.adminMenu=adminMenu;}(window));﻿(function(window){adminMetrics={};adminMetrics.init=function(){adminMetrics.addEventListeners();adminMetrics.loadMetrics();}
adminMetrics.loadMetrics=function(){var endDate=new Date();$("#metricStartDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'./images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Start Date"});$("#metricStartDate").datepicker("setDate","01 Jan 2013");$("#metricEndDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'./images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"End Date"});$("#metricEndDate").datepicker("setDate",endDate);adminMetrics.initiateMetrics();}
adminMetrics.initiateMetrics=function(){var start=$("#metricStartDate").val();var end=$("#metricEndDate").val();if($("#metricStartDate").datepicker("getDate")>$("#metricEndDate").datepicker("getDate")){sd.component.messageBox.action({title:"Error",height:150,text:"Start date must be before end date",btn1:"Ok"});}
else{var sc=new sd.ServerCall("TotalFavourites");var obj={};obj.searchDate=start;obj.searchEndDate=end;obj.type="bestcase";sc.data(obj);sc.go({onSuccess:adminMetrics.handleBestcaseFavourites,onError:adminMetrics.handleError});}}
adminMetrics.handleBestcaseFavourites=function(myData,status){$('#txtBestCases').val(myData[0][0].result);$('#txtVaultItems').val(myData[1][0].result);$('#txtTotalFaves').val(myData[0][0].result+myData[1][0].result);$('#txtPosts').val(myData[2][0].result);$('#txtReplies').val(myData[3][0].result);$('#txtLikes').val(myData[4][0].result);$('#txtUniqueLogons').val(myData[5][0].result);$('#txtLogons').val(myData[6][0].result);}
adminMetrics.runMetrics=function(){$("#txtBestCases").val("");$("#txtVaultItems").val("");$("#txtChannels").val("");$("#txtLikes").val("");$("#txtReplies").val("");$("#txtPosts").val("");$("#txtUniqueLogons").val("");$("#txtLogons").val("");adminMetrics.initiateMetrics();}
adminMetrics.resetMetrics=function(){$("#metricStartDate").datepicker("setDate",'01 Jan 2013');$("#metricEndDate").datepicker("setDate",new Date());adminMetrics.runMetrics();}
adminMetrics.addEventListeners=function(){$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});$("#metricsRun").bind("click",function(){adminMetrics.runMetrics();});$("#metricsReset").bind("click",function(){adminMetrics.resetMetrics();});$("#metricsListLogons").bind("click",function(){adminMetrics.openMetrics("ListLogons");});$("#metricsMostActiveUsers").bind("click",function(){adminMetrics.openMetrics("MostActiveUsers");});$("#metricsSearchPhrases").bind("click",function(){adminMetrics.openMetrics("SearchPhrases");});$("#metricsFavouriteFiles").bind("click",function(){adminMetrics.openMetrics("FavouriteFiles");});$("#metricsContentMostViews").bind("click",function(){adminMetrics.openMetrics("ContentMostViews");});$("#metricsBestCaseMostViews").bind("click",function(){adminMetrics.openMetrics("BestCaseMostViews");});$("#metricsPopularTags").bind("click",function(){adminMetrics.openMetrics("PopularTags");});$("#metricsFavouriteSpokespeople").bind("click",function(){adminMetrics.openMetrics("FavouriteSpokespeople");});$("#metricsFavouriteExperts").bind("click",function(){adminMetrics.openMetrics("FavouriteExperts");});$("#metricsSectionsMostViews").bind("click",function(){adminMetrics.openMetrics("SectionsMostViews");});$("#metricsNewsletterMostViews").bind("click",function(){adminMetrics.openMetrics("NewsletterMostViews");});$("#metricsContentMostDownloads").bind("click",function(){adminMetrics.openMetrics("ContentMostDownloads");});}
adminMetrics.openMetrics=function(metric){if($("#metricStartDate").datepicker("getDate")>$("#metricEndDate").datepicker("getDate")){sd.component.messageBox.action({title:"Error",height:150,text:"Start date must be before end date",btn1:"Ok"});}
else{var url=sd.Configuration.ws+"/metrics.aspx?report="+metric+"&StartDate="+$("#metricStartDate").val()+"&EndDate="+$("#metricEndDate").val();window.open(url,'_blank');}}
adminMetrics.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.adminMetrics=adminMetrics;}(window));﻿(function(window){var adminUserSettings={};adminUserSettings.init=function(){adminUserSettings.addEventListeners();adminUserSettings.loadUserSettings();}
adminUserSettings.loadUserSettings=function(){var sc=new sd.ServerCall("GetUserSettings",0);var obj=new Object();obj.uid=sd.Session.user.userID;sc.data(obj);sc.go({onSuccess:adminUserSettings.displayUserSettings,onError:adminUserSettings.handleError});}
adminUserSettings.displayUserSettings=function(myData,status){if(myData[0].receiveAlerts==1)
$("#dvUserSettings input[name=chkReceiveAlerts]").prop("checked",true);else
$("#dvUserSettings input[name=chkReceiveAlerts]").prop("checked",false);if(myData[0].displayTutorial==1)
$("#dvUserSettings input[name=chkDisplayOverlay]").prop("checked",true);else
$("#dvUserSettings input[name=chkDisplayOverlay]").prop("checked",false);$('#loader').hide();}
adminUserSettings.saveUserSettings=function(){var sc=new sd.ServerCall("SaveUserSettings",0);var obj={};obj.uid=sd.Session.user.userID;var settings={};if($("#dvUserSettings input[name=chkReceiveAlerts]").prop("checked")==true)
settings.receiveAlerts=1;else
settings.receiveAlerts=0;if($("#dvUserSettings input[name=chkDisplayOverlay]").prop("checked")==true)
settings.displayTutorial=1;else
settings.displayTutorial=0;obj.settings=settings;sc.data(obj);sc.go({onSuccess:LoadSection("admin",false),onError:adminUserSettings.handleError});}
adminUserSettings.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
adminUserSettings.addEventListeners=function(){$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});$("#user-settings-close").bind("click",function(){LoadSection("admin",false);});$("#user-settings-save").bind("click",function(){adminUserSettings.saveUserSettings();});}
window.adminUserSettings=adminUserSettings;}(window));﻿(function(window){"use strict";var announcementsFnode;var announcements={};announcements.selectedItem=null;announcements.currentSortDirection="";announcements.currentSortBy="";announcements.currentList=[];announcements.init=function(){announcementsFnode=sd.Configuration.siteRoot;announcements.getAnnouncements();}
announcements.initAdmin=function(){announcements.selectedItem=null;announcements.currentSortDirection="ASC";announcements.currentSortBy="text";announcements.currentList=[];announcementsFnode=sd.Configuration.siteRoot;$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();sd.Utils.sortArrayByString(announcements.currentList,"text");$('#sectionContainer .sectionAnnouncementText').click(function(){announcements.displayList("text");});$('#announcementFilterText').on('input',function(){announcements.displayList(announcements.currentSortBy,announcements.currentSortDirection);});announcements.getAdminAnnouncements();announcements.addEventListeners();}
announcements.getAnnouncements=function(){var sc=new sd.ServerCall("ListAnnouncements",0);var obj=new Object();obj.f_node=announcementsFnode;sc.data(obj);sc.go({onSuccess:$.proxy(announcements.displayAnnouncements,this),onError:$.proxy(announcements.handleError,this)});}
announcements.getAdminAnnouncements=function(){var sc=new sd.ServerCall("ListAdminAnnouncements",0);var obj=new Object();obj.f_node=announcementsFnode;sc.data(obj);sc.go({onSuccess:$.proxy(announcements.handleList,this),onError:$.proxy(announcements.handleError,this)});}
announcements.handleList=function(myData,status){announcements.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.id=myData[idx].i_node;item.text=myData[idx].MetaData;announcements.currentList.push(item);}
announcements.displayList(announcements.currentSortBy,announcements.currentSortDirection);}
announcements.displayList=function(sortBy,sortDirection){$("#loader").hide();if(announcements.currentSortBy==sortBy){if(announcements.currentSortBy=="text")sd.Utils.sortArrayByString(announcements.currentList,"text");if(sortDirection!=announcements.currentSortDirection){if(announcements.currentSortDirection=="ASC")announcements.currentSortDirection="DESC";else announcements.currentSortDirection="ASC";}}
else{announcements.currentSortBy=sortBy;announcements.currentSortDirection=sortDirection||"ASC";if(announcements.currentSortBy=="text")sd.Utils.sortArrayByString(announcements.currentList,"text");}
$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(announcements.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(announcements.currentSortBy=="text")$('#sectionContainer .sectionAnnouncementText > .'+sortArrow).show();var htmlOut="";var listCount=announcements.currentList.length;var filterText=$('#announcementFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=announcements.currentList[idx];if(announcements.currentSortDirection=="DESC")item=announcements.currentList[listCount-(idx+1)];if(filterText!=""&&item.text.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<div class='row grid' data-text='"+item.text+"' data-id='"+item.id+"'>   \
                            <div class='yui3-u-3-4'><div class='section-list-field pa-l-1 brand-text'>"+decodeURIComponent(item.text)+"</div></div> \
                            <div class='yui3-u-1-4'><div class='section-list-field'> \
                            <button class='adminEditAnnouncement small-rnd brand ma-r-half' data-text='"+item.text+"' data-id='"+item.id+"'><i class=\"icon-edit\"></i></button> \
                            <button class='delAnnouncement small-rnd brand ma-r-half' data-text='"+item.text+"' data-id='"+item.id+"'><i class=\"icon-trash\"></i></button> \
                            </div></div> \
                        </div>";}
$('#dvAdminAnnouncementsList').html(htmlOut);$(".adminEditAnnouncement").click(function(){var id=$(this).data('id');var text=$(this).data('text');announcements.editAnnouncement({id:id,text:text});});$(".delAnnouncement").click(function(){var id=$(this).data('id');announcements.removeAnnouncement({id:id});});}
announcements.displayAnnouncements=function(myData,status){if(myData.length>0){var item;var htmlOut='';htmlOut+='<span>';htmlOut+='<i class="icon-remove-sign announcements-btn text-on-brand" onclick="announcements.disableAnnouncements();"></i>';htmlOut+='<ul id="js-news" class="js-hidden">';for(var i=0;i<myData.length;i++){item=myData[i];htmlOut+='<li class="news-item">'+decodeURIComponent(item.MetaData)+'</li>';}
htmlOut+='</ul></span>';$('#dvAnnouncements').html(htmlOut);$('#js-news').ticker({titleText:'Announcements',controls:false});}}
announcements.displayFullAnnouncement=function(inode,metadata){sd.component.messageBox.action({title:"Announcement",height:140,btn1callback:$.proxy(this.groupSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
announcements.disableAnnouncements=function(){var sc=new sd.ServerCall("DisableAnnouncements",0);var obj=new Object();obj.f_node=announcementsFnode;sc.data(obj);sc.go({onSuccess:$.proxy(announcements.confirmDisabled,this),onError:$.proxy(announcements.handleError,this)});}
announcements.confirmDisabled=function(){$('#dvAnnouncements').hide();$('#dvChannelStatusFeed').css('padding-bottom','0px');}
announcements.addAnnouncementDialog=function(){sd.component.messageBox.action({title:"Add Announcement",height:250,width:550,template:sd.Configuration.templates.announcementDetails,btn1callback:$.proxy(this.saveAnnouncement,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
announcements.updateOptOut=function(){var sc=new sd.ServerCall("UpdateAnnouncementsOptOut",0);var obj=new Object();obj.f_node=announcementsFnode;sc.data(obj);sc.go({onSuccess:$.proxy(announcements.confirmOptOutReset,this),onError:$.proxy(announcements.handleError,this)});}
announcements.confirmOptOutReset=function(){sd.component.messageBox.action({title:"Confirmed",text:"Announcements will be displayed for all users",height:150,width:400,btn1:"OK",btn1callback:$.proxy(sd.component.messageBox.close,this)});}
announcements.saveAnnouncement=function(){if($("#announcementText").val()==""){sd.component.messageBox.showError("Please Insert some text.");return;}
else{var action="AddAnnouncement";var obj={};obj.announcement=encodeURIComponent($("#announcementText").val()).replace(/'/g,"%27");;obj.f_node=announcementsFnode;if($("#announcementID").val()!=""){action="EditAnnouncement";obj.ID=$("#announcementID").val();}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:announcements.refreshList,onError:announcements.handleError});}}
announcements.refreshList=function(){sd.component.messageBox.close();var sc=new sd.ServerCall("ListAdminAnnouncements");var obj={};obj.f_node=announcementsFnode;sc.data(obj);sc.go({onSuccess:announcements.handleList,onError:announcements.handleError});}
announcements.editAnnouncement=function(objAnnouncement){sd.component.messageBox.action({title:"Edit Announcement",width:700,height:250,loadCallback:function(){$("#announcementID").val(objAnnouncement.id);$("#announcementText").val(decodeURIComponent(objAnnouncement.text));},template:sd.Configuration.templates.announcementDetails,btn1callback:$.proxy(this.saveAnnouncement,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
announcements.removeAnnouncement=function(objAnnouncement){announcements.selectedItem=objAnnouncement;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deleteConfirmed,this),icon2:"icon-ban-circle",btn2:"No"});}
announcements.deleteConfirmed=function(){var obj={};obj.id=announcements.selectedItem.id;obj.f_node=announcementsFnode;var sc=new sd.ServerCall("DeleteAnnouncement");sc.data(obj);sc.go({onSuccess:announcements.refreshList,onError:announcements.handleError});}
announcements.addEventListeners=function(){$("#announcementAdminAdd_btn").bind("click",function(){announcements.addAnnouncementDialog();});$("#announcementOptOut_btn").bind("click",function(){announcements.updateOptOut();});$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});};announcements.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.announcements=announcements;}(window));﻿(function(window){var bestCase={};bestCase.options={};bestCase.formCheckLists=[];bestCase.imageid=0;var selectedItem=0;bestCase.loadForm=function(obj){bestCase.options=obj;bestCase.formCheckLists=[];var sc=new sd.ServerCall("ListSectionMetaTags");var obj={};obj.section='bestcase';sc.data(obj);sc.go({onSuccess:bestCase.handleFromMeta,onError:bestCase.handleError});}
bestCase.formReady=function(){var action="Add Best Case Item";if(bestCase.options.inode>0)
action="Update Best Case Item";sd.Utils.killAllVideos();sd.component.messageBox.action({title:action,height:600,width:960,fade:false,cssClass:"msg-box-front-end",headerClass:"msg-box-front-end-header",bodyClass:"msg-box-front-end-body",loadCallback:function(){var item;var htmlOut="<div class='flex'><input type=\"radio\" name = \"rdoDisclaimer\" class=\"self-center rdoDisclaimer ma-r-half\" id=\"rdoDisclaimer0\" value=\"0\">";htmlOut+="<span class=\"rdo-disclaimer\">None </span></div>";if(disclaimer.currentList.length>0){for(var i=0;i<disclaimer.currentList.length;i++){item=disclaimer.currentList[i];htmlOut+="<div class='flex pa-b-half'><input type=\"radio\" name = \"rdoDisclaimer\" class=\"rdoDisclaimer flex self-center ma-r-half\" id=\"rdoDisclaimer"+item.id+"\" value=\""+item.id+"\">";htmlOut+="<span class=\"rdo-disclaimer\">"+item.name+"</span></div>";}
$('#rdoDisclaimers').html(htmlOut);}else{$('.libraryDisclaimer').hide();$('#rdoDisclaimers').html("");}
var obj={};obj.inode=library.rootNode;obj.limit=library.limit;obj.level=15;var sc=new sd.ServerCall("FolderTraverse");sc.data(obj);sc.go({onSuccess:bestCase.handleLocationItems,onError:bestCase.handleError});$("#bestCaseID").val(bestCase.options.inode);tinymce.init({selector:"#txtDescription",init_instance_callback:function(){if(bestCase.options.inode>0){tinyMCE.activeEditor.setContent(bestCase.options.selectedItem.d);}
window.setTimeout(function(){$(".messageBoxMainBody").scrollTop(0)},500);},content_style:"html {height:81%} #tinymce {height:100%;}"});$('#lstRelatedFiles').multiSelect({keepOrder:true,width:270,backgroundHeight:102,selBackgroundHeight:102,height:100,selHeight:100});if(bestCase.formCheckLists.length==0)$('#dvBestForm .no-tags').html("No Tags configured.");var fragment;var clone;for(i=0;i<bestCase.formCheckLists.length;i++){fragment=document.createDocumentFragment();clone=$('#dvBestForm .guide .checkListItem').clone().appendTo(fragment);clone.attr('id',"dv"+bestCase.formCheckLists[i].attribute+"Container");clone.find('span').html(bestCase.formCheckLists[i].title);clone.find('div').attr('id',bestCase.formCheckLists[i].checklist);$('#dvBestForm .chk-list').append(fragment);$('#'+bestCase.formCheckLists[i].checklist).checkList({listItems:{},onChange:bestCase.selChange});}
if(bestCase.options.inode>0){$("#rdoDisclaimer"+bestCase.options.selectedItem.did).attr('checked','checked');$("#txtTitle").val(bestCase.options.selectedItem.t);if(bestCase.options.selectedItem.ft==1){$("#chkFeaturedItem").prop("checked",true);}else{$("#chkFeaturedItem").prop("checked",false);}
$("#spBestCaseAsset").html(bestCase.options.selectedItem.fn);for(j=0;j<bestCase.options.selectedItem.rf.length;j++){var file=bestCase.options.selectedItem.rf[j];$('#lstRelatedFiles').append('<option selected="selected" value="'+file.i+'">'+file.t+'</option>');$('#div.ms-lstRelatedFiles > div.ms-selection > ul.ms-list').append('<li class="ms-elem-selected" ms-value="'+file.i+' style="">'+file.t+'</li>');}
$('#lstRelatedFiles').multiSelect('refresh');bestCase.imageid=bestCase.options.inode;}else{$("#rdoDisclaimer0").attr('checked','checked');}
var types="";$.each(bestCase.formCheckLists,function(){types+=$(this)[0].id+", ";})
if(types.length>2)types=types.substring(0,types.length-2);var sc=new sd.ServerCall("ListMetaAttributes");var obj={};obj.types=types;obj.returnAll=false;obj.userAttr=false;sc.data(obj);sc.go({onSuccess:bestCase.handleMetaAttributes,onError:bestCase.handleError});$("#relatedFileSearch_btn").bind("click",function(){var searchTerm=$("#txtRelatedFileSearch").val();if(searchTerm==""){library.handleFormError("Please enter a search term for the related file search.");return;}
var obj={};obj.searchString=searchTerm;obj.onError=bestCase.handleFormError;obj.onSuccess=bestCase.handleAssociatedFileSearch;obj.searchUsers=false;obj.searchBox=false;obj.searchEgnyte=false;obj.searchType="any";obj.searchContent=true;obj.searchTitleOnly=false;obj.searchOrder="rank";obj.searchOrderDirection="DESC";obj.searchLimitResults=50;obj.searchCategories="document,bestcase,artist,expert,dreamteam";var rfSearch=new sd.Search(obj);rfSearch.runSearch();});$("#bestCaseUpload_btn").bind("click",function(){sd.FileUploader.browse({'destinationInode':-90,'onComplete':bestCase.uploadComplete,'onSelect':function(lastFile){$("#spBestCaseAsset").html("uploading ...");sd.FileUploader.upload();},'onError':function(msg){$("#spBestCaseAsset").html("Upload Failed. Try Again");}});});$("#relatedFileUpload_btn").bind("click",function(){sd.FileUploader.browse({'destinationInode':-2,'onComplete':bestCase.rfUploadComplete,'onError':function(fileName){}});});$(".messageBoxMainBody").scrollTop(0)},template:sd.Configuration.templates.bestCaseForm,btn1callback:bestCase.saveForm,btn1:"Save",btn2callback:library.cancelForm,btn2:"Cancel"});}
bestCase.handleFromMeta=function(myData){bestCase.formCheckLists=[];var metaItem;for(var m=0;m<myData.length;m++){metaItem=myData[m];bestCase.formCheckLists.push({attribute:metaItem.type,checklist:"dv"+metaItem.type+"List",title:metaItem.label,id:metaItem.attrID});}
bestCase.formReady();}
bestCase.handleLocationItems=function(myData,status){var item;var data=[];data.push({i:library.rootNode,im:library.rootTitle});for(var i=0;i<myData.length;i++){item=myData[i];if(item.a==3&&item.tpl=="bestcase")
data.push(item);}
bestCase.appendMenu($(".location"),data,0);$('#locationDD').fgmenu({content:$('#locationDD').next().html(),backLink:false,label:$('#locationLbl').attr('id'),value:$('#hdnLocationID').attr('id'),width:200});}
bestCase.appendMenu=function(parent,menu,level){for(var i=0;i<menu.length;i++){var fnode;if(bestCase.options.inode==0)
fnode=bestCase.options.fnode;else
fnode=bestCase.options.selectedItem.f;bestCase.formFnode=fnode;if(menu[i].i==fnode){$("#hdnLocationID").text(menu[i].i);$("#locationLbl").text(menu[i].n);bestCase.locationChange(menu[i].i);}
var submenu=parent.append('<li><a data-template="bestcase" id="'+menu[i].i+'" href="#" >'+menu[i].im+'</a></li>').find("li:last");if(menu[i].menu!=undefined&&menu[i].menu.length>0){submenu=submenu.append('<ul></ul>').find("ul");bestCase.appendMenu(submenu,menu[i].menu,level+1);}}}
bestCase.selChange=function(){}
bestCase.locationChange=function(folderID){var obj={};obj.inode=folderID;var sc=new sd.ServerCall("GetFolderDetails",0);sc.data(obj);sc.go({onSuccess:bestCase.updateLocationIndicator});$("#lblNoLocation").hide();}
bestCase.updateLocationIndicator=function(myData,status){var item=myData[0];bestCase.formFnode=item.i_node;var html="";html+="<li id=\"liLocation"+item.i_node+"\" class=\"liLocation ma-tb-1\"><a class='folder-location--remove' onclick = \"bestCase.removeLocation("+item.i_node+");\"><i id=\"icon-remove\" class=\"icon-remove\" title=\"Remove This Location\"></i></a><label class = \"ddLbl dd-lbl\">"+item.FullPath+item.item+"</label></li>";$("#ulFolderLocations").html(html);}
bestCase.removeLocation=function(folderID){bestCase.formFnode=0;$("#liLocation"+folderID).remove();if($("#ulFolderLocations").html()==""){$("#lblNoLocation").fadeIn();}}
bestCase.handleAssociatedFileSearch=function(myData,status){var count=myData.length;var arrText=[];var arrIds=[];$("#lstRelatedFiles option:selected").each(function(){arrIds.push($(this).val());arrText.push($(this).text());});$('#lstRelatedFiles').empty();var item;var addItem;for(i=0;i<myData.length;i++){item=myData[i];addItem=true;for(j=0;j<arrIds.length;j++){if(item.id==arrIds[j]){addItem=false;count--;break;}}
if(addItem==true)
$('#lstRelatedFiles').append('<option value="'+item.id+'">'+item.name+'</option>');}
for(j=0;j<arrIds.length;j++){$('#lstRelatedFiles').append('<option selected="selected" value="'+arrIds[j]+'">'+arrText[j]+'</option>');}
$("#lblSearchCount").html(count);$('#lstRelatedFiles').multiSelect('refresh');}
bestCase.handleMetaAttributes=function(myData,status){var title="";var item;var type,checklist,lstJSON;for(i=0;i<bestCase.formCheckLists.length;i++){type=bestCase.formCheckLists[i].attribute;chkList=bestCase.formCheckLists[i].checklist;$('#'+chkList).checkList({listItems:{},onChange:bestCase.selChange});lstJSON="[]";for(j=0;j<myData.length;j++){if(j==0)lstJSON="[";item=myData[j];if(item.t!=type)
continue;title=item.v.replace(/"/g,'\'');lstJSON+='{ text: "'+title+'", value: "'+item.i+'", ';if(bestCase.options.inode>0){var jsonMeta=$.parseJSON(bestCase.options.selectedItem.ma);for(k=0;k<jsonMeta.length;k++){if(jsonMeta[k].i==item.i){lstJSON+='selected: "1" ';}}}else
lstJSON+='selected: "0" ';lstJSON+='}';lstJSON+=',';}
lstJSON+=']';var obj=eval('('+lstJSON+')');if(lstJSON!="[]")$('#'+chkList).checkList('setData',obj);else $('#'+chkList).parent().remove();}}
bestCase.saveForm=function(){var errString=bestCase.validForm();if(errString!=""){sd.component.messageBox.showError("Please complete the following field(s): "+errString);return;}
var action="";var obj={};obj.startDate="";obj.endDate="";obj.fnode=bestCase.formFnode;if($("#bestCaseID").val()==0){action="AddFormLibraryItem";obj.type="bestcase";obj.inode=bestCase.imageid;}else{action="UpdateFormLibraryItem";obj.orgInode=$("#bestCaseID").val();obj.inode=bestCase.imageid;}
obj.item=$("#txtTitle").val();obj.description=tinyMCE.activeEditor.getContent();obj.disclaimer=$('input:radio[name=rdoDisclaimer]:checked').val()||0;var lstData;var item;var meta="";for(i=0;i<bestCase.formCheckLists.length;i++){lstData=$('#'+bestCase.formCheckLists[i].checklist).checkList('getSelection');for(j=0;j<lstData.length;j++){item=lstData[j];meta+="<meta><type><![CDATA["+bestCase.formCheckLists[i].attribute+"]]></type><value><![CDATA["+item.text+"]]></value><id><![CDATA["+item.value+"]]></id></meta>";}}
meta="<metadata>"+meta+"</metadata>";obj.metaAttributes=meta;obj.metaData="";obj.relatedFiles=$("#lstRelatedFiles").val()+"";if($("#chkFeaturedItem").prop("checked")==true)
obj.featured=1;else
obj.featured=0;var sc=new sd.ServerCall(action);sc.data(obj);if($("#bestCaseID").val()==0)
sc.go({onSuccess:bestCase.showEmailDialog,onError:bestCase.handleFormError});else
sc.go({onSuccess:bestCase.refreshItem,onError:bestCase.handleFormError});}
bestCase.showEmailDialog=function(){sd.component.messageBox.action({fade:false,height:600,width:900,title:"Email New Best Case Details",template:"templates/mccann/email.htm",loadCallback:function(){$('#txtSubject').val(sd.Configuration.messages.emailNewUploadSubject);var url=encodeURIComponent(window.location.protocol)+"//";url+=encodeURIComponent(window.location.host);url+=encodeURIComponent(window.location.pathname);url+="?inode="+bestCase.imageid;var body=sd.Configuration.messages.emailNewUploadBody;body+="%0D%0A%0D%0A";body+=url+" %0D%0A%0D%0A";$('#txtBody').val(decodeURIComponent(body));var obj={};obj.inode=bestCase.options.fnode;var sc=new sd.ServerCall("GetEmailList");sc.data(obj);sc.go({onSuccess:bestCase.handleRecipients,onError:bestCase.handleFormError});},btn1callback:bestCase.sendEmail,btn1:"Send",icon1:"icon-mail-forward",btn2:"Cancel",icon2:"icon-ban-circle",btn2callback:library.refreshList});}
bestCase.sendEmail=function(){var emailSubject=$('#txtSubject').val();var emailBody=$('#txtBody').val();var recipientUsers=[];var recipientGroups=[];$('.ms-elem-selected').each(function(){if(($(this).attr('data-type')!=undefined)&&(($(this).attr('ms-value')!=undefined))){if($(this).attr('data-type')=="user")
recipientUsers.push($(this).attr("ms-value").replace("user",""));else
recipientGroups.push($(this).attr("ms-value").replace("group",""));}});if((emailSubject=="")||(emailBody=="")||(recipientGroups.length<1&&recipientUsers.length<1)){var errStr="<span class='errMsg'>";errStr+="Required Field(s) *, 'Subject', 'Body' and at least one 'Recipient' must be entered.";errStr+="</span>";$("#dvValidationError").show();$("#dvValidationError").html(errStr);}else{var obj={};obj.subject=emailSubject;obj.body=emailBody;obj.recipientUsers=recipientUsers;obj.recipientGroups=recipientGroups;obj.emailFrom="";obj.source="bestCase";var sc=new sd.ServerCall("SendEmail",0);sc.data(obj);sc.go({onSuccess:bestCase.refreshList,onError:bestCase.handleFormError});}}
bestCase.handleRecipients=function(myData,status){var type="";var item;var name;var id;for(i=0;i<myData.length;i++){item=myData[i];name=item.n;if(item.g==true){type="group";id=item.i;}else{type="user";id=item.id}
$('#lstUsers').append('<option data-type ="'+type+'"  value="'+id+'">'+name+'</option>');}
$('#searchable-form').multiSelect({selectableHeader:'<input class="box-sizing" placeholder="Select Users and Groups" style="width:100%;" type="text" id="search" value="" autocomplete = "off"/>',width:304,backgroundHeight:200,selBackgroundHeight:200,height:166,selHeight:198,applyIcons:true});$('input#search').quicksearch('#ms-searchable-form .ms-selectable li');$('#searchable-form').multiSelect();$('#search').focus();}
bestCase.validForm=function(){var valid;var message="";if($("#txtTitle").val()==""||$("#txtTitle").val().length<3){message+="Title is required and must be greater than 3 characters in length, ";}
var bodyText=tinyMCE.activeEditor.getContent();if(bestCase.imageid==0)
message+="Asset, ";var relatedFileCount=$('#ms-lstRelatedFiles > div.ms-selection > ul.ms-list > li').length;if(message!="")
message=message.slice(0,-2)+".";return message;}
bestCase.preview=function(inode){sd.Utils.killAllVideos();$("#dvLibrarySelectedMetaFilters").hide();var sc=new sd.ServerCall("ListSectionMetaTags");sc.data({section:"bestcase"});sc.cbData({i_node:inode})
sc.go({onSuccess:bestCase.handleMeta,onError:bestCase.handleError});}
bestCase.handleMeta=function(myData,status,cbData){bestCase.formCheckLists=[];var metaItem;for(var m=0;m<myData.length;m++){metaItem=myData[m];bestCase.formCheckLists.push({attribute:metaItem.type,checklist:"dv"+metaItem.type+"List",title:metaItem.label,id:metaItem.attrID});}
var sc=new sd.ServerCall("GetLibraryItem");sc.data({inode:cbData.i_node,logView:true});sc.go({onSuccess:bestCase.handleItem,onError:bestCase.handleError});}
bestCase.handleItem=function(myData,Status){var item=myData[0];selectedItem=myData[0].i;if(!library.jumpTo)
sd.Utils.historyAdd({'section':'library','template':'bestcase','inode':item.i,'csid':sd.Configuration.csid,'fnode':item.f});library.jumpTo=false;$('#libraryList').load(sd.Configuration.templates.bestCaseItem,function(){$("#btnEditItem").hide();$("#btnDelete").hide();$("#bestCaseAdd_btn").hide();$("#newLibraryItem_btn").hide();$("#addUrl_btn").hide();if(sd.Session.user.superAdmin||library.adminUser>1||admin.adminUser()||selectedItem.al==3){$("#btnEditItem").show();$("#btnDelete").show();}
window.scrollTo(0,0);$('#dvLibraryFilter').hide();$('js-filt').fadeOut();$('#dvBestCaseHeader').hide();$('#dvLibraryPagingHeader').hide();$('#tbLibraryListHeader').hide();$('#dvLibraryPagingFooter').hide();$(".list-header").hide();$("#dvBestCaseHeader").hide();$("#dvBestCaseHeaderDesc").hide();$(".crw-side-media").show();if(sd.Utils.isVideo(item.ff)==false){$("#dvBCImage").css({"background-image":"url("+sd.Configuration.vault+"/"+item.i+"/bigthumb.jpg)","background-repeat":"no-repeat ","background-size":"cover","background-position":"center"});$("#dvBCImage").bind("click",function(){previewer.open(item.i);});}else{var html="<video class='videoClass' id='"+item.i+"' style=\"width: 100% ;height: 100%;\" controls autoplay> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.i+"/"+item.i+".mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";$("#dvBCImage").html(html);$("#dvBCImage").find('video').bind("loadeddata",function(){$("#dvBCImage").find('video').attr('poster','');});}
var locationPath=(item.pf!=undefined&&item.pf!="")?item.pn+" > "+item.pf:item.pn;$("#hSectionHeader").text(locationPath);$("#dvBCTitle").html(item.t);$("#spFavCount").html(item.tf);if(item.uf==1)
$("#iconFav").addClass("ico-heart-fav");if(item.ft==1){$("#dvBestCaseItem .js-featured-tag").show();}
$(".add-favourites").click(function(){if(item.uf==1){item.uf=0;item.tf=item.tf-1;$("#iconFav").removeClass("ico-heart-fav");$("#spFavCount").html(item.tf);favourites.removeFavourite(item.i);}else{item.uf=1;item.tf=item.tf+1;$("#iconFav").addClass("ico-heart-fav");$("#spFavCount").html(item.tf);favourites.addFavourite(item.i);}});$("#dvBCOwner").html(item.a);if(item.aci!=null&&item.aci!=0){item.ai=item.aci;}
if(item.ai!=null&&item.ai>0){if(String(item.ai).indexOf("base64")>-1){$(".js-aPic").css({'background-image':'url('+item.ai+')','background-size':'cover','background-position':'center'});}
else{$(".js-aPic").css({'background-image':'url('+sd.Configuration.vault+"/"+item.ai+"/bigthumb.jpg"+')','background-size':'cover','background-position':'center'});}}
else{var fullName=item.a.split(' ');if(item.ac==null){item.ac=users.UpdateColour(item.uid);}
var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();$(".js-aPic").html(userInitials).attr("style",'background-color:'+item.ac+'').addClass("white-text");}
$("#dvBCCreateDate").html(item.ct);$("#dvBCBody").html(channel.formatEmbeddedLinks(item.d).replace(/\n/g,"<br/>"));var rfHTML="";$("#dvRFLeft").empty();if(item.rf.length==0){rfHTML="<p> 0 Related Files</p>";}else{for(var i=0;i<item.rf.length;i++){rfHTML+="<div class=\"related-tbl pa-all-1 self-start\">";rfHTML+='<div class="xlarge-sqr"><img onClick="previewer.open('+item.rf[i].i+', {logMetric: true, logSection: \'Associated File\'});" onmouseover="$(this).css(\'cursor\',\'pointer\')" src = "images/docIcons/'+sd.Utils.getFileIcon({fmt:item.rf[i].ft,size:"med"})+'" title = "'+item.rf[i].t+'"/></div>';rfHTML+='<div class="item-desc related-file-name brand-color" onClick="previewer.open('+item.rf[i].i+', {logMetric: true, logSection: \'Associated File\'});">'+item.rf[i].t+'</div>';rfHTML+='<div class="item-desc related-file-desc">'+item.rf[i].a+'</div>';rfHTML+='<div class="item-desc related-file-date">'+item.rf[i].ct+'</div>';rfHTML+="</div>";}}
$("#dvRFLeft").html(rfHTML);var jsonMeta=$.parseJSON(item.ma);var html="";var meta=[];var html="";for(var m=0;m<bestCase.formCheckLists.length;m++){var arrTmp=sd.Utils.getItemsFromObject(jsonMeta,"t",bestCase.formCheckLists[m].attribute,"v");for(var i=0;i<arrTmp.length;i++){html+="<span class=\"tag\"><span data-type=\""+bestCase.formCheckLists[m].attribute+"\" class=\"tag-link brand-color-2\">"+arrTmp[i]+"</span></span>";}}
$("#dvBestCaseItem .js-bcKeyWds").html(html);$("#dvBestCaseItem .js-edit").unbind("click").bind("click",function(){var obj={};obj.inode=item.i;obj.action="edit";obj.fnode=library.currFnode;obj.selectedItem=item;bestCase.loadForm(obj);});$("#dvBestCaseItem .js-delete").unbind("click").bind("click",function(){bestCase.deleteItem();});$("#btnCloseItem").unbind("click").bind("click",function(){if(library.currFnode!=undefined){if(library.currFnode==library.i_node)
$("#dvGoHome").click();else
JumpToItem(library.currFnode);}
else
window.history.go(-1);});$("#dvBestCaseItem  .download-link").unbind("click").bind("click",function(){library.downloadFile(item.i,item.dis);});$("#dvBestCaseItem .mail-link").bind("click",function(){sd.Utils.sendEmailLink({inode:item.i,fnode:item.f});});$("#dvBestCaseItem .share-link").bind("click",function(){sd.Utils.shareFileLink(item.i);});$("#dvBestCaseItem #dvBCOwner").bind("click",function(){LoadSection("userProfile",true,{userID:item.uid,userName:item.u});});$(".tag-link").unbind("click").bind("click",function(){var tag=$(this).html();var tagText=$(this).text();var type=$(this).data('type');$('#headerSearchFieldInput').val(tagText);var obj={};obj.mode="preset"
obj.onError=$.proxy(runSearch.handleError);obj.onSuccess=$.proxy(runSearch.handleResults);obj.searchUsers=false;obj.searchEgnyte=false;obj.metaOnlySearch=true;obj.searchString=tagText;obj.searchMetaData="<metadata><meta><label>"+type+"</label><value>"+tag+"</value></meta></metadata>";LoadSection("search",true,obj);});});}
bestCase.refreshList=function(){sd.component.messageBox.close();library.refreshList();}
bestCase.refreshItem=function(){sd.component.messageBox.close();library.jumpTo=true;library.OpenMenuToInode(bestCase.formFnode);bestCase.preview(bestCase.imageid);}
bestCase.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
bestCase.handleFormError=function(error){sd.component.messageBox.showError(error);}
bestCase.selChange=function(){}
bestCase.uploadComplete=function(newFiles){var count=newFiles.length-1;bestCase.imageid=newFiles[count].i_node;var html=newFiles[count].name+" <i id=\"icon-remove\" class=\"icon-remove-sign  removeAsset\" title=\"Remove This Asset\"></i>";$("#spBestCaseAsset").html(html);$("#spBestCaseAsset .removeAsset").click(function(){bestCase.imageid=0;$("#spBestCaseAsset").html("");});}
bestCase.rfUploadComplete=function(newFiles){for(var i=0;i<newFiles.length;i++){$('#lstRelatedFiles').append('<option value="'+newFiles[i].i_node+'" selected="selected">'+newFiles[i].name+'</option>');$('#ms-lstRelatedFiles > div.ms-selection > ul.ms-list').append('<li class="ms-elem-selected" ms-value="'+newFiles[i].i_node+'" style="">'+newFiles[i].name+'</li>');}
$('#lstRelatedFiles').multiSelect('refresh');}
bestCase.deleteItem=function(){sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deletedConfirmed,this),icon2:"icon-ban-circle",btn2:"No"});}
bestCase.deletedConfirmed=function(){var obj={};obj.inodes=selectedItem;var sc=new sd.ServerCall("DeleteItems");sc.data(obj);sc.go({onSuccess:library.refreshList,onError:library.handleSaveError});if(selectedItem==sd.Configuration.csFeatureID){var sc1=new sd.ServerCall("UpdateCollabSpace");var cs={};cs.id=sd.Configuration.csid;cs.title=sd.Configuration.csName;cs.logo=sd.Configuration.csLogo;cs.background=sd.Configuration.csBackground;cs.theme=sd.Configuration.csTheme;cs.contact=sd.Configuration.csContact;cs.email=sd.Configuration.csEmail;cs.featureID="0";cs.meta='';cs.status="active";cs.accessGroup=sd.Configuration.csAccess;sc1.data({details:cs});sc1.go({onSuccess:bestCase.Success,onError:bestCase.handleError});}}
window.bestCase=bestCase;}(window));(function(window){var channel={};channel.selectedItem=null;channel.currentSortDirection="";channel.currentSortBy="";channel.currentList=[];channel.currentFeed=[];channel.numItemsToShow=5;channel.adminUser=0;channel.access=0;channel.options={};var urlPrefixes=new Array("http://","https://","mailto:","www.");var channel_uploadedFiles=[];var channelInode;var selectedChannel;var channelFilter=[];var channelAttachmentInode="";var itemToDelete;var selectedChannelToDelete;var userImage="0";var emailSubject="";var emailBody="";var selectedPost="";var commentInProgress=0;var previews=[];var viewingsearch=false;var channel_uploadedFilesMax=5;var emptyGroupMessage="<p style=\"justify-self: last baseline;align-self: center;top: calc(50% - 1rem);position: relative;\"> There are no posts to display. </p>";channel.init=function(){$("#loader").show();channel.selectedItem=null;channel.currentSortDirection="ASC";channel.currentSortBy="n";channel.currentList=[];channel.currentFeed=[];channel.numItemsToShow=5;channel.access=0;channel.container="#sectionContainer";channel.withDash=channel.options.withDash||false;if(sd.Global.collabData.channelAdminGroup==1)
channel.adminUser=3;channelInode=sd.Configuration.discussionRoot;$('#loader').css('display','flex');$('#channelAdd').hide();$("#channelUpload_btn").hide();$("#btnSubmit").hide();$("#notify").hide();$("#preview").hide();$('.channel-add-post .postPreviewWrapper').hide();$('#dvChannelPost').hide();$('.channel-post-prompt').hide();sd.Utils.killAllVideos();$("#homeLinksList").hide();if(sd.Configuration.homepageLinks[sd.Configuration.csid]!=undefined){var heading=sd.Configuration.homepageLinks[sd.Configuration.csid][0].heading;$("#homeLinksList .js_linkHead").html(heading);var fragment=document.createDocumentFragment();for(var i=1;i<sd.Configuration.homepageLinks[sd.Configuration.csid].length;i++){var item=sd.Configuration.homepageLinks[sd.Configuration.csid][i];var clone=$(".guide .js_homeLink").clone().appendTo(fragment);clone.data("url",item.url);clone.find("span").text(item.text);}
$("#homeLinksList").show();$("#homeLinksList").append(fragment);$("#homeLinksList .js_homeLink").off("click").on("click",function(){var url=$(this).data("url");window.open(url,"_blank");});}
if(sd.Configuration.csid=='1'){$("#dvMcCannHome .js-lfaq").show().unbind("click").bind("click",function(){previewer.open(sd.Configuration.crewFAQinode);});}
var sc=new sd.ServerCall("GetUserDetails");var obj={};obj.uid=sd.Session.user.userID;sc.data(obj);sc.go({onSuccess:channel.setUser,onError:channel.handleError});if(channel.withDash){$(channel.container+" .jsDashboardSwitch").show();$(channel.container+" .jsDashboardButton").unbind('click');$(channel.container+" .jsDashboardButton").bind('click',function(){if(myDashboard.allowLoad||$("#myDashboard").length==0){$('html').css('overflow-y','auto');$("#sectionContainer").load(sd.Configuration.templates.dashboard,function(){myDashboard.init(true,master.currentSection);});}});}
else{$(channel.container+" .jsDashboardSwitch").hide();}
selectedChannel=channelInode;var fields=" discussionID AS i, discussionName AS n,  MetaData AS meta, accesslevel AS al ";channel.getChannelData(fields);channel.getFeed();if($('#dvAnnouncements').html!=""){$('#dvChannelStatusFeed').css('padding-bottom','25px');}
$("#get-feed").addClass("selected-filter");$("#get-feed").on("click",function(){$("#most-liked").removeClass("selected-filter");$("#get-feed").addClass("selected-filter");channel.getFeed();});$("#most-liked").on("click",function(){$("#get-feed").removeClass("selected-filter");$("#most-liked").addClass("selected-filter");channel.getFeed();});$("#chkChannelSelectToggle").bind("change",function(){$('#loader').css('display','flex');channel.toggleFilter();});$('.toggle-filters').bind("click",function(){$('.sidebar').toggleClass('toggled')});$('.channel-post-prompt').unbind("click");$('.channel-post-prompt').bind("click",function(e){$('#dvChannelStatusFeed').addClass("channel-overlay");$(this).css({"visibility":"hidden"});$(".channel-add-post .postTitle").val("");$(".channel-add-post .postDescription").val("");$(".channel-add-post .postNotify").prop("checked",false);$(".channel-add-post .postNotify").hide();$(".channel-add-post .postPreview").prop("checked",true);$(".channel-add-post .postHomepageSubmit").addClass('disabledBtn');$('.channel-add-post .jsPostPreview').empty();$(".channel-add-post .attachments").empty();channel_uploadedFiles=[];$(".channel-add-post .postAttachment").show();channel.resetHomePagePostChannelList();var fragment=document.createDocumentFragment();var clone=$(".guide .addNewAttachment").clone().appendTo(fragment);$(".channel-add-post .attachments").html(fragment);$('.channel-add-post').fadeIn("slow",function(){$('.channel-add-post .postTitle').focus();$(".channel-add-post .postTitle, .channel-add-post .postDescription").unbind("keyup");$(".channel-add-post .postTitle, .channel-add-post .postDescription").bind("keyup",function(e){$(".channel-add-post .postHomepageSubmit").removeClass('disabledBtn');if($(".channel-add-post .postTitle").val()==""||$(".channel-add-post .postDescription").val()==''||$(".channel-add-post .channelPostList .selected").length==0)
$(".channel-add-post .postHomepageSubmit").addClass('disabledBtn');});$(".channel-add-post .postTitle, .channel-add-post .postDescription").unbind('keydown paste');$(".channel-add-post .postTitle, .channel-add-post .postDescription").bind('keydown paste',null,function(e){if(e.type=="paste"&&$(".channel-add-post .postPreview").prop('checked')){setTimeout(function(){channel.formatEmbeddedLinks($(".channel-add-post .postDescription").val(),0,1);},100);}else{var key=e.keyCode||e.charCode;if(key=="32"&&$(".channel-add-post .postPreview").prop('checked')){setTimeout(function(){channel.formatEmbeddedLinks($(".channel-add-post .postDescription").val(),0,1);},100);}}});$(".channel-add-post .postPreview").unbind("click");$(".channel-add-post .postPreview").bind("click",function(){if($(".channel-add-post .postPreview").prop('checked')){channel.formatEmbeddedLinks($(".channel-add-post .postDescription").val(),0,1);}else{$('.channel-add-post .postPreviewWrapper').hide();}});$(".channel-add-post .postAttachment").unbind("click");$(".channel-add-post .postAttachment").bind("click",function(e){channel.UploadPostImage();});$(".channel-add-post .postHomepageSubmit").unbind("click");$(".channel-add-post .postHomepageSubmit").bind("click",function(e){channel.homepagePostSubmit();});$(".channel-add-post .addNewAttachment").unbind("click");$(".channel-add-post .addNewAttachment").bind("click",function(e){channel.UploadPostImage();});$(".channel-add-post .postClose").unbind("click");$(".channel-add-post .postClose").bind("click",function(e){$('#dvChannelStatusFeed').removeClass("channel-overlay");$('.channel-add-post').fadeOut("fast",function(){$('.channel-post-prompt').css({"visibility":"visible","position":""});});});$(".channel-add-post .channelPostList").unbind("click");$(".channel-add-post .channelPostList").bind("click",function(e){channel.showHomePagePostChannelList();});});});};channel.showHomePagePostChannelList=function(){$(".channel-add-post .channelPostList .channel").fadeIn('fast',function(){$(".channel-add-post .channelPostList .channel").unbind("click");$(".channel-add-post .channelPostList .channel").bind("click",function(e){e.stopPropagation();if($(this).hasClass('selected')){channel.showHomePagePostChannelList();}else{$(".channel-add-post .channelPostList .channel").removeClass('selected');$(this).addClass('selected');$(".channel-add-post .channelPostList .channel:not(.selected)").hide();$(".channel-add-post .postNotify").hide();$(".channel-add-post .postNotify").prop("checked",false);if($(this).data("accesslevel")>=2)$(".channel-add-post .postNotify").show();$(".channel-add-post .postHomepageSubmit").removeClass('disabledBtn');if($(".channel-add-post .postTitle").val()==""||$(".channel-add-post .postDescription").val()==''||$(".channel-add-post .channelPostList .selected").length==0)
$(".channel-add-post .postHomepageSubmit").addClass('disabledBtn');}});});};channel.resetHomePagePostChannelList=function(){$(".channel-add-post .channelPostList .channel").removeClass('selected');if($(".channel-add-post .channelPostList .channel").first().data('accesslevel')>=2)$(".channel-add-post .postNotify").show();else $(".channel-add-post .postNotify").hide();$(".channel-add-post .channelPostList .channel:not(.selected)").hide();$(".channel-add-post .channelPostList .channel").first().addClass('selected').show();};channel.initChannel=function(i_node,cb){$('#loader').css('display','flex');$('#channelAdd').hide();$("#channelUpload_btn").hide();$("#btnSubmit").hide();$("#notify").hide();$("#preview").hide();$('.channel-add-post .postPreviewWrapper').hide();$('#dvChannelPost').hide();$("#chkChannelSelectToggle").hide();$('.channelCheckbox').removeAttr('checked').hide();channelInode=sd.Configuration.discussionRoot;var themeBG="";if(sd.Configuration.csTheme=="dark-theme.css")
themeBG="#1A1A1A";else
themeBG="#f3f3f3";var topoffset=422;if($('#mc-back').is(":visible"))topoffset=100;var sc=new sd.ServerCall("GetUserDetails");var obj={};obj.uid=sd.Session.user.userID;sc.data(obj);sc.go({onSuccess:channel.setUser,onError:channel.handleError});channel.getChannelData(" discussionID AS i, discussionName AS n,  MetaData AS meta, accesslevel AS al ");channel.getDisplayChannelDetails(i_node);};channel.locateComment=function(i_node,f_node){$('#loader').css('display','flex');$("#postList").hide();var item='channel-block-'+f_node+'-'+i_node;waitUntilExists("done",function(){if($('[id*="'+item+'"]').length>0){imagesLoaded('#dvChannelStatusFeed',function(){$('[id*="channel-block"]').hide();$('[id*="'+item+'"]').show();$("#postList").show();$(window).scrollTop(400);viewingsearch=true;if($('[id*="channel-block"]').length<4&&$('[id*="channel-block"]').length>1){$("#postList").append("<button id='more' class=\"w-12 show-replies full-w-btn-small brand-btn brand__outline theme-show-reply\"><span class=\"read-more-story\">Load More Posts</span></button>");$('#more').show().click(function(){viewingsearch=false;$('[id*="channel-block"]').show();if(channel.currentFeed.length>0)
channel.displayFeed(channel.currentFeed,"loadMore");return false;});}
$('#loader').fadeOut();});}else{channel.displayFeed(channel.currentFeed,"loadMore");channel.locateComment(i_node,f_node);}});};channel.jumpToComment=function(i_node,f_node){var item='channel-block-'+f_node+'-'+i_node;waitUntilExists("done",function(){imagesLoaded('#dvChannelStatusFeed',function(){var stop=false;var intervalID=setInterval(function(){if($.active<1&&stop==false){stop=true;clearInterval(intervalID);$('[id*="channel-block"]').show();$('#more').hide();$.each($('#postList').find('li'),function(){if($(this).attr('data-id')==i_node){var cTop=$(this).offset().top;var cHeight=$(this).outerHeight(true)+400;var windowTop=$(window).scrollTop();var visibleHeight=$(window).height();if(cTop<windowTop){$('body').animate({'scrollTop':cTop},'slow','swing');}else if(cTop+cHeight>windowTop+visibleHeight){$('body').animate({'scrollTop':cTop-visibleHeight+cHeight},'slow','swing');}else{$(window).scrollTop(cTop-visibleHeight+cHeight);}}});}},2000);});});};channel.Upload=function(){sd.FileUploader.browse({'destinationInode':'-999','onCancel':$.proxy(channel.uploadCancel,this),'onComplete':$.proxy(channel.uploadComplete,this)});};channel.UploadPostImage=function(){sd.FileUploader.browse({'destinationInode':'-999','onComplete':$.proxy(channel.uploadPostComplete,this)});};channel.uploadCancel=function(){$('#channelUpload_btn').html("UPLOAD");$('#channelUpload_btn').removeAttr('disabled');};channel.uploadPostComplete=function(newFiles){for(var i=0;i<newFiles.length;i++){var extension=newFiles[i].name.substr((newFiles[i].name.lastIndexOf('.')+1));if(newFiles[i].i_node!=undefined)channel_uploadedFiles.push({i_node:newFiles[i].i_node,name:newFiles[i].name,fmt:extension});}
if(channel_uploadedFiles.length>channel_uploadedFilesMax){channel_uploadedFiles=channel_uploadedFiles.splice(0,5);sd.component.messageBox.action({title:"Alert",text:"Max 5 uploads are allowed to a post. Only the first 5 uploads will be processed",btn1:"OK"});}
channel.displayPostUploads();};channel.displayPostUploads=function(){var fragment=document.createDocumentFragment();var clone;var imgSrc;for(var i=0;i<channel_uploadedFiles.length;i++){var file=channel_uploadedFiles[i];clone=$(".guide .attachment").clone();if(sd.Utils.isVideo(file.fmt)){imgSrc=sd.Utils.buildAssetSource({prefix:"imgC",inode:file.i_node,format:file.fmt,thumbSize:"lge",thumbType:"smallthumb",height:100,width:100,title:file.name,videoSize:"thumb"});clone.html(imgSrc);clone.find('.removeAttachment').attr("data-inode",file.i_node);}else{imgSrc=sd.Configuration.vault+"/"+file.i_node+"/bigthumb.jpg";clone.css({"background":"url("+imgSrc+")","background-size":"cover"});clone.find('.removeAttachment').attr("data-inode",file.i_node);}
clone.appendTo(fragment);}
if(channel_uploadedFiles.length<5){clone=$(".guide .addNewAttachment").clone();clone.appendTo(fragment);$(".channel-add-post .postAttachment").show();}else{$(".channel-add-post .postAttachment").hide();}
$(".channel-add-post .attachments").html(fragment);$(".channel-add-post .removeAttachment").unbind("click");$(".channel-add-post .removeAttachment").click(function(){var id=$(this).attr('data-inode');channel.cancelAttachment(id,true);});$(".channel-add-post .addNewAttachment").unbind("click");$(".channel-add-post .addNewAttachment").bind("click",function(){channel.UploadPostImage();});};channel.cancelAttachment=function(id,homepagePost){if(channelAttachmentInode==id){$('#channelAttachment').html("");}else{$.each(channel_uploadedFiles,function(i,v){if(v.i_node==id){channel_uploadedFiles.splice(i,1);return false;}});if(homepagePost==true){channel.displayPostUploads();}else{channel.displayUploads();}}
var sc=new sd.ServerCall("DeleteAttachment",0);var obj={};obj.i_node=id;sc.data(obj);sc.go({onSuccess:$.proxy(this.confirmDeleted,this),onError:$.proxy(this.handleError,this)});};channel.setUser=function(MyData,status){var item=MyData[0];var imgSrc;if(item.Image==null||item.Image==0){var fullName=item.FullName.split(' ');var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();imgSrc="<span class=\"user-no-image-big\">"+userInitials+"</span>";if(item.colour==null){item.colour=users.UpdateColour(item.userid);}
$("channel-item-avatar").css("background-color",item.colour).html(imgSrc);}
else{if(String(item.Image).indexOf("base64")>-1)
imgSrc=item.Image;else
imgSrc=sd.Configuration.vault+"/"+item.Image+"/bigthumb.jpg";$("channel-item-avatar").css({"background-image":"url("+imgSrc+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}
$('.channel-item.avatar').bind("click",function(){channel.getUserDetails({userID:sd.Session.user.userID,userName:sd.Session.user.username});});};channel.toggleFilter=function(){if($("#chkChannelSelectToggle").is(":checked")){$('.channelCheckbox').each(function(){$(this).attr("checked","checked");});}else{$('.channelCheckbox').each(function(){$(this).removeAttr("checked");});}
channel.multiFilter();};channel.singleFilter=function(){$('.channelCheckbox').removeAttr('checked');channelFilter=[];channel.getFeed();};channel.multiFilter=function(inode){$('#chkChannelSelectToggle').attr("checked",true);channelFilter=[];$('.channelCheckbox').each(function(){if(this.checked){channelFilter.push(String($(this).val()));}else{$('#chkChannelSelectToggle').attr("checked",false);}});$("#channelSelect").val("0");selectedChannel="1";$('#dvChannelStatusFilter').hide();if(channelFilter.length>0){channel.getFeed();}else{$('#dvChannelToggleSelect').html("Select All");$('#postList').html(emptyGroupMessage);$('#loader').fadeOut();}
$('#dvChannelStatusFilter').show();};channel.showReply=function(i){$(".reply-textarea").val("");$("#replyDialog"+i).toggle();$("#replyDialog"+i).find("textarea").focus();};channel.resizeTextArea=function(inode){};channel.getFeed=function(){if(channelFilter.length>0){selectedChannel=channelInode;}else if($("#channelSelect").val()!=null){selectedChannel=$("#channelSelect").val();}
var filter=$('.selected-filter').attr("id");var obj={};obj.f_node=selectedChannel;obj.limit=0;if(filter=="most-liked"){var sc=new sd.ServerCall("ListMostLiked",0);}else{sc=new sd.ServerCall("ListChannelComments",0);}
sc.data(obj);sc.go({onSuccess:$.proxy(this.handleChannelData,this),onError:$.proxy(this.handleError,this)});};channel.filterMyPosts=function(){$('#loader').css('display','flex');if($("#channelSelect").val()!=null){selectedChannel=$("#channelSelect").val();}
var sc=new sd.ServerCall("ListUserComments",0);var obj={};obj.f_node=selectedChannel;sc.data(obj);sc.go({onSuccess:$.proxy(this.handleChannelData,this),onError:$.proxy(this.handleError,this)});};channel.handleChannelData=function(myData,status){var feed=[];for(var i=0;i<myData[0].comments.length;i++){var comment=myData[0].comments[i];var tmpObj={};tmpObj.i=comment.i_node;tmpObj.f=comment.f_node;tmpObj.d=comment.description;tmpObj.dc=sd.Utils.formatDate(comment.createdTime,"dd mmm yy");tmpObj.cd=comment.createdTime;tmpObj.cb=comment.createdBy;tmpObj.r=comment.replies;tmpObj.t=comment.type;tmpObj.l=comment.likes;tmpObj.il=comment.isLiked;tmpObj.del=comment.canDel;tmpObj.adm=comment.admin;tmpObj.c=comment.channelID;tmpObj.cn=comment.channelName;tmpObj.tle=comment.title;tmpObj.cbID=comment.userID;tmpObj.cbun=comment.username;tmpObj.cbdn=comment.displayname;tmpObj.p=comment.preview;tmpObj.uc=comment.userColour;if(!(comment.csImage==null))
tmpObj.cbi=comment.csImage;else if(!(comment.Image==null))
tmpObj.cbi=comment.Image;else if(!(comment.image==null))
tmpObj.cbi=comment.image;else
tmpObj.cbi="0";if(comment.attachments==0){tmpObj.a=[];}else{tmpObj.a=[];var arrTmp=$.grep(myData[0].attachments,function(e){return e.f_node==comment.i_node;});for(var j=0;j<arrTmp.length;j++){var tmpAttach={};tmpAttach.i=arrTmp[j].i_node;tmpAttach.f=arrTmp[j].fmt;tmpAttach.n=arrTmp[j].filename;tmpObj.a.push(tmpAttach);}}
feed.push(tmpObj);}
channel.displayFeed(feed);};channel.displayFeed=function(feed,status){$('#loader').css('display','flex');channel.currentFeed=feed.slice();var sCount=feed.length;var item;var htmlOut='';var replyCount=0;var channelPostCount=0;var numReplies=0;var hiddenReplies;var userThumbID='';var i=0;var numPosts=0;var currentChannel;var currentStatus;var imgSrc;var itemID=0;var count=channel.numItemsToShow;$("#postList").hide();if(status!="loadMore")
$("#postList").empty();else
{$('#more').remove();channelPostCount=$(".channel-item").length;}
previews=[];if(viewingsearch)
count=feed.length;for(i=0;i<feed.length;i++){if(count==0){break;}
channel.currentItem=i;item=feed[i];if(item.t=="p"){currentChannel=item.c;currentStatus=item.i;count--;}
if(item.tle==null)item.tle=item.cn;if(channelFilter.length>0&&($.inArray(currentChannel,channelFilter)==-1)){if(item.t=="p"){count++;}}
else{userThumbID="imgUT"+item.cbi;numReplies=item.r;if(item.t=="p"){numPosts++;htmlOut+='<li data-id="'+item.i+'">';htmlOut+='<ul id="channel-block-'+item.f+'-'+item.i+'" class="ma-all-0 ma-b-1 channel-border-bottom"><li id="channel-item'+channelPostCount+'" class="channel-item frame-child"><div class="channelPost'+item.i+'">';htmlOut+='<div class="channel-post flex">';replyCount=1;channelPostCount++;}else{htmlOut+='<li data-id="'+item.i+'" id="channel-reply-'+item.f+'-'+replyCount+'" class="channel-reply theme-channel-reply "><div class="relpy-wrapper channelReply'+item.f+'">';htmlOut+='<div class="flex">';replyCount++;}
htmlOut+='<div class="avatar reply-avatar flex flex-column medium-sqr white-text" onClick="channel.getUserDetails( { userID: '+item.cbID+', userName: \''+item.cbdn+'\'});" ';var imgSrc;if(item.cbi==null||item.cbi==0){var fullName=item.cbdn.split(' ');var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();if(item.uc==null){item.uc=users.UpdateColour(item.cbID);}
htmlOut+=' style="background-color: '+item.uc+';" '
htmlOut+='>';htmlOut+="<span class=\"user-no-image-big\">"+userInitials+"</span>";}
else{if(String(item.cbi).indexOf("base64")>-1)
imgSrc=item.cbi;else
imgSrc=sd.Configuration.vault+"/"+item.cbi+"/bigthumb.jpg";htmlOut+=' style="background-image: url('+imgSrc+');';htmlOut+=' background-repeat: no-repeat;';htmlOut+=' background-size: cover;';htmlOut+=' background-position: center;';htmlOut+=' cursor: pointer;"';htmlOut+='>';}
htmlOut+='</div>';htmlOut+='<div class="flex flex-4 flex-column pa-l-1">';htmlOut+='<div class="flex">';if(item.t=="p"){var newTitle=item.tle;try{newTitle=decodeURIComponent(item.tle);}catch(e){newTitle=item.tle;}
htmlOut+='<div class="ch-title flex"><span id="channel" class="comm-heading channel-post-title flex pa-b-half"> '+newTitle+'</span></div>';}else{htmlOut+='<div class="ch-posted-by flex-1 pa-b-1"><span class="comm-heading comm-heading-theme posted-by pa-b-half"><span class="pa-r-half">Posted by</span></span>';htmlOut+='<span class="comm-heading  comm-heading-theme brand-color brand-color-link attach" onClick="channel.getUserDetails( { userID: '+item.cbID+', userName: \''+item.cbdn+'\'})"; > '+item.cbdn+'</span></div>';}
htmlOut+='<div class="ch-date date pa-r-half ma-l-auto self-center">'+item.dc+'</div>';if(item.del==1||sd.Session.user.superAdmin==true||admin.adminUser()||item.adm==1||channel.adminUser==3){htmlOut+='<a data-type = "'+item.t+'" data-inode = "'+item.i+'" class="channel-admin-actions mid-grey-text pos-r self-center" title="Edit or Delete post"><svg role="img" class="svg-icon-nano" > <use xlink:href="#shape-mcann-edit-icon"></use> </svg></a>';}
htmlOut+='</div>';if(item.t=="p"){htmlOut+='<div class="this-5"><span id="channel" class="comm-heading comm-heading-theme posted-by flex pa-b-1" >Posted in <span class="brand-color brand-color-link pa-l-half pa-r-half" onClick="channel.getDisplayChannelDetails(\''+item.c+'\');">'+decodeURIComponent(item.cn)+'</span><span class="pa-r-half"> by</span><span class="brand-color brand-color-link" onClick="channel.getUserDetails( { userID: '+item.cbID+', userName: \''+item.cbdn+'\'})";> '+item.cbdn+'</span></span></div>';}
htmlOut+='<div class="this-6">';if(item.a.length>0){htmlOut+='<span id="channel" class="comm-heading comm-heading-theme attach flex pa-b-half" >Uploaded '+item.a.length;if(item.a.length==1)
htmlOut+=' Attachment';else
htmlOut+=' Attachments';htmlOut+='</span></div>';}
var newDescription=item.d;try{newDescription=decodeURIComponent(item.d);}catch(e){newDescription=item.d;}
htmlOut+='<div class="feedContent" id = "'+item.i+'">'+channel.formatEmbeddedLinks(newDescription,item.i,item.p).replace(/\n/g,"<br/>")+'</div>';htmlOut+='<div class="channels-attach pa-t-1 pa-b-1"><div>';if(item.a.length>0){var arrTmp=[];var arrRandom=[];switch(item.a.length){case 1:htmlOut+=channel.buildPostImage(".big-thumb",item.a[0]);break;case 2:htmlOut+=channel.buildPostImage(".big-thumb",item.a[0]);htmlOut+=channel.buildPostImage(".big-thumb",item.a[1]);break;case 3:arrTmp=[];arrTmp.push(channel.buildPostImage(".big-thumb",item.a[0]));arrTmp.push(channel.buildPostImage(".small-thumb-wrap",item.a[1],item.a[2]));arrRandom=sd.Utils.shuffleArray(arrTmp);htmlOut+=arrRandom[0];htmlOut+=arrRandom[1];break;case 4:arrTmp=[];arrTmp.push(channel.buildPostImage(".big-thumb",item.a[0]));arrTmp.push(channel.buildPostImage(".small-thumb-wrap",item.a[1],item.a[2]));arrTmp.push(channel.buildPostImage(".big-thumb",item.a[3]));arrRandom=sd.Utils.shuffleArray(arrTmp);htmlOut+=arrRandom[0];htmlOut+=arrRandom[1];htmlOut+=arrRandom[2];break;case 5:arrTmp=[];arrTmp.push(channel.buildPostImage(".big-thumb",item.a[0]));arrTmp.push(channel.buildPostImage(".small-thumb-wrap",item.a[1],item.a[2]));arrTmp.push(channel.buildPostImage(".small-thumb-wrap",item.a[3],item.a[4]));arrRandom=sd.Utils.shuffleArray(arrTmp);htmlOut+=arrRandom[0];htmlOut+=arrRandom[1];htmlOut+=arrRandom[2];break;default:break;}}
htmlOut+='</div>';htmlOut+='</div>';htmlOut+='</div>';htmlOut+='</div>';htmlOut+='</div>';htmlOut+='<div class="replies flex flex-1">';if(item.t=="p"){if(item.a.length>0){var arrTmp1=[];for(var j=0;j<item.a.length;j++){arrTmp1.push(item.a[j].i);}
htmlOut+='<span class="actions-text brand-color actions-text--border pa-all-half" onClick="channel.download(\''+arrTmp1.join(",")+'\');"><span class="actions-text brand-color">Download All</span></span>';}
htmlOut+='<span class="actions-text brand-color actions-text--border pa-all-half" onClick="channel.showReply(\''+item.i+'\');" ><span class="jsCommentCount actions-text brand-color" data-count="'+item.r+'">'+item.r+' Comment(s)</span></span>';}
htmlOut+='<span class="actions-text brand-color actions-text--border pa-all-half"><span><span class="like-pop-holder"></span><span></span><span class="js-likeC" data-inode="'+item.i+'" >'+item.l+'</span><span></span></span>';htmlOut+='<span data-id="'+item.i+'" data-liked="'+item.il+'" data-count="'+item.l+'" class="js-likeP"> Like(s)</span></span>';htmlOut+='</span>';htmlOut+='</li>';hiddenReplies=(item.r-2);if(item.r>2){htmlOut+="<div class='show-comment-btn frame-child'>";htmlOut+="<button class='w-12 show-replies full-w-btn-small brand-btn brand__outline theme-show-reply' id='showReplies"+item.i+"' style='text-align:center' class='orangeText' onClick='channel.toggleReplies("+item.i+", "+hiddenReplies+")';> Show "+hiddenReplies+" Older ";if(hiddenReplies==1){htmlOut+="Comment </button>";}else{htmlOut+="Comments </button>";}
htmlOut+="</div>";}
if(typeof feed[i+1]!="undefined"){if(feed[i+1].t=="p"){if(item.t=="p"){htmlOut+='<li  id="replyDialog'+item.i+'" class="channel-reply theme-channel-reply flextoblock"><ul class=\"indent-reply flex flex-1 flex-column ma-b-0\">';}else{htmlOut+='<li id="replyDialog'+item.f+'" class="channel-reply theme-channel-reply flextoblock"><ul class=\"indent-reply flex flex-1 flex-column  ma-b-0\">';}
htmlOut+='<li>';htmlOut+='<div class="flex">';htmlOut+='<div class="avatar reply-avatar flex flex-column medium-sqr white-text" onClick="channel.getUserDetails( { userID: '+sd.Session.user.userID+', userName: \''+sd.Session.user.username+'\'});" ';var imgSrc;if(item.cbi==null||item.cbi==0){var fullName=item.cbdn.split(' ');var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();if(item.uc==null){item.uc=users.UpdateColour(item.cbID);}
htmlOut+=' style="background-color: '+item.uc+';" '
htmlOut+='>';htmlOut+="<span class=\"user-no-image-big\">"+userInitials+"</span>";}
else{if(String(item.cbi).indexOf("base64")>-1)
imgSrc=item.cbi;else
imgSrc=sd.Configuration.vault+"/"+item.cbi+"/bigthumb.jpg";htmlOut+=' style="background-image: url('+imgSrc+');';htmlOut+=' background-repeat: no-repeat;';htmlOut+=' background-size: cover;';htmlOut+=' background-position: center;';htmlOut+=' cursor: pointer;"';htmlOut+='>';}
htmlOut+='</div><div class="flex flex-4 flex-column pa-l-1"><textarea class="ma-b-1 default-input pa-all-half" onclick="channel.resizeTextArea(\''+i+currentStatus+'\');" placeholder="click to comment" id = "txtStatusReply'+i+currentStatus+'"></textarea></div>';htmlOut+='</li>';htmlOut+='<div class="flex justify-end"><button id="addReply'+i+'" class="small brand__outline ma-r-1" onclick="channel.addReply('+currentStatus+', '+i+', '+item.c+');"> Comment </button>';if(item.t=="p"){htmlOut+='<button id="cancelReply'+i+'" class="small self-center brand__outline ma-r-0" onclick="channel.showReply('+item.i+')"> Cancel </button>';}else{htmlOut+='<button id="cancelReply'+i+'" class="small self-center brand__outline ma-r-0" onclick="channel.showReply('+item.f+')"> Cancel </button>';}
htmlOut+='</div>';htmlOut+="</ul></li>";htmlOut+="</ul></li>";}}else{if(item.t=="p"){htmlOut+='<li id="replyDialog'+item.i+'" class="channel-reply theme-channel-reply"><ul class=\"indent-reply flex flex-1 flex-column  ma-b-0\">';}else{htmlOut+='<li id="replyDialog'+item.f+'" class="channel-reply theme-channel-reply"><ul class=\"indent-reply flex flex-1 flex-column  ma-b-0\">';}
htmlOut+='<li>';htmlOut+='<div class="flex">';htmlOut+='<div class="avatar flex flex-column medium-sqr white-text" onClick="channel.getUserDetails( { userID: '+item.cbID+', userName: \''+item.cbdn+'\'});" ';var imgSrc;if(item.cbi==null||item.cbi==0){var fullName=item.cbdn.split(' ');var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();if(item.uc==null){item.uc=users.UpdateColour(item.cbID);}
htmlOut+=' style="background-color: '+item.uc+';" '
htmlOut+='>';htmlOut+="<span class=\"user-no-image-big medium-sqr white-text\">"+userInitials+"</span>";}
else{if(String(item.cbi).indexOf("base64")>-1)
imgSrc=item.cbi;else
imgSrc=sd.Configuration.vault+"/"+item.cbi+"/bigthumb.jpg";htmlOut+=' style="background-image: url('+imgSrc+');';htmlOut+=' background-repeat: no-repeat;';htmlOut+=' background-size: cover;';htmlOut+=' background-position: center;';htmlOut+=' cursor: pointer;"';htmlOut+='>';}
htmlOut+='</div><div class="flex flex-4 flex-column pa-l-1"><textarea class="default-input pa-all-half" onclick="channel.resizeTextArea(\''+i+currentStatus+'\');" placeholder="click to comment" id = "txtStatusReply'+i+currentStatus+'"></textarea></div>';htmlOut+='</li>';htmlOut+='<div class="flex justify-end reply-btn"><button id="addReply'+i+'" class="medium-btn brand-btn brand__outline ma-r-1" onclick="channel.addReply('+currentStatus+', '+i+', '+item.c+');"> Comment </button><button id="cancelReply'+i+'" class="medium-btn brand-btn brand__outline ma-r-0" onclick="channel.showReply('+item.f+')"> Cancel </button>';htmlOut+='</div>';htmlOut+="</ul></li>";htmlOut+="</ul></li>";}}
channel.currentFeed.splice(0,1);}
if(htmlOut=="")
htmlOut=emptyGroupMessage;if(status!="loadMore")
$("#postList").html(htmlOut);else
$("#postList").append(htmlOut);$('[id*="AVA"]').show();$("#postList").show();$(".small-thumb").css({"background-size":"cover"});$("#postList .postImage, #postList .postVideo").unbind("click").bind("click",function(){var y=window.pageYOffset;previewer.open($(this).data('inode'),{returnScroll:y,onClose:function(){window.scrollTo(0,previewer.returnScroll);},logMetric:true,logSection:"Channel Item"});});$(".channel-admin-actions").unbind("click").bind("click",function(e){var inode=$(this).data('inode');var type=$(this).data('type');if($(this).find(".channelAdminActions").length==1){$("#dvChannelStatusFeed .channelAdminActions").remove();}else{$("#dvChannelStatusFeed .channelAdminActions").remove();var fragment=document.createDocumentFragment();var clone=$(".guide .channelAdminActions").clone().appendTo(fragment);var pTop=$(this).position().top+24;$(clone).css({"top":pTop});$(this).prepend(fragment);$('#dvChannelStatusFeed .channel-edit-post').bind("click",function(e){channel.editPost(inode,type);});$('#dvChannelStatusFeed .channel-delete-post').bind("click",function(e){channel.deletePost(inode);});}});$("#postList .js-likeP").unbind("click").bind("click",function(e){channel.toggleLike({id:$(this).data('id'),count:$(this).data('count'),liked:$(this).data('liked'),elem:$(this)});});$("#postList video").bind("loadeddata",function(){$(this).attr('poster','');});$("#postList .js-likeC").unbind("mouseenter").unbind("mouseleave").on({mouseenter:function(e){$("#dvChannelStatusFeed .like-names").remove();var elem=$(this);var sc=new sd.ServerCall("ListPostLikes",0);var obj={i_node:$(this).data('inode')};sc.data(obj);sc.cbData({i_node:$(this).data('inode'),elem:$(this)});sc.go({onSuccess:function(myData,status,cbData){if(myData.length>0){var fragment=document.createDocumentFragment();var clone=$(".guide .like-names").clone();clone.find("div").remove();for(var i=0;i<myData.length;i++){clone.append("<div>"+myData[i].fullName+"</div>");}
clone.appendTo(fragment);var pLeft=$(elem).position().left-46;$(clone).css({"left":pLeft});cbData.elem.parent().find(".like-pop-holder").html(fragment);}},onError:function(){$("#dvChannelStatusFeed .like-names").remove();}});},mouseleave:function(e){$("#dvChannelStatusFeed .like-names").remove();}});$('.channel-reply').hide();$('[id*="channel-reply-"]').hide();$('[id*="channel-reply-"][id$="1"]').show();$('[id*="channel-reply-"][id$="2"]').show();if(sCount==0){$("#postList").html(emptyGroupMessage);}
if(channel.currentFeed.length>1){$("#postList").append("<a id='more' class=\"button brand__outline small ma-lr-2\"> Load More Posts</a>");}
$('#more').show().unbind('click').click(function(){viewingsearch=false;$('[id*="channel-block"]').show();channel.displayFeed(channel.currentFeed,"loadMore");return false;});$('#sectionContainer').show();$("#postList").append("<div id='done'></div>");$('#loader').fadeOut();commentInProgress=0;$(window).unbind('scroll');$(window).bind('scroll',function(){if($(window).scrollTop()==$(document).height()-$(window).height()&&!viewingsearch){$('#more').click();}});};channel.editPost=function(inode,type){sd.component.messageBox.action({title:"Edit Post",width:"830",height:"480",cssClass:"msg-box-update-pro",headerClass:"update-pro-front-header",bodyClass:"edit-post-front",template:sd.Configuration.templates.statusDetails,loadCallback:function(){if(type!='p'&&type!='c')$("#messageBox .postTitle").parent().parent().hide();if(type=='c'){$("#messageBox .postTitle").parent().hide();$("#messageBox #editPreview").parent().hide();}
$("#messageBox .validation").hide();var sc=new sd.ServerCall("ListChannelCommentByID",0);var obj={};obj.i_node=inode;sc.data(obj);sc.go({onSuccess:$.proxy(channel.populateEditPost,this),onError:$.proxy(channel.handleError,this)});},btn2callback:$.proxy(channel.updatePost,this),btn2close:false,btn1:"Cancel",btn2:"Update Post"});};channel.toggleReplies=function(fnode,n){$('[id*="channel-reply-"][id*="'+fnode+'"]').toggle();$('[id*="channel-reply-"][id*="'+fnode+'"][id$=1]').show();$('[id*="channel-reply-"][id*="'+fnode+'"][id$=2]').show();if($('#showReplies'+fnode).html()=="HIDE OLDER"){var html="Show "+n+" Older ";if(n=="1"){html+="Comment ";}else{html+="Comments ";}
$('#showReplies'+fnode).html(html);}else{$('#showReplies'+fnode).html("HIDE OLDER");}
var count=1;$(".channelReply"+fnode).each(function(){if(count>1){$(this).css("margin-top","-5px");}
count++;});};channel.getChannelData=function(fields){var sc=new sd.ServerCall("ListUserDiscussions",0);var obj={};obj.f_node=channelInode;obj.fields=fields;sc.data(obj);sc.go({onSuccess:$.proxy(this.populateChannels,this),onError:$.proxy(this.handleError,this)});};channel.populateChannels=function(myData,status){var sc=new sd.ServerCall("GetChannelFilter",0);var obj={};obj.f_node=channelInode;sc.data(obj);sc.go({onSuccess:function(d){var cCount=myData.length;$("#channelList").empty();$("#channelSelectList").empty();$("#channelSelect").empty();$("#channelAdd").empty();var item;var htmlOutList='';var htmlOutSelect='';var htmlOut='';var htmlPostList="";var rssOut='';var i=0;var channelAdmin=0;if(d.length>0)
var checkList=d[0].CheckList;for(i=0;i<myData.length;i++){item=myData[i];if(item.al==3)channelAdmin=1;var xmlMeta=$.parseXML(item.meta);var RSS=$(xmlMeta).find("RSS").text();var checked="checked";if(RSS=="1"){rssOut+='<div class="rss-home-left pointer" onClick="channel.getDisplayChannelDetails('+item.i+');">';rssOut+='<span class=\"channel-grp home-link-text pa-l-2\">'+decodeURIComponent(item.n)+'</span><i class="icon-rss rss-ico"></i> </div>';rssOut+='<div class="clear"></div>';}
else{if(sd.Configuration.csid==1&&item.n.toLowerCase()=="releases"){if(checkList!=undefined){if($.inArray(""+item.i,checkListItems)!=-1)
checked="checked";else{checked="";$("#dvChannelList #chkChannelSelectToggle").prop('checked',false);}}else{checked="";$("#dvChannelList #chkChannelSelectToggle").prop('checked',false);}}
if(checkList!=undefined){var checkListItems=checkList.split(", ");if($.inArray(""+item.i,checkListItems)==-1)
checked="";}
htmlOutSelect+='<div id="chkChannel'+item.i+'" data-id = "'+item.i+'" class="select-wrapper theme-select-wrapper border-bottom pa-l-half"><input class="channelCheckbox" type="checkbox" '+checked+' " name="'+decodeURIComponent(item.n)+'" value="'+item.i+'"></div>';htmlOutList+='<div id="txtChannel'+item.i+'" class="name-wrapper pa-all-half pa-l-1 theme-name-wrapper border-bottom""><span data-id = "'+item.i+'" class=\"channel-grp js-cselect\">'+decodeURIComponent(item.n)+'</span></div>';htmlOut+='<option value="'+item.i+'">'+decodeURIComponent(item.n)+'</option>';if(admin.adminUser()||sd.Session.user.superAdmin||channel.adminUser==3)item.al=3
if(item.al>=2)
htmlPostList+='<li class = "channel" data-accesslevel = "'+item.al+'" data-id="'+item.i+'" style="display: list-item;">'+decodeURIComponent(item.n)+'</li>';}}
if(channel.adminUser>1||sd.Session.user.superAdmin||admin.adminUser())$('#addEditChannelBtn').show();$("#channelList").append(htmlOutList);$("#channelSelectList").append(htmlOutSelect);$("#channelSelect").append('<option value="'+sd.Configuration.discussionRoot+'" selected="selected">Groups</option>');$("#channelSelect").append(htmlOut);$("#channelAdd").append(htmlOut);if(sd.Configuration.homepagePosting=="True"&&myData.length>0){$('.channel-post-prompt').show();$('.js-channel-title').html("Share With Us");}
else{$('.js-channel-title').html("What's Happening?");}
$(".channel-add-post .channelPostList").html(htmlPostList);$(".channel-add-post .channelPostList .channel").first().addClass('selected');if($(".channel-add-post .channelPostList .channel").first().data('accesslevel')>=2)$(".channel-add-post .postNotify").show();else $(".channel-add-post .postNotify").hide();$(".channel-add-post .channelPostList .channel:not(.selected)").hide();$(".rssout").html(rssOut);channelFilter=[];$('.channelCheckbox').each(function(){if(this.checked){channelFilter.push(String($(this).val()));}
else{$('#chkChannelSelectToggle').attr("checked",false);}});$("#channelSelectList .channelCheckbox").unbind("click").bind("click",function(){channel.multiFilter($(this).data("id"));});$("#channelList .js-cselect").unbind("click").bind("click",function(){$("#channelSelectList input:checkbox").prop("checked",false);channel.getDisplayChannelDetails($(this).data("id"));});},onError:$.proxy(this.handleError,this)});}
channel.getDisplayChannelDetails=function(channelID){$('#loader').css('display','flex');$('#dvChannelPost').hide();$('.channel-post-prompt').hide();$('.channel-post-prompt').css({'visibility':'hidden'});$('.channel-add-post').hide();$('#chkChannel'+channelID+' input').prop("checked",true);channelFilter=[];selectedChannel=channelID;var sc=new sd.ServerCall("ListDiscussionShort",0);var obj={};obj.f_node=channelID;sc.data(obj);sc.go({onSuccess:$.proxy(this.displayChannelDetails,this),onError:$.proxy(this.handleError,this)});};channel.displayChannelDetails=function(myData,status){$('#dvHeaderTitle').empty();$("#dvChannelDetails").empty().fadeOut("fast");$('#dvFilterSelect').hide();$('#channelToggle').hide();$('#channelAdd').hide();$('#dvRSSList').hide();$('#mc-back').hide();$('.channel-post-prompt').css({'visibility':'hidden'});$('.channel-add-post').hide();var themeBG="";if(sd.Configuration.csTheme=="dark-theme.css")
themeBG="#1A1A1A";else
themeBG="#f3f3f3";$('.call-to-action').hide();$('.call-to-action-multi').hide();$('#homeLinksList').hide();$("#postAttachment").empty();$('#get-feed').addClass("selected-filter");$('#most-liked').removeClass("selected-filter");$('.channel-add-post .postPreviewWrapper').hide();$('#dvChannelStatusFeed').removeClass("channel-overlay");channel_uploadedFiles=[];$('#postList').hide();var item;var isPrivate="0";var isMandatory="0";var htmlOut='';var channelHTML='';var i=0;item=myData[0];channel.access=item.al;htmlOut+="<h4 id=\"channel-top-header\" class=\"channel-top-heder ma-tb-0\">"+decodeURIComponent(item.n)+"</h4>";channelHTML+="<h5>"+decodeURIComponent(item.n)+"</h5>";if(isPrivate=="1"){channelHTML+="<p>Private Channel</p>";}
if(isMandatory=="1"){channelHTML+="<p>Mandatory Channel</p>";}
channelHTML+="<p> Created "+item.cd+"</p>";channelHTML+="<p> by "+item.cb+"</p>";channelHTML+="<hr class='hrStyle'>";$("#dvHeaderTitle").html(htmlOut);$("#dvChannelDetails").append(channelHTML).fadeIn("fast");$("#channelAdd").val(item.i);$("#channelSelect").val(item.i);selectedChannel=item.i;var xmlMeta=$.parseXML(item.meta);var RSS=$(xmlMeta).find("RSS").text();var URL=decodeURIComponent(item.d);if(RSS=="0"){var sc=new sd.ServerCall("ShowAccess",0);var obj={};obj.inode=item.i;sc.data(obj);sc.go({onSuccess:$.proxy(this.displayChannelUsers,this),onError:$.proxy(this.handleError,this)});channelFilter=[];channel.getFeed();$('#dvChannelFilter').show();if(sd.Session.user.superAdmin||admin.adminUser()||channel.adminUser==3)item.al="3";$('#dvChannelPost').hide();$('.channel-post-prompt').hide();$('.channel-post-prompt').css({'visibility':'hidden'});$('.channel-add-post').hide();$(".channel-add-post .postNotify").hide();$(".channel-add-post .postNotify").prop("checked",false);switch(item.al){case"1":$('#dvChannelPost').hide();$('.channel-post-prompt').hide();$('.channel-post-prompt').css({'visibility':'hidden'});$('.channel-add-post').hide();$(".channel-add-post .postNotify").hide();$(".channel-add-post .postNotify").prop("checked",false);break;case"2":$('#dvChannelPost').show();$('.channel-post-prompt').show();$('.channel-post-prompt').css({'visibility':'visible'});$('.channel-add-post').hide();$(".channel-add-post .postNotify").show();$(".channel-add-post .postNotify").prop("checked",false);break;case"3":$('#dvChannelPost').show();$('.channel-post-prompt').show();$('.channel-post-prompt').css({'visibility':'visible'});$('.channel-add-post').hide();$(".channel-add-post .postNotify").show();$(".channel-add-post .postNotify").prop("checked",false);break;default:$('#dvChannelPost').hide();}
if(sd.Session.user.superAdmin||admin.adminUser()||channel.adminUser==3){$('#dvChannelPost').show();}}else{channel.displayRSSChannel(URL);}
$('.channel-post-prompt').unbind("click");$('.channel-post-prompt').bind("click",function(e){$('#dvChannelStatusFeed').addClass("channel-overlay");var topPos=$(this).offset().top-70;$(this).css({"visibility":"hidden"});$(".channel-add-post .postTitle").val("");$(".channel-add-post .postDescription").val("");$(".channel-add-post .postNotify").prop("checked",false);$(".channel-add-post .postPreview").prop("checked",true);$(".channel-add-post .postHomepageSubmit").addClass('disabledBtn');$(".channel-add-post .attachments").empty();channel_uploadedFiles=[];$(".channel-add-post .postAttachment").show();var fragment=document.createDocumentFragment();var clone=$(".guide .addNewAttachment").clone().appendTo(fragment);$(".channel-add-post .attachments").html(fragment);$('.channel-add-post').fadeIn("slow",function(){$('.channel-add-post .postTitle').focus();$(".channel-add-post .postTitle, #Textarea1").unbind("keyup");$(".channel-add-post .postTitle, #Textarea1").bind("keyup",function(e){$(".channel-add-post .postHomepageSubmit").removeClass('disabledBtn');if($(".channel-add-post .postTitle").val()==""||$("#Textarea1").val()==''||$(".channel-add-post .channelPostList .selected").length==0)
$(".channel-add-post .postHomepageSubmit").addClass('disabledBtn');});$(".channel-add-post .postTitle, #Textarea1").unbind('keydown paste');$(".channel-add-post .postTitle, #Textarea1").bind('keydown paste',null,function(e){if(e.type=="paste"&&$(".channel-add-post .postPreview").prop('checked')){setTimeout(function(){channel.formatEmbeddedLinks($("#Textarea1").val(),0,1);},100);}else{var key=e.keyCode||e.charCode;if(key=="32"&&$(".channel-add-post .postPreview").prop('checked')){setTimeout(function(){channel.formatEmbeddedLinks($("#Textarea1").val(),0,1);},100);}}});$(".channel-add-post .postPreview").unbind('click');$(".channel-add-post .postPreview").bind("click",function(){if($(".channel-add-post .postPreview").prop('checked')){channel.formatEmbeddedLinks($("#Textarea1").val(),0,1);}else{$('.channel-add-post .postPreviewWrapper').hide();}});$(".channel-add-post .postAttachment").unbind("click");$(".channel-add-post .postAttachment").bind("click",function(e){channel.UploadPostImage();});$(".channel-add-post .postHomepageSubmit").unbind("click");$(".channel-add-post .postHomepageSubmit").bind("click",function(e){channel.homepagePostSubmit();});$(".channel-add-post .addNewAttachment").unbind("click");$(".channel-add-post .addNewAttachment").bind("click",function(e){channel.UploadPostImage();});$(".channel-add-post .postClose").unbind("click");$(".channel-add-post .postClose").bind("click",function(e){$('#dvChannelStatusFeed').removeClass("channel-overlay");$('.channel-add-post').fadeOut("fast",function(){$('.channel-post-prompt').css({"visibility":"visible","position":""});});});$('.channelPostList').find("[data-id='"+selectedChannel+"']").addClass('selected');});});$('.channel-post-prompt').attr("id","groupPostPrompt");channelFilter=[];};channel.displayChannelUsers=function(myData,status){var viewAccess="";var editAccess="";var adminAccess="";var item;var icon="";var sort="";for(var idx=0;idx<myData.length;idx++){item=myData[idx];switch(item.a){case 1:viewAccess+="<li class='pa-b-half' data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\">"+icon+" "+item.dn+"</li>";break;case 2:editAccess+="<li class='pa-b-half' data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\">"+icon+" "+item.dn+"</li>";break;case 3:adminAccess+="<li class='pa-b-half' data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\">"+icon+" "+item.dn+"</li>";break;default:break;}}
var details="";details+="<h5> Channel Admins </h5><ul id='adminList'></ul>";details+=adminAccess;details+="<h5> Channel Members </h5><ul id='memberList'></ul>";details+=editAccess;details+=viewAccess;$("#dvChannelDetails").append(details).fadeIn("fast");};channel.homepagePostSubmit=function(){if($(sd.FileUploader.container).data('fineuploader').uploader._filesInProgress.length>0){sd.component.messageBox.action({title:"Confirm",text:"Uploads are still in progress and will be cancelled, are you sure you want to continue?",height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.homepagePostSubmitConfirmed,this),icon2:"icon-ban-circle",btn2:"No",cancelUploadsOnClose:false});}else{channel.homepagePostSubmitConfirmed();}};channel.homepagePostSubmitConfirmed=function(){var missingFields="";if($(".channel-add-post .postDescription").val()=="")missingFields+="description, ";if($(".channel-add-post .postTitle").val()=="")missingFields+="title, ";if($(".channel-add-post .channelPostList .selected").length==0)missingFields+="group, ";if(missingFields.length>0){missingFields=missingFields.substring(0,missingFields.length-2);sd.component.messageBox.action({title:"Required Fields",text:" Please ensure you populate missing fields: "+missingFields,height:150,btn1:"Ok"});return;}
if($(".channel-add-post .postTitle").val().length>100){sd.component.messageBox.action({title:"Title Too Long",text:"Your post title must be less than 100 characters long, please adjust and try again.",height:150,btn1:"Ok"});return;}
sd.FileUploader.cancelAll();var i=0;var attachments="";for(i=0;i<channel_uploadedFiles.length;i++){attachments+=channel_uploadedFiles[i].i_node+";";}
if(attachments!="")
attachments=attachments.slice(0,-1);var channelText=$(".channel-add-post .postDescription").val();var parentChannel;if(selectedChannel==sd.Configuration.discussionRoot){parentChannel=$(".channel-add-post .channelPostList .selected").attr("data-id");}else{parentChannel=selectedChannel;}
var message=encodeURIComponent(channelText).replace(/'/g,"%27");var title=$(".channel-add-post .postTitle").val();var sendMail=$('.channel-add-post input.postNotify').prop('checked');var sc=new sd.ServerCall("CreateComment",0);var obj={};if($('.channel-add-post .postPreview').prop('checked')){obj.preview=1;}else{obj.preview=0;}
obj.f_node=parentChannel;obj.parent=parentChannel;obj.selectedChannel=selectedChannel;obj.title=title;obj.message=message;obj.attachmentInode=attachments;sc.data(obj);if(sendMail){sc.go({onSuccess:function(myData,status){channel.replaceLinks(myData);channel.getFeed();},onError:$.proxy(this.handleError,this)});}else{sc.go({onSuccess:$.proxy(this.getFeed,this),onError:$.proxy(this.handleError,this)});}
channel_uploadedFiles=[];$('#dvChannelStatusFeed').removeClass("channel-overlay");$('.channel-add-post').fadeOut("fast",function(){$('.channel-post-prompt').css({"visibility":"visible","position":""});});};channel.Submit=function(){if($(sd.FileUploader.container).data('fineuploader').uploader._filesInProgress.length>0){sd.component.messageBox.action({title:"Confirm",text:"Uploads are still in progress and will be cancelled, are you sure you want to continue?",height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.submitConfirmed,this),icon2:"icon-ban-circle",btn2:"No",cancelUploadsOnClose:false});}else{channel.submitConfirmed();}};channel.addReply=function(inode,loc,channel){if(commentInProgress==1){return;}
commentInProgress=1;var replyText=$("#txtStatusReply"+loc+inode).val();if(replyText==""){sd.component.messageBox.action({title:"Error",text:"Please enter a comment",height:150,btn1:"Ok"});commentInProgress=0;return;}else{var sc=new sd.ServerCall("CreateComment",0);var obj={};obj.f_node=inode;obj.parent=channel;obj.title="";obj.message=encodeURIComponent(replyText).replace(/'/g,"%27");obj.selectedChannel=selectedChannel;obj.preview=0;obj.attachmentInode="";sc.data(obj);sc.go({onSuccess:$.proxy(this.getFeed,this),onError:$.proxy(this.handleError,this)});$('#loader').css('display','flex');$("#postList").hide();$("#postList").empty();}};channel.toggleLike=function(obj){var action="";var newCount=0;var countElem=$(obj.elem).prev().find('[data-inode="'+obj.id+'"]');if(obj.liked=="1"){action="UnLike";newCount=obj.count-1;$(obj.elem).data("liked","0");}else{action="AddLike";newCount=obj.count+1;$(obj.elem).data("liked","1");}
$(obj.elem).data("count",newCount);$(countElem).html(newCount);var sc=new sd.ServerCall(action,0);sc.data({i_node:obj.id,selectedChannel:obj.id});sc.go({onSuccess:$.proxy(this.confirmComplete,this),onError:$.proxy(this.handleError,this)});};channel.deletePost=function(inode){selectedPost=inode;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deletedConfirmed,this),icon2:"icon-ban-circle",btn2:"No"});};channel.deletedConfirmed=function(){var inode=selectedPost;var sc=new sd.ServerCall("DeleteComment",0);var obj={};obj.i_node=inode;obj.selectedChannel=selectedChannel;sc.data(obj);sc.go({onSuccess:$.proxy(this.confirm,this),onError:$.proxy(this.handleError,this)});$.each($('#postList').find('li'),function(){if($(this).attr('data-id')==selectedPost){var cTop=$(this).offset().top;var cHeight=$(this).outerHeight(true);var windowTop=$(window).scrollTop();var visibleHeight=$(window).height();if(cTop<windowTop){$('body').animate({'scrollTop':cTop},'slow','swing');}else if(cTop+cHeight>windowTop+visibleHeight){$('body').animate({'scrollTop':cTop-visibleHeight+cHeight},'slow','swing');}else{$(window).scrollTop(cTop-visibleHeight+cHeight);}
$(this).parent().find('.show-replies').click();$(this).parent().find('.show-replies').remove();$(this).parent().find('.hr-reply').remove();$(this).parent().find('.channel-post').next('.brand-channel-divider').remove();var commentCountElem=$(this).parent().find('.jsCommentCount');var commentCount=$(commentCountElem).data('count');var newCount=commentCount-1;$(commentCountElem).data('count',newCount);$(commentCountElem).html(newCount+" Comment(s)");$(this).remove();}});};channel.formatEmbeddedLinks=function(status,inode,preview,source){var newStatus="";var index=0;var linkStart;var linkEnd;var linkString;var linkCount;linkStart=channel.findNextLink(status,index);linkCount=1;while(linkStart!=-1){linkEnd=channel.findLinkEnd(status,linkStart);linkString=status.substring(linkStart,linkEnd);if(status.substring(linkStart-6,linkStart)!='href="'){var idDiv=""+inode+"_"+linkStart;newStatus+=status.substring(index,linkStart)+" <div id='"+idDiv+"'></div>";newStatus=channel.formatLink(newStatus,linkString,inode,preview,source,idDiv);}else{newStatus+=status.substring(index,linkEnd);}
index=linkEnd;linkStart=channel.findNextLink(status,index);linkCount++;}
newStatus+=status.substring(linkEnd,status.length);return newStatus;};channel.findNextLink=function(status,index){var linkIndex=0;var minIndex=status.length+1;for(var i=0;i<urlPrefixes.length;i++){linkIndex=status.indexOf(urlPrefixes[i],index);if((linkIndex!=-1)&&(linkIndex<minIndex)){minIndex=linkIndex;}}
return(minIndex==status.length+1)?-1:minIndex;};channel.findLinkEnd=function(status,index){var linkEnd=status.replace(/\n/g," ").indexOf(" ",index);if(linkEnd==-1){linkEnd=status.length;}
return linkEnd;};channel.formatLink=function(newStatus,link,i,p,source,idDiv){var length;if(source=="search")length=30;else length=90;var displayLink=link;if(displayLink.length>length)displayLink=displayLink.substring(0,length)+"...";var type="unknown";var vid="unknown";var apiURL="";var title="";var desc="";var thumb="";var output="";var img="";if(link.substring(0,3).toLowerCase()=="www"){link="http://"+link;}
var siteUrl="^"+window.location.protocol+"\/\/";siteUrl+=window.location.host+"*";var regex=new RegExp(siteUrl);if(link.match(regex)){type="local";}else{link.match(/^(http|https):\/\/(?:.*?\.?)(youtube|vimeo|youtu)\.(com|be)\/(watch\?[^#]*v=([a-zA-Z0-9\-_]+)|([a-zA-Z0-9\-_]+))*/);type=RegExp.$2;if(type=="youtube"){vid=RegExp.$5;}else if(type=="youtu"){vid=RegExp.$4;}else if(type=="vimeo"){vid=RegExp.$4;}else{vid="unknown";}}
if(type=="youtube"||type=="youtu"){if(p==1){apiURL="https://www.googleapis.com/youtube/v3/videos?id="+vid+"&key=AIzaSyDj92u8Rl055X3_p1tBB1w9bKJ83A3rHpo&part=snippet,statistics";$.getJSON(apiURL,function(data){title=data.items[0].snippet.title;desc=data.items[0].snippet.description;vid=data.items[0].id;if(desc==""||desc==null){desc="No Description Provided";}
output='<table data-vid="'+vid+'" data-type="youtube" class="external-video">';output+='<tr><td><br>';output+='<iframe style="pointer-events:none" allowtransparency="true" height="200" width="300" class="youtube-player" type="text/html" src="https://www.youtube.com/embed/'+vid+'" allowfullscreen frameborder="0"></iframe>';output+='</td></tr><tr><td><a href="javascript:"><u><span class="brand-youtube-link">'+title+'</span></u></a></td></tr><tr></tr></table>';if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-video').remove();$('#'+i).append(output);}
$(".external-video").unbind();$(".external-video").bind("click",function(){var y=window.pageYOffset;var vid=$(this).data("vid");var type=$(this).data("type");var returnScroll=window.pageYOffset;sd.component.messageBox.action({header:false,escape:false,height:410,width:810,bodyClass:"video-previewer",loadCallback:function(){$('#dvVideoDownload').hide();if(type=="youtube"){apiURL="https://www.googleapis.com/youtube/v3/videos?id="+vid+"&key=AIzaSyDj92u8Rl055X3_p1tBB1w9bKJ83A3rHpo&part=snippet,statistics";$.getJSON(apiURL,function(data){title=data.items[0].snippet.title;desc=data.items[0].snippet.description;vid=data.items[0].id;if(desc==""||desc==null){desc="No Description Provided";}
output='<table class="external-video"><tr><td><br><iframe allowtransparency="true" height="380px" width="780px" class="youtube-player" type="text/html" src="https://www.youtube.com/embed/'+vid+'?autoplay=1" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);});}else if(type=="vimeo"){apiURL="https://vimeo.com/api/oembed.json?url=https://vimeo.com/"+vid+"&callback=?";$.getJSON(apiURL,function(data){title=data.title;desc=data.description;vid=data.video_id;if(desc==""||desc==null){desc="No Description Provided";}
thumb=data.thumbnail_url;output='<table class="external-video"><tr><td><br><iframe style="height: 380px; width: 780px; block; margin: 0 auto;" src="https://player.vimeo.com/video/'+vid+'?autoplay=1" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);});}
$('#vidCloseItem').on('click',function(){sd.component.messageBox.close();});$(".video-previewer").parent().css("border","0");$(".video-previewer").parent().css("background","#000");},template:sd.Configuration.templates.videoPreview,closeCallback:function(){window.scrollTo(0,returnScroll);}});});});}else{newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}}else if(type=="vimeo"){if(p==1){apiURL="https://vimeo.com/api/oembed.json?url=https://vimeo.com/"+vid;$.getJSON(apiURL,function(data){title=data.title;desc=data.description;vid=data.video_id;if(desc==""||desc==null){desc="No Description Provided";}
thumb=data.thumbnail_url;output='<table data-vid="'+vid+'" data-type="vimeo" class="external-video"><tr><td><br><iframe style="pointer-events:none" style="display: height: 200px; width: 250px; block; margin: 0 auto;" src="https://player.vimeo.com/video/'+vid+'" allowfullscreen frameborder="0"></iframe></td></tr><tr><td><a href="javascript:" target="_blank"><u><font class="brand-color">'+title+'</font></u></a></td></tr><tr></tr></table>';if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-video').remove();$('#'+i).append(output);}
$(".external-video").unbind();$(".external-video").bind("click",function(){var y=window.pageYOffset;var vid=$(this).data("vid");var type=$(this).data("type");var returnScroll=window.pageYOffset;sd.component.messageBox.action({header:false,escape:false,height:410,width:782,bodyClass:"video-previewer",loadCallback:function(){$('#dvVideoDownload').hide();if(type=="youtube"){apiURL="https://www.googleapis.com/youtube/v3/videos?id="+vid+"&key=AIzaSyDj92u8Rl055X3_p1tBB1w9bKJ83A3rHpo&part=snippet,statistics";$.getJSON(apiURL,function(data){title=data.items[0].snippet.title;desc=data.items[0].snippet.description;vid=data.items[0].id;if(desc==""||desc==null){desc="No Description Provided";}
output='<table class="external-video"><tr><td><br><iframe allowtransparency="true" height="380px" width="780px" class="youtube-player" type="text/html" src="https://www.youtube.com/embed/'+vid+'?autoplay=1" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);});}else if(type=="vimeo"){apiURL="https://vimeo.com/api/oembed.json?url=https://vimeo.com/"+vid;$.getJSON(apiURL,function(data){title=data.title;desc=data.description;vid=data.video_id;if(desc==""||desc==null){desc="No Description Provided";}
thumb=data.thumbnail_url;output='<table class="external-video"><tr><td><br><iframe style="height: 380px; width: 780px; block; margin: 0 auto;" src="https://player.vimeo.com/video/'+vid+'" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);});}
$('#vidCloseItem').on('click',function(){sd.component.messageBox.close();});$(".video-previewer").parent().css("border","0");$(".video-previewer").parent().css("background","#000");},template:sd.Configuration.templates.videoPreview,closeCallback:function(){window.scrollTo(0,returnScroll);}});});});}else{newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}}else if(type=="local"){var sLink=link.split('?');var sURLVariables=sLink[1].split('&');var inode=0;for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split('=');if(sParameterName[0]=="inode"){inode=sParameterName[1];}}
inode=inode.toString().replace(/\D/g,'');if(inode>0){newStatus+='<a href="'+link+'"><u id="lnk'+inode+'">'+displayLink+'</u></a>';var sc=new sd.ServerCall("GetJumpToDetails",0);var obj={};obj.i_node=inode;sc.data(obj);sc.go({onSuccess:$.proxy(this.updateEmbeddedLink,this),onError:$.proxy(this.handleError,this)});}else{newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}}else{if(p==1){var parser=document.createElement('a');parser.href=link;var site=parser.protocol+"//"+parser.hostname;var maxHeight=100;var query="select * from html where url='"+link+"' AND xpath = \"//title|//head/meta\"";var url="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(query)+"&format=json";$.getJSON(url,function(data){title=link;var imgFoundInMeta=false;if(data.query.results!=null){title=data.query.results.title;$.each(data.query.results.meta,function(key,val){if(val.content){if(val.name&&val.name=='description'){desc=val.content;}
var metaContentSeemsImage=(""+val.content).match("^http(s)?://.*(jpeg|jpg|png|gif)$");if(val.name=='image'||metaContentSeemsImage){if(val.content.substring(0,7)=='http://'&&val.content.charAt(val.content.length-4)=='.'){if(val.content!='undefined'){imgFoundInMeta=true;img=val.content;}}}}});}
if(imgFoundInMeta==false){var url="https://api.embed.ly/1/oembed?key=9c59af118a744a588186e6264d1da748&url="+encodeURIComponent(link);$.getJSON(url,function(data){var img=data.thumbnail_url;var desc=data.description;var title=data.title;if(img==""){output='<table class="external-news theme-external-news test2"><tr><td><a href="'+link+'" target="_blank"><u><font class="brand-color">'+title+'</font></u></a></td></tr><tr><td>'+desc+'</td></tr></table>';}else{output='<div class="flex ma-b-2 flex-0 self-start"> <div class="external-news-image flex-1 ma-r-2" style="background-image:url('+img+');background-repeat: no-repeat;background-size:contain;background-position: center;"> </div><div class="external-desc flex-4"> <strong><a href="'+link+'" target="_blank"> '+title+'</a></strong> <p>'+desc+'</p> </div> ';}
if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.jsPostPreview .external-news').find('td').eq(2).dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:35});$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-news').remove();$('#'+idDiv).append(output);}});}else{output='<table class="external-news theme-external-news test1"><tr><td class="external-img" rowspan="2"><img height="120px" width="150px" id="imgA'+i+'" src="'+img+'"></img></td><td><a href="'+link+'" target="_blank"><u><font class="brand-color">'+title+'</font></u></a></td></tr><tr><td>'+desc+'</td></tr></table>';if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.jsPostPreview .external-news').find('td').eq(2).dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:35});$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-news').remove();$('#'+idDiv).append(output);}}});}else
newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}
return newStatus;};channel.updateEmbeddedLink=function(myData){var item=myData[0].item;var inode=myData[0].i_node;var origInode=myData[0].origInode;$('#lnk'+origInode).html(item);};channel.createChannelDialog=function(){sd.component.messageBox.action({title:"GROUPS - ADD NEW GROUP",width:"600",height:"530",cssClass:"msg-box-update-pro",headerClass:"update-pro-front-header",template:sd.Configuration.templates.channelDetails,btn1callback:$.proxy(this.addChannel,this),btn1:"Save",btn2callback:$.proxy(this.addEditChannel,this),btn2:"Cancel",});};channel.createRSSDialog=function(){sd.component.messageBox.action({title:"GROUPS - ADD RSS FEED",width:"400",height:"332",template:sd.Configuration.templates.rssDetails,btn1callback:$.proxy(this.addRSSChannel,this),btn1:"Save",btn2callback:$.proxy(this.addEditChannel,this),btn2:"Cancel",});};channel.addEditChannel=function(){sd.component.messageBox.action({title:"ADD/EDIT GROUPS",width:"750",height:"500",cssClass:"msg-box-add-edit-groups",headerClass:"update-pro-front-header",bodyClass:"add-edit-group-scroll",loadCallback:function(){var sc=new sd.ServerCall("ListUserDiscussions",0);var fields=" MetaData, discussionID AS i, discussionName AS n, createdBy AS cb, createdByUN AS cbid, CreatedTime AS cd, accesslevel AS al ";var obj={f_node:channelInode,fields:fields};sc.data(obj);sc.go({onSuccess:$.proxy(channel.loadAvailableChannels,this),onError:$.proxy(channel.handleError,this)});$('#dvChannelContent .sectionTitleName').click(function(){channel.displayList("n");});$('#dvChannelContent .sectionTitleCreatedBy').click(function(){channel.displayList("cb");});$('#dvChannelContent .sectionTitleCreatedDate').click(function(){channel.displayList("cd");});$('#channelFilterText').on('input',function(){channel.displayList(channel.currentSortBy,channel.currentSortDirection);});},template:sd.Configuration.templates.channelList});};channel.loadAvailableChannels=function(myData,status){channel.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={};var xmlMeta=$.parseXML(myData[idx].meta);item.i=myData[idx].i;item.n=decodeURIComponent(myData[idx].n);item.cb=myData[idx].cb;item.cbid=myData[idx].cbid;item.cd=sd.Utils.formatDate(myData[idx].cd,"dd mmm yy");item.rss=$(xmlMeta).find("RSS").text();item.al=myData[idx].al;channel.currentList.push(item);}
channel.displayList(channel.currentSortBy,channel.currentSortDirection);};channel.displayList=function(sortBy,sortDirection){if(sd.Session.user.superAdmin||channel.adminUser>1||admin.adminUser()){$('#addChannel').show();}
if(channel.currentSortBy==sortBy){if(channel.currentSortBy=="cb")sd.Utils.sortArrayByString(channel.currentList,"cb");if(channel.currentSortBy=="cd")sd.Utils.sortArrayByJSDate(channel.currentList,"cd");if(channel.currentSortBy=="n")sd.Utils.sortArrayByString(channel.currentList,"n");if(sortDirection!=channel.currentSortDirection){if(channel.currentSortDirection=="ASC")channel.currentSortDirection="DESC";else channel.currentSortDirection="ASC";}}else{channel.currentSortBy=sortBy;channel.currentSortDirection=sortDirection||"ASC";if(channel.currentSortBy=="n")sd.Utils.sortArrayByString(channel.currentList,"n");if(channel.currentSortBy=="cb")sd.Utils.sortArrayByString(channel.currentList,"cb");if(channel.currentSortBy=="cd")sd.Utils.sortArrayByJSDate(channel.currentList,"cd");}
$('#dvChannelContent .icon-chevron-up').hide();$('#dvChannelContent .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(channel.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(channel.currentSortBy=="n")$('#dvChannelContent .sectionTitleName > .'+sortArrow).show();if(channel.currentSortBy=="cb")$('#dvChannelContent .sectionTitleCreatedBy > .'+sortArrow).show();if(channel.currentSortBy=="cd")$('#dvChannelContent .sectionTitleCreatedDate > .'+sortArrow).show();var htmlOut="";var listCount=channel.currentList.length;var filterText=$('#channelFilterText').val()
if(filterText!=undefined)filterText=filterText.toLowerCase();for(var idx=0;idx<listCount;idx++){var item=channel.currentList[idx];if(channel.currentSortDirection=="DESC")item=channel.currentList[listCount-(idx+1)];if(filterText!=""&&item.n.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<div class='flex flex-1 pa-all-half border-bottom' data-creator='"+item.cbid+"' data-creatorname='"+item.cb+"' data-rss='"+item.rss+"' data-channelname='"+item.n+"' data-channelid='"+item.i+"'>   \
                            <div class='flex flex-1'><div class='section-list-field'>"+item.n;if(item.rss=="1")htmlOut+="<img class=\"circular rss-home\" style=\"height:10px;width:10px;display:inline-block;\" src=\"images/mccann/rss_small-24x24.png\">";htmlOut+="</div></div> \
                            <div class='flex flex-1'><div class='section-list-field'>"+item.cd+"</div></div> \
                            <div class='flex flex-1'><div class='section-list-field'>"+item.cb+"</div></div> \
                            <div class='flex flex-1 justify-end'><div class='section-list-field'>";if(item.al=="3"){htmlOut+="<button class=\"channelPermsBtn small-rnd brand ma-r-half\" title=\"Change Permissions\" style=\"display: inline-block;\"><svg role=\"img\" class=\"svg-icon\"><use xlink:href=\"#shape-permissions\"></use></svg></button> \
                            <button class=\"channelEditBtn small-rnd brand ma-r-half\" title=\"Edit Group\" style=\"display: inline-block;\"><svg role=\"img\" class=\"svg-icon\"><use xlink:href=\"#shape-mcann-settings-icon\"></use></svg></button> \
                            <button class=\"channelDeleteBtn small-rnd brand ma-r-half\" title=\"Delete Group\" style=\"display: inline-block;\"><svg role=\"img\" class=\"svg-icon\"><use xlink:href=\"#shape-trash\"></use></svg></button>";}
htmlOut+="</div></div> \
                        </div>";}
$('#dvChannelAdminList').html(htmlOut);$(".channelPermsBtn").click(function(){var id=$(this).parent().parent().parent().data('channelid');var creator=$(this).parent().parent().parent().data('creator');var creatorName=$(this).parent().parent().parent().data('creatorname');channel.setChannelPermissions({inode:id,creator:creator,creatorName:creatorName});});$(".channelEditBtn").click(function(){var id=$(this).parent().parent().parent().data('channelid');var rss=$(this).parent().parent().parent().data('rss');if(rss=="1"){channel.editRSSChannel(id);}else{channel.editChannel(id);}});$(".channelDeleteBtn").click(function(){var id=$(this).parent().parent().parent().data('channelid');channel.deleteChannel(id);});$('#addChannel').unbind("click");$('#addChannel').bind("click",function(){channel.createChannelDialog();});$('#refresh').unbind("click");$('#refresh').bind("click",function(){channel.addEditChannel();});};channel.deleteChannel=function(channelID){selectedChannelToDelete=channelID;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:171,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deleteConfirmed,this),icon2:"icon-ban-circle",btn2:"No"});};channel.deleteConfirmed=function(){var sc=new sd.ServerCall("DeleteDiscussion",0);var obj={};obj.i_node=selectedChannelToDelete;obj.f_node=channelInode;sc.data(obj);sc.go({onSuccess:$.proxy(channel.populateChannels,this),onError:$.proxy(channel.handleError,this)});if(selectedChannel==selectedChannelToDelete){LoadSection("mccann",true);}else{channel.getFeed();}};channel.editChannel=function(channelID){sd.component.messageBox.action({title:"Edit Group",width:"600",height:"530",template:sd.Configuration.templates.channelDetails,loadCallback:function(){var sc=new sd.ServerCall("ListDiscussionShort",0);var obj={};obj.f_node=channelID;sc.data(obj);sc.go({onSuccess:$.proxy(channel.populateEditChannel,this),onError:$.proxy(channel.handleError,this)});},btn1callback:$.proxy(channel.updateChannel,this),btn1:"Update",btn2:"Cancel"});};channel.editRSSChannel=function(channelID){sd.component.messageBox.action({title:"Edit RSS Feed",width:"400",height:"332",template:sd.Configuration.templates.rssDetails,loadCallback:function(){var sc=new sd.ServerCall("ListDiscussionShort",0);var obj={};obj.f_node=channelID;sc.data(obj);sc.go({onSuccess:$.proxy(channel.populateEditRSSChannel,this),onError:$.proxy(channel.handleError,this)});},btn1callback:$.proxy(channel.updateRSSChannel,this),btn1:"Update",icon1:"icon-ok-sign",btn2:"Cancel",icon2:"icon-ban-circle"});};channel.populateEditChannel=function(MyData,status){$('#channelID').val(MyData[0].i);$('#channelName').val(decodeURIComponent(MyData[0].n));$('#channelDesc').val(decodeURIComponent(MyData[0].d));var xmlMeta=$.parseXML(MyData[0].meta);var isMandatory=$(xmlMeta).find("Mandatory").text();var isPrivate=$(xmlMeta).find("Private").text();if(isMandatory=="1"){$('#isMandatory').prop('checked',true);}};channel.populateEditRSSChannel=function(MyData,status){$('#channelID').val(MyData[0].i);$('#channelName').val(decodeURIComponent(MyData[0].n));$('#channelDesc').val(decodeURIComponent(MyData[0].d));};channel.addChannelToUser=function(channelID){var sc=new sd.ServerCall("AddChannelToUser",0);var obj={};obj.channelID=channelID;sc.data(obj);sc.go(channel.addEditChannel);};channel.populateEditPost=function(MyData,status){var title=MyData[0].item;var newDescription=MyData[0].description;try{newDescription=decodeURIComponent(MyData[0].description);title=decodeURIComponent(MyData[0].item);}catch(e){newDescription=MyData[0].description;title=MyData[0].item;}
$('#postID').val(MyData[0].i_node);$('#postContent').val(newDescription);$("#messageBox .postTitle").val(title);if(MyData[0].preview.trim()=="1"){$('#editChkPreview').prop('checked',true);}};channel.updateChannel=function(){if($("#channelName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}else{var channelName=$("#channelName").val();var channelDesc=$("#channelDesc").val();var isMandatory=0;var isPrivate=0;var isRSS=0;if($("#isMandatory").is(":checked")){isMandatory=1;}
if($("#isPrivate").is("checked")){isPrivate=1;}
var sc=new sd.ServerCall("EditDiscussion",0);var obj={};obj.i_node=$("#channelID").val();obj.f_node=channelInode;obj.discussionDesc=encodeURIComponent(channelDesc).replace(/'/g,"%27");obj.isMandatory=isMandatory;obj.isPrivate=isPrivate;obj.isRSS=isRSS;obj.discussionName=encodeURIComponent(channelName).replace(/'/g,"%27");obj.attachmentInode=channelAttachmentInode;sc.data(obj);sc.go({onSuccess:$.proxy(channel.populateChannels,this),onError:$.proxy(this.handleError,this)});sd.component.messageBox.close();}};channel.updateRSSChannel=function(){if($("#channelName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}else if($("#channelDesc").val()==""){sd.component.messageBox.showError("URL is a required field.");return;}else if(!(sd.Utils.isValidURLFormat($("#channelDesc").val()))){sd.component.messageBox.showError("URL appears to be an invalid format. Please update.");return;}else{var channelName=$("#channelName").val();var channelDesc=$("#channelDesc").val();var isMandatory=1;var isPrivate=0;var isRSS=1;if($("#isMandatory").is(":checked")){isMandatory=1;}
if($("#isPrivate").is("checked")){isPrivate=1;}
if($("#isRSS").is("checked")){isRSS=1;}
var sc=new sd.ServerCall("EditDiscussion",0);var obj={};obj.i_node=$("#channelID").val();obj.f_node=channelInode;obj.discussionDesc=encodeURIComponent(channelDesc).replace(/'/g,"%27");obj.isMandatory=isMandatory;obj.isPrivate=isPrivate;obj.isRSS=isRSS;obj.discussionName=encodeURIComponent(channelName).replace(/'/g,"%27");obj.attachmentInode=channelAttachmentInode;sc.data(obj);sc.go({onSuccess:$.proxy(channel.populateChannels,this),onError:$.proxy(this.handleError,this)});sd.component.messageBox.close();}};channel.updatePost=function(){if($("#postContent").val()==""||($("#messageBox .postTitle").is(':visible')&&$("#messageBox .postTitle").val()=="")){$("#messageBox .validation").html("Please enter a title and message.");$("#messageBox .validation").show();return;}
if($("#messageBox .postTitle").is(':visible')&&$("#messageBox .postTitle").val().length>100){$("#messageBox .validation").html("Title must be less than 100 characters.");("#messageBox .validation").show();return;}
var title=$("#messageBox .postTitle").val();var content=$("#postContent").val();var preview=0;if($('#editChkPreview').is(":checked")){preview=1;}
var i_node=$("#postID").val();selectedPost=$("#postID").val();var sc=new sd.ServerCall("EditComment",0);var obj={};obj.i_node=i_node;obj.preview=preview;obj.title=title;obj.description=encodeURIComponent(content).replace(/'/g,"%27");sc.data(obj);sc.go({onSuccess:$.proxy(channel.Success,this),onError:$.proxy(this.handleError,this)});sd.component.messageBox.close();$('.channelPost'+i_node+" .channel-post-title").html(title);$('#'+i_node).html(channel.formatEmbeddedLinks(content,i_node,preview).replace(/\n/g,"<br/>"));$.each($('#postList').find('li'),function(){if($(this).attr('data-id')==i_node){var cTop=$(this).offset().top;var cHeight=$(this).outerHeight(true);var windowTop=$(window).scrollTop();var visibleHeight=$(window).height();if(cTop<windowTop){$('body').animate({'scrollTop':cTop},'slow','swing');}else if(cTop+cHeight>windowTop+visibleHeight){$('body').animate({'scrollTop':cTop-visibleHeight+cHeight},'slow','swing');}else{$(window).scrollTop(cTop-visibleHeight+cHeight);}}});};channel.loadUserChannels=function(myData,status){var item;var htmlOut='';var i=0;for(i=0;i<myData.length;i++){item=myData[i];if(item.g==1){htmlOut+='<li class="global">'+decodeURIComponent(item.n)+'</li>';}else{htmlOut+='<li>'+decodeURIComponent(item.n)+'<button class="remove" onClick="channel.removeChannelFromUser('+item.i_node+');">X</button>  </li>';}}
$("#listUserChannels").append(htmlOut);};channel.removeChannelFromUser=function(channelID){var sc=new sd.ServerCall("RemoveChannelFromUser",0);var obj={};obj.channelID=channelID;sc.data(obj);sc.go(channel.addEditChannel);};channel.loadAvailableUsers=function(myData,status){var item;var htmlOut='';var i=0;for(i=0;i<myData.length;i++){item=myData[i];if(item.status!=1){htmlOut+='<option value="'+item.userID+'">'+item.f_nodeirstName+' '+item.lastName+'</li>';}}
$("#listUsersAndGroups").append(htmlOut);};channel.setChannelPermissions=function(MyData,status){channel.closeAddEditChannel();var creator;var inode;var creatorName;if(typeof MyData[0]==='undefined'){inode=MyData.inode;creator=MyData.creator;creatorName=MyData.creatorName;}else{inode=MyData[0].i_node;}
sd.component.permissionsForm.action({title:"Group - Manage Access - Creator/Admin: "+creatorName,inode:inode,useDialog:true,height:470,width:650,itemCreator:creator,populateNoAccess:false,saveCallback:$.proxy(channel.updateSaved,this)});};channel.updateSaved=function(){channel.addEditChannel();if(selectedChannel!=sd.Configuration.discussionRoot){channel.getDisplayChannelDetails(selectedChannel);}};channel.closeAddEditChannel=function(){$('#dvChannelContainer').empty();$('#dvChannelContainer').fadeOut();var fields=" discussionID AS i, discussionName AS n,  MetaData AS meta, accesslevel AS al ";channel.getChannelData(fields);};channel.addChannel=function(){if($("#channelName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}else{var channelName=$("#channelName").val();var channelDesc=$("#channelDesc").val();var isMandatory=0;var isPrivate=0;var isRSS=0;if($("#isMandatory").is(":checked")){isMandatory=1;}
var sc=new sd.ServerCall("AddDiscussion",0);var obj={};obj.f_node=channelInode;obj.discussionDesc=encodeURIComponent(channelDesc).replace(/'/g,"%27");obj.isPrivate=isPrivate;obj.isMandatory=isMandatory;obj.isRSS=isRSS;obj.discussionName=encodeURIComponent(channelName).replace(/'/g,"%27");obj.attachmentInode=channelAttachmentInode;sc.data(obj);sc.go({onSuccess:$.proxy(this.setChannelPermissions,this),onError:$.proxy(this.handleError,this)});}};channel.addRSSChannel=function(){if($("#channelName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}else if($("#channelDesc").val()==""){sd.component.messageBox.showError("Please Enter the URL");return;}else{var channelName=$("#channelName").val();var channelDesc=$("#channelDesc").val();var isMandatory=1;var isPrivate=0;var isRSS=1;var sc=new sd.ServerCall("AddDiscussion",0);var obj={};obj.f_node=channelInode;obj.discussionDesc=encodeURIComponent(channelDesc).replace(/'/g,"%27");obj.isPrivate=isPrivate;obj.isMandatory=isMandatory;obj.discussionName=encodeURIComponent(channelName).replace(/'/g,"%27");obj.attachmentInode=channelAttachmentInode;obj.isRSS=isRSS;sc.data(obj);sc.go({onSuccess:$.proxy(this.setChannelPermissions,this),onError:$.proxy(this.handleError,this)});}};channel.getDocIcon=function(fileFormat){var fmt=String(fileFormat).toLowerCase();if(fmt=='pdf'){return"pdf.png";}else if(fmt=='doc'||fmt=='docx'){return"doc.png";}else if(fmt=='ppt'||fmt=='pptx'){return"ppt.png";}else if(fmt=='xls'||fmt=='xlsx'||fmt=='xlb'||fmt=='xlsm'||fmt=='xltx'||fmt=='xlsb'){return"xls.png";}else if(fmt=='jpg'||fmt=='jpeg'||fmt=='png'||fmt=='gif'){return"image.png";}else if(fmt=='mp4'||fmt=='avi'||fmt=='wmv'||fmt=='mpg'||fmt=='mpeg'||fmt=='mov'||fmt=='rm'||fmt=='ram'||fmt=='flv'){return"movie.png";}else if(fmt=='zip'||fmt=='rar'){return"zip.png";}else if(fmt=='swf'){return"swf.png";}else{return"default.png";}};channel.handleError=function(error){sd.component.messageBox.action({title:"Action unavailable",height:110,text:error,btn1:"Ok",btn1Callback:function(){if(error=="Group ERROR: This group no longer exists."){LoadSection("mccann",true);}}});};channel.displayRSSChannel=function(url){$('#postList').empty();$('#dvChannelFilter').hide();$('#dvChannelPost').hide();$('#loader').css('display','flex');var sc=new sd.ServerCall("ReadRSS",0);var obj={};obj.url=url;sc.data(obj);sc.go({onSuccess:$.proxy(this.parseRSS,this),onError:$.proxy(this.handleError,this)});};channel.parseRSS=function(data){var htmlOut='';var title;var description;var pubDate;var link;var content;var i=0;$('#loader').css('display','flex');if(data.length==0){$('#postList').append("Uh oh, this RSS feed didn't load or has no content. <br>");$('#postList').append("Try refreshing by clicking <a class=\"admin-actions brand-color\" onClick='channel.getDisplayChannelDetails("+selectedChannel+")'>here.</a><br>");$('#postList').append("If you continue to have issues please email the portal admin: <a class=\"pro-mail brand-color\" href='mailto: "+sd.Configuration.csEmail+"'>"+sd.Configuration.csEmail+"</a>");$('#postList').show();return;}
for(i=0;i<data.length;i++){var item=data[i];title=item.Title;pubDate=new Date(parseInt(item.Published.substr(6))).toDateString();description=item.Description;content=item.Content;link=item.Url;htmlOut='<li>';htmlOut+='<ul id="channel-block-'+i+'"><li id="channel-item-'+i+'" class="channel-item"><div class="channelPost"><table class="rss"><tbody><tr>';htmlOut+='<td class="avatar" rowspan="3"><img class="circular" src="images/mccann/rss_small.png" style="display:inline; height:40px; width:40px;"/></td></tr>';htmlOut+='<tr><td><a class="heading" href="'+link+'">'+title+'</a><p>'+pubDate+'</p></td></tr><tr><td><p>'+content+'</p></td>';htmlOut+='</tr></tbody></table></div></li></ul>';htmlOut+='</li><hr class="no-reply-hr brand-channel-divider">';$('#postList').append(htmlOut);}
$('#postList').find('a').attr('target','_blank');$('#postList').show();$('#loader').fadeOut();};channel.getUserDetails=function(objdata){LoadSection("userProfile",true,objdata);};channel.replaceLinks=function(myData){var post=myData[0];if(post.d.split(' ').length>500){var newDesc=post.d.split(' ');post.d="";for(var i=0;i<500;i++){post.d+=newDesc[i]+" ";}}
linkStart=channel.findNextLink(post.d,0);linkEnd=channel.findLinkEnd(post.d,linkStart);linkString=post.d.substring(linkStart,linkEnd);var siteUrl="^"+window.location.protocol+"\/\/";siteUrl+=window.location.host+"*";var regex=new RegExp(siteUrl);if(linkString.match(regex)){var sLink=linkString.split('?');var sURLVariables=sLink[1].split('&');var inode=0;for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split('=');if(sParameterName[0]=="inode"){inode=sParameterName[1];}}
if(inode>0){var sc=new sd.ServerCall("GetJumpToDetails",0);var obj={};obj.i_node=inode;sc.data(obj);sc.go({onSuccess:function(myData,status){var item=myData[0].item;var replaceString=" <a href=\""+linkString+"\">"+item+"</a> ";post.d=post.d.replace(linkString,replaceString);channel.buildEmail(post);},onError:$.proxy(this.handleError,this)});}}else{var urlRegex=/(https?:\/\/[^\s]+)/g;post.d=post.d.replace(urlRegex," ");channel.buildEmail(post);}};channel.buildEmail=function(post){var urlRegex=/<a.*<\/a>/g;var url=window.location.protocol+"//";url+=window.location.host;url+=window.location.pathname;url+="?inode="+post.i;var adminURL=window.location.protocol+"//";adminURL+=window.location.host;adminURL+=window.location.pathname;adminURL+="?section=adminUserSettings&csID="+sd.Configuration.csid;emailSubject=sd.Configuration.csName+":  "+post.t;var bodyText=post.d;bodyText=bodyText.replace(/(?:\r\n|\r|\n)/g,'<br />');emailBody+=bodyText+"... ";emailBody+=" <br><br><a href='"+url+"'><h4>View Post</h4></a> <br>";emailBody+="View, comment on or like this post by clicking the above link<br><br><hr>";emailBody+="If you don’t want to receive these emails from Brand Lounge in the future, please go to User Settings under the<a href='"+adminURL+"'> Admin Tool </a>(look for the gear icon at the top right of the homepage) and unselect \"Receive System Email Alerts.\"";selectedChannel=$(".channel-add-post .channelPostList .selected").data('id');var obj={};obj.inode=selectedChannel;var sc=new sd.ServerCall("GetEmailList",0);sc.data(obj);sc.go({onSuccess:channel.sendEmail,onError:channel.handleError});};channel.sendEmail=function(myData,status){var recipientUsers=[];var recipientGroups=[];var i=0;for(i=0;i<myData.length;i++){var item=myData[i];if(!item.g&&sd.Session.user.superAdmin||admin.adminUser()){recipientUsers.push(item.id);}
else if(!item.g&&item.r){recipientUsers.push(item.id);}}
var obj={};obj.subject=emailSubject;obj.body=emailBody;obj.recipientUsers=recipientUsers;obj.recipientGroups=recipientGroups;if(selectedChannel==5958||selectedChannel==6592)
obj.emailFrom="RELEASES";else
obj.emailFrom="";obj.source="groups";var sc=new sd.ServerCall("SendEmail",0);sc.data(obj);sc.go({onSuccess:channel.emailSent,onError:channel.handleError});};channel.emailSent=function(){};channel.download=function(inodes){try{sd.Utils.downloadZip(inodes);}catch(err){sd.component.messageBox.action({title:"Error",width:"300",height:"180",text:"Your files could not be downloaded. Please try again later.",btn1:"OK"});}};channel.buildPostImage=function(cloneClass,objImage1,objImage2){var imrSrc="";var clone=$(".guide "+cloneClass).clone();if(cloneClass==".small-thumb-wrap"){if(sd.Utils.isVideo(objImage1.f)){imgSrc=sd.Utils.buildAssetSource({prefix:"imgC",inode:objImage1.i,format:objImage1.f,thumbSize:"lge",thumbType:"smallthumb",height:125,width:125,title:objImage1.n,videoSize:"thumb"});imgSrc+="<div class='vidOverlay'></div>";clone.find('.small-thumb').first().html(imgSrc);clone.find('.small-thumb').first().attr("data-inode",objImage1.i);clone.find('.small-thumb').first().removeClass("postImage").addClass("postVideo");clone.find('.small-thumb').first().removeAttr("href");}else{imgSrc=sd.Configuration.vault+"/"+objImage1.i+"/bigthumb.jpg";clone.find('.small-thumb').first().css({"background":"url("+imgSrc+") no-repeat","background-size":"cover"});clone.find('.small-thumb').first().attr("data-inode",objImage1.i);clone.find('.small-thumb').first().attr("href",imgSrc);clone.find('.small-thumb').first().attr("data-filename",objImage1.n);}
if(sd.Utils.isVideo(objImage2.f)){imgSrc=sd.Utils.buildAssetSource({prefix:"imgC",inode:objImage2.i,format:objImage2.f,thumbSize:"lge",thumbType:"smallthumb",height:125,width:125,title:objImage2.n,videoSize:"thumb"});imgSrc+="<div class='vidOverlay' ></div>";clone.find('.small-thumb').last().html(imgSrc);clone.find('.small-thumb').last().attr("data-inode",objImage2.i);clone.find('.small-thumb').last().removeClass("postImage").addClass("postVideo");clone.find('.small-thumb').last().removeAttr("href");}else{imgSrc=sd.Configuration.vault+"/"+objImage2.i+"/bigthumb.jpg";clone.find('.small-thumb').last().css({"background":"url("+imgSrc+") no-repeat","background-size":"cover"});clone.find('.small-thumb').last().attr("data-inode",objImage2.i);clone.find('.small-thumb').last().attr("href",imgSrc);clone.find('.small-thumb').last().attr("data-filename",objImage2.n);}}else{var imgSrc="";if(sd.Utils.isVideo(objImage1.f)){imgSrc=sd.Utils.buildAssetSource({prefix:"imgC",inode:objImage1.i,format:objImage1.f,thumbSize:"lge",thumbType:"smallthumb",height:250,width:250,title:objImage1.n,videoSize:"full"});imgSrc+="<div class='vidOverlay'></div>";clone.html(imgSrc);clone.attr("data-inode",objImage1.i);clone.removeClass("postImage").addClass("postVideo");clone.removeAttr("href");}else{imgSrc=sd.Configuration.vault+"/"+objImage1.i+"/bigthumb.jpg";clone.css({"background":"url("+imgSrc+")","background-size":"cover"});clone.attr("data-inode",objImage1.i);clone.attr("href",imgSrc);clone.attr("data-filename",objImage1.n);}}
return $('<div>').append(jQuery(clone)).html();};channel.saveUserChecklist=function(){var checkListItems=[]
var checkList="[]";$('.channelCheckbox').each(function(){if(this.checked){checkListItems.push(String($(this).val()));}});if(checkListItems.length>0)
checkList=""+checkListItems.join(", ");var obj={};obj.checkList=checkList;obj.f_node=channelInode;var sc=new sd.ServerCall("SaveChannelFilter",0);sc.data(obj);sc.go({onSuccess:function(){sd.component.messageBox.action({title:"Filters",text:"Your filter preferences have been saved.",btn1:"OK"});},onError:channel.handleError});}
window.channel=channel;}(window));﻿(function(window){var client={};client.currentSortDirection="";client.currentSortBy="";client.currentList=[];client.filteredList=[];client.itemsPerPage=20;client.totalPages=0;client.attributes=[];client.fnode=0;client.options={};client.pagingOptions={};client.type="";client.allUniqueMetaAttributes=[];client.allMetaAttributes=[];client.filteredMetaAttributes=[];client.appliedFilters=[];client.init=function(options){$("#loader").show();client.options=options;client.type=options.template;client.root=options.f_node;client.id=options.i_node||0;client.currentSortDirection="ASC";client.currentSortBy="sortname";client.currentList=[];client.filteredList=[];client.totalPages=0;client.currentPage=1;client.allUniqueMetaAttributes=[];client.filteredMetaAttributes=[];client.appliedFilters=[];client.allMetaAttributes=[];client.pagingOptions={};$("#clientExport_btn").hide();$("#clientImport_btn").hide();if(sd.Session.user.superAdmin==true||admin.adminUser()){$("#clientExport_btn").show();$("#clientImport_btn").show();}
waitUntilExists("ulTopNav"+client.root,function(){var title=$("#ulTopNav"+client.root).find('a').data("item");$('#spClientListTitle').html(title);});$('#clientContent .icon-chevron-up').hide();$('#clientContent .icon-chevron-down').hide();$('#clientContent #dvNameSort').click(function(){client.createList("sortname","");});$('#txtFilterClient').on('input',function(){client.currentPage=1;client.createList("sortname",null);});client.addEventListeners();client.setUpList();}
client.setUpList=function(){$("#loader").show();$("#dvClientList").empty();$("#dvClientHeaderPages").empty();$("#dvClientFooterPages").empty();var sc=new sd.ServerCall("ListClients");sc.data({fnode:client.root});sc.go({onSuccess:client.handleList,onError:client.handleError});}
client.handleList=function(myData,status){client.currentList=[];client.metaAttributes=[];client.allMetaAttributes=[];client.allUniqueMetaAttributes=[];$("#loader").hide();var obj={};var xmlMeta;for(var idx=0;idx<myData.length;idx++){var item={};xmlMeta=$.parseXML(myData[idx].m);item.id=myData[idx].i;item.fullname=$.trim(myData[idx].n);$("#loader").hide();$(xmlMeta).find("meta").each(function(){switch($(this).find("type").text()){case"firstName":item.fname=$(this).find("value").text();break;case"lastName":item.lname=$(this).find("value").text();break;case"country":obj={};if($(this).find("value").text()==""){obj.value="";item.country="";}
else{item.country=$(this).find("value").text();obj.value=item.country;}
item.countryid=-1;obj.type="country";obj.title="Country";obj.id=-1;client.allUniqueMetaAttributes.push(obj);obj.inode=item.id;client.allMetaAttributes.push(obj);break;case"city":obj={};if($(this).find("value").text()==""){obj.value="(Blank)";item.city="";}
else{item.city=$(this).find("value").text();obj.value=item.city;}
item.cityid=-1;obj.type="city";obj.title="City";obj.id=-1;client.allUniqueMetaAttributes.push(obj);obj.inode=item.id;client.allMetaAttributes.push(obj);break;case"email":item.email=$(this).find("value").text();break;case"officeNumber":item.phone=$(this).find("value").text();break;case"mobileNumber":item.mobile=$(this).find("value").text();break;case"company":item.company=$(this).find("value").text();break;}});item.sortname=item.lname+' '+item.fname;client.currentList.push(item);}
client.allUniqueMetaAttributes=sd.Utils.removeObjectArrayDuplicates(client.allUniqueMetaAttributes,"value");client.allUniqueMetaAttributes.sort(sd.Utils.dynamicSortMultiple("title","value"));for(var i=0;i<client.currentList.length;i++){for(var j=0;j<client.allUniqueMetaAttributes.length;j++){if((client.allUniqueMetaAttributes[j].type=="city")&&(client.currentList[i].city==client.allUniqueMetaAttributes[j].value)){client.currentList[i].cityid=j+1;client.allUniqueMetaAttributes[j].id=j+1;}
if((client.allUniqueMetaAttributes[j].type=="country")&&(client.currentList[i].country==client.allUniqueMetaAttributes[j].value)){client.currentList[i].countryid=j+1;client.allUniqueMetaAttributes[j].id=j+1;}
for(var k=0;k<client.allMetaAttributes.length;k++){if(client.allUniqueMetaAttributes[j].value==client.allMetaAttributes[k].value){client.allMetaAttributes[k].id=j+1;}}}}
client.buildFilterMenu();}
client.buildFilterMenu=function(){var item;var htmlOut="";var currentMetaType="";for(var idx=0;idx<client.allUniqueMetaAttributes.length;idx++){item=client.allUniqueMetaAttributes[idx];if(item.type!=currentMetaType){if(currentMetaType!="")htmlOut+="</div>";currentMetaType=item.type;htmlOut+="<h3> &nbsp; &nbsp; "+item.title+"</h3><div>";}
htmlOut+="<div class=\"accordion-menu\">";htmlOut+="<label class = \"filterText\" data-id=\""+item.id+"\" data-value=\""+item.value+"\" data-type=\""+item.type+"\">";htmlOut+="<input type=\"checkbox\" id=\"chk"+item.id+"\" value=\""+item.id+"\"/>"+item.value+"</label>";htmlOut+="</div>";}
$("#dvClientMetaFilters").empty();$("#dvClientMetaFilters").show();$("#dvClientMetaFilters").append("<div id=\"dvClientFilterAccordion\" class=\"accordion-menu\"></div>");$("#dvClientFilterAccordion").append(htmlOut);$("#dvClientFilterAccordion").accordion({heightStyle:"content",active:false,collapsible:true});$(".filterText").click(function(){var id=$(this).data('id');var type=$(this).data('type');var value=$(this).data('value');if($("#chk"+id).prop("checked")==true){var obj={};obj.id=id;obj.type=type;obj.value=value;client.appliedFilters.push(obj);}
else{client.removeFilterFromArray(id)}
client.currentPage=1;client.createList("sortname",null);});client.createList("sortname",null);}
client.createList=function(sortBy,sortDirection){client.filterData();var listCount=client.filteredList.length;var countHeader="&nbsp;FOUND "+listCount;if(listCount==1)
countHeader+=" RESULT";else
countHeader+=" RESULTS";$("#dvClientCount").html(countHeader);client.pagingOptions={prev_text:"<i class=\"icon-double-angle-left\"></i> Prev",next_text:"Next <i class=\"icon-double-angle-right\"></i>",num_display_entries:9,current_page:client.currentPage-1,num_edge_entries:1,callback:client.changePage,items_per_page:client.itemsPerPage}
var endIndex=(client.currentPage)*client.itemsPerPage;var startIndex=endIndex-client.itemsPerPage;if(endIndex>listCount)endIndex=listCount;if(sortDirection!=null){if(client.currentSortBy==sortBy){if(sortDirection!=client.currentSortDirection){if(client.currentSortDirection=="ASC")client.currentSortDirection="DESC";else client.currentSortDirection="ASC";}}
else{client.currentSortBy=sortBy;client.currentSortDirection=sortDirection||"ASC";}}
if(client.currentSortBy=="sortname")sd.Utils.sortArrayByString(client.filteredList,"sortname");$('#clientContent .icon-chevron-up').hide();$('#clientContent .icon-chevron-down').hide();var sortArrow="icon-chevron-up";if(client.currentSortDirection=="DESC")sortArrow="icon-chevron-down";$('#clientContent .'+sortArrow).show();$("#dvClientList").empty();client.totalPages=Math.ceil(listCount/client.itemsPerPage);$("#dvClientHeaderPages").empty();$("#dvClientFooterPages").empty();if(client.totalPages>1){$("#dvClientHeaderPages").pagination(listCount,client.pagingOptions);$("#dvClientFooterPages").pagination(listCount,client.pagingOptions);}
var fragmentWrap=document.createDocumentFragment();$(".guide .teamGuideList .list-wrap").clone().appendTo(fragmentWrap);$("#dvClientList").empty().show();$("#dvClientList").html(fragmentWrap);$("#dvClientList").foundation();$("#dvClientList").addClass("list-tbl");var fragmentTeam=document.createDocumentFragment();var cloneTeam;$("#dvClientListHeader").show();var display="";for(var idx=startIndex;idx<endIndex;idx++){var item=client.filteredList[idx];if(client.currentSortDirection=="DESC")item=client.filteredList[client.filteredList.length-(idx+1)];cloneTeam=$(".guide .teamGuideList .user-list").clone().appendTo(fragmentTeam);cloneTeam.find(".pic-list").remove();cloneTeam.find(".list-username").addClass("list-table-top");cloneTeam.find(".list-username").html(item.fullname);cloneTeam.find(".job-title").remove();cloneTeam.find(".department").remove();cloneTeam.find(".description").remove();if(item.city!=undefined&&item.city!="")
cloneTeam.find(".city").html(item.city);else
cloneTeam.find(".city").html("&nbsp;");if(item.country!=undefined&&item.country!="")
cloneTeam.find(".country").html(item.country);else
cloneTeam.find(".country").html("&nbsp;");if(item.phone.trim()!=""){cloneTeam.find(".phone-list").show();cloneTeam.find(".phone-list").attr("title",item.phone);}
if(item.mobile.trim()!=""){cloneTeam.find(".mobile-list").show();cloneTeam.find(".mobile-list").attr("title",item.mobile);}
if(item.email.trim()!=""){cloneTeam.find(".mail-list").show();cloneTeam.find(".mail-list").attr("title",item.email);cloneTeam.find(".mail-list").unbind("click").bind("click",function(event){window.location="mailto:"+item.email;});}}
$("#dvClientList .list-wrap").empty().show();$("#dvClientList .list-wrap").html(fragmentTeam);$("#dvClientList .list-wrap").foundation();}
client.filterData=function(){for(var k=0;k<client.allUniqueMetaAttributes.length;k++)
$("#chk"+client.allUniqueMetaAttributes[k].id).prop("checked",false);$("#dvClientSelectedMetaFilters").empty();var html="";var filterData=[];var listCount=client.currentList.length;var item;var filterText=$('#txtFilterClient').val().toLowerCase();client.filteredList=[];client.filteredMetaAttributes=[];if(client.appliedFilters.length>0||filterText!="")
$("#clientReset_btn").show();if(client.appliedFilters.length==0&&filterText=="")
$("#clientReset_btn").hide();for(var k=0;k<client.appliedFilters.length;k++){item=client.appliedFilters[k];if(k==0)html="Selected Filters: <br>";html+="<i class=\"icon-remove-sign\" title=\"Remove Filter\" onClick=\"client.removeFilterFromPanel("+item.id+")\"></i><label onClick=\"client.removeFilterFromPanel("+item.id+")\">";html+=" "+item.value;html+="</label><br>";$("#chk"+item.id).prop("checked",true);if(filterData[client.appliedFilters[k].type]==undefined)
filterData[client.appliedFilters[k].type]=[];filterData[client.appliedFilters[k].type].push(client.appliedFilters[k]);}
$("#dvClientSelectedMetaFilters").html(html);var arrUniqueTypes=sd.Utils.removeObjectArrayDuplicates(client.appliedFilters,"type");var uniqueTypes=arrUniqueTypes.length;for(var idx=0;idx<listCount;idx++){var match=false;item=client.currentList[idx];if(filterText!=""&&item.fullname.toLowerCase().indexOf(filterText)<0)continue;if(client.appliedFilters.length==0){match=true;}
else{var matchCount=0;var typeMatch;if(Object.keys(filterData).length>0){var filter;for(var key in filterData){typeMatch=false;for(var i=0;i<filterData[key].length;i++){filter=filterData[key][i];for(var j=0;j<client.allMetaAttributes.length;j++){if((client.allMetaAttributes[j].inode==item.id)&&(client.allMetaAttributes[j].id==filter.id)){matchCount++;typeMatch=true;break;}}
if(typeMatch==true)break;}}
if(matchCount==uniqueTypes)match=true;}}
if(!match)continue;for(var i=0;i<client.allMetaAttributes.length;i++){if(item.id==client.allMetaAttributes[i].inode){var obj={};obj.id=client.allMetaAttributes[i].inode;obj.value=client.allMetaAttributes[i].value;obj.type=client.allMetaAttributes[i].type;client.filteredMetaAttributes.push(obj);}}
client.filteredList.push(item);}}
client.changePage=function(newPage){client.currentPage=newPage+1;client.createList("sortname",null);}
client.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:100,text:error,btn1:"Ok"});}
client.addEventListeners=function(){$("#clientReset_btn").bind("click",function(){client.appliedFilters=[];$('#clientFilterText').val("");client.currentPage=1;client.createList("sortname",null);$("#clientReset_btn").hide();});$("#clientReset_btn").hide();$("#clientExport_btn").bind("click",function(){var now=new Date().getTime();var url=sd.Configuration.ws+"/ExcelExport.aspx?report=ClientExport&fnode="+client.root+"&timestamp="+now;window.open(url);});$("#clientImport_btn").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'uploadType':'client','onComplete':client.uploadComplete,'onError':client.handleError});});}
client.uploadComplete=function(myData,status){var extension=myData[0].name.substr((myData[0].name.lastIndexOf('.')+1));if(sd.Utils.isExcel(extension)==false){client.handleError("Client imports must have a .xls or .xlsx extension. Please choose another file.");return;}
sd.component.messageBox.action({title:"Client Import",height:150,text:"Importing client data from excel. Please wait. This can take up to 2 or 3 minutes depending on the size of the data import. "});var sc=new sd.ServerCall("HandleImportFile");sc.data({filename:myData[0].name,fnode:client.root});sc.go({onSuccess:client.importComplete,onError:client.handleError});}
client.importComplete=function(myData,status){sd.component.messageBox.action({title:"Client Import",height:150,text:"Client import complete. The list will automatically reload/refresh.",btn1:"Ok"});client.setUpList();}
client.removeFilterFromPanel=function(id){client.currentPage=1;client.removeFilterFromArray(id);client.createList("sortname",null);}
client.removeFilterFromArray=function(id){for(var j=0;j<client.appliedFilters.length;j++){if(client.appliedFilters[j].id==id){client.appliedFilters.splice(j,1);break;}}}
window.client=client;}(window));﻿"use strict";(function(window){var collabSpaces={};collabSpaces.selectedItem=null;collabSpaces.currentSortDirection="";collabSpaces.currentSortBy="";collabSpaces.currentList=[];collabSpaces.selectedID=0;collabSpaces.selectedItem={};collabSpaces.noAccessList=[];collabSpaces.viewAccessList=[];collabSpaces.adminAccessList=[];collabSpaces.globalSearchList=[];collabSpaces.init=function(){collabSpaces.selectedItem=null;collabSpaces.currentSortDirection="ASC";collabSpaces.currentSortBy="name";collabSpaces.currentList=[];collabSpaces.selectedID=0;collabSpaces.selectedItem={};collabSpaces.noAccessList=[];collabSpaces.viewAccessList=[];collabSpaces.adminAccessList=[];collabSpaces.globalSearchList=[];$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleName').click(function(){collabSpaces.displayList("name")});$('#sectionContainer .sectionTitleOwner').click(function(){collabSpaces.displayList("owner")});$('#sectionContainer .sectionTitleDate').click(function(){collabSpaces.displayList("datesort")});$('#sectionContainer .sectionTitleStatus').click(function(){collabSpaces.displayList("status")});$('#csFilterText').on('input',function(){collabSpaces.displayList(collabSpaces.currentSortBy,collabSpaces.currentSortDirection);});collabSpaces.addEventListeners();collabSpaces.listItems();}
collabSpaces.listItems=function(){$("#loader").show();$("#dvCSList").empty();collabSpaces.selectedItem=null;var sc=new sd.ServerCall("ListCollabSpaces");sc.go({onSuccess:collabSpaces.handleList,onError:collabSpaces.handleError});}
collabSpaces.handleList=function(myData,status){$("#loader").hide();collabSpaces.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.id=myData[idx].i;item.name=myData[idx].n;item.owner=myData[idx].o;item.status=myData[idx].s;item.date=sd.Utils.formatDate(myData[idx].dc,"dd mmm yy");item.datesort=myData[idx].dc;item.pending=myData[idx].p;collabSpaces.currentList.push(item);}
collabSpaces.displayList(collabSpaces.currentSortBy,collabSpaces.currentSortDirection);}
collabSpaces.displayList=function(sortBy,sortDirection){if(collabSpaces.currentSortBy==sortBy){if(sortDirection!=collabSpaces.currentSortDirection){if(collabSpaces.currentSortDirection=="ASC")collabSpaces.currentSortDirection="DESC";else collabSpaces.currentSortDirection="ASC";}}
else{collabSpaces.currentSortBy=sortBy;collabSpaces.currentSortDirection=sortDirection||"ASC";}
if(collabSpaces.currentSortBy=="name")sd.Utils.sortArrayByString(collabSpaces.currentList,"name");if(collabSpaces.currentSortBy=="owner")sd.Utils.sortArrayByString(collabSpaces.currentList,"owner");if(collabSpaces.currentSortBy=="datesort")sd.Utils.sortArrayByDate(collabSpaces.currentList,"datesort");if(collabSpaces.currentSortBy=="status")sd.Utils.sortArrayByString(collabSpaces.currentList,"status");$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(collabSpaces.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(collabSpaces.currentSortBy=="name")$('#sectionContainer .sectionTitleName > .'+sortArrow).show();if(collabSpaces.currentSortBy=="owner")$('#sectionContainer .sectionTitleOwner > .'+sortArrow).show();if(collabSpaces.currentSortBy=="datesort")$('#sectionContainer .sectionTitleDate > .'+sortArrow).show();if(collabSpaces.currentSortBy=="status")$('#sectionContainer .sectionTitleStatus > .'+sortArrow).show();var htmlOut="";var listCount=collabSpaces.currentList.length;var filterText=$('#csFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=collabSpaces.currentList[idx];if(collabSpaces.currentSortDirection=="DESC")item=collabSpaces.currentList[listCount-(idx+1)];if(filterText!=""&&item.name.toLowerCase().indexOf(filterText)<0)continue;if((item.status=="disabled"||item.status=="inactive")&&$("#csStatusChk").is(':checked')==false)
continue;else if(item.status=="active"&&$("#csStatusChk").is(':checked')==true)
continue;htmlOut+="<div class='row grid' data-csname='"+item.name+"' data-csid='"+item.id+"' >";htmlOut+="                <div class='yui3-u-1-5 pa-l-1'><div class='section-list-field'>"+item.name+"</div></div>";htmlOut+="                <div class='yui3-u-1-5'><div class='section-list-field'>"+item.status+"</div></div>";htmlOut+="                <div class='yui3-u-1-5'><div class='section-list-field'>"+item.owner+"</div></div>";htmlOut+="                <div class='yui3-u-1-5'><div class='section-list-field'>"+item.date+"</div></div>";htmlOut+="                <div class='yui3-u-1-5'><div class='section-list-field'>";if(item.pending>0)
htmlOut+="                <button class='small-rnd brand ma-r-half accessCS' style=\"background-color:red\"><i class='icon-flag'></i></button>";else
htmlOut+="                <button class='small-rnd brand ma-r-half accessCS'><i class='icon-group'></i></button>";htmlOut+="                <button class='small-rnd brand ma-r-half editCS'><i class='icon-edit'></i></button>";htmlOut+="                </div></div>";htmlOut+="            </div>";}
$('#dvCSList').html(htmlOut);$(".accessCS").click(function(){var csID=$(this).parent().parent().parent().data('csid');var csName=$(this).parent().parent().parent().data('csname');collabSpaces.editCSAccess({id:csID,name:csName});});$(".editCS").click(function(){var csID=$(this).parent().parent().parent().data('csid');collabSpaces.selectedID=csID;collabSpaces.showDetailsDialog();});}
collabSpaces.editCSAccess=function(objCS){collabSpaces.selectedItem=objCS;sd.component.messageBox.action({title:collabSpaces.selectedItem.name+" Portal Access",width:900,height:900,loadCallback:function(){$("#csDialogID").val(collabSpaces.selectedItem.id);$("#tabs").tabs();$("#portalSaveAccess_btn").show();$('#tab2').bind("click",function(){sd.component.messageBox.showError("");sd.component.messageBox.showMessage("");});$('#tab1').bind("click",function(){sd.component.messageBox.showError("");sd.component.messageBox.showMessage("");});var sc=new sd.ServerCall("ListCollabSpaceAccess");sc.data({csID:collabSpaces.selectedItem.id});sc.go({onSuccess:collabSpaces.handleAccessData,onError:collabSpaces.handleError});},template:sd.Configuration.templates.csAccess});}
collabSpaces.handleAccessData=function(myData,status){var permissions=myData[0];var accessRequests=myData[1];collabSpaces.populateAccessRequests(accessRequests);collabSpaces.populatePermissions(permissions);collabSpaces.setUpAddUsers();}
collabSpaces.populateAccessRequests=function(accessRequests){var listCount=accessRequests.length;var filterText=$('#csAccessFilterText').val().toLowerCase();var htmlOut="";for(var idx=0;idx<listCount;idx++){var item=accessRequests[idx];if(item.status!='pending')continue;if(filterText!=""&&item.firstname.toLowerCase().indexOf(filterText)<0&&item.lastname.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<div class='row grid grid-request-list' data-uid='"+item.userid+"' >";htmlOut+="<div class='yui3-u-1-5'><div class='section-list-field'>"+item.firstname+"</div></div>";htmlOut+="<div class='yui3-u-1-5'><div class='section-list-field'>"+item.lastname+"</div></div>";htmlOut+="<div class='yui3-u-1-5'><div class='section-list-field' title='"+item.email+"'>"+item.email+"</div></div>";htmlOut+="<div class='yui3-u-1-5'><div class='section-list-field'>"+sd.Utils.formatDate(item.lastmodifiedtime)+"</div></div>";htmlOut+="<div class='yui3-u-1-5'><div class='section-list-field'>";htmlOut+="<button class='admin-admins-btn approve access-request-btn'> Approve</button>";htmlOut+="<button class='admin-admins-btn reject access-request-btn'> Reject</button>";htmlOut+="</div></div>";htmlOut+="</div>";}
if(htmlOut=="")htmlOut="<h6 class='text-center'>No pending requests</h6>";$('#userAccessRequestList').html(htmlOut);$('#csAccessFilterText').unbind().bind('input',function(){collabSpaces.populateAccessRequests(accessRequests);});$('#csAccessExport_btn').unbind().bind('click',function(){var now=new Date().getTime();var url=sd.Configuration.ws+"/ExcelExport.aspx?report=AccessRequestLogExport&csid="+collabSpaces.selectedItem.id+"&timestamp"+now;window.open(url);});$('.approve').unbind().bind('click',function(){var sc=new sd.ServerCall("ApproveUserRequest");var obj={};obj.uid=$(this).closest('.grid-request-list').data("uid");obj.csID=collabSpaces.selectedItem.id;sc.data(obj);sc.go({onSuccess:function(myData,status){var details=myData[0];var options={};options.users=[details.userID];options.groups=[];options.source="userupdate";options.subject="Brand Lounge Access Approved";options.body="";options.callback=collabSpaces.listItems;var url=window.location.protocol+"//";url+=window.location.host;url+=window.location.pathname;url+="?csid="+details.portalID;options.body="<p>Your access to the "+details.csname+" Brand Lounge has been approved.</p><br>";options.body+="<p>Follow this link to login:</p>";options.body+="<p><a href=\""+url+"\">The Brand Lounge</a></p><br>";options.body+="<p>Don’t forget to upload a photo and hope you enjoy!</p>"
sd.component.messageBox.action({title:"Send Email",width:800,height:600,template:sd.Configuration.templates.sendEmail,loadCallback:function(){sendEmail.init(options);}});},onError:collabSpaces.handleError});});$('.reject').unbind().bind('click',function(){var sc=new sd.ServerCall("RejectUserRequest");var obj={};obj.uid=$(this).closest('.grid-request-list').data("uid");obj.csID=collabSpaces.selectedItem.id;sc.data(obj);sc.go({onSuccess:function(myData,status){var details=myData[0];var options={};options.users=[details.userID];options.groups=[];options.source="userupdate";options.subject="Brand Lounge Access Rejected";options.body="";options.callback=collabSpaces.listItems;options.body="Dear "+details.FullName+": <br> You recently requested access to the "+details.csname+" Brand Lounge. ";options.body+="Client security requires we validate all user requests. Please advise what work you perform with "+details.csname+" and please cc: ";options.body+="your supervisor on the return email. We are happy to grant you access upon the reception of this email. <br>";options.body+="Best, "+sd.Session.user.FullName;sd.component.messageBox.action({title:"Send Email",width:800,height:600,template:sd.Configuration.templates.sendEmail,loadCallback:function(){sendEmail.init(options);}});},onError:collabSpaces.handleError});});}
collabSpaces.populatePermissions=function(permissions){var noAccess="";var viewAccess="";var adminAccess="";var item;var image="images/selectList/user.png";var sort="";collabSpaces.noAccessList=[];collabSpaces.viewAccessList=[];collabSpaces.adminAccessList=[];for(var idx=0;idx<permissions.length;idx++){item=permissions[idx];switch(item.a){case 1:viewAccess+="<li data-sort = \""+item.n+"\" data-id=\""+item.i+"\"><img src=\""+image+"\" />"+item.n+"</li>";collabSpaces.viewAccessList.push(item);break;case 3:adminAccess+="<li data-sort = \""+item.n+"\" data-id=\""+item.i+"\"><img src=\""+image+"\" />"+item.n+"</li>";collabSpaces.adminAccessList.push(item);break;default:collabSpaces.noAccessList.push(item);break;}}
$("#ulNoAccess").selectable();$("#ulAdminAccess").append(adminAccess).selectable();$("#ulViewAccess").append(viewAccess).selectable();$("#btnAddViewer").bind("click",function(){collabSpaces.moveItem("#ulNoAccess","add","view");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulNoAccess","#ulViewAccess");});$("#btnRemoveViewer").bind("click",function(){collabSpaces.moveItem("#ulViewAccess","remove","view");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulViewAccess","#ulNoAccess");});$("#btnAddAdmin").bind("click",function(){collabSpaces.moveItem("#ulNoAccess","add","admin");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulNoAccess","#ulAdminAccess");});$("#btnRemoveAdmin").bind("click",function(){collabSpaces.moveItem("#ulAdminAccess","remove","admin");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulAdminAccess","#ulNoAccess");});$('#noAccessFilterText').on('input',function(){collabSpaces.displayNoAccessList();});$('#viewAccessFilterText').on('input',function(){collabSpaces.displayViewAccessList();});$('#adminAccessFilterText').on('input',function(){collabSpaces.displayAdminAccessList();});$('#portalSaveAccess_btn').unbind().bind('click',function(){collabSpaces.updateCollabAccess();});}
collabSpaces.setUpAddUsers=function(){$("#portalAdminGlobalSearch_btn").bind("click",function(){var globalString=$('#txtPortalAdminGlobalSearch').val();if(globalString==""){sd.component.messageBox.showError("Please enter a search term before running a search.");return;}
var arrTemp=globalString.split(" ");if(arrTemp[0].length<2){sd.component.messageBox.showError("Your first search term '"+arrTemp[0]+"' must be greater than 1 character.");return;}
if(arrTemp.length>1){if(arrTemp[1].length<2){sd.component.messageBox.showError("Your second search term '"+arrTemp[1]+"' must be greater than 1 character.");return;}}
collabSpaces.runAdminGlobalSearch(globalString);});$(".js-csaloader").fadeOut();}
collabSpaces.moveItem=function(container,type,level){var itemsSelected=$(container).children(".ui-selected");var item;for(var idx=0;idx<itemsSelected.length;idx++){item=itemsSelected[idx];if(type=="add"){for(var i=0;i<collabSpaces.noAccessList.length;i++){if(item.getAttribute('data-id')==collabSpaces.noAccessList[i].i){collabSpaces.noAccessList.splice(i,1);var id=item.getAttribute('data-id');var name=item.innerText;if(level=="view")
{collabSpaces.viewAccessList.push({a:1,i:id,n:name});sd.Utils.sortArrayByString(collabSpaces.viewAccessList,"n")}
else
{collabSpaces.adminAccessList.push({a:1,i:id,n:name});sd.Utils.sortArrayByString(collabSpaces.adminAccessList,"n")}}}}
else if(type=="remove"&&level=="view"){for(var i=0;i<collabSpaces.viewAccessList.length;i++){if(item.getAttribute('data-id')==collabSpaces.viewAccessList[i].i){collabSpaces.viewAccessList.splice(i,1);var id=item.getAttribute('data-id');var name=item.innerText;collabSpaces.noAccessList.push({a:1,i:id,n:name});sd.Utils.sortArrayByString(collabSpaces.noAccessList,"n")}}}
else{for(var i=0;i<collabSpaces.adminAccessList.length;i++){if(item.getAttribute('data-id')==collabSpaces.adminAccessList[i].i){collabSpaces.adminAccessList.splice(i,1);var id=item.getAttribute('data-id');var name=item.innerText;collabSpaces.noAccessList.push({a:1,i:id,n:name});sd.Utils.sortArrayByString(collabSpaces.noAccessList,"n")}}}}}
collabSpaces.displayNoAccessList=function(){var listCount=collabSpaces.noAccessList.length;var filterText=$('#noAccessFilterText').val().toLowerCase();var htmlOut="";var image="images/selectList/user.png";for(var idx=0;idx<listCount;idx++){var item=collabSpaces.noAccessList[idx];if(filterText!=""&&item.n.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<li data-sort = \""+item.n+"\" data-id=\""+item.i+"\"><img src=\""+image+"\" />"+item.n+"</li>";}
$("#ulNoAccess").html(htmlOut);}
collabSpaces.displayViewAccessList=function(){var listCount=collabSpaces.viewAccessList.length;var filterText=$('#viewAccessFilterText').val().toLowerCase();var htmlOut="";var image="images/selectList/user.png";for(var idx=0;idx<listCount;idx++){var item=collabSpaces.viewAccessList[idx];if(filterText!=""&&item.n.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<li data-sort = \""+item.n+"\" data-id=\""+item.i+"\"><img src=\""+image+"\" />"+item.n+"</li>";}
$("#ulViewAccess").html(htmlOut);}
collabSpaces.displayAdminAccessList=function(){var listCount=collabSpaces.adminAccessList.length;var filterText=$('#adminAccessFilterText').val().toLowerCase();var htmlOut="";var image="images/selectList/user.png";for(var idx=0;idx<listCount;idx++){var item=collabSpaces.adminAccessList[idx];if(filterText!=""&&item.n.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<li data-sort = \""+item.n+"\" data-id=\""+item.i+"\"><img src=\""+image+"\" />"+item.n+"</li>";}
$("#ulAdminAccess").html(htmlOut);}
collabSpaces.updateCollabAccess=function(){var arrAdminAccess=[];var arrViewAccess=[];var li;$.each(collabSpaces.viewAccessList,function(index,value){arrViewAccess.push(value.i);})
$.each(collabSpaces.adminAccessList,function(index,value){arrAdminAccess.push(value.i);})
var obj={};obj.csID=$("#csDialogID").val();obj.viewAccess=arrViewAccess.join(";");obj.adminAccess=arrAdminAccess.join(";");var sc=new sd.ServerCall("UpdateCollabSpaceAccess");sc.data(obj);sc.go({onSuccess:collabSpaces.refreshList,onError:collabSpaces.handleFormError});}
collabSpaces.deletedConfirmed=function(){var obj={};obj.csID=collabSpaces.selectedItem.id;var sc=new sd.ServerCall("DisableCollabSpace");sc.data(obj);sc.go({onSuccess:collabSpaces.refreshList,onError:collabSpaces.handleFormError});}
collabSpaces.showDetailsDialog=function(){if(collabSpaces.selectedID==0){collabSpaces.populateForm();}
else{var sc=new sd.ServerCall("GetCollabSpaceDetails");sc.data({id:collabSpaces.selectedID});sc.go({onSuccess:collabSpaces.populateForm,onError:collabSpaces.handleError});}}
collabSpaces.populateForm=function(myData,status){var action="Update Portal Instance";if(collabSpaces.selectedID==0)
action="Create New Portal Instance";sd.component.messageBox.action({title:action,height:650,width:1200,bodyClass:"collab-space",template:sd.Configuration.templates.csDetails,loadCallback:function(){$(".ico-info").tooltip();var bestCaseRoot=0;if(collabSpaces.selectedID>0){var item=myData[0];collabSpaces.selectedItem=item;bestCaseRoot=item.libraryRoot;$("#txtCollabTitle").val(item.CS_Name);$("#spPortalLogo").html(item.logo);var numBackgrounds=3;item.homepageCarousel=true;var xmlMeta=$.parseXML(item.metaData);$(xmlMeta).find("meta").each(function(){switch($(this).find("label").text()){case"numBackgrounds":numBackgrounds=3
break;case"background0":$("#spPortalBackground1").html($(this).find("value").text());break;case"background1":$("#spPortalBackground2").html($(this).find("value").text());break;case"background2":$("#spPortalBackground3").html($(this).find("value").text());break;case"bestcase0":$("#title1").val($(this).find("value").text());break;case"bestcase1":$("#title2").val($(this).find("value").text());break;case"bestcase2":$("#title3").val($(this).find("value").text());break;case"itemlink0":$("#link1").val($(this).find("value").text());break;case"itemlink1":$("#link2").val($(this).find("value").text());break;case"itemlink2":$("#link3").val($(this).find("value").text());break;}});if(numBackgrounds=="1")
{$('#trBackground2').hide();$('#trBackground3').hide();$("#bestcase2").hide();$("#itemLink2").hide();$("#bestcase3").hide();$("#itemLink3").hide();$("#spPortalBackground1").html(item.backgroundImage);}
$("input[name=rdoBackground][value=\""+numBackgrounds+"\"]").prop('checked',true);$("#spPortalSkin").html(item.cssSkin);$("#cboPortalTheme").val(item.cssTheme);if(item.status=="active")
$("input[name=rdoCollabStatus][value=\"active\"]").prop('checked',true);else
$("input[name=rdoCollabStatus][value=\"disabled\"]").prop('checked',true);$("#txtCollabContact").val(item.contact);$("#txtCollabContactEmail").val(item.email);$("#txtCollabBestCaseEmail").val(item.bcEmail);$("#chkHomepagePosting").prop("checked",item.homepagePosting);$("#chkCarousel").prop("checked",item.homepageCarousel);$("#messageBox .js_egnyteDomain").val(item.egnyteDomain);$("#toolStackLink1").val(item.toolStackLink);$("#toolStackTitle1").val(item.toolStackTitle);if(item.quickLinks!=undefined){collabSpaces.populateQuickLinks(item.quickLinks);}}
else{$("#spPortalSkin").html("default.css");$("input[name=rdoCollabStatus][value=\"active\"]").prop('checked',true);$("input[name=rdoBackground][value=\"3\"]").prop('checked',true);$("#messageBox .js_egnyteDomain").val(sd.Configuration.defaultEgnyteDomain);}
$("#btnPortalLogo").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'uploadType':'logo','onComplete':collabSpaces.uploadLogoComplete,'onError':collabSpaces.handleFormError});});$("#btnPortalBackground1").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'uploadType':'background','onComplete':collabSpaces.uploadBg1Complete,'onError':collabSpaces.handleFormError});});$("#btnPortalBackground2").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'uploadType':'background','onComplete':collabSpaces.uploadBg2Complete,'onError':collabSpaces.handleFormError});});$("#btnPortalBackground3").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'uploadType':'background','onComplete':collabSpaces.uploadBg3Complete,'onError':collabSpaces.handleFormError});});$("#btnPortalSkin").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'uploadType':'theme','onComplete':collabSpaces.uploadSkinComplete,'onError':collabSpaces.handleFormError});});$("#btnPortalSkinReset").bind("click",function(){$("#spPortalSkin").html('default.css');});$("#btnSkinDownload").bind("click",function(){var url=sd.Configuration.ws.replace("ws","")+'css/mccann/skin/default.css';window.open(url);});$("input[name=rdoBackground][value=\"1\"]").bind("click",function(){$("#trBackground2").hide();$("#trBackground3").hide();$("#bestcase2").hide();$("#bestcase3").hide();$("#itemLink2").hide();$("#itemLink3").hide();});$("input[name=rdoBackground][value=\"3\"]").bind("click",function(){$("#trBackground2").show();$("#trBackground3").show();$("#bestcase2").show();$("#bestcase3").show();$("#itemLink2").show();$("#itemLink3").show();});$("input[name=rdoCollabStatus][value=\"disabled\"]").bind("click",function(){$('#csWarning').css("color","red");});$("input[name=rdoCollabStatus][value=\"active\"]").bind("click",function(){$('#csWarning').css("background-color","");});$(".remove-link").unbind("click");$(".js-background-btns button").css("width","30px");$(".remove-link").unbind("click");$("#removeBackground1").bind("click",function(){$("#title1").val("");$("#link1").val("");$("#spPortalBackground1").val("");$("#spPortalBackground1").text("");});$("#removeBackground2").bind("click",function(){$("#title2").val("");$("#link2").val("");$("#spPortalBackground2").val("");$("#spPortalBackground2").text("");});$("#removeBackground3").bind("click",function(){$("#title3").val("");$("#link3").val("");$("#spPortalBackground3").val("");$("#spPortalBackground3").text("");});$("#addQuickLink").unbind("click").bind("click",function(){var fragment=document.createDocumentFragment();var clone=$(".guide .quickLinkRow").clone().appendTo(fragment);$(".quicklinks").append(fragment);collabSpaces.addQuickLinkListeners();});},btn1callback:$.proxy(collabSpaces.csSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
collabSpaces.uploadLogoComplete=function(myData,status){if(myData[0].valid==false){collabSpaces.handleFormError(myData[0].failReason);}
else{$(".messagebox-error").hide();$("#spPortalLogo").html(myData[0].name);}}
collabSpaces.uploadQuickLinkComplete=function(myData,status){var row=$(".qluploading");if(myData[0].valid==false){collabSpaces.handleFormError(myData[0].failReason);}
else{$(".messagebox-error").hide();$(row).find(".js-lki").val(myData[0].name);}}
collabSpaces.uploadBg1Complete=function(myData,status){if(myData[0].valid==false){collabSpaces.handleFormError(myData[0].failReason);}
else{$(".messagebox-error").hide();$("#spPortalBackground1").html(myData[0].name);}}
collabSpaces.uploadBg2Complete=function(myData,status){if(myData[0].valid==false){collabSpaces.handleFormError(myData[0].failReason);}
else{$(".messagebox-error").hide();$("#spPortalBackground2").html(myData[0].name);}}
collabSpaces.uploadBg3Complete=function(myData,status){if(myData[0].valid==false){collabSpaces.handleFormError(myData[0].failReason);}
else{$(".messagebox-error").hide();$("#spPortalBackground3").html(myData[0].name);}}
collabSpaces.uploadSkinComplete=function(myData,status){if(myData[0].valid==false){collabSpaces.handleFormError(myData[0].failReason);}
else{$(".messagebox-error").hide();$("#spPortalSkin").html(myData[0].name);}}
collabSpaces.csSave=function(error){var errString="";if($("#txtCollabTitle").val()=="")
errString="Name, ";if($("#spPortalLogo").text()=="")
errString+="Logo, ";var numBackgrounds=3;if($("#spPortalBackground1").text()==""&&$("#spPortalBackground2").text()==""&&$("#spPortalBackground3").text()=="")
{errString+="Background, ";}
if($("#cboPortalTheme").val()=="0")
errString+="Theme, ";if(errString!=""){errString=errString.slice(0,-2)+".";sd.component.messageBox.showError("Required field(s): "+errString);return;}
var extension=""
extension=$("#spPortalSkin").text().split('.').pop().toLowerCase();if(extension!="css")
errString="The portal skin must be a css file (e.g. theme.css). ";if(numBackgrounds=="1")
{extension=$("#spPortalBackground1").text().split('.').pop().toLowerCase()
if((extension!="png")&&(extension!="jpeg"))
errString+="The background image ("+$("#spPortalBackground1").text()+") must be a .jpeg (not .jpg) or png file. ";}
else{$.each($('[id*="spPortalBackground"]'),function(){if($(this).text()!="")
{extension=$(this).text().split('.').pop().toLowerCase()
if((extension!="png")&&(extension!="jpeg"))
errString+="The background image ("+$(this).text()+") must be a .jpeg (not .jpg) or .png file. ";}});}
extension=$("#spPortalLogo").text().split('.').pop().toLowerCase()
if((extension!="png")&&(extension!="jpeg"))
errString+="The logo image ("+$("#spPortalLogo").text()+") must be a .jpeg (not .jpg) or .png file. ";if($(".quicklinks .quickLinkRow").length>0){$('.quicklinks .quickLinkRow').each(function(index){if($(this).find(".js-lktle").val()==""){errString+="Quick Link "+$(this).index()+" : Title is a required field.";}
if($(this).find(".js-lkdesc").val()==""){errString+="Quick Link "+$(this).index()+" : Description is a required field.";}
var url=$(this).find(".js-lkurl").val();if(url==""){errString+="Quick Link "+$(this).index()+" : URL is a required field.";}
if(url!=""){if(!(sd.Utils.isValidURLFormat(url))){errString+="Quick Link "+$(this).index()+" : Please enter a URL with a valid format.";}}
else if($(this).find(".js-lki").val()==""){errString+="Quick Link "+$(this).index()+" : Image is a required field.";}})}
if(errString!=""){sd.component.messageBox.showError(errString);return;}
var action;var cs={};if(collabSpaces.selectedID==0)
action="CreateCollabSpace";else
action="UpdateCollabSpace";cs.background=[];$.each($('[id*="spPortalBackground"]'),function(){if($(this).text()!="")
{cs.background.push($(this).text());}});cs.featureID=[];$.each($('[id^="title"]'),function(){var idx=$(this).attr("id").split("title")[1];if($("#spPortalBackground"+idx).text()!="")
{cs.featureID.push($(this).val());}});cs.featureLink=[];$.each($('[id^="link"]'),function(){var idx=$(this).attr("id").split("link")[1];if($("#spPortalBackground"+idx).text()!=""){var url=$(this).val();if(url.length>0&&url.indexOf("://")<0&&url.indexOf(":\\")<0){url="http://"+url;}
cs.featureLink.push(url);}});cs.id=collabSpaces.selectedID;cs.title=$("#txtCollabTitle").val();cs.logo=$("#spPortalLogo").text();cs.theme=$("#cboPortalTheme").val();cs.skin=$("#spPortalSkin").text();cs.contact=$("#txtCollabContact").val();cs.email=$("#txtCollabContactEmail").val();cs.bcEmail=$("#txtCollabBestCaseEmail").val();cs.meta='';cs.status=$('input[name="rdoCollabStatus"]:checked').val();cs.homepagePosting=$("#chkHomepagePosting").is(':checked');cs.numBackgrounds=numBackgrounds;cs.egnyteDomain=$("#messageBox .js_egnyteDomain").val();cs.homepageCarousel=true;cs.toolStackLink=$("#toolStackLink1").val();cs.toolStackTitle=$("#toolStackTitle1").val();cs.quickLinks=[];if($(".quicklinks .quickLinkRow").length>0){$('.quicklinks .quickLinkRow').each(function(index){var url=$(this).find(".js-lkurl").val();if(url.substring(0,3).toLowerCase()=="www"){url="http://"+url;}
cs.quickLinks.push({"title":$(this).find(".js-lktle").val(),"description":$(this).find(".js-lkdesc").val(),"url":url,"image":$(this).find(".js-lki").val()});})}
var sc=new sd.ServerCall(action);sc.data({details:cs});sc.go({onSuccess:collabSpaces.refreshList,onError:collabSpaces.handleFormError});}
collabSpaces.refreshList=function(error){sd.component.messageBox.close();var sc=new sd.ServerCall("ListCollabSpaces");sc.go({onSuccess:collabSpaces.handleList,onError:collabSpaces.handleError});}
collabSpaces.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
collabSpaces.handleFormError=function(error){if(error=="This user already exists in the system. Username must be unique.")
{error+="<br>Visit the 'Manage Access' tab to assign portal access rights.";}
sd.component.messageBox.showError(error);}
collabSpaces.addEventListeners=function(){$("#csAdminAdd_btn").bind("click",function(){collabSpaces.selectedID=0;collabSpaces.showDetailsDialog();});$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});$('#csStatusChk').unbind("change").bind("change",function(){collabSpaces.displayList(collabSpaces.currentSortBy,collabSpaces.currentSortDirection);})}
collabSpaces.runAdminGlobalSearch=function(searchTerm){collabSpaces.globalSearchList=[];var sc=new sd.ServerCall("McCannGlobalSearch");var obj={};obj.searchString=searchTerm;obj.startIndex=0;obj.endIndex=100;obj.showPhoto=false;sc.data(obj);sc.go({onSuccess:collabSpaces.handleMcCannGlobalSearch,onError:collabSpaces.handleFormError});}
collabSpaces.handleMcCannGlobalSearch=function(myData,status){var count=myData.length;$('#dvPortalAdminUserSearchList').empty();var htmlOut="";var item;for(var i=0;i<count;i++){item=myData[i];collabSpaces.globalSearchList.push(item);htmlOut+="<div class='row grid globalSearchResult' data-id='"+item.un+"'>   \
                            <div class='yui3-u-1-5'><div class='section-list-field'>"+item.fn+"</div></div> \
                            <div class='yui3-u-1-5'><div class='section-list-field'>"+item.ln+"</div></div> \
                            <div class='yui3-u-2-5'><div class='section-list-field'>"+item.e+"</div></div> \
                            <div class='yui3-u-1-5'><div class='section-list-field'> \
                            <button class=\"small-rnd brand ma-r-half addGlobalUser\"><i class='icon-plus'></i></button> \
                            </div></div> \
                        </div>";}
if(myData.length<1)
$('#dvPortalAdminUserSearchList').html("<br/><br/>No results found");else
$('#dvPortalAdminUserSearchList').html(htmlOut);$('#loader').hide();$(".addGlobalUser").click(function(){var sc=new sd.ServerCall("AddQuickUser");var obj={};var user;var username=$(this).closest(".globalSearchResult").data("id");for(var i=0;i<count;i++){user=collabSpaces.globalSearchList[i];if(username==user.un)
break;}
obj.userName=user.un;obj.firstName=user.fn;obj.lastName=user.ln;obj.email=user.e;obj.mobile=user.m;obj.phone=user.p;obj.title=user.t;obj.address=user.a;obj.status="active";sc.data(obj);sc.go({onSuccess:function(){sd.component.messageBox.showMessage("User added successfully");$('#loader').show();$('#portalAdminGlobalSearch_btn').click();},onError:collabSpaces.handleFormError});});}
collabSpaces.loadIFrameAdmin=function(){$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});$("#iFrame-settings-close").bind("click",function(){LoadSection("admin",false);});$("#iFrame-settings-save").bind("click",function(){collabSpaces.saveIFrameSettings();});var sc=new sd.ServerCall("GetIFrameSettings",0);sc.go({onSuccess:collabSpaces.displayIFrameSettings,onError:collabSpaces.handleError});}
collabSpaces.displayIFrameSettings=function(myData,status){if(myData[0].displayIFrame==true)
$("#dvIFrameSettings input[name=chkEnableIFrame]").prop("checked",true);else
$("#dvIFrameSettings input[name=chkEnableIFrame]").prop("checked",false);$("#dvIFrameSettings .embedCode").text(myData[0].iFrameEmbed);$('#loader').hide();}
collabSpaces.saveIFrameSettings=function(){var sc=new sd.ServerCall("UpdateIFrameSettings",0);var obj={};if($("#dvIFrameSettings input[name=chkEnableIFrame]").prop("checked")==true)
obj.displayIFrame=1;else
obj.displayIFrame=0;obj.iFrameEmbed=$("#dvIFrameSettings .embedCode").val();if(obj.displayIFrame==1&&obj.iFrameEmbed==""){sd.component.messageBox.action({title:"Required Field",height:150,text:"Please enter the Embed Code.",btn1:"Ok"});}
else{sc.data(obj);sc.go({onSuccess:LoadSection("admin",false),onError:collabSpaces.handleError});}}
collabSpaces.populateQuickLinks=function(quickLinks){var fragment=document.createDocumentFragment();var clone;var links=JSON.parse(quickLinks);for(var i=0;i<links.length;i++){var link=links[i];clone=$(".guide .quickLinkRow").clone().appendTo(fragment);clone.find(".js-lktle").val(link.title);clone.find(".js-lkdesc").val(link.description);clone.find(".js-lkurl").val(link.url);clone.find(".js-lki").val(link.image);$(".quicklinks").append(fragment);}
collabSpaces.addQuickLinkListeners();}
collabSpaces.addQuickLinkListeners=function(){$(".quicklinks .js-remove").unbind("click").bind("click",function(){$(this).closest(".quickLinkRow").remove();});$(".quicklinks .js-upload").unbind("click").bind("click",function(){$(".quickLinkRow").removeClass('qluploading');$(this).closest(".quickLinkRow").addClass('qluploading');sd.FileUploader.browse({'destinationInode':-1,'uploadType':'quickLink','onComplete':collabSpaces.uploadQuickLinkComplete,'onError':collabSpaces.handleFormError});});}
window.collabSpaces=collabSpaces;}(window));﻿(function(window){var crew={};crew.currentSortDirection="";crew.currentSortBy="";crew.currentList=[];crew.filteredList=[];crew.viewMode="";crew.itemsPerPage=16;crew.totalPages=0;crew.attributes=[];crew.type="";crew.id=0;crew.imageid=0;crew.selectedItem={};crew.fnode=0;crew.options={};crew.selectedExpert=0;crew.adminUser=0;crew.pagingOptions={};crew.allUniqueMetaAttributes=[];crew.allMetaAttributes=[];crew.filteredMetaAttributes=[];crew.appliedFilters=[];crew.shuffle=false;crew.init=function(options){$("#loader").show();crew.options=options;crew.type=options.template;crew.root=options.f_node;crew.id=options.i_node||0;crew.currentSortDirection="ASC";crew.currentSortBy="sortname";crew.currentList=[];crew.filteredList=[];crew.viewMode="thumb";crew.totalPages=0;crew.currentPage=1;crew.selectedItem={};crew.allUniqueMetaAttributes=[];crew.filteredMetaAttributes=[];crew.appliedFilters=[];crew.allMetaAttributes=[];crew.adminUser=(options==undefined)?0:options.al;crew.pagingOptions={};crew.shuffle=true;crew.attributes=[];$("#crewAdd_btn").hide();$('#crewContent .icon-chevron-up').hide();$('#crewContent .icon-chevron-down').hide();$('#crewContent #dvNameSort').click(function(){crew.shuffle=false;crew.createList("sortname","");});$('#txtFilterCrew').on('input',function(){crew.shuffle=false;crew.currentPage=1;crew.createList("sortname",null);});crew.addEventListeners();var sc=new sd.ServerCall("ListSectionMetaTags");var obj={};obj.section=crew.type;sc.data(obj);sc.go({onSuccess:crew.handleMeta,onError:crew.handleError});}
crew.handleMeta=function(myData){crew.formCheckLists=[];var metaItem;for(var m=0;m<myData.length;m++){metaItem=myData[m];crew.attributes.push({attribute:metaItem.type,checklist:"dv"+metaItem.type+"List",title:metaItem.label,id:metaItem.attrID,container:"dv"+metaItem+"Container",allowFilter:true});}
crew.setUpList();if(crew.id>0){crew.loadItem();}}
crew.setUpList=function(){$("#loader").show();$("#dvCrewList").empty();$("#dvCrewHeaderPages").empty();$("#dvCrewFooterPages").empty();$("#crewThumb_btn").addClass("view-as-selected ");var title=$('#nvHorizontalMenu').find('li.brand-current').find('a').data("item");$('.spCrewListTitle').html(title);switch(crew.type){case"dreamteam":crew.fnode=-91;$(".spCrewListTitle").html(title);if(sd.Session.user.superAdmin==true||crew.adminUser>1||admin.adminUser()){$("#crewAdd_btn").show();}
break;case"expert":crew.fnode=-92;if(sd.Session.user.superAdmin==true||crew.adminUser>1||admin.adminUser()){$("#crewAdd_btn").show();}
break;case"artist":crew.fnode=-93;$(".spCrewListTitle").html(title);$("#crewExcel_btn").hide();if(sd.Session.user.superAdmin==true||crew.adminUser>1||admin.adminUser()){$("#crewAdd_btn").show();}
break;default:break;}
var sc=new sd.ServerCall("ListCrew");var obj={};obj.type=crew.type;obj.fnode=crew.root;sc.data(obj);sc.go({onSuccess:crew.handleList,onError:crew.handleError});}
crew.handleList=function(myData,status){$("#loader").hide();$('#dvLibraryFilter').show();$('#dvLibraryPagingHeader').show();$('#tbListHeader').show();$('#dvLibraryPagingFooter').show();$('.list-header').show();crew.currentList=[];crew.metaAttributes=[];var jsonMeta;var inodeList=[-1];for(var idx=0;idx<myData.length;idx++){var item={};item.id=myData[idx].i;inodeList.push(item.id);item.name=$.trim(myData[idx].n);item.sortname=$.trim(myData[idx].n);if(sd.Configuration.site=="mccann"){var arrTmp=$.trim(myData[idx].n).split(" ");if(arrTmp.length>1){var lelem=arrTmp.pop();item.sortname=lelem+" "+arrTmp.join(" ");}}
if(myData[idx].sd.match(/1900$/))item.startdate="";else item.startdate=myData[idx].sd;if(myData[idx].ed.match(/1900$/))item.enddate="";else item.enddate=myData[idx].ed;item.createdate=myData[idx].cd;item.format=myData[idx].f;crew.currentList.push(item);}
var sc=new sd.ServerCall("GetItemMetaAttributes");var obj={};obj.inodes=inodeList.join(",");obj.returnAll=false;sc.data(obj);sc.go({onSuccess:crew.buildFilterMenu,onError:crew.handleError});}
crew.buildFilterMenu=function(myData,status){var item;var html="";var currentMetaType="";var useFilter;var showTerms=false;for(var idx=0;idx<myData.length;idx++){var obj={};useFilter=false;item=myData[idx];for(var i=0;i<crew.attributes.length;i++){if((item.t==crew.attributes[i].attribute)&&(crew.attributes[i].allowFilter==true)&&(item.t!="startdate"||item.t!="enddate")){obj.title=crew.attributes[i].title;useFilter=true;break;}else if(item.t=="startdate"||item.t=="enddate"){showTerms=true;}}
if(useFilter==false)continue;obj.id=myData[idx].i;obj.type=myData[idx].t;obj.value=myData[idx].v;crew.allUniqueMetaAttributes.push(obj);obj.inode=myData[idx].nd;crew.allMetaAttributes.push(obj);}
crew.allUniqueMetaAttributes=sd.Utils.removeObjectArrayDuplicates(crew.allUniqueMetaAttributes,"id");crew.allUniqueMetaAttributes.sort(sd.Utils.dynamicSortMultiple("type","value"));var htmlOut="";for(var idx=0;idx<crew.allUniqueMetaAttributes.length;idx++){item=crew.allUniqueMetaAttributes[idx];if(item.type!=currentMetaType){if(currentMetaType!="")htmlOut+="</div>";currentMetaType=item.type;htmlOut+="<h3><span class=\"accordionHead\">"+item.title+"</span></h3><div>";}
htmlOut+="<div class=\"accordion-menu\">";htmlOut+="<label class = \"filterText\" data-id=\""+item.id+"\" data-value=\""+item.value+"\" data-type=\""+item.type+"\">";htmlOut+="<input type=\"checkbox\" id=\"chk"+item.id+"\" value=\""+item.id+"\"/>"+item.value+"</label>";htmlOut+="</div>";}
if(crew.type!="artist"&&showTerms){htmlOut+="</div><h3>Terms of Contract</h3><div>";htmlOut+="<div class=\"\">";htmlOut+="<div class=\"date-picker-text\">Start Date :</div><div class=\"input-icon not-round icon2 light-grey ma-b-1\">";htmlOut+="<input type = \"text\" id = \"dpCrewStartDate\" name = \"datepicker\" readonly=\"readonly\" placeholder=\"Start date...\"/><a class=\"icon-calendar\"></a>";htmlOut+="<a title=\"Clear start date\" class=\"refresh-date brand-color icon-remove\" id=\"clearCrewSD_btn\"></a></div>";htmlOut+="<div class=\"date-picker-text\">End Date :</div><div class=\"input-icon not-round icon2 light-grey\">";htmlOut+="<input type = \"text\" id = \"dpCrewEndDate\" name = \"datepicker\" readonly=\"readonly\" placeholder=\"End date...\"/><a class=\"icon-calendar\"></a>";htmlOut+="<a title=\"Clear end date\" class=\"refresh-date brand-color icon-remove\" id=\"clearCrewED_btn\"></a>";htmlOut+="</div></div>";}
if(htmlOut!=""){$("#dvCrewMetaFilters").empty();$("#dvCrewMetaFilters").show();$("#dvCrewMetaFilters").append("<div id=\"dvCrewFilterAccordion\" class=\"accordion-menu\"></div>");$("#dvCrewFilterAccordion").append(htmlOut);$("#dvCrewFilterAccordion").accordion({heightStyle:"content",active:false,collapsible:true});if(crew.type!="artist"){$("#dpCrewStartDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Start Date",onSelect:function(dateText){crew.startDateFilterChanged(dateText)}})
$("#dpCrewEndDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"End Date",onSelect:function(dateText){crew.endDateFilterChanged(dateText)}})
$("#clearCrewSD_btn").bind("click",function(){crew.shuffle=false;$("#dpCrewStartDate").val("");crew.currentPage=1;crew.removeFilterFromArray(-1);crew.createList("sortname",null);});$("#clearCrewED_btn").bind("click",function(){crew.shuffle=false;$("#dpCrewEndDate").val("");crew.currentPage=1;crew.removeFilterFromArray(-2);crew.createList("sortname",null);});}
$(".filterText").click(function(){var id=$(this).data('id');var type=$(this).data('type');var value=$(this).data('value');crew.shuffle=false;if($("#chk"+id).prop("checked")==true){var obj={};obj.id=id;obj.type=type;obj.value=value;crew.appliedFilters.push(obj);}else{crew.removeFilterFromArray(id)}
crew.currentPage=1;crew.createList("sortname",null);});}else{$('.filter-text-by').hide();}
crew.createList("sortname",null);}
crew.filterData=function(){for(var k=0;k<crew.allUniqueMetaAttributes.length;k++)
$("#chk"+crew.allUniqueMetaAttributes[k].id).prop("checked",false);$("#dpCrewStartDate").val("");$("#dpCrewEndDate").val("");$("#dvCrewSelectedMetaFilters").empty();var item;var listCount=crew.currentList.length;var filterData=[];var html="";var sDate="";var eDate="";var filterText=$('#txtFilterCrew').val();if(filterText!=undefined)filterText=filterText.toLowerCase();crew.filteredList=[];crew.filteredMetaAttributes=[];if(crew.shuffle==false){if(crew.appliedFilters.length>0||filterText!="")
$("#crewReset_btn").show();if(crew.appliedFilters.length==0&&filterText=="")
$("#crewReset_btn").hide();for(var k=0;k<crew.appliedFilters.length;k++){item=crew.appliedFilters[k];if(k==0){html="<h5 class='ma-tb-1'>Selected Filters:</h5>";}
html+="<div class='tag'>";html+="<i class='icon-remove-sign filter-remove' title='Remove Filter' onClick=\"crew.removeFilterFromPanel("+item.id+")\"></i>";html+="<label onClick=\"crew.removeFilterFromPanel("+item.id+")\">";if(item.type=="sd"){html+=" Start Date: "+item.value;$("#dpCrewStartDate").val(item.value);sDate=item.value;}else if(item.type=="ed"){html+=" End Date: "+item.value;$("#dpCrewEndDate").val(item.value);eDate=item.value;}else{html+=" "+item.value;$("#chk"+item.id).prop("checked",true);}
html+="</label>";html+="</div>";if(filterData[crew.appliedFilters[k].type]==undefined)
filterData[crew.appliedFilters[k].type]=[];filterData[crew.appliedFilters[k].type].push(crew.appliedFilters[k]);}
$("#dvCrewSelectedMetaFilters").html(html);var arrUniqueTypes=sd.Utils.removeObjectArrayDuplicates(crew.appliedFilters,"type");var uniqueTypes=arrUniqueTypes.length;for(var idx=0;idx<listCount;idx++){var match=false;item=crew.currentList[idx];if(filterText!=""&&item.name.toLowerCase().indexOf(filterText)<0)continue;if(crew.appliedFilters.length==0){match=true;}else{var matchCount=0;var typeMatch;if(Object.keys(filterData).length>0){var filter;for(var key in filterData){typeMatch=false;for(var i=0;i<filterData[key].length;i++){filter=filterData[key][i];for(var j=0;j<crew.allMetaAttributes.length;j++){if((crew.allMetaAttributes[j].inode==item.id)&&(crew.allMetaAttributes[j].id==filter.id)){matchCount++;typeMatch=true;break;}}
if(typeMatch==true)break;}}
if(matchCount==uniqueTypes)match=true;}}
if((!match)&&((sDate=="")&&(eDate=="")))continue;if((sDate!="")&&(eDate!="")){if($("#dpCrewStartDate").datepicker("getDate")>$("#dpCrewEndDate").datepicker("getDate")){sd.component.messageBox.action({title:"Filtering",height:150,text:"Start Date must be before End Date",btn1:"Ok"});continue;}
if((new Date(item.enddate).getTime()<new Date(sDate).getTime())||(new Date(item.enddate).getTime()>new Date(eDate).getTime()))
continue;}
for(var i=0;i<crew.allMetaAttributes.length;i++){if(item.id==crew.allMetaAttributes[i].inode){var obj={};obj.id=crew.allMetaAttributes[i].id;obj.value=crew.allMetaAttributes[i].value;obj.type=crew.allMetaAttributes[i].type;crew.filteredMetaAttributes.push(obj);}}
crew.filteredList.push(item);}}else{$("#crewReset_btn").hide();filterText="";for(var idx=0;idx<crew.currentList.length;idx++)
crew.filteredList.push(crew.currentList[idx]);}}
crew.updateFilterCounts=function(){var filterText=$('#txtFilterCrew').val().toLowerCase();for(var k=0;k<crew.allUniqueMetaAttributes.length;k++){var count=0;if(crew.appliedFilters.length==0&&filterText=="")
count=sd.Utils.countObjectArrayValues(crew.allMetaAttributes,"id",crew.allUniqueMetaAttributes[k].id);else
count=sd.Utils.countObjectArrayValues(crew.filteredMetaAttributes,"id",crew.allUniqueMetaAttributes[k].id);if(count>0){$("#lblFilterCount"+crew.allUniqueMetaAttributes[k].id).parent().show();$("#lblFilterCount"+crew.allUniqueMetaAttributes[k].id).text(" ("+count+")");}else{$("#lblFilterCount"+crew.allUniqueMetaAttributes[k].id).parent().hide();}
$("#dvCrewFilterAccordion h3").each(function(index){var count=0;$(this).next("div").children().each(function(index){if($(this).css("display")=="none")count++;});if(count==$(this).next("div").children().length){$(this).hide();}else{$(this).show();}});}}
crew.createList=function(sortBy,sortDirection){crew.filterData();var listCount=crew.filteredList.length;var countHeader=listCount;$("#dvCrewCount").html(countHeader);crew.pagingOptions={prev_text:"<i class=\"icon-double-angle-left\"></i> Prev",next_text:"Next <i class=\"icon-double-angle-right\"></i>",num_display_entries:9,current_page:crew.currentPage-1,num_edge_entries:1,callback:crew.changePage,items_per_page:crew.itemsPerPage}
var endIndex=(crew.currentPage)*crew.itemsPerPage;var startIndex=endIndex-crew.itemsPerPage;if(endIndex>listCount)endIndex=listCount;if(sortDirection!=null){if(crew.currentSortBy==sortBy){if(sortDirection!=crew.currentSortDirection){if(crew.currentSortDirection=="ASC")crew.currentSortDirection="DESC";else crew.currentSortDirection="ASC";}}else{crew.currentSortBy=sortBy;crew.currentSortDirection=sortDirection||"ASC";}}
if(crew.currentSortBy=="sortname")sd.Utils.sortArrayByString(crew.filteredList,"sortname");$('#crewContent .icon-chevron-up').hide();$('#crewContent .icon-chevron-down').hide();var sortArrow="icon-chevron-up";if(crew.currentSortDirection=="DESC")sortArrow="icon-chevron-down";if(team.shuffle==false)
$('#crewContent .'+sortArrow).show();sd.Utils.killAllVideos();$("#dvCrewList").empty();if(crew.shuffle==true){$(".crewShuffle_btn").removeClass("unselected");for(var i=crew.filteredList.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=crew.filteredList[i];crew.filteredList[i]=crew.filteredList[j];crew.filteredList[j]=temp;}}else{$(".crewShuffle_btn").addClass("unselected");}
crew.totalPages=Math.ceil(listCount/crew.itemsPerPage);$("#dvCrewHeaderPages").empty();$("#dvCrewFooterPages").empty();if(crew.totalPages>1){$("#dvCrewHeaderPages").pagination(listCount,crew.pagingOptions);$("#dvCrewFooterPages").pagination(listCount,crew.pagingOptions);}
if(crew.viewMode=="list")
crew.displayListView(startIndex,endIndex);else
crew.displayThumbView(startIndex,endIndex);}
crew.displayListView=function(startIdx,endIdx){var fragmentWrap=document.createDocumentFragment();$(".guide .teamGuideList .list-wrap").clone().appendTo(fragmentWrap);$("#dvCrewList").empty().show();$("#dvCrewList").html(fragmentWrap);$("#dvCrewList").foundation();var description="";if(crew.filteredList.length<endIdx)
endIdx=crew.filteredList.length;var fragment=document.createDocumentFragment();var clone;for(var idx=startIdx;idx<endIdx;idx++){var item=crew.filteredList[idx];if(crew.currentSortDirection=="DESC")item=crew.filteredList[crew.filteredList.length-(idx+1)];if(crew.type=="artist"){var arrTemp=[];for(i=0;i<crew.allMetaAttributes.length;i++){if((crew.allMetaAttributes[i].inode==item.id)&&(crew.allMetaAttributes[i].type=="profession"))
arrTemp.push(crew.allMetaAttributes[i].value);}
description=arrTemp.join(',');}else{description="Term of contract ("+item.startdate+" to "+item.enddate+")"}
clone=$(".guide .teamGuideList .user-list").clone().appendTo(fragment);clone.data({"id":item.id});clone.addClass("selectCrewList");clone.find(".list-username").html(item.name);clone.find(".list-username").addClass("list-table-top");clone.find(".pic-list").css({"background-image":"url("+sd.Configuration.vault+"/"+item.id+"/bigthumb.jpg"+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"}).addClass("list-thumb-settings");clone.find(".job-title").remove();clone.find(".department").remove();clone.find(".list-buttons").remove();if(description!=undefined&&description!="")
clone.find(".crewDescription").html(description);else
clone.find(".crewDescription").html("&nbsp;");}
$("#dvCrewList .list-wrap").empty().show().html(fragment).foundation();$('#dvCrewList').find('td').each(function(i){if($(this).hasClass('list-table-top')){$(this).dotdotdot({ellipsis:'... ',wrap:'letter',after:null,watch:true,height:25});}});$(".selectCrewList").click(function(){crew.id=$(this).data('id');crew.loadItem();});$('#loader').hide();window.scrollTo(0,0);}
crew.displayThumbView=function(startIdx,endIdx){var htmlOut="";var fragmentWrap=document.createDocumentFragment();$(".guide .userThumbGuide .list-thumb-wrap").clone().appendTo(fragmentWrap);$("#dvCrewList").empty().show();$("#dvCrewList").html(fragmentWrap);$("#dvCrewList").foundation();var fragment=document.createDocumentFragment();var clone;var description="";for(var idx=startIdx;idx<endIdx;idx++){var item=crew.filteredList[idx];if(crew.currentSortDirection=="DESC")item=crew.filteredList[crew.filteredList.length-(idx+1)];if(crew.type=="artist"){var arrTemp=[];for(var i=0;i<crew.allMetaAttributes.length;i++){if((crew.allMetaAttributes[i].inode==item.id)&&(crew.allMetaAttributes[i].type=="profession"))
arrTemp.push(crew.allMetaAttributes[i].value);}
description=arrTemp.join(',');}
else{description="Term of contract ("+item.startdate+" to "+item.enddate+")"}
clone=$(".guide .userThumbGuide .searchThumbItem").clone().appendTo(fragment);clone.data({"id":item.id});clone.addClass("searchThumbItem");clone.find(".pic-thumb").css({"background-image":"url("+sd.Configuration.vault+"/"+item.id+"/bigthumb.jpg"+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"}).addClass("list-thumb-settings").addClass("thumb-img");clone.find(".name").addClass("thumb-name");clone.find(".name").addClass("title");clone.find(".name").html(item.name);clone.find(".job-title").remove();clone.find(".department").remove();clone.find(".list-buttons").remove();clone.find(".city").remove();clone.find(".country").remove();if(description!=undefined&&description!="")
clone.find(".crewDescription").html(description);else
clone.find(".crewDescription").html("&nbsp;");}
$("#dvCrewList .list-thumb-wrap").empty().show().html(fragment).foundation();$(".searchThumbItem").unbind("click").bind("click",function(){crew.id=$(this).data('id');crew.loadItem();});$('#loader').hide();window.scrollTo(0,0);}
crew.changePage=function(newPage){crew.shuffle=false;crew.currentPage=newPage+1;crew.createList("sortname",null);}
crew.refreshItem=function(){sd.component.messageBox.close();crew.id=crew.imageid;LoadSection("crewItem",true);}
crew.loadItem=function(){LoadSection("crewItem",true);}
crew.getItemDetails=function(inode){$('#loader').show();$("#editCrewItem_btn").hide();$("#deleteCrewItem_btn").hide();window.scrollTo(0,0);var sc=new sd.ServerCall("GetCrewItem");var obj={};if(crew.id==0){obj.inode=inode;}else{obj.inode=crew.id;}
sc.data(obj);sc.go({onSuccess:crew.populateCrewItem,onError:crew.handleError});}
crew.populateCrewItem=function(myData,status){var htmlOut="";var item=myData[0];var xmlMeta=$.parseXML(item.m);var jsonMeta=$.parseJSON(item.a);crew.selectedExpert=0;crew.selectedItem=item;crew.id=item.i;crew.imageid=item.im;if(sd.Session.user.superAdmin==true||crew.adminUser>1||admin.adminUser()){$("#editCrewItem_btn").show();$("#deleteCrewItem_btn").show();}
$("#editCrewItem_btn").bind("click",function(){crew.loadCrewForm("Edit");});$("#deleteCrewItem_btn").bind("click",function(){crew.deleteItem();});$("#closeCrewItem_btn").bind("click",function(){if(crew.type!=undefined&&crew.root!=undefined)
LoadSection("crew",true,{template:crew.type,f_node:crew.root});else
window.history.go(-1);});$("#printCrewItem_btn").bind("click",function(){window.print();});$("#print-link").bind("click",function(){window.print();});$("#btnEmailFile").bind("click",function(){sd.Utils.sendEmailLink(item.i);});$("#mail-link").bind("click",function(){sd.Utils.sendEmailLink({inode:item.i,fnode:crew.root});});$("#btnShareFile").bind("click",function(){sd.Utils.shareFileLink(item.i);});$("#copy-link").bind("click",function(){sd.Utils.shareFileLink(item.i);});$("#dvCrewItemTitle").html(item.n);if(sd.Utils.isVideo(item.f)){var html="<video class='videoClass' id='"+item.thumb+"' style=\"width: 100%; height: 100%;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.thumb+"/"+item.thumb+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";$("#dvCrewImage").html(html).unbind("click").bind("click",function(){previewer.open(item.i);});}
else{$("#dvCrewImage").css({"background-image":"url("+sd.Configuration.vault+"/"+item.i+"/bigthumb.jpg)","background-repeat":"no-repeat ","background-size":"cover","background-position":"center"});}
$("#spFavCount").html(item.tf+'&nbsp;');if(item.uf==1)
$("#iconFav").addClass("ico-heart-fav");$("#dvCrewFav").click(function(){if(item.uf==1){item.uf=0;item.tf=item.tf-1;$("#iconFav").removeClass("ico-heart-fav");$("#spFavCount").html(item.tf+'&nbsp;');favourites.removeFavourite(item.i);}else{item.uf=1;item.tf=item.tf+1;$("#iconFav").addClass("ico-heart-fav");$("#spFavCount").html(item.tf+'&nbsp;');favourites.addFavourite(item.i);}});var arrTemp=sd.Utils.getItemsFromObject(jsonMeta,"t","tag","v");htmlOut="";if(arrTemp.length>0)$("#keywordsHead").show();for(var j=0;j<arrTemp.length;j++){htmlOut+="<div class=\"crw-side-tags brand-color tagClick\"><span class=\"tag-link brand-color-2\">"+arrTemp[j]+"</span></div>";}
$("#dvCrewTags").html(htmlOut);$(".tag-link").click(function(){var tag=$(this).html();var tagText=$(this).text();$('#headerSearchFieldInput').val(tagText);var obj={};obj.mode="preset"
obj.onError=$.proxy(runSearch.handleError);obj.onSuccess=$.proxy(runSearch.handleResults);obj.searchString=tagText;obj.searchUsers=false;obj.searchEgnyte=false;obj.searchMetaData="<metadata><meta><label>tag</label><value>"+tag+"</value></meta></metadata>";LoadSection("search",true,obj);});var title=$('#nvHorizontalMenu').find('li.brand-current').find('a').data("item");$("#tbItemContent").empty();if(crew.type=="dreamteam"||crew.type=="expert"){htmlOut="";$("#dvCrewItemHeader").html(title);var start=item.sd;var end=item.ed;if(item.sd.match(/1900$/))start="";if(item.ed.match(/1900$/))end="";if(start!=""||end!=""){htmlOut="<label>Dates/Terms of Contract</label>";htmlOut+="<span>"+start+" - "+end+"</span>";}
htmlOut+="<label>Original Sign Date</label>";htmlOut+="<span id=\"origDate\"></span>";var territories=sd.Utils.getItemsFromObject(jsonMeta,"t","territory","v").join(',');if(territories!=""){htmlOut+="<label>Territory</label>";htmlOut+="<span>"+territories+"</span>";}
var segments=sd.Utils.getItemsFromObject(jsonMeta,"t","segment","v").join(',');if(segments!=""){htmlOut+="<label>Segment</label>";htmlOut+="<span>"+segments+" (Exceptions: <a id=\"segExceptions\"> "+"</a>)</span>";}
var countries=sd.Utils.getItemsFromObject(jsonMeta,"t","country","v");if(countries!=""){htmlOut+="<hr><label>Countries</label>";for(var i=0;countries.length>i;i++){htmlOut+="<span class=\"tag\">"+countries[i]+"</span>";}}
htmlOut+="<hr><label>Usage</label>";htmlOut+="<span> <strong id=\"usage\"></strong> (Exceptions: <span id=\"usageExceptions\"> "+"</span>)</span>";htmlOut+="<hr><label>Voice Dubbing</label>";htmlOut+="<span id=\"dubbing\"></span>";}else{htmlOut="";$("#dvCrewItemHeader").html(title);var campaigns=sd.Utils.getItemsFromObject(jsonMeta,"t","campaign","v").join(',');if(campaigns!=""){htmlOut="<hr><label>Campaigns</label>";htmlOut+="<span>"+campaigns+"</span>";}
var professions=sd.Utils.getItemsFromObject(jsonMeta,"t","profession","v").join(',');if(professions!=""){htmlOut+="<hr><label>Profession</label>";htmlOut+="<span>"+professions+"</span>";}}
var fb,tw,ws,contactName,contactEmail,contactDTName,contactDTEmail,contactWebsite,contactCell,contactOffice
var contactCountry,contactAgency,origDate,usage,exception,dubbing,segException
$(xmlMeta).find("meta").each(function(){switch($(this).find("type").text()){case"facebook":fb=encodeURI($(this).find("value").text());break;case"twitter":tw=encodeURI($(this).find("value").text());break;case"website":ws=encodeURI($(this).find("value").text());break;case"contactName":contactName=$(this).find("value").text();break;case"contactEmail":contactEmail=$(this).find("value").text();break;case"contactDTName":contactDTName=$(this).find("value").text();break;case"contactDTEmail":contactDTEmail=$(this).find("value").text();break;case"contactWebsite":contactWebsite=$(this).find("value").text();break;case"contactCell":contactCell=$(this).find("value").text();break;case"contactOffice":contactOffice=$(this).find("value").text();break;case"contactAgency":contactAgency=$(this).find("value").text();break;case"contactCountry":contactCountry=$(this).find("value").text();break;case"selectedExpert":crew.selectedExpert=$(this).find("value").text();break;case"origContractDate":origDate=$(this).find("value").text();break;case"usage":usage=$(this).find("value").text();break;case"voicedubbing":dubbing=$(this).find("value").text();break;case"usageExceptions":exception=$(this).find("value").text();break;case"segmentExceptions":segException=$(this).find("value").text();break;default:}});if(item.d!=""){htmlOut+="<hr><label>Bio</label>";htmlOut+="<span class=\"bio\">"+channel.formatEmbeddedLinks(item.d).replace(/\n/g,"<br/>")+"</span><br />";$(".bio u").addClass('brand-color');}
htmlOut+="<div class='open-contact flex flex-column'>";htmlOut+="</div>";$("#tbItemContent").html(htmlOut);if(fb!=""){if(fb.indexOf("http")<0)fb="http://"+fb;$("#dvCrewItem .js-soc").show();$("#dvCrewItem .js-fb").show().unbind("click").bind("click",function(){window.open(fb,"_blank");});}
if(tw!=""){if(tw.indexOf("http")<0)tw="http://"+tw;$("#dvCrewItem .js-soc").show();$("#dvCrewItem .js-twt").show().unbind("click").bind("click",function(){window.open(tw,"_blank");});}
if(ws!=""){if(ws.indexOf("http")<0)ws="http://"+ws;$("#dvCrewItem .js-soc").show();$("#dvCrewItem .js-web").show().unbind("click").bind("click",function(){window.open(ws,"_blank");});}
if(crew.type=="dreamteam"||crew.type=="expert"){if(origDate!="")$('#origDate').html(origDate);else{$('#origDate').hide();$('#origDate').prev().hide();}
if(usage!="")$('#usage').html(usage);else{$('#usage').parent().hide();$('#usage').parent().prev().hide();}
if(dubbing!="")$('#dubbing').html(dubbing);else{$('#dubbing').hide();$('#dubbing').prev().hide();}
if(exception!="")$('#usageExceptions').html(exception);$('#segExceptions').html(segException);}
if(crew.type=="expert"||crew.type=="dreamteam"){$("#dvCrewFooterHeader").html("<p class=\"int-cont\">Internal Contact Details</p><span>For usage rights or to update the bio, please contact: </span>");htmlOut="<div class='open-contact flex flex-column'>";htmlOut+="<p class=\"internal-contact\" id = \"pContactName\"><i class=\"icon-user theme-font-color\"></i>  Name: &nbsp;<a href = \"mailto:\"><span class=\"int-cont-color brand-color\"></span></a> </p>";htmlOut+="</div>";}else{$("#dvCrewFooterHeader").html("Agent Contact Details");htmlOut="<div class='open-contact flex-flex-column'>";htmlOut+="<div class='flex flex-auto flex-column'>";htmlOut+="<p class=\"internal-contact\"><i class=\"icon-user theme-font-color\"></i>  Name: &nbsp;<a href = \"mailto:"+contactEmail+"\"><span class=\"int-cont-color brand-color\">"+contactName+"</span></a> </p>";htmlOut+="<p class=\"internal-contact\"><i class=\"icon-phone theme-font-color\"></i>  Office: &nbsp;<span class=\"int-cont-default\">"+contactOffice+"</span></p>";htmlOut+="<p class=\"internal-contact\"><i class=\"icon-mobile-phone theme-font-color\"></i>  Cell: &nbsp;<span class=\"int-cont-default\">"+contactCell+"</span></p>";htmlOut+="<p class=\"internal-contact\"><i class=\"icon-envelope theme-font-color\"></i>  Email: &nbsp;<a href = \"mailto:"+contactEmail+"\"><span class=\"int-cont-color brand-color\">"+contactEmail+"</span></a></p>";htmlOut+="<p class=\"internal-contact\"><i class=\"icon-globe theme-font-color\"></i> Website: &nbsp;<span class=\"int-cont-default\"><a class=\"brand-color\" href = \""+contactWebsite+"\ target=\"_blank\">"+contactWebsite+"</a></span></p>";htmlOut+="</div>";htmlOut+="</div>";}
$("#dvCrewFooterBody").html(htmlOut);if((crew.type=="expert"||crew.type=="dreamteam")&&crew.selectedExpert!=0){var scExpert=new sd.ServerCall("GetUserDetails");var obj={uid:crew.selectedExpert};scExpert.data(obj);scExpert.go({onSuccess:crew.handleExpertUser,onError:crew.handleError});}
$('#loader').hide();}
crew.handleExpertUser=function(myData,status){var item=myData[0];var phone=(item.Phone==null)?"":item.Phone;var mobile=(item.Mobile==null)?"":item.Mobile;$("#pContactName").html("<i class=\"icon-user theme-font-color\"></i>  Name: &nbsp;<a href = \"mailto:"+item.email+"\"><span class=\"int-cont-color brand-color\">"+item.FirstName+" "+item.LastName+"</span></a>");$("#pContactOffice").html("<i class=\"icon-phone theme-font-color\"></i>  Office: &nbsp;<span class=\"int-cont-default\">"+phone+"</span>");$("#pContactCell").html("<i class=\"icon-mobile-phone theme-font-color\"></i>  Cell: &nbsp;<span class=\"int-cont-default\">"+mobile+"</span>");$("#pContactEmail").html("<i class=\"icon-envelope theme-font-color\"></i>  Email: &nbsp;<a href = \"mailto:"+item.email+"\"><span class=\"int-cont-color brand-color\">"+item.email+"</span></a>");}
crew.handleRelatedMedia=function(myData,status){var imgSrc="";var item;var count=1;for(var idx=0;idx<myData.length;idx++){item=myData[idx];if(item.id==crew.selectedItem.i){continue;}
$('#relFilesHead').show();if(sd.Utils.isVideo(item.format)){var html="<video class='videoClass' id='"+item.id+"' style=\"width: 100%; height: 100%;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.id+"/"+item.id+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";$("#dvRM"+count).append(html);}
else{var image=sd.Configuration.vault+"/"+item.id+"/bigthumb.jpg";$("#dvRM"+count).append("<div class=\"js-image\"></div>").find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}
$("#dvRM"+count).attr("data-id",item.id).show();$("#dvRM"+count).click(function(){var id=$(this).attr("data-id")
JumpToItem(id);});count=count+1;}
$('#dvCrewMedia').find('img').each(function(i){sd.Utils.imageResize(58,58,$(this).attr('id'));});$('#dvCrewMedia').find('video').bind("loadeddata",function(){$('#dvCrewMedia').find('video').attr('poster','');});}
crew.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
crew.loadCrewForm=function(action){if(crew.id>0)
action="Update ";else
action="Create New ";if(crew.type=="artist")
action+="Recommended Beauty Artist";else if(crew.type=="expert")
action+="Expert Under Contract";else if(crew.type=="dreamteam")
action+="Dream Team";sd.Utils.killAllVideos();sd.component.messageBox.action({title:action,height:600,width:960,cssClass:"msg-box-front-end",headerClass:"msg-box-front-end-header",bodyClass:"msg-box-front-end-body",loadCallback:function(){$("#crewID").val(crew.id);$("#dvBlank").hide();$("#dvBeautyArtistContact").hide();$("#dvExpertContact").hide();$("#dvCrewAgentInfo").hide();if(crew.type=="artist"){$("#dvCrewFormStartDate").hide();$("#dvCrewFormEndDate").hide();$("#dvCrewFormOrigDate").hide();}
if(crew.type=="artist"){$("#dvBeautyArtistContact").show();$('#dvOtherDetails').hide();}else if(crew.type=="expert")
$("#dvExpertContact").show();else if(crew.type=="dreamteam")
$("#dvExpertContact").show();if(crew.attributes.length==0)$('#dvCrewForm .chk-list').html("No Tags configured.");var fragment;var clone;for(i=0;i<crew.attributes.length;i++){fragment=document.createDocumentFragment();clone=$('#dvCrewForm .guide .checkListItem').clone().appendTo(fragment);clone.attr('id',crew.attributes[i].container);clone.find('span').html(crew.attributes[i].title);clone.find('div').attr('id',crew.attributes[i].checklist);$('#dvCrewForm .chk-list').append(fragment);$('#'+crew.attributes[i].chkList).checkList({listItems:{},onChange:crew.selChange});}
if(crew.id>0){crew.imageid=crew.id;var html="<button id='icon-remove' style='display: none;' class='icon-remove removeAsset dialogue-attachment--icon flex self-center' title='Remove This Asset'></button>";$("#spCrewAsset").html(crew.selectedItem.file);$("#spCrewAsset").after(html);$("#spCrewAsset .removeAsset").click(function(){crew.imageid=0;$("#spCrewAsset").html("");});$("#txtName").val(crew.selectedItem.n);$("#txtBio").val(crew.selectedItem.d);var start=crew.selectedItem.sd;var end=crew.selectedItem.ed;if(crew.selectedItem.sd.match(/1900$/))start="";if(crew.selectedItem.ed.match(/1900$/))end="";$("#dpStartDate").val(start);$("#dpEndDate").val(end);$("#spCrewAsset").html(crew.selectedItem.imn);var xmlMeta=$.parseXML(crew.selectedItem.m);$(xmlMeta).find("meta").each(function(){switch($(this).find("type").text()){case"facebook":$("#txtFacebook").val($(this).find("value").text());break;case"twitter":$("#txtTwitter").val($(this).find("value").text());break;case"website":$("#txtWebsite").val($(this).find("value").text());break;case"contactName":$("#txtContactName").val($(this).find("value").text());break;case"contactDTName":$("#txtContactDTName").val($(this).find("value").text());break;case"contactEmail":$("#txtContactEmail").val($(this).find("value").text());break;case"contactDTEmail":$("#txtContactDTEmail").val($(this).find("value").text());break;case"contactOffice":$("#txtContactOffice").val($(this).find("value").text());break;case"contactCell":$("#txtContactCell").val($(this).find("value").text());break;case"contactWebsite":$("#txtContactWebsite").val($(this).find("value").text());break;case"contactAgency":$("#txtContactAgency").val($(this).find("value").text());break;case"contactCountry":$("#txtContactCountry").val($(this).find("value").text());break;case"origContractDate":$("#dpOrigDate").val($(this).find("value").text());break;case"usage":$("#txtUsageInfo").val($(this).find("value").text());break;case"voicedubbing":$("#txtVoiceDubbing").val($(this).find("value").text());break;case"usageExceptions":$("#txtExceptionInfo").val($(this).find("value").text());break;case"segmentExceptions":$("#txtSegExceptions").val($(this).find("value").text());break;default:}});}
$("#dpStartDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Start Date"})
$("#dpEndDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"End Date"})
$("#dpOrigDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Orig Date"})
$(".dtpck img").addClass("mc-form-datepicker");var types="";$.each(crew.attributes,function(){types+=$(this)[0].id+", ";})
if(types.length>2)types=types.substring(0,types.length-2);var sc=new sd.ServerCall("ListMetaAttributes");var obj={};obj.types=types;obj.returnAll=false;obj.userAttr=false;sc.data(obj);sc.go({onSuccess:crew.handleMetaAttributes,onError:crew.handleError});$("#crewUpload_btn").bind("click",function(){sd.FileUploader.browse({'destinationInode':crew.fnode,'onComplete':crew.uploadComplete});});if(crew.type=="expert"||crew.type=="dreamteam"){var scUsers=new sd.ServerCall("ListActiveUsers");scUsers.go({onSuccess:crew.handleExpertUsers,onError:crew.handleError});}
$(".dream-team .icon-calendar").unbind("click").bind("click",function(){$(this).closest("div").find(".ui-datepicker-trigger").click()});},template:sd.Configuration.templates.crewForm,btn1callback:crew.saveCrewForm,btn1:"Save",btn2:"Cancel"});}
crew.handleMetaAttributes=function(myData,status){var title="";var item;var type,checklist,lstJSON;for(i=0;i<crew.attributes.length;i++){type=crew.attributes[i].attribute;chkList=crew.attributes[i].checklist;$('#'+chkList).checkList({listItems:{},onChange:crew.selChange});lstJSON="[]";for(j=0;j<myData.length;j++){if(j==0)lstJSON="[";item=myData[j];if(item.t!=type)
continue;title=item.v.replace(/"/g,'\'');lstJSON+='{ text: "'+title+'", value: "'+item.i+'", ';if(crew.id>0){var jsonMeta=$.parseJSON(crew.selectedItem.a);for(k=0;k<jsonMeta.length;k++){if(jsonMeta[k].i==item.i){lstJSON+='selected: "1" ';}}}else
lstJSON+='selected: "0" ';lstJSON+='}';lstJSON+=',';}
if(lstJSON.match("\]$")){}
else lstJSON+=']';var obj=eval('('+lstJSON+')');if(lstJSON!="[]")$('#'+chkList).checkList('setData',obj);else $('#'+chkList).parent().hide();}}
crew.handleExpertUsers=function(myData,status){var item;var arrExperts=[];for(var idx=0;idx<myData.length;idx++){var item={};item.userid=myData[idx].i;item.fullname=myData[idx].fn+' '+myData[idx].ln;arrExperts.push(item);}
sd.Utils.sortArrayByString(arrExperts,"fullname");var optOut="<option value=\"0\"";if(crew.selectedExpert==0)optOut+=" selected ";optOut+=">Select Contact</option>";for(var idx=0;idx<arrExperts.length;idx++){optOut+="<option value=\""+arrExperts[idx].userid+"\"";if(arrExperts[idx].userid==crew.selectedExpert)optOut+=" selected ";optOut+="\">"+arrExperts[idx].fullname+"</option>";}
$("#cboExpertContact").html(optOut);}
crew.saveCrewForm=function(){var errString=crew.validForm();if(errString!=""){sd.component.messageBox.showError("Please complete the following field(s): "+errString);return;}
var action="";var obj={};obj.fnode=crew.root;if($("#crewID").val()==0){action="AddCrewItem";obj.inode=crew.imageid;}else{action="EditCrewItem";obj.orgInode=$("#crewID").val();obj.inode=crew.imageid;}
var meta="";var sc=new sd.ServerCall(action);obj.item=$("#txtName").val();obj.description=$("#txtBio").val();obj.StartDate=$("#dpStartDate").val();obj.EndDate=$("#dpEndDate").val();obj.type=crew.type;var lstData;var item;for(i=0;i<crew.attributes.length;i++){lstData=$('#'+crew.attributes[i].checklist).checkList('getSelection');if($('#'+crew.attributes[i].checklist).is(":visible")){for(j=0;j<lstData.length;j++){item=lstData[j];meta+="<meta><type><![CDATA["+crew.attributes[i].attribute+"]]></type><value><![CDATA["+item.text+"]]></value><id><![CDATA["+item.value+"]]></id></meta>";}}}
meta="<metadata>"+meta+"</metadata>";obj.MetaAttributes=meta;meta="";meta+="<meta><type><![CDATA[facebook]]></type><value><![CDATA["+$("#txtFacebook").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[twitter]]></type><value><![CDATA["+$("#txtTwitter").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[website]]></type><value><![CDATA["+$("#txtWebsite").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactDTName]]></type><value><![CDATA["+$("#txtContactDTName").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactDTEmail]]></type><value><![CDATA["+$("#txtContactDTEmail").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactName]]></type><value><![CDATA["+$("#txtContactName").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactEmail]]></type><value><![CDATA["+$("#txtContactEmail").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactCell]]></type><value><![CDATA["+$("#txtContactCell").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactOffice]]></type><value><![CDATA["+$("#txtContactOffice").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactWebsite]]></type><value><![CDATA["+$("#txtContactWebsite").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactAgency]]></type><value><![CDATA["+$("#txtContactAgency").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[contactCountry]]></type><value><![CDATA["+$("#txtContactCountry").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[usage]]></type><value><![CDATA["+$("#txtUsageInfo").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[voicedubbing]]></type><value><![CDATA["+$("#txtVoiceDubbing").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[usageExceptions]]></type><value><![CDATA["+$("#txtExceptionInfo").val()+"]]></value></meta>";meta+="<meta><type><![CDATA[segmentExceptions]]></type><value><![CDATA["+$("#txtSegExceptions").val()+"]]></value></meta>";if(crew.type=="expert"||crew.type=="dreamteam")
meta+="<meta><type><![CDATA[selectedExpert]]></type><value><![CDATA["+$("#cboExpertContact").val()+"]]></value></meta>";if(crew.type=="dreamteam"||crew.type=="expert")
meta+="<meta><type><![CDATA[origContractDate]]></type><value><![CDATA["+$("#dpOrigDate").val()+"]]></value></meta>";meta="<metadata>"+meta+"</metadata>";obj.MetaData=meta;sc.data(obj);if($("#crewID").val()==0)
sc.go({onSuccess:crew.refreshList,onError:crew.handleSaveError});else
sc.go({onSuccess:crew.refreshItem,onError:crew.handleSaveError});}
crew.validForm=function(){var valid;var message="";if($("#txtName").val()==""||$("#txtName").val().length<3){message+="Name is required and must be greater than 3 characters in length, ";}
if(crew.imageid==0)
message+="Asset, ";if(message!="")
message=message.slice(0,-2)+".";if($("#txtFacebook").val()!=""&&!(sd.Utils.isValidURLFormat($("#txtFacebook").val()))){message+="Invalid URL format in Facebook field. ";}
if($("#txtTwitter").val()!=""&&!(sd.Utils.isValidURLFormat($("#txtTwitter").val()))){message+="Invalid URL format in Twitter field. ";}
if($("#txtWebsite").val()!=""&&!(sd.Utils.isValidURLFormat($("#txtWebsite").val()))){message+="Invalid URL format in Website field.";}
return message;}
crew.selChange=function(){}
crew.addEventListeners=function(){$("#crewList_btn").on("click",function(){crew.viewMode="list";crew.createList("sortname",null);$("#crewThumb_btn").removeClass("view-as-selected ")
$("#crewList_btn").addClass("view-as-selected ");});$("#crewThumb_btn").on("click",function(){crew.viewMode="thumb";crew.createList("sortname",null);$("#crewList_btn").removeClass("view-as-selected ")
$("#crewThumb_btn").addClass("view-as-selected ");});$("#crewAdd_btn").bind("click",function(){crew.id=0;crew.imageid=0;crew.loadCrewForm("Add");});$(".crewShuffle_btn").on("click",function(){$('#txtFilterCrew').val("");crew.currentPage=1;for(var k=0;k<crew.allUniqueMetaAttributes.length;k++)
$("#chk"+k).prop("checked",false);crew.shuffle=true;crew.createList();$(".crewShuffle_btn").removeClass("unselected");$("#crewList_btn").removeClass("view-as-selected");$("#crewThumb_btn").addClass("view-as-selected");});$("#crewExcel_btn").bind("click",function(){var now=new Date().getTime();var url=sd.Configuration.ws+"/ExcelExport.aspx?report=CrewExport&types=expert,dreamteam&timestamp"+now;window.open(url);});$("#crewReset_btn").bind("click",function(){$('#loader').show();crew.shuffle=false;crew.appliedFilters=[];$("#dpCrewStartDate").val("");$("#dpCrewEndDate").val("");$('#txtFilterCrew').val("");crew.currentPage=1;crew.createList("sortname",null);$("#crewReset_btn").hide();});$("#crewReset_btn").hide();}
crew.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
crew.startDateFilterChanged=function(date){crew.removeFilterFromArray(-1);crew.shuffle=false;var obj={};obj.id=-1;obj.type="sd";obj.value=date;crew.currentPage=1;crew.appliedFilters.push(obj);crew.createList("sortname",null);}
crew.endDateFilterChanged=function(date){crew.removeFilterFromArray(-2);crew.shuffle=false;var obj={};obj.id=-2;obj.type="ed";obj.value=date;crew.currentPage=1;crew.appliedFilters.push(obj);crew.createList("sortname",null);}
crew.deleteItem=function(){sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deletedConfirmed,this),icon2:"icon-ban-circle",btn2:"No"});}
crew.deletedConfirmed=function(){var obj={};obj.inode=crew.id;var sc=new sd.ServerCall("DeleteCrewItem");sc.data(obj);sc.go({onSuccess:crew.reloadList,onError:crew.handleSaveError});}
crew.refreshList=function(){sd.component.messageBox.close();var sc=new sd.ServerCall("ListCrew");var obj={};obj.type=crew.type;obj.fnode=crew.root;sc.data(obj);sc.go({onSuccess:crew.handleList,onError:crew.handleError});}
crew.reloadList=function(){sd.component.messageBox.close();LoadSection("crew",true,crew.options);}
crew.uploadComplete=function(newFiles){var count=newFiles.length-1;crew.imageid=newFiles[count].i_node;var html=newFiles[count].name+" <a id=\"icon-remove\" class=\"icon-remove removeAsset right ma-l-half\" title=\"Remove This Asset\"></a>";$("#spCrewAsset").html(html);$("#spCrewAsset .removeAsset").click(function(){crew.imageid=0;$("#spCrewAsset").html("");});}
crew.handleSaveError=function(error){sd.component.messageBox.showError(error);}
crew.removeFilterFromPanel=function(id){crew.currentPage=1;crew.removeFilterFromArray(id);crew.createList("sortname",null);}
crew.removeFilterFromArray=function(id){for(var j=0;j<crew.appliedFilters.length;j++){if(crew.appliedFilters[j].id==id){crew.appliedFilters.splice(j,1);break;}}}
window.crew=crew;}(window));﻿(function(window){var disclaimer={};disclaimer.currentList=[];disclaimer.currentSortBy;disclaimer.currentSortDirection;disclaimer.currentDisclaimer;disclaimer.initAdmin=function(){disclaimer.selectedItem=null;disclaimer.currentSortDirection="ASC";disclaimer.currentSortBy="name";disclaimer.currentDisclaimer=[];$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleName').click(function(){disclaimer.displayList("name");});$('#sectionContainer .sectionTitleDesc').click(function(){disclaimer.displayList("description");});$('#sectionContainer .sectionTitleDownload').click(function(){disclaimer.displayList("canDownload");});$('#disclaimerFilterText').on('input',function(){disclaimer.displayList(disclaimer.currentSortBy,disclaimer.currentSortDirection);});disclaimer.addEventListeners();disclaimer.getList();}
disclaimer.getList=function(){var sc=new sd.ServerCall("ListDisclaimers");sc.go({onSuccess:disclaimer.handleAdmin,onError:disclaimer.handleError});}
disclaimer.handleAdmin=function(myData,status){disclaimer.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={};item.id=myData[idx].i_node;item.name=myData[idx].item;item.description=myData[idx].description;if(myData[idx].canDownload==0){item.canDownload="No";}
else{item.canDownload="Yes";}
disclaimer.currentList.push(item);}
disclaimer.displayList(disclaimer.currentSortBy,disclaimer.currentSortDirection);}
disclaimer.displayList=function(sortBy,sortDirection){if(sortBy!=undefined||sortDirection!=undefined){if(disclaimer.currentSortBy==sortBy){if(disclaimer.currentSortBy=="name")sd.Utils.sortArrayByString(disclaimer.currentList,"name");if(disclaimer.currentSortBy=="description")sd.Utils.sortArrayByString(disclaimer.currentList,"description");if(disclaimer.currentSortBy=="canDownload")sd.Utils.sortArrayByString(disclaimer.currentList,"canDownload");if(sortDirection!=disclaimer.currentSortDirection){if(disclaimer.currentSortDirection=="ASC")disclaimer.currentSortDirection="DESC";else disclaimer.currentSortDirection="ASC";}}
else{disclaimer.currentSortBy=sortBy;disclaimer.currentSortDirection=sortDirection||"ASC";if(disclaimer.currentSortBy=="name")sd.Utils.sortArrayByString(disclaimer.currentList,"name");if(disclaimer.currentSortBy=="description")sd.Utils.sortArrayByString(disclaimer.currentList,"description");if(disclaimer.currentSortBy=="canDownload")sd.Utils.sortArrayByString(disclaimer.currentList,"canDownload");}
$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(disclaimer.currentSortDirection=="ASC")sortArrow="icon-chevron-up";if(disclaimer.currentSortBy=="name")$('#sectionContainer .sectionTitleName > .'+sortArrow).show();if(disclaimer.currentSortBy=="description")$('#sectionContainer .sectionTitleDesc > .'+sortArrow).show();if(disclaimer.currentSortBy=="canDownload")$('#sectionContainer .sectionTitleDownload > .'+sortArrow).show();}
var htmlOut="";var listCount=disclaimer.currentList.length;var filterText=$('#disclaimerFilterText').val().toLowerCase();var description="";for(var idx=0;idx<listCount;idx++){var item=disclaimer.currentList[idx];if(disclaimer.currentSortDirection=="DESC")item=disclaimer.currentList[listCount-(idx+1)];if(filterText!=""&&item.name.toLowerCase().indexOf(filterText)<0)continue;description=item.description;if(description.length>150)
description=description.substr(0,147)+"...";htmlOut+="<div class='row grid'>   \
                            <div class='yui3-u-1-4'><div class='section-list-field name'>"+item.name+"</div></div> \
                            <div class='yui3-u-1-4'><div class='section-list-field desc'>"+description+"</div></div> \
                            <div class='yui3-u-1-4'><div class='section-list-field canDownload'>"+item.canDownload+"</div></div> \
                            <div class='yui3-u-1-4'><div class='section-list-field'> \
                            <button class='editDisclaimer adm-general-btn' data-id='"+item.id+"'><i class=\"icon-edit\"></i>  Edit</button> \
                            <button class='delDisclaimer adm-general-btn' data-id='"+item.id+"'><i class=\"icon-trash\"></i>  Remove</button> \
                            </div></div> \
                        </div>";}
$('#dvDisclaimersList').html(htmlOut);$(".editDisclaimer").click(function(){var id=$(this).data('id');disclaimer.editDisclaimer(id);});$(".delDisclaimer").click(function(){var id=$(this).data('id');disclaimer.removeDisclaimer(id);});$('#loader').hide();}
disclaimer.editDisclaimer=function(id){sd.component.messageBox.action({title:"Update Disclaimer",width:800,height:400,template:sd.Configuration.templates.disclaimerDetails,btn1callback:$.proxy(this.saveDisclaimer,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel",loadCallback:function(){var listCount=disclaimer.currentList.length;for(var idx=0;idx<listCount;idx++){var item=disclaimer.currentList[idx];if(id==item.id){$('#dvDisclaimerDetails #disclaimerID').val(id);$("#dvDisclaimerDetails #disclaimerTitle").val(item.name);var body=item.description;$("#dvDisclaimerDetails #disclaimerDescription").val(body);if(item.canDownload=="No")
$("#dvDisclaimerDetails input[name=chkAllowDownload]").prop("checked",false);else
$("#dvDisclaimerDetails input[name=chkAllowDownload]").prop("checked",true);break;}}}});};disclaimer.removeDisclaimer=function(id){disclaimer.selectedItem=id;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:disclaimer.deleteConfirmed,icon2:"icon-ban-circle",btn2:"No"});};disclaimer.deleteConfirmed=function(){var sc=new sd.ServerCall("RemoveDisclaimer");var obj={};obj.disclaimerID=disclaimer.selectedItem;sc.data(obj);sc.go({onSuccess:disclaimer.getList,onError:disclaimer.handleError});}
disclaimer.listDisclaimers=function(){var sc=new sd.ServerCall("ListDisclaimers");sc.go({onSuccess:disclaimer.handleDisclaimers,onError:disclaimer.handleError});};disclaimer.handleDisclaimers=function(myData,status){disclaimer.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={};item.id=myData[idx].i_node;item.name=myData[idx].item;item.description=myData[idx].description;disclaimer.currentList.push(item);}}
disclaimer.addDisclaimerToItem=function(inode){sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:links.deleteConfirmed,icon2:"icon-ban-circle",btn2:"No"});};disclaimer.showLoginDisclaimer=function(){var sc=new sd.ServerCall("ListLoginDisclaimer");sc.go({onSuccess:disclaimer.handleLoginDisclaimer,onError:disclaimer.handleError});}
disclaimer.handleLoginDisclaimer=function(myData,status){if(myData.length>0){if(myData[0].date==null){sd.component.messageBox.action({title:"Disclaimer Information",height:280,width:300,cssClass:"msg-box-front-end-disc",headerClass:"msg-box-front-end-header",bodyClass:"msg-box-front-end-disclaimer",loadCallback:function(){$('#disclaimerText').html(myData[0].description);$('#disclaimerID').val(myData[0].i_node);$('#disclaimerDL').val(myData[0].canDownload);$('.disclaimer-check').show();$('#disclaimerChk').hide();$('.messagebox-escape').hide();$('#termsLink').unbind();$('#termsLink').bind('click',function(){previewer.open(sd.Configuration.terms);});},template:sd.Configuration.templates.disclaimer,btn1callback:function(){var obj={};obj.i_node=0;obj.disclaimer_id=$('#disclaimerID').val();obj.disclaimer_text=$('#disclaimerText').html();var sc=new sd.ServerCall("AddAuditTrail");sc.data(obj);sc.go({onSuccess:function(){sd.component.messageBox.close();},onError:library.handleError});},btn1:"Agree"});}}}
disclaimer.saveDisclaimer=function(){if($("#disclaimerDescription").val()==""||$("#disclaimerTitle").val()==""){sd.component.messageBox.showError("Please enter a disclaimer title and description before saving");return;}
else{var action="AddDisclaimer";var obj={};obj.title=encodeURIComponent($("#disclaimerTitle").val());obj.text=encodeURIComponent($("#disclaimerDescription").val()).replace(/'/g,"%27");if($("#dvDisclaimerDetails input[name=chkAllowDownload]").prop("checked")==true)
obj.canDownload=1;else
obj.canDownload=0;if($("#disclaimerID").val()!=""){action="EditDisclaimer";obj.disclaimerID=$("#disclaimerID").val();}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:disclaimer.refreshAdminList,onError:disclaimer.handleError});}}
disclaimer.refreshAdminList=function(){sd.component.messageBox.close();disclaimer.getList();}
disclaimer.addDisclaimerDialog=function(){sd.component.messageBox.action({title:"Add Disclaimer",width:800,height:400,template:sd.Configuration.templates.disclaimerDetails,btn1callback:$.proxy(this.saveDisclaimer,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
disclaimer.addEventListeners=function(){$("#disclaimernAdd_btn").unbind()
$("#disclaimerAdd_btn").bind("click",function(){disclaimer.addDisclaimerDialog();});$(".admin-close-btn").unbind();$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});}
disclaimer.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.disclaimer=disclaimer;}(window));﻿(function(window){var emailNotification={};emailNotification.inode=null;emailNotification.subject="";emailNotification.body="";emailNotification.includeLink=true;emailNotification.container="";emailNotification.init=function(options)
{var options=options||{};emailNotification.subject=options.subject||"";if(isNaN(options.inode))emailNotification.inode=0;else emailNotification.inode=Number(options.inode);emailNotification.body=options.body||"";emailNotification.includeLink=options.includeLink||true;emailNotification.container=options.container||"#emailNotification";emailNotification.onClose=options.onClose||function(){};$(emailNotification.container).load(sd.Configuration.templates.emailNotification,function()
{$("#emailNotificationSubject").val(emailNotification.subject);if(emailNotification.includeLink&&emailNotification.inode>0)
{var link=sd.Configuration.site+'?i_node='+emailNotification.inode;var body=options.body+"<br><br>Click <a href='"+link+"'>here</a> to view this item";$("#emailNotificationBody").val(body);}
else $("#emailNotificationBody").val(options.body);var editor=new TINY.editor.edit('discussionSubject',{id:'emailNotificationBody',cssclass:'tinyeditor',controlclass:'tinyeditor-control',rowclass:'tinyeditor-header',dividerclass:'tinyeditor-divider',controls:[],footer:false,fonts:[],xhtml:true,cssfile:'custom.css',bodyid:'editor',footerclass:'tinyeditor-footer',toggle:{text:'source',activetext:'wysiwyg',cssclass:'toggle'}});$(emailNotification.container).fadeIn();var x=$(window).width()/2-$(emailNotification.container).width()/2;$(emailNotification.container).css({"position":"absolute","left":x+"px","top":"40px","z-index":"10000"});$("#emailNotificationUsers").multiselect({minWidth:400,noneSelectedText:'Select...',selectedList:30}).multiselectfilter();var obj={};obj.inode=emailNotification.inode;var sc=new sd.ServerCall("GetRecipientList");sc.data(obj);sc.go({onSuccess:emailNotification.handleRecipients});});}
emailNotification.handleRecipients=function(myData,status){var options="";var type=-1;for(var i=0;i<myData.length;i++){if(type!=myData[i].g)
{if(type>=0)options+="</optgroup>";if(myData[i].g==0)options+="<optgroup label='Users'> ";else if(myData[i].g==1)options+="<optgroup label='Groups'> ";type=myData[i].g;}
options+="<option value='"+myData[i].i+"'>"+myData[i].n+"</option>";}
options+="</optgroup>";$("#emailNotificationUsers").append(options);$("#emailNotificationUsers").multiselect('refresh');emailNotification.addEventListeners();}
emailNotification.addEventListeners=function(){$("#emailNotificationSend_btn").click(emailNotification.send);$("#emailNotificationCancel_btn").click(emailNotification.close);$("#previewer_annotationCloseIcon").click(emailNotification.close);}
emailNotification.send=function(){var groups=[];var users=[];var array_of_checked_values=$("#emailNotificationUsers").multiselect("getChecked").map(function(){var id=this.value;if(parseInt(id)>0)groups.push(parseInt(id));else users.push(id);}).get();var obj={};obj.subject=$("#emailNotificationSubject").val();obj.body=$("iframe").contents().find("#editor").html();obj.users=users;obj.groupList=groups;var sc=new sd.ServerCall("SendEmailNotification");sc.data(obj);sc.go();emailNotification.close()}
emailNotification.close=function(){$(emailNotification.container).empty();$(emailNotification.container).hide();emailNotification.onClose();}
window.emailNotification=emailNotification;}(window));﻿(function(window){var favourites={};favourites.init=function(){favourites.listFavourites();}
favourites.listFavourites=function(){var sc=new sd.ServerCall("ListFavourites");var obj={};sc.data(obj);sc.go({onSuccess:favourites.populateFavouriteList,onError:favourites.handleError});}
favourites.populateFavouriteList=function(myData,status){var item;var htmlOut="";htmlOut+="<div class=\"head-fav pa-all-1\">Favorites</div>";htmlOut+="<div class=\"opt-scroll\">";htmlOut+="<div class='favs-table pa-all-1'>";if(myData.length==0)
{htmlOut+="<div> You have no favorites </div>";}
else
{for(var i=0;i<myData.length;i++){item=myData[i];htmlOut+="<div class='flex pa-b-1' id='fav"+item.i+"'>";if(item.type=="Document"||item.type=="bestcase")
htmlOut+="<div class=\"self-center\"><image src='images/docicons/defaultsml.png'/></div>";else
htmlOut+="<i class=\"icon-user ico-user\"></i>";htmlOut+="<div class='favs-item brand-color flex self-center pa-l-half' data-id='"+item.i_node+"'>"+item.item+"</div>";htmlOut+="<a style='display:none' class='favs-item-remove ma-l-auto' data-id='"+item.i_node+"'><svg role=\"img\" class=\"svg-icon-nano\" > <use xlink:href=\"#shape-trash\"></use></svg></div>";htmlOut+="</a>";}}
htmlOut+="</div>";htmlOut+="</div>";htmlOut+="<div class=\"edit-head-opt pa-all-1 flex justify-center\"><button class='small brand js-editFavs w-12'>Edit</button></div>";$("#header .js-favList").html(htmlOut);if(myData.length==0)$(".js-editFavs").hide();$(".favs-item").click(function(){header.restAll();JumpToItem($(this).data('id'));});$(".favs-item-remove").click(function(){var id=$(this).data('id');favourites.removeFavourite(id);});$(".js-editFavs").unbind("click").bind("click",function(){$('.favs-item-remove').toggle();$(".favs-item").addClass("delete-fvs");});}
favourites.addFavourite=function(i_node){var sc=new sd.ServerCall("AddFavourite");var obj={};obj.i_node=i_node;sc.data(obj);sc.go({onSuccess:favourites.populateFavouriteList,onError:favourites.handleError});}
favourites.removeFavourite=function(i_node){var sc=new sd.ServerCall("RemoveFavourite");var obj={};obj.i_node=i_node;sc.data(obj);sc.go({onSuccess:favourites.populateFavouriteList,onError:favourites.handleError});}
window.favourites=favourites;}(window));﻿(function(window){var fileUploadDialog={};fileUploadDialog.container=null;fileUploadDialog.onComplete=null;fileUploadDialog.onCancel=null;fileUploadDialog.metaForm=null;fileUploadDialog.init=function(options){fileUploadDialog.container=options.container||"#messageBox";fileUploadDialog.location=options.location||0;fileUploadDialog.files=options.files||[];fileUploadDialog.onSubmit=options.onSubmit||function(){};fileUploadDialog.onCancel=options.onCancel||function(){};$(fileUploadDialog.container).load(sd.Configuration.templates.fileUploadDialog,function(){$(fileUploadDialog.container).show();$("#assetExpiryDate").datepicker({dateFormat:"mm-dd-yy"});fileUploadDialog.loadMetaFormList();fileUploadDialog.addEventListeners();});}
fileUploadDialog.addEventListeners=function(){$("#fileUploadDialog .uploadCancel").click(fileUploadDialog.cancel);$("#fileUploadDialog .uploadFinish").click(fileUploadDialog.upload);$("#metaDataForms").change(function(){fileUploadDialog.loadMetaForm($("#metaDataForms").val());});}
fileUploadDialog.loadMetaFormList=function(){console.log("Lets load the meta data options");var obj=new Object();obj.inode=fileUploadDialog.location;obj.extensionList="";for(var i=0;i<fileUploadDialog.files.length;i++){var fileDetails=fileUploadDialog.files[i].name.split(".");obj.extensionList+=fileDetails[fileDetails.length-1]+",";}
var sc=new sd.ServerCall("ListMetaForms");sc.data(obj);sc.go({onSuccess:fileUploadDialog.handleMetaForms});}
fileUploadDialog.handleMetaForms=function(myData,status){console.log("handleMetaForms "+myData.length);if(myData.length==0)
{$(fileUploadDialog.container+" .uploadMetaData").hide();}
var optionsHTML="<option value=\"0\" >Select A Meta Form</option>";for(var i=0;i<myData.length;i++){optionsHTML+="<option value=\""+myData[i].i_node+"\" >"+myData[i].item+"</option>";}
$("#metaDataForms").html(optionsHTML);}
fileUploadDialog.loadMetaForm=function(formID){$(fileUploadDialog.container+" .uploadMetaForm").empty();if(formID==0){$(fileUploadDialog.container+" .uploadMetaForm").hide();}else{fileUploadDialog.metaForm=new sd.Form({'id':formID,'container':fileUploadDialog.container+" .uploadMetaForm"});fileUploadDialog.metaForm.getDetails({onSuccess:fileUploadDialog.handleForm});}}
fileUploadDialog.handleForm=function(form){console.log("fileUploadDialog.handleForm");console.log(form.fields);var formHTML="";for(var i=0;i<form.fields.length;i++)
{formHTML+="<div class='metaFormItem  yui3-g-r'><div class='metaFormQuestion yui3-u-1-4'>"+form.fields[i].label+"</div><div class='metaFormComponent  yui3-u-3-4'>";formHTML+=form.fieldAsHTMLFormElement(i);formHTML+="</div></div>";}
$(fileUploadDialog.container+" .uploadMetaForm").show();$(fileUploadDialog.container+" .uploadMetaForm").html(formHTML);}
fileUploadDialog.cancel=function(){fileUploadDialog.close();$(fileUploadDialog.container).empty()
fileUploadDialog.onCancel();}
fileUploadDialog.upload=function(){var uploadDetails={};uploadDetails.description=$('textarea#fileUploadDescription').val();uploadDetails.meta=(fileUploadDialog.metaForm==null)?"":fileUploadDialog.metaForm.getMetaFormInputXML();uploadDetails.endDate=$("#assetExpiryDate").val()
uploadDetails.sendEmail=($("#sendEmailNotificationFlag").attr('checked')=="checked")?true:false;fileUploadDialog.onSubmit(uploadDetails);fileUploadDialog.close();}
fileUploadDialog.close=function(){$(fileUploadDialog.container).empty();}
window.fileUploadDialog=fileUploadDialog;}(window));var libFuncName=null;if(typeof jQuery=="undefined"&&typeof Zepto=="undefined"&&typeof $=="function")libFuncName=$;else if(typeof jQuery=="function")libFuncName=jQuery;else{if(typeof Zepto!="function")throw new TypeError;libFuncName=Zepto}(function(e,t,n,r){"use strict";e("head").append('<meta class="foundation-mq-small">'),e("head").append('<meta class="foundation-mq-medium">'),e("head").append('<meta class="foundation-mq-large">'),t.matchMedia=t.matchMedia||function(e,t){var n,r=e.documentElement,i=r.firstElementChild||r.firstChild,s=e.createElement("body"),o=e.createElement("div");return o.id="mq-test-1",o.style.cssText="position:absolute;top:-100em",s.style.background="none",s.appendChild(o),function(e){return o.innerHTML='&shy;<style media="'+e+'"> #mq-test-1 { width: 42px; }</style>',r.insertBefore(s,i),n=o.offsetWidth===42,r.removeChild(s),{matches:n,media:e}}}(n),Array.prototype.filter||(Array.prototype.filter=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(typeof e!="function")return;var r=[],i=arguments[1];for(var s=0;s<n;s++)if(s in t){var o=t[s];e&&e.call(i,o,s,t)&&r.push(o)}return r}),Function.prototype.bind||(Function.prototype.bind=function(e){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this==null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!=0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),e.fn.stop=e.fn.stop||function(){return this},t.Foundation={name:"Foundation",version:"4.3.2",cache:{},media_queries:{small:e(".foundation-mq-small").css("font-family").replace(/\'/g,""),medium:e(".foundation-mq-medium").css("font-family").replace(/\'/g,""),large:e(".foundation-mq-large").css("font-family").replace(/\'/g,"")},stylesheet:e("<style></style>").appendTo("head")[0].sheet,init:function(t,n,r,i,s,o){var u,a=[t,r,i,s],f=[],o=o||!1;o&&(this.nc=o),this.rtl=/rtl/i.test(e("html").attr("dir")),this.scope=t||this.scope;if(n&&typeof n=="string"&&!/reflow/i.test(n)){if(/off/i.test(n))return this.off();u=n.split(" ");if(u.length>0)for(var l=u.length-1;l>=0;l--)f.push(this.init_lib(u[l],a))}else{/reflow/i.test(n)&&(a[1]="reflow");for(var c in this.libs)f.push(this.init_lib(c,a))}return typeof n=="function"&&a.unshift(n),this.response_obj(f,a)},response_obj:function(e,t){for(var n=0,r=t.length;n<r;n++)if(typeof t[n]=="function")return t[n]({errors:e.filter(function(e){if(typeof e=="string")return e})});return e},init_lib:function(e,t){return this.trap(function(){return this.libs.hasOwnProperty(e)?(this.patch(this.libs[e]),this.libs[e].init.apply(this.libs[e],t)):function(){}}.bind(this),e)},trap:function(e,t){if(!this.nc)try{return e()}catch(n){return this.error({name:t,message:"could not be initialized",more:n.name+" "+n.message})}return e()},patch:function(e){this.fix_outer(e),e.scope=this.scope,e.rtl=this.rtl},inherit:function(e,t){var n=t.split(" ");for(var r=n.length-1;r>=0;r--)this.lib_methods.hasOwnProperty(n[r])&&(this.libs[e.name][n[r]]=this.lib_methods[n[r]])},random_str:function(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");e||(e=Math.floor(Math.random()*t.length));var n="";for(var r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n},libs:{},lib_methods:{set_data:function(e,t){var n=[this.name,+(new Date),Foundation.random_str(5)].join("-");return Foundation.cache[n]=t,e.attr("data-"+this.name+"-id",n),t},get_data:function(e){return Foundation.cache[e.attr("data-"+this.name+"-id")]},remove_data:function(t){t?(delete Foundation.cache[t.attr("data-"+this.name+"-id")],t.attr("data-"+this.name+"-id","")):e("[data-"+this.name+"-id]").each(function(){delete Foundation.cache[e(this).attr("data-"+this.name+"-id")],e(this).attr("data-"+this.name+"-id","")})},throttle:function(e,t){var n=null;return function(){var r=this,i=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(r,i)},t)}},data_options:function(t){function u(e){return!isNaN(e-0)&&e!==null&&e!==""&&e!==!1&&e!==!0}function a(t){return typeof t=="string"?e.trim(t):t}var n={},r,i,s=(t.attr("data-options")||":").split(";"),o=s.length;for(r=o-1;r>=0;r--)i=s[r].split(":"),/true/i.test(i[1])&&(i[1]=!0),/false/i.test(i[1])&&(i[1]=!1),u(i[1])&&(i[1]=parseInt(i[1],10)),i.length===2&&i[0].length>0&&(n[a(i[0])]=a(i[1]));return n},delay:function(e,t){return setTimeout(e,t)},scrollTo:function(n,r,i){if(i<0)return;var s=r-e(t).scrollTop(),o=s/i*10;this.scrollToTimerCache=setTimeout(function(){isNaN(parseInt(o,10))||(t.scrollTo(0,e(t).scrollTop()+o),this.scrollTo(n,r,i-10))}.bind(this),10)},scrollLeft:function(e){if(!e.length)return;return"scrollLeft"in e[0]?e[0].scrollLeft:e[0].pageXOffset},empty:function(e){if(e.length&&e.length>0)return!1;if(e.length&&e.length===0)return!0;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},addCustomRule:function(e,t){if(t===r)Foundation.stylesheet.insertRule(e,Foundation.stylesheet.cssRules.length);else{var n=Foundation.media_queries[t];n!==r&&Foundation.stylesheet.insertRule("@media "+Foundation.media_queries[t]+"{ "+e+" }")}}},fix_outer:function(e){e.outerHeight=function(e,t){return typeof Zepto=="function"?e.height():typeof t!="undefined"?e.outerHeight(t):e.outerHeight()},e.outerWidth=function(e,t){return typeof Zepto=="function"?e.width():typeof t!="undefined"?e.outerWidth(t):e.outerWidth()}},error:function(e){return e.name+" "+e.message+"; "+e.more},off:function(){return e(this.scope).off(".fndtn"),e(t).off(".fndtn"),!0},zj:e},e.fn.foundation=function(){var e=Array.prototype.slice.call(arguments,0);return this.each(function(){return Foundation.init.apply(Foundation,[this].concat(e)),this})}})(libFuncName,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.interchange={name:"interchange",version:"4.2.4",cache:{},images_loaded:!1,settings:{load_attr:"interchange",named_queries:{"default":"only screen and (min-width: 1px)",small:"only screen and (min-width: 768px)",medium:"only screen and (min-width: 1280px)",large:"only screen and (min-width: 1440px)",landscape:"only screen and (orientation: landscape)",portrait:"only screen and (orientation: portrait)",retina:"only screen and (-webkit-min-device-pixel-ratio: 2),only screen and (min--moz-device-pixel-ratio: 2),only screen and (-o-min-device-pixel-ratio: 2/1),only screen and (min-device-pixel-ratio: 2),only screen and (min-resolution: 192dpi),only screen and (min-resolution: 2dppx)"},directives:{replace:function(e,t){if(/IMG/.test(e[0].nodeName)){var n=e[0].src;if((new RegExp(t,"i")).test(n))return;return e[0].src=t,e.trigger("replace",[e[0].src,n])}}}},init:function(t,n,r){return Foundation.inherit(this,"throttle"),typeof n=="object"&&e.extend(!0,this.settings,n),this.events(),this.images(),typeof n!="string"?this.settings.init:this[n].call(this,r)},events:function(){var n=this;e(t).on("resize.fndtn.interchange",n.throttle(function(){n.resize.call(n)},50))},resize:function(){var t=this.cache;if(!this.images_loaded){setTimeout(e.proxy(this.resize,this),50);return}for(var n in t)if(t.hasOwnProperty(n)){var r=this.results(n,t[n]);r&&this.settings.directives[r.scenario[1]](r.el,r.scenario[0])}},results:function(t,n){var r=n.length;if(r>0){var i=e('[data-uuid="'+t+'"]');for(var s=r-1;s>=0;s--){var o,u=n[s][2];this.settings.named_queries.hasOwnProperty(u)?o=matchMedia(this.settings.named_queries[u]):o=matchMedia(u);if(o.matches)return{el:i,scenario:n[s]}}}return!1},images:function(e){return typeof this.cached_images=="undefined"||e?this.update_images():this.cached_images},update_images:function(){var t=n.getElementsByTagName("img"),r=t.length,i=0,s="data-"+this.settings.load_attr;this.cached_images=[],this.images_loaded=!1;for(var o=r-1;o>=0;o--)this.loaded(e(t[o]),function(e){i++;if(e){var t=e.getAttribute(s)||"";t.length>0&&this.cached_images.push(e)}i===r&&(this.images_loaded=!0,this.enhance())}.bind(this));return"deferred"},loaded:function(e,t){function n(){t(e[0])}function r(){this.one("load",n);if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=this.attr("src"),t=e.match(/\?/)?"&":"?";t+="random="+(new Date).getTime(),this.attr("src",e+t)}}if(!e.attr("src")){n();return}e[0].complete||e[0].readyState===4?n():r.call(e)},enhance:function(){var n=this.images().length;for(var r=n-1;r>=0;r--)this._object(e(this.images()[r]));return e(t).trigger("resize")},parse_params:function(e,t,n){return[this.trim(e),this.convert_directive(t),this.trim(n)]},convert_directive:function(e){var t=this.trim(e);return t.length>0?t:"replace"},_object:function(e){var t=this.parse_data_attr(e),n=[],r=t.length;if(r>0)for(var i=r-1;i>=0;i--){var s=t[i].split(/\((.*?)(\))$/);if(s.length>1){var o=s[0].split(","),u=this.parse_params(o[0],o[1],s[1]);n.push(u)}}return this.store(e,n)},uuid:function(e){function n(){return((1+Math.random())*65536|0).toString(16).substring(1)}var t=e||"-";return n()+n()+t+n()+t+n()+t+n()+t+n()+n()+n()},store:function(e,t){var n=this.uuid(),r=e.data("uuid");return r?this.cache[r]:(e.attr("data-uuid",n),this.cache[n]=t)},trim:function(t){return typeof t=="string"?e.trim(t):t},parse_data_attr:function(e){var t=e.data(this.settings.load_attr).split(/\[(.*?)\]/),n=t.length,r=[];for(var i=n-1;i>=0;i--)t[i].replace(/[\W\d]+/,"").length>4&&r.push(t[i]);return r},reflow:function(){this.images(!0)}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.abide={name:"abide",version:"4.3.2",settings:{live_validate:!0,focus_on_invalid:!0,timeout:1e3,patterns:{alpha:/[a-zA-Z]+/,alpha_numeric:/[a-zA-Z0-9]+/,integer:/-?\d+/,number:/-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?/,password:/(?=^.{8,}$)((?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/,card:/^(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11})$/,cvv:/^([0-9]){3,4}$/,email:/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,url:/(https?|ftp|file|ssh):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?/,domain:/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/,datetime:/([0-2][0-9]{3})\-([0-1][0-9])\-([0-3][0-9])T([0-5][0-9])\:([0-5][0-9])\:([0-5][0-9])(Z|([\-\+]([0-1][0-9])\:00))/,date:/(?:19|20)[0-9]{2}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-9])|(?:(?!02)(?:0[1-9]|1[0-2])-(?:30))|(?:(?:0[13578]|1[02])-31))/,time:/(0[0-9]|1[0-9]|2[0-3])(:[0-5][0-9]){2}/,dateISO:/\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}/,month_day_year:/(0[1-9]|1[012])[- \/.](0[1-9]|[12][0-9]|3[01])[- \/.](19|20)\d\d/,color:/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/}},timer:null,init:function(t,n,r){typeof n=="object"&&e.extend(!0,this.settings,n);if(typeof n=="string")return this[n].call(this,r);this.settings.init||this.events()},events:function(){var t=this,n=e("form[data-abide]",this.scope).attr("novalidate","novalidate");n.on("submit validate",function(n){return t.validate(e(this).find("input, textarea, select").get(),n)}),this.settings.init=!0;if(!this.settings.live_validate)return;n.find("input, textarea, select").on("blur change",function(e){t.validate([this],e)}).on("keydown",function(e){clearTimeout(t.timer),t.timer=setTimeout(function(){t.validate([this],e)}.bind(this),t.settings.timeout)})},validate:function(t,n){var r=this.parse_patterns(t),i=r.length,s=e(t[0]).closest("form");for(var o=0;o<i;o++)if(!r[o]&&/submit/.test(n.type))return this.settings.focus_on_invalid&&t[o].focus(),s.trigger("invalid"),e(t[o]).closest("form").attr("data-invalid",""),!1;return/submit/.test(n.type)&&s.trigger("valid"),s.removeAttr("data-invalid"),!0},parse_patterns:function(e){var t=e.length,n=[];for(var r=t-1;r>=0;r--)n.push(this.pattern(e[r]));return this.check_validation_and_apply_styles(n)},pattern:function(e){var t=e.getAttribute("type"),n=typeof e.getAttribute("required")=="string";if(this.settings.patterns.hasOwnProperty(t))return[e,this.settings.patterns[t],n];var r=e.getAttribute("pattern")||"";return this.settings.patterns.hasOwnProperty(r)&&r.length>0?[e,this.settings.patterns[r],n]:r.length>0?[e,new RegExp(r),n]:(r=/.*/,[e,r,n])},check_validation_and_apply_styles:function(t){var n=t.length,r=[];for(var i=n-1;i>=0;i--){var s=t[i][0],o=t[i][2],u=s.value,a=s.type==="radio",f=o?s.value.length>0:!0;a&&o?r.push(this.valid_radio(s,o)):t[i][1].test(u)&&f||!o&&s.value.length<1?(e(s).removeAttr("data-invalid").parent().removeClass("error"),r.push(!0)):(e(s).attr("data-invalid","").parent().addClass("error"),r.push(!1))}return r},valid_radio:function(t,r){var i=t.getAttribute("name"),s=n.getElementsByName(i),o=s.length,u=!1;for(var a=0;a<o;a++)s[a].checked&&(u=!0);for(var a=0;a<o;a++)u?e(s[a]).removeAttr("data-invalid").parent().removeClass("error"):e(s[a]).attr("data-invalid","").parent().addClass("error");return u}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.dropdown={name:"dropdown",version:"4.3.2",settings:{activeClass:"open",is_hover:!1,opened:function(){},closed:function(){}},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"throttle scrollLeft data_options"),typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||this.events(),this.settings.init):this[n].call(this,r)},events:function(){var r=this;e(this.scope).on("click.fndtn.dropdown","[data-dropdown]",function(t){var n=e.extend({},r.settings,r.data_options(e(this)));t.preventDefault(),n.is_hover||r.toggle(e(this))}).on("mouseenter","[data-dropdown]",function(t){var n=e.extend({},r.settings,r.data_options(e(this)));n.is_hover&&r.toggle(e(this))}).on("mouseleave","[data-dropdown-content]",function(t){var n=e('[data-dropdown="'+e(this).attr("id")+'"]'),i=e.extend({},r.settings,r.data_options(n));i.is_hover&&r.close.call(r,e(this))}).on("opened.fndtn.dropdown","[data-dropdown-content]",this.settings.opened).on("closed.fndtn.dropdown","[data-dropdown-content]",this.settings.closed),e(n).on("click.fndtn.dropdown",function(t){var n=e(t.target).closest("[data-dropdown-content]");if(e(t.target).data("dropdown")||e(t.target).parent().data("dropdown"))return;if(!e(t.target).data("revealId")&&n.length>0&&(e(t.target).is("[data-dropdown-content]")||e.contains(n.first()[0],t.target))){t.stopPropagation();return}r.close.call(r,e("[data-dropdown-content]"))}),e(t).on("resize.fndtn.dropdown",r.throttle(function(){r.resize.call(r)},50)).trigger("resize"),this.settings.init=!0},close:function(t){var n=this;t.each(function(){e(this).hasClass(n.settings.activeClass)&&(e(this).css(Foundation.rtl?"right":"left","-99999px").removeClass(n.settings.activeClass),e(this).trigger("closed"))})},open:function(e,t){this.css(e.addClass(this.settings.activeClass),t),e.trigger("opened")},toggle:function(t){var n=e("#"+t.data("dropdown"));if(n.length===0)return;this.close.call(this,e("[data-dropdown-content]").not(n)),n.hasClass(this.settings.activeClass)?this.close.call(this,n):(this.close.call(this,e("[data-dropdown-content]")),this.open.call(this,n,t))},resize:function(){var t=e("[data-dropdown-content].open"),n=e("[data-dropdown='"+t.attr("id")+"']");t.length&&n.length&&this.css(t,n)},css:function(n,r){var i=n.offsetParent(),s=r.offset();s.top-=i.offset().top,s.left-=i.offset().left;if(this.small())n.css({position:"absolute",width:"95%","max-width":"none",top:s.top+this.outerHeight(r)}),n.css(Foundation.rtl?"right":"left","2.5%");else{if(!Foundation.rtl&&e(t).width()>this.outerWidth(n)+r.offset().left&&!this.data_options(r).align_right){var o=s.left;n.hasClass("right")&&n.removeClass("right")}else{n.hasClass("right")||n.addClass("right");var o=s.left-(this.outerWidth(n)-this.outerWidth(r))}n.attr("style","").css({position:"absolute",top:s.top+this.outerHeight(r),left:o})}return n},small:function(){return e(t).width()<768||e("html").hasClass("lt-ie9")},off:function(){e(this.scope).off(".fndtn.dropdown"),e("html, body").off(".fndtn.dropdown"),e(t).off(".fndtn.dropdown"),e("[data-dropdown-content]").off(".fndtn.dropdown"),this.settings.init=!1},reflow:function(){}}}(Foundation.zj,this,this.document),function(e){"use strict";function t(e,t,n){if(e.addEventListener)return e.addEventListener(t,n,!1);if(e.attachEvent)return e.attachEvent("on"+t,n)}function n(e,t){var n,r;for(n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1}function r(e,t){var n;e.createTextRange?(n=e.createTextRange(),n.move("character",t),n.select()):e.selectionStart&&(e.focus(),e.setSelectionRange(t,t))}function i(e,t){try{return e.type=t,!0}catch(n){return!1}}e.Placeholders={Utils:{addEventListener:t,inArray:n,moveCaret:r,changeType:i}}}(this),function(e){"use strict";function M(){}function _(e){var t;return e.value===e.getAttribute(a)&&e.getAttribute(f)==="true"?(e.setAttribute(f,"false"),e.value="",e.className=e.className.replace(s,""),t=e.getAttribute(l),t&&(e.type=t),!0):!1}function D(e){var t,n=e.getAttribute(a);return e.value===""&&n?(e.setAttribute(f,"true"),e.value=n,e.className+=" "+i,t=e.getAttribute(l),t?e.type="text":e.type==="password"&&b.changeType(e,"text")&&e.setAttribute(l,"password"),!0):!1}function P(e,t){var n,r,i,s,f;if(e&&e.getAttribute(a))t(e);else{n=e?e.getElementsByTagName("input"):o,r=e?e.getElementsByTagName("textarea"):u;for(f=0,s=n.length+r.length;f<s;f++)i=f<n.length?n[f]:r[f-n.length],t(i)}}function H(e){P(e,_)}function B(e){P(e,D)}function j(e){return function(){w&&e.value===e.getAttribute(a)&&e.getAttribute(f)==="true"?b.moveCaret(e,0):_(e)}}function F(e){return function(){D(e)}}function I(e){return function(t){S=e.value;if(e.getAttribute(f)==="true"&&S===e.getAttribute(a)&&b.inArray(n,t.keyCode))return t.preventDefault&&t.preventDefault(),!1}}function q(e){return function(){var t;e.getAttribute(f)==="true"&&e.value!==S&&(e.className=e.className.replace(s,""),e.value=e.value.replace(e.getAttribute(a),""),e.setAttribute(f,!1),t=e.getAttribute(l),t&&(e.type=t)),e.value===""&&(e.blur(),b.moveCaret(e,0))}}function R(e){return function(){e===document.activeElement&&e.value===e.getAttribute(a)&&e.getAttribute(f)==="true"&&b.moveCaret(e,0)}}function U(e){return function(){H(e)}}function z(e){e.form&&(k=e.form,k.getAttribute(c)||(b.addEventListener(k,"submit",U(k)),k.setAttribute(c,"true"))),b.addEventListener(e,"focus",j(e)),b.addEventListener(e,"blur",F(e)),w&&(b.addEventListener(e,"keydown",I(e)),b.addEventListener(e,"keyup",q(e)),b.addEventListener(e,"click",R(e))),e.setAttribute(h,"true"),e.setAttribute(a,N),D(e)}var t=["text","search","url","tel","email","password","number","textarea"],n=[27,33,34,35,36,37,38,39,40,8,46],r="#ccc",i="placeholdersjs",s=new RegExp("(?:^|\\s)"+i+"(?!\\S)"),o,u,a="data-placeholder-value",f="data-placeholder-active",l="data-placeholder-type",c="data-placeholder-submit",h="data-placeholder-bound",p="data-placeholder-focus",d="data-placeholder-live",v=document.createElement("input"),m=document.getElementsByTagName("head")[0],g=document.documentElement,y=e.Placeholders,b=y.Utils,w,E,S,x,T,N,C,k,L,A,O;y.nativeSupport=v.placeholder!==void 0;if(!y.nativeSupport){o=document.getElementsByTagName("input"),u=document.getElementsByTagName("textarea"),w=g.getAttribute(p)==="false",E=g.getAttribute(d)!=="false",x=document.createElement("style"),x.type="text/css",T=document.createTextNode("."+i+" { color:"+r+"; }"),x.styleSheet?x.styleSheet.cssText=T.nodeValue:x.appendChild(T),m.insertBefore(x,m.firstChild);for(O=0,A=o.length+u.length;O<A;O++)L=O<o.length?o[O]:u[O-o.length],N=L.attributes.placeholder,N&&(N=N.nodeValue,N&&b.inArray(t,L.type)&&z(L));C=setInterval(function(){for(O=0,A=o.length+u.length;O<A;O++){L=O<o.length?o[O]:u[O-o.length],N=L.attributes.placeholder;if(N){N=N.nodeValue;if(N&&b.inArray(t,L.type)){L.getAttribute(h)||z(L);if(N!==L.getAttribute(a)||L.type==="password"&&!L.getAttribute(l))L.type==="password"&&!L.getAttribute(l)&&b.changeType(L,"text")&&L.setAttribute(l,"password"),L.value===L.getAttribute(a)&&(L.value=N),L.setAttribute(a,N)}}}E||clearInterval(C)},100)}y.disable=y.nativeSupport?M:H,y.enable=y.nativeSupport?M:B}(this),function(e,t,n,r){"use strict";Foundation.libs.forms={name:"forms",version:"4.3.2",cache:{},settings:{disable_class:"no-custom",last_combo:null},init:function(t,n,r){return typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||this.events(),this.assemble(),this.settings.init):this[n].call(this,r)},assemble:function(){var t=this;e('form.custom input[type="radio"],[type="checkbox"]',e(this.scope)).not('[data-customforms="disabled"]').not("."+this.settings.disable_class).each(function(e,n){t.set_custom_markup(n)}).change(function(){t.set_custom_markup(this)}),e("form.custom select",e(this.scope)).not('[data-customforms="disabled"]').not("."+this.settings.disable_class).not("[multiple=multiple]").each(this.append_custom_select)},events:function(){var r=this;e(this.scope).on("click.fndtn.forms","form.custom span.custom.checkbox",function(t){t.preventDefault(),t.stopPropagation(),r.toggle_checkbox(e(this))}).on("click.fndtn.forms","form.custom span.custom.radio",function(t){t.preventDefault(),t.stopPropagation(),r.toggle_radio(e(this))}).on("change.fndtn.forms","form.custom select",function(t,n){if(e(this).is('[data-customforms="disabled"]'))return;r.refresh_custom_select(e(this),n)}).on("click.fndtn.forms","form.custom label",function(t){if(e(t.target).is("label")){var n=e("#"+r.escape(e(this).attr("for"))).not('[data-customforms="disabled"]'),i,s;n.length!==0&&(n.attr("type")==="checkbox"?(t.preventDefault(),i=e(this).find("span.custom.checkbox"),i.length===0&&(i=n.add(this).siblings("span.custom.checkbox").first()),r.toggle_checkbox(i)):n.attr("type")==="radio"&&(t.preventDefault(),s=e(this).find("span.custom.radio"),s.length===0&&(s=n.add(this).siblings("span.custom.radio").first()),r.toggle_radio(s)))}}).on("mousedown.fndtn.forms","form.custom div.custom.dropdown",function(){return!1}).on("click.fndtn.forms","form.custom div.custom.dropdown a.current, form.custom div.custom.dropdown a.selector",function(t){var n=e(this),s=n.closest("div.custom.dropdown"),o=i(s,"select");s.hasClass("open")||e(r.scope).trigger("click"),t.preventDefault();if(!1===o.is(":disabled"))return s.toggleClass("open"),s.hasClass("open")?e(r.scope).on("click.fndtn.forms.customdropdown",function(){s.removeClass("open"),e(r.scope).off(".fndtn.forms.customdropdown")}):e(r.scope).on(".fndtn.forms.customdropdown"),!1}).on("click.fndtn.forms touchend.fndtn.forms","form.custom div.custom.dropdown li",function(t){var r=e(this),s=r.closest("div.custom.dropdown"),o=i(s,"select"),u=0;t.preventDefault(),t.stopPropagation();if(!e(this).hasClass("disabled")){e("div.dropdown").not(s).removeClass("open");var a=r.closest("ul").find("li.selected");a.removeClass("selected"),r.addClass("selected"),s.removeClass("open").find("a.current").text(r.text()),r.closest("ul").find("li").each(function(e){r[0]===this&&(u=e)}),o[0].selectedIndex=u,o.data("prevalue",a.html());if(typeof n.createEvent!="undefined"){var f=n.createEvent("HTMLEvents");f.initEvent("change",!0,!0),o[0].dispatchEvent(f)}else o[0].fireEvent("onchange")}}),e(t).on("keydown",function(t){var r=n.activeElement,s=Foundation.libs.forms,o=e(".custom.dropdown"),u=i(o,"select"),a=e("input,select,textarea,button");if(o.length>0&&o.hasClass("open")){t.preventDefault(),t.which===9&&(e(a[e(a).index(u)+1]).focus(),o.removeClass("open")),t.which===13&&o.find("li.selected").trigger("click"),t.which===27&&o.removeClass("open");if(t.which>=65&&t.which<=90){var f=s.go_to(o,t.which),l=o.find("li.selected");f&&(l.removeClass("selected"),s.scrollTo(f.addClass("selected"),300))}if(t.which===38){var l=o.find("li.selected"),c=l.prev(":not(.disabled)");c.length>0&&(c.parent()[0].scrollTop=c.parent().scrollTop()-s.outerHeight(c),l.removeClass("selected"),c.addClass("selected"))}else if(t.which===40){var l=o.find("li.selected"),f=l.next(":not(.disabled)");f.length>0&&(f.parent()[0].scrollTop=f.parent().scrollTop()+s.outerHeight(f),l.removeClass("selected"),f.addClass("selected"))}}}),e(t).on("keyup",function(t){var r=n.activeElement,i=e(".custom.dropdown");r===i.find(".current")[0]&&i.find(".selector").focus().click()}),this.settings.init=!0},go_to:function(e,t){var n=e.find("li"),r=n.length;if(r>0)for(var i=0;i<r;i++){var s=n.eq(i).text().charAt(0).toLowerCase();if(s===String.fromCharCode(t).toLowerCase())return n.eq(i)}},scrollTo:function(e,t){if(t<0)return;var n=e.parent(),r=this.outerHeight(e),i=r*e.index()-n.scrollTop(),s=i/t*10;this.scrollToTimerCache=setTimeout(function(){isNaN(parseInt(s,10))||(n[0].scrollTop=n.scrollTop()+s,this.scrollTo(e,t-10))}.bind(this),10)},set_custom_markup:function(t){var n=e(t),r=n.attr("type"),i=n.next("span.custom."+r);n.parent().hasClass("switch")||n.addClass("hidden-field"),i.length===0&&(i=e('<span class="custom '+r+'"></span>').insertAfter(n)),i.toggleClass("checked",n.is(":checked")),i.toggleClass("disabled",n.is(":disabled"))},append_custom_select:function(t,n){var r=Foundation.libs.forms,i=e(n),s=i.next("div.custom.dropdown"),o=s.find("ul"),u=s.find(".current"),a=s.find(".selector"),f=i.find("option"),l=f.filter(":selected"),c=i.attr("class")?i.attr("class").split(" "):[],h=0,p="",d,v=!1;if(s.length===0){var m=i.hasClass("small")?"small":i.hasClass("medium")?"medium":i.hasClass("large")?"large":i.hasClass("expand")?"expand":"";s=e('<div class="'+["custom","dropdown",m].concat(c).filter(function(e,t,n){return e===""?!1:n.indexOf(e)===t}).join(" ")+'"><a href="#" class="selector"></a><ul /></div>'),a=s.find(".selector"),o=s.find("ul"),p=f.map(function(){var t=e(this).attr("class")?e(this).attr("class"):"";return"<li class='"+t+"'>"+e(this).html()+"</li>"}).get().join(""),o.append(p),v=s.prepend('<a href="#" class="current">'+(l.html()||"")+"</a>").find(".current"),i.after(s).addClass("hidden-field")}else p=f.map(function(){return"<li>"+e(this).html()+"</li>"}).get().join(""),o.html("").append(p);r.assign_id(i,s),s.toggleClass("disabled",i.is(":disabled")),d=o.find("li"),r.cache[s.data("id")]=d.length,f.each(function(t){this.selected&&(d.eq(t).addClass("selected"),v&&v.html(e(this).html())),e(this).is(":disabled")&&d.eq(t).addClass("disabled")});if(!s.is(".small, .medium, .large, .expand")){s.addClass("open");var r=Foundation.libs.forms;r.hidden_fix.adjust(o),h=r.outerWidth(d)>h?r.outerWidth(d):h,Foundation.libs.forms.hidden_fix.reset(),s.removeClass("open")}},assign_id:function(e,t){var n=[+(new Date),Foundation.random_str(5)].join("-");e.attr("data-id",n),t.attr("data-id",n)},refresh_custom_select:function(t,n){var r=this,i=0,s=t.next(),o=t.find("option"),u=s.find("ul"),a=s.find("li");if(o.length!==this.cache[s.data("id")]||n){u.html("");var f="";o.each(function(){var t=e(this),n=t.html(),r=this.selected;f+='<li class="'+(r?" selected ":"")+(t.is(":disabled")?" disabled ":"")+'">'+n+"</li>",r&&s.find(".current").html(n)}),u.html(f),s.removeAttr("style"),u.removeAttr("style"),s.find("li").each(function(){s.addClass("open"),r.outerWidth(e(this))>i&&(i=r.outerWidth(e(this))),s.removeClass("open")}),a=s.find("li"),this.cache[s.data("id")]=a.length}},refresh_custom_selection:function(t){var n=e("option:selected",t).text();e("a.current",t.next()).text(n)},toggle_checkbox:function(e){var t=e.prev(),n=t[0];!1===t.is(":disabled")&&(n.checked=n.checked?!1:!0,e.toggleClass("checked"),t.trigger("change"))},toggle_radio:function(e){var t=e.prev(),n=t.closest("form.custom"),r=t[0];!1===t.is(":disabled")&&(n.find('input[type="radio"][name="'+this.escape(t.attr("name"))+'"]').next().not(e).removeClass("checked"),e.hasClass("checked")||e.toggleClass("checked"),r.checked=e.hasClass("checked"),t.trigger("change"))},escape:function(e){return e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""},hidden_fix:{tmp:[],hidden:null,adjust:function(t){var n=this;n.hidden=t.parents(),n.hidden=n.hidden.add(t).filter(":hidden"),n.hidden.each(function(){var t=e(this);n.tmp.push(t.attr("style")),t.css({visibility:"hidden",display:"block"})})},reset:function(){var t=this;t.hidden.each(function(n){var i=e(this),s=t.tmp[n];s===r?i.removeAttr("style"):i.attr("style",s)}),t.tmp=[],t.hidden=null}},off:function(){e(this.scope).off(".fndtn.forms")},reflow:function(){}};var i=function(t,n){var t=t.prev();while(t.length){if(t.is(n))return t;t=t.prev()}return e()}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.alerts={name:"alerts",version:"4.3.2",settings:{animation:"fadeOut",speed:300,callback:function(){}},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"data_options"),typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||this.events(),this.settings.init):this[n].call(this,r)},events:function(){var t=this;e(this.scope).on("click.fndtn.alerts","[data-alert] a.close",function(n){var r=e(this).closest("[data-alert]"),i=e.extend({},t.settings,t.data_options(r));n.preventDefault(),r[i.animation](i.speed,function(){e(this).remove(),i.callback()})}),this.settings.init=!0},off:function(){e(this.scope).off(".fndtn.alerts")},reflow:function(){}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.magellan={name:"magellan",version:"4.3.2",settings:{activeClass:"active",threshold:0},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"data_options"),typeof n=="object"&&e.extend(!0,this.settings,n),typeof n!="string"?(this.settings.init||(this.fixed_magellan=e("[data-magellan-expedition]"),this.set_threshold(),this.last_destination=e("[data-magellan-destination]").last(),this.events()),this.settings.init):this[n].call(this,r)},events:function(){var n=this;e(this.scope).on("arrival.fndtn.magellan","[data-magellan-arrival]",function(t){var r=e(this),i=r.closest("[data-magellan-expedition]"),s=i.attr("data-magellan-active-class")||n.settings.activeClass;r.closest("[data-magellan-expedition]").find("[data-magellan-arrival]").not(r).removeClass(s),r.addClass(s)}),this.fixed_magellan.on("update-position.fndtn.magellan",function(){var t=e(this)}).trigger("update-position"),e(t).on("resize.fndtn.magellan",function(){this.fixed_magellan.trigger("update-position")}.bind(this)).on("scroll.fndtn.magellan",function(){var r=e(t).scrollTop();n.fixed_magellan.each(function(){var t=e(this);typeof t.data("magellan-top-offset")=="undefined"&&t.data("magellan-top-offset",t.offset().top),typeof t.data("magellan-fixed-position")=="undefined"&&t.data("magellan-fixed-position",!1);var i=r+n.settings.threshold>t.data("magellan-top-offset"),s=t.attr("data-magellan-top-offset");t.data("magellan-fixed-position")!=i&&(t.data("magellan-fixed-position",i),i?(t.addClass("fixed"),t.css({position:"fixed",top:0})):(t.removeClass
("fixed"),t.css({position:"",top:""})),i&&typeof s!="undefined"&&s!=0&&t.css({position:"fixed",top:s+"px"}))})}),this.last_destination.length>0&&e(t).on("scroll.fndtn.magellan",function(r){var i=e(t).scrollTop(),s=i+e(t).height(),o=Math.ceil(n.last_destination.offset().top);e("[data-magellan-destination]").each(function(){var t=e(this),r=t.attr("data-magellan-destination"),u=t.offset().top-i;u<=n.settings.threshold&&e("[data-magellan-arrival='"+r+"']").trigger("arrival"),s>=e(n.scope).height()&&o>i&&o<s&&e("[data-magellan-arrival]").last().trigger("arrival")})}),this.settings.init=!0},set_threshold:function(){typeof this.settings.threshold!="number"&&(this.settings.threshold=this.fixed_magellan.length>0?this.outerHeight(this.fixed_magellan,!0):0)},off:function(){e(this.scope).off(".fndtn.magellan"),e(t).off(".fndtn.magellan")},reflow:function(){}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.reveal={name:"reveal",version:"4.3.2",locked:!1,settings:{animation:"fadeAndPop",animationSpeed:250,closeOnBackgroundClick:!0,closeOnEsc:!0,dismissModalClass:"close-reveal-modal",bgClass:"reveal-modal-bg",open:function(){},opened:function(){},close:function(){},closed:function(){},bg:e(".reveal-modal-bg"),css:{open:{opacity:0,visibility:"visible",display:"block"},close:{opacity:1,visibility:"hidden",display:"none"}}},init:function(t,n,r){return Foundation.inherit(this,"data_options delay"),typeof n=="object"?e.extend(!0,this.settings,n):typeof r!="undefined"&&e.extend(!0,this.settings,r),typeof n!="string"?(this.events(),this.settings.init):this[n].call(this,r)},events:function(){var t=this;return e(this.scope).off(".fndtn.reveal").on("click.fndtn.reveal","[data-reveal-id]",function(n){n.preventDefault();if(!t.locked){var r=e(this),i=r.data("reveal-ajax");t.locked=!0;if(typeof i=="undefined")t.open.call(t,r);else{var s=i===!0?r.attr("href"):i;t.open.call(t,r,{url:s})}}}).on("click.fndtn.reveal touchend",this.close_targets(),function(n){n.preventDefault();if(!t.locked){var r=e.extend({},t.settings,t.data_options(e(".reveal-modal.open"))),i=e(n.target)[0]===e("."+r.bgClass)[0];if(i&&!r.closeOnBackgroundClick)return;t.locked=!0,t.close.call(t,i?e(".reveal-modal.open"):e(this).closest(".reveal-modal"))}}),e(this.scope).hasClass("reveal-modal")?e(this.scope).on("open.fndtn.reveal",this.settings.open).on("opened.fndtn.reveal",this.settings.opened).on("opened.fndtn.reveal",this.open_video).on("close.fndtn.reveal",this.settings.close).on("closed.fndtn.reveal",this.settings.closed).on("closed.fndtn.reveal",this.close_video):e(this.scope).on("open.fndtn.reveal",".reveal-modal",this.settings.open).on("opened.fndtn.reveal",".reveal-modal",this.settings.opened).on("opened.fndtn.reveal",".reveal-modal",this.open_video).on("close.fndtn.reveal",".reveal-modal",this.settings.close).on("closed.fndtn.reveal",".reveal-modal",this.settings.closed).on("closed.fndtn.reveal",".reveal-modal",this.close_video),e("body").bind("keyup.reveal",function(n){var r=e(".reveal-modal.open"),i=e.extend({},t.settings,t.data_options(r));n.which===27&&i.closeOnEsc&&r.foundation("reveal","close")}),!0},open:function(t,n){if(t)if(typeof t.selector!="undefined")var r=e("#"+t.data("reveal-id"));else{var r=e(this.scope);n=t}else var r=e(this.scope);if(!r.hasClass("open")){var i=e(".reveal-modal.open");typeof r.data("css-top")=="undefined"&&r.data("css-top",parseInt(r.css("top"),10)).data("offset",this.cache_offset(r)),r.trigger("open"),i.length<1&&this.toggle_bg();if(typeof n=="undefined"||!n.url)this.hide(i,this.settings.css.close),this.show(r,this.settings.css.open);else{var s=this,o=typeof n.success!="undefined"?n.success:null;e.extend(n,{success:function(t,n,u){e.isFunction(o)&&o(t,n,u),r.html(t),e(r).foundation("section","reflow"),s.hide(i,s.settings.css.close),s.show(r,s.settings.css.open)}}),e.ajax(n)}}},close:function(t){var t=t&&t.length?t:e(this.scope),n=e(".reveal-modal.open");n.length>0&&(this.locked=!0,t.trigger("close"),this.toggle_bg(),this.hide(n,this.settings.css.close))},close_targets:function(){var e="."+this.settings.dismissModalClass;return this.settings.closeOnBackgroundClick?e+", ."+this.settings.bgClass:e},toggle_bg:function(){e("."+this.settings.bgClass).length===0&&(this.settings.bg=e("<div />",{"class":this.settings.bgClass}).appendTo("body")),this.settings.bg.filter(":visible").length>0?this.hide(this.settings.bg):this.show(this.settings.bg)},show:function(n,r){if(r){if(n.parent("body").length===0){var i=n.wrap('<div style="display: none;" />').parent();n.on("closed.fndtn.reveal.wrapped",function(){n.detach().appendTo(i),n.unwrap().unbind("closed.fndtn.reveal.wrapped")}),n.detach().appendTo("body")}if(/pop/i.test(this.settings.animation)){r.top=e(t).scrollTop()-n.data("offset")+"px";var s={top:e(t).scrollTop()+n.data("css-top")+"px",opacity:1};return this.delay(function(){return n.css(r).animate(s,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.trigger("opened")}.bind(this)).addClass("open")}.bind(this),this.settings.animationSpeed/2)}if(/fade/i.test(this.settings.animation)){var s={opacity:1};return this.delay(function(){return n.css(r).animate(s,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.trigger("opened")}.bind(this)).addClass("open")}.bind(this),this.settings.animationSpeed/2)}return n.css(r).show().css({opacity:1}).addClass("open").trigger("opened")}return/fade/i.test(this.settings.animation)?n.fadeIn(this.settings.animationSpeed/2):n.show()},hide:function(n,r){if(r){if(/pop/i.test(this.settings.animation)){var i={top:-e(t).scrollTop()-n.data("offset")+"px",opacity:0};return this.delay(function(){return n.animate(i,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.css(r).trigger("closed")}.bind(this)).removeClass("open")}.bind(this),this.settings.animationSpeed/2)}if(/fade/i.test(this.settings.animation)){var i={opacity:0};return this.delay(function(){return n.animate(i,this.settings.animationSpeed,"linear",function(){this.locked=!1,n.css(r).trigger("closed")}.bind(this)).removeClass("open")}.bind(this),this.settings.animationSpeed/2)}return n.hide().css(r).removeClass("open").trigger("closed")}return/fade/i.test(this.settings.animation)?n.fadeOut(this.settings.animationSpeed/2):n.hide()},close_video:function(t){var n=e(this).find(".flex-video"),r=n.find("iframe");r.length>0&&(r.attr("data-src",r[0].src),r.attr("src","about:blank"),n.hide())},open_video:function(t){var n=e(this).find(".flex-video"),i=n.find("iframe");if(i.length>0){var s=i.attr("data-src");if(typeof s=="string")i[0].src=i.attr("data-src");else{var o=i[0].src;i[0].src=r,i[0].src=o}n.show()}},cache_offset:function(e){var t=e.show().height()+parseInt(e.css("top"),10);return e.hide(),t},off:function(){e(this.scope).off(".fndtn.reveal")},reflow:function(){}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.tooltips={name:"tooltips",version:"4.3.2",settings:{selector:".has-tip",additionalInheritableClasses:[],tooltipClass:".tooltip",touchCloseText:"tap to close",appendTo:"body","disable-for-touch":!1,tipTemplate:function(e,t){return'<span data-selector="'+e+'" class="'+Foundation.libs.tooltips.settings.tooltipClass.substring(1)+'">'+t+'<span class="nub"></span></span>'}},cache:{},init:function(t,n,r){Foundation.inherit(this,"data_options");var i=this;typeof n=="object"?e.extend(!0,this.settings,n):typeof r!="undefined"&&e.extend(!0,this.settings,r);if(typeof n=="string")return this[n].call(this,r);Modernizr.touch?e(this.scope).on("click.fndtn.tooltip touchstart.fndtn.tooltip touchend.fndtn.tooltip","[data-tooltip]",function(t){var n=e.extend({},i.settings,i.data_options(e(this)));n["disable-for-touch"]||(t.preventDefault(),e(n.tooltipClass).hide(),i.showOrCreateTip(e(this)))}).on("click.fndtn.tooltip touchstart.fndtn.tooltip touchend.fndtn.tooltip",this.settings.tooltipClass,function(t){t.preventDefault(),e(this).fadeOut(150)}):e(this.scope).on("mouseenter.fndtn.tooltip mouseleave.fndtn.tooltip","[data-tooltip]",function(t){var n=e(this);/enter|over/i.test(t.type)?i.showOrCreateTip(n):(t.type==="mouseout"||t.type==="mouseleave")&&i.hide(n)})},showOrCreateTip:function(e){var t=this.getTip(e);return t&&t.length>0?this.show(e):this.create(e)},getTip:function(t){var n=this.selector(t),r=null;return n&&(r=e('span[data-selector="'+n+'"]'+this.settings.tooltipClass)),typeof r=="object"?r:!1},selector:function(e){var t=e.attr("id"),n=e.attr("data-tooltip")||e.attr("data-selector");return(t&&t.length<1||!t)&&typeof n!="string"&&(n="tooltip"+Math.random().toString(36).substring(7),e.attr("data-selector",n)),t&&t.length>0?t:n},create:function(t){var n=e(this.settings.tipTemplate(this.selector(t),e("<div></div>").html(t.attr("title")).html())),r=this.inheritable_classes(t);n.addClass(r).appendTo(this.settings.appendTo),Modernizr.touch&&n.append('<span class="tap-to-close">'+this.settings.touchCloseText+"</span>"),t.removeAttr("title").attr("title",""),this.show(t)},reposition:function(n,r,i){var s,o,u,a,f,l;r.css("visibility","hidden").show(),s=n.data("width"),o=r.children(".nub"),u=this.outerHeight(o),a=this.outerHeight(o),l=function(e,t,n,r,i,s){return e.css({top:t?t:"auto",bottom:r?r:"auto",left:i?i:"auto",right:n?n:"auto",width:s?s:"auto"}).end()},l(r,n.offset().top+this.outerHeight(n)+10,"auto","auto",n.offset().left,s);if(e(t).width()<767)l(r,n.offset().top+this.outerHeight(n)+10,"auto","auto",12.5,e(this.scope).width()),r.addClass("tip-override"),l(o,-u,"auto","auto",n.offset().left);else{var c=n.offset().left;Foundation.rtl&&(c=n.offset().left+n.offset().width-this.outerWidth(r)),l(r,n.offset().top+this.outerHeight(n)+10,"auto","auto",c,s),r.removeClass("tip-override"),i&&i.indexOf("tip-top")>-1?l(r,n.offset().top-this.outerHeight(r),"auto","auto",c,s).removeClass("tip-override"):i&&i.indexOf("tip-left")>-1?l(r,n.offset().top+this.outerHeight(n)/2-u*2.5,"auto","auto",n.offset().left-this.outerWidth(r)-u,s).removeClass("tip-override"):i&&i.indexOf("tip-right")>-1&&l(r,n.offset().top+this.outerHeight(n)/2-u*2.5,"auto","auto",n.offset().left+this.outerWidth(n)+u,s).removeClass("tip-override")}r.css("visibility","visible").hide()},inheritable_classes:function(t){var n=["tip-top","tip-left","tip-bottom","tip-right","noradius"].concat(this.settings.additionalInheritableClasses),r=t.attr("class"),i=r?e.map(r.split(" "),function(t,r){if(e.inArray(t,n)!==-1)return t}).join(" "):"";return e.trim(i)},show:function(e){var t=this.getTip(e);this.reposition(e,t,e.attr("class")),t.fadeIn(150)},hide:function(e){var t=this.getTip(e);t.fadeOut(150)},reload:function(){var t=e(this);return t.data("fndtn-tooltips")?t.foundationTooltips("destroy").foundationTooltips("init"):t.foundationTooltips("init")},off:function(){e(this.scope).off(".fndtn.tooltip"),e(this.settings.tooltipClass).each(function(t){e("[data-tooltip]").get(t).attr("title",e(this).text())}).remove()},reflow:function(){}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";Foundation.libs.clearing={name:"clearing",version:"4.3.2",settings:{templates:{viewing:'<a href="#" class="clearing-close">&times;</a><div class="visible-img" style="display: none"><img src="//:0"><p class="clearing-caption"></p><a href="#" class="clearing-main-prev"><span></span></a><a href="#" class="clearing-main-next"><span></span></a></div>'},close_selectors:".clearing-close",init:!1,locked:!1},init:function(t,n,r){var i=this;return Foundation.inherit(this,"set_data get_data remove_data throttle data_options"),typeof n=="object"&&(r=e.extend(!0,this.settings,n)),typeof n!="string"?(e(this.scope).find("ul[data-clearing]").each(function(){var t=e(this),n=n||{},r=t.find("li"),s=i.get_data(t);!s&&r.length>0&&(n.$parent=t.parent(),i.set_data(t,e.extend({},i.settings,n,i.data_options(t))),i.assemble(t.find("li")),i.settings.init||i.events().swipe_events())}),this.settings.init):this[n].call(this,r)},events:function(){var n=this;return e(this.scope).on("click.fndtn.clearing","ul[data-clearing] li",function(t,r,i){var r=r||e(this),i=i||r,s=r.next("li"),o=n.get_data(r.parent()),u=e(t.target);t.preventDefault(),o||n.init(),i.hasClass("visible")&&r[0]===i[0]&&s.length>0&&n.is_open(r)&&(i=s,u=i.find("img")),n.open(u,r,i),n.update_paddles(i)}).on("click.fndtn.clearing",".clearing-main-next",function(e){this.nav(e,"next")}.bind(this)).on("click.fndtn.clearing",".clearing-main-prev",function(e){this.nav(e,"prev")}.bind(this)).on("click.fndtn.clearing",this.settings.close_selectors,function(e){Foundation.libs.clearing.close(e,this)}).on("keydown.fndtn.clearing",function(e){this.keydown(e)}.bind(this)),e(t).on("resize.fndtn.clearing",function(){this.resize()}.bind(this)),this.settings.init=!0,this},swipe_events:function(){var t=this;e(this.scope).on("touchstart.fndtn.clearing",".visible-img",function(t){t.touches||(t=t.originalEvent);var n={start_page_x:t.touches[0].pageX,start_page_y:t.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:r};e(this).data("swipe-transition",n),t.stopPropagation()}).on("touchmove.fndtn.clearing",".visible-img",function(n){n.touches||(n=n.originalEvent);if(n.touches.length>1||n.scale&&n.scale!==1)return;var r=e(this).data("swipe-transition");typeof r=="undefined"&&(r={}),r.delta_x=n.touches[0].pageX-r.start_page_x,typeof r.is_scrolling=="undefined"&&(r.is_scrolling=!!(r.is_scrolling||Math.abs(r.delta_x)<Math.abs(n.touches[0].pageY-r.start_page_y)));if(!r.is_scrolling&&!r.active){n.preventDefault();var i=r.delta_x<0?"next":"prev";r.active=!0,t.nav(n,i)}}).on("touchend.fndtn.clearing",".visible-img",function(t){e(this).data("swipe-transition",{}),t.stopPropagation()})},assemble:function(t){var n=t.parent();n.after('<div id="foundationClearingHolder"></div>');var r=e("#foundationClearingHolder"),i=this.get_data(n),s=n.detach(),o={grid:'<div class="carousel">'+this.outerHTML(s[0])+"</div>",viewing:i.templates.viewing},u='<div class="clearing-assembled"><div>'+o.viewing+o.grid+"</div></div>";return r.after(u).remove()},open:function(e,t,n){var r=n.closest(".clearing-assembled"),i=r.find("div").first(),s=i.find(".visible-img"),o=s.find("img").not(e);this.locked()||(o.attr("src",this.load(e)).css("visibility","hidden"),this.loaded(o,function(){o.css("visibility","visible"),r.addClass("clearing-blackout"),i.addClass("clearing-container"),s.show(),this.fix_height(n).caption(s.find(".clearing-caption"),e).center(o).shift(t,n,function(){n.siblings().removeClass("visible"),n.addClass("visible")})}.bind(this)))},close:function(t,n){t.preventDefault();var r=function(e){return/blackout/.test(e.selector)?e:e.closest(".clearing-blackout")}(e(n)),i,s;return n===t.target&&r&&(i=r.find("div").first(),s=i.find(".visible-img"),this.settings.prev_index=0,r.find("ul[data-clearing]").attr("style","").closest(".clearing-blackout").removeClass("clearing-blackout"),i.removeClass("clearing-container"),s.hide()),!1},is_open:function(e){return e.parent().prop("style").length>0},keydown:function(t){var n=e(".clearing-blackout").find("ul[data-clearing]");t.which===39&&this.go(n,"next"),t.which===37&&this.go(n,"prev"),t.which===27&&e("a.clearing-close").trigger("click")},nav:function(t,n){var r=e(".clearing-blackout").find("ul[data-clearing]");t.preventDefault(),this.go(r,n)},resize:function(){var t=e(".clearing-blackout .visible-img").find("img");t.length&&this.center(t)},fix_height:function(t){var n=t.parent().children(),r=this;return n.each(function(){var t=e(this),n=t.find("img");t.height()>r.outerHeight(n)&&t.addClass("fix-height")}).closest("ul").width(n.length*100+"%"),this},update_paddles:function(e){var t=e.closest(".carousel").siblings(".visible-img");e.next().length>0?t.find(".clearing-main-next").removeClass("disabled"):t.find(".clearing-main-next").addClass("disabled"),e.prev().length>0?t.find(".clearing-main-prev").removeClass("disabled"):t.find(".clearing-main-prev").addClass("disabled")},center:function(e){return this.rtl?e.css({marginRight:-(this.outerWidth(e)/2),marginTop:-(this.outerHeight(e)/2)}):e.css({marginLeft:-(this.outerWidth(e)/2),marginTop:-(this.outerHeight(e)/2)}),this},load:function(e){if(e[0].nodeName==="A")var t=e.attr("href");else var t=e.parent().attr("href");return this.preload(e),t?t:e.attr("src")},preload:function(e){this.img(e.closest("li").next()).img(e.closest("li").prev())},loaded:function(e,t){function n(){t()}function r(){this.one("load",n);if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=this.attr("src"),t=e.match(/\?/)?"&":"?";t+="random="+(new Date).getTime(),this.attr("src",e+t)}}if(!e.attr("src")){n();return}e[0].complete||e[0].readyState===4?n():r.call(e)},img:function(e){if(e.length){var t=new Image,n=e.find("a");n.length?t.src=n.attr("href"):t.src=e.find("img").attr("src")}return this},caption:function(e,t){var n=t.data("caption");return n?e.html(n).show():e.text("").hide(),this},go:function(e,t){var n=e.find(".visible"),r=n[t]();r.length&&r.find("img").trigger("click",[n,r])},shift:function(e,t,n){var r=t.parent(),i=this.settings.prev_index||t.index(),s=this.direction(r,e,t),o=parseInt(r.css("left"),10),u=this.outerWidth(t),a;t.index()!==i&&!/skip/.test(s)?/left/.test(s)?(this.lock(),r.animate({left:o+u},300,this.unlock())):/right/.test(s)&&(this.lock(),r.animate({left:o-u},300,this.unlock())):/skip/.test(s)&&(a=t.index()-this.settings.up_count,this.lock(),a>0?r.animate({left:-(a*u)},300,this.unlock()):r.animate({left:0},300,this.unlock())),n()},direction:function(t,n,r){var i=t.find("li"),s=this.outerWidth(i)+this.outerWidth(i)/4,o=Math.floor(this.outerWidth(e(".clearing-container"))/s)-1,u=i.index(r),a;return this.settings.up_count=o,this.adjacent(this.settings.prev_index,u)?u>o&&u>this.settings.prev_index?a="right":u>o-1&&u<=this.settings.prev_index?a="left":a=!1:a="skip",this.settings.prev_index=u,a},adjacent:function(e,t){for(var n=t+1;n>=t-1;n--)if(n===e)return!0;return!1},lock:function(){this.settings.locked=!0},unlock:function(){this.settings.locked=!1},locked:function(){return this.settings.locked},outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},off:function(){e(this.scope).off(".fndtn.clearing"),e(t).off(".fndtn.clearing"),this.remove_data(),this.settings.init=!1},reflow:function(){this.init()}}}(Foundation.zj,this,this.document),function(e,t,n){function i(e){return e}function s(e){return decodeURIComponent(e.replace(r," "))}var r=/\+/g,o=e.cookie=function(r,u,a){if(u!==n){a=e.extend({},o.defaults,a),u===null&&(a.expires=-1);if(typeof a.expires=="number"){var f=a.expires,l=a.expires=new Date;l.setDate(l.getDate()+f)}return u=o.json?JSON.stringify(u):String(u),t.cookie=[encodeURIComponent(r),"=",o.raw?u:encodeURIComponent(u),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=o.raw?i:s,h=t.cookie.split("; ");for(var p=0,d=h.length;p<d;p++){var v=h[p].split("=");if(c(v.shift())===r){var m=c(v.join("="));return o.json?JSON.parse(m):m}}return null};o.defaults={},e.removeCookie=function(t,n){return e.cookie(t)!==null?(e.cookie(t,null,n),!0):!1}}(Foundation.zj,document),function(e,t,n,r){"use strict";var i=i||!1;Foundation.libs.joyride={name:"joyride",version:"4.3.2",defaults:{expose:!1,modal:!1,tipLocation:"bottom",nubPosition:"auto",scrollSpeed:300,timer:0,startTimerOnClick:!0,startOffset:0,nextButton:!0,tipAnimation:"fade",pauseAfter:[],exposed:[],tipAnimationFadeSpeed:300,cookieMonster:!1,cookieName:"joyride",cookieDomain:!1,cookieExpires:365,tipContainer:"body",postRideCallback:function(){},postStepCallback:function(){},preStepCallback:function(){},preRideCallback:function(){},postExposeCallback:function(){},template:{link:'<a href="#close" class="joyride-close-tip">&times;</a>',timer:'<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',tip:'<div class="joyride-tip-guide"><span class="joyride-nub"></span></div>',wrapper:'<div class="joyride-content-wrapper"></div>',button:'<a href="#" class="small button joyride-next-tip"></a>',modal:'<div class="joyride-modal-bg"></div>',expose:'<div class="joyride-expose-wrapper"></div>',exposeCover:'<div class="joyride-expose-cover"></div>'},exposeAddClass:""},settings:{},init:function(t,n,r){return this.scope=t||this.scope,Foundation.inherit(this,"throttle data_options scrollTo scrollLeft delay"),typeof n=="object"?e.extend(!0,this.settings,this.defaults,n):e.extend(!0,this.settings,this.defaults,r),typeof n!="string"?(this.settings.init||this.events(),this.settings.init):this[n].call(this,r)},events:function(){var n=this;e(this.scope).on("click.joyride",".joyride-next-tip, .joyride-modal-bg",function(e){e.preventDefault(),this.settings.$li.next().length<1?this.end():this.settings.timer>0?(clearTimeout(this.settings.automate),this.hide(),this.show(),this.startTimer()):(this.hide(),this.show())}.bind(this)).on("click.joyride",".joyride-close-tip",function(e){e.preventDefault(),this.end()}.bind(this)),e(t).on("resize.fndtn.joyride",n.throttle(function(){if(e("[data-joyride]").length>0&&n.settings.$next_tip){if(n.settings.exposed.length>0){var t=e(n.settings.exposed);t.each(function(){var t=e(this);n.un_expose(t),n.expose(t)})}n.is_phone()?n.pos_phone():n.pos_default(!1,!0)}},100)),this.settings.init=!0},start:function(){var t=this,n=e(this.scope).find("[data-joyride]"),r=["timer","scrollSpeed","startOffset","tipAnimationFadeSpeed","cookieExpires"],i=r.length;this.settings.init||this.events(),this.settings.$content_el=n,this.settings.$body=e(this.settings.tipContainer),this.settings.body_offset=e(this.settings.tipContainer).position(),this.settings.$tip_content=this.settings.$content_el.find("> li"),this.settings.paused=!1,this.settings.attempts=0,this.settings.tipLocationPatterns={top:["bottom"],bottom:[],left:["right","top","bottom"],right:["left","top","bottom"]},typeof e.cookie!="function"&&(this.settings.cookieMonster=!1);if(!this.settings.cookieMonster||this.settings.cookieMonster&&e.cookie(this.settings.cookieName)===null)this.settings.$tip_content.each(function(n){var s=e(this);e.extend(!0,t.settings,t.data_options(s));for(var o=i-1;o>=0;o--)t.settings[r[o]]=parseInt(t.settings[r[o]],10);t.create({$li:s,index:n})}),!this.settings.startTimerOnClick&&this.settings.timer>0?(this.show("init"),this.startTimer()):this.show("init")},resume:function(){this.set_li(),this.show()},tip_template:function(t){var n,r;return t.tip_class=t.tip_class||"",n=e(this.settings.template.tip).addClass(t.tip_class),r=e.trim(e(t.li).html())+this.button_text(t.button_text)+this.settings.template.link+this.timer_instance(t.index),n.append(e(this.settings.template.wrapper)),n.first().attr("data-index",t.index),e(".joyride-content-wrapper",n).append(r),n[0]},timer_instance:function(t){var n;return t===0&&this.settings.startTimerOnClick&&this.settings.timer>0||this.settings.timer===0?n="":n=this.outerHTML(e(this.settings.template.timer)[0]),n},button_text:function(t){return this.settings.nextButton?(t=e.trim(t)||"Next",t=this.outerHTML(e(this.settings.template.button).append(t)[0])):t="",t},create:function(t){var n=t.$li.attr("data-button")||t.$li.attr("data-text"),r=t.$li.attr("class"),i=e(this.tip_template({tip_class:r,index:t.index,button_text:n,li:t.$li}));e(this.settings.tipContainer).append(i)},show:function(t){var n=null;this.settings.$li===r||e.inArray(this.settings.$li.index(),this.settings.pauseAfter)===-1?(this.settings.paused?this.settings.paused=!1:this.set_li(t),this.settings.attempts=0,this.settings.$li.length&&this.settings.$target.length>0?(t&&(this.settings.preRideCallback(this.settings.$li.index(),this.settings.$next_tip),this.settings.modal&&this.show_modal()),this.settings.preStepCallback(this.settings.$li.index(),this.settings.$next_tip),this.settings.modal&&this.settings.expose&&this.expose(),this.settings.tipSettings=e.extend(this.settings,this.data_options(this.settings.$li)),this.settings.timer=parseInt(this.settings.timer,10),this.settings.tipSettings.tipLocationPattern=this.settings.tipLocationPatterns[this.settings.tipSettings.tipLocation],/body/i.test(this.settings.$target.selector)||this.scroll_to(),this.is_phone()?this.pos_phone(!0):this.pos_default(!0),n=this.settings.$next_tip.find(".joyride-timer-indicator"),/pop/i.test(this.settings.tipAnimation)?(n.width(0),this.settings.timer>0?(this.settings.$next_tip.show(),this.delay(function(){n.animate({width:n.parent().width()},this.settings.timer,"linear")}.bind(this),this.settings.tipAnimationFadeSpeed)):this.settings.$next_tip.show()):/fade/i.test(this.settings.tipAnimation)&&(n.width(0),this.settings.timer>0?(this.settings.$next_tip.fadeIn(this.settings.tipAnimationFadeSpeed).show(),this.delay(function(){n.animate({width:n.parent().width()},this.settings.timer,"linear")}.bind(this),this.settings.tipAnimationFadeSpeed)):this.settings.$next_tip.fadeIn(this.settings.tipAnimationFadeSpeed)),this.settings.$current_tip=this.settings.$next_tip):this.settings.$li&&this.settings.$target.length<1?this.show():this.end()):this.settings.paused=!0},is_phone:function(){return i?i.mq("only screen and (max-width: 767px)")||e(".lt-ie9").length>0:e(t).width()<767},hide:function(){this.settings.modal&&this.settings.expose&&this.un_expose(),this.settings.modal||e(".joyride-modal-bg").hide(),this.settings.$current_tip.css("visibility","hidden"),setTimeout(e.proxy(function(){this.hide(),this.css("visibility","visible")},this.settings.$current_tip),0),this.settings.postStepCallback(this.settings.$li.index(),this.settings.$current_tip)},set_li:function(e){e?(this.settings.$li=this.settings.$tip_content.eq(this.settings.startOffset),this.set_next_tip(),this.settings.$current_tip=this.settings.$next_tip):(this.settings.$li=this.settings.$li.next(),this.set_next_tip()),this.set_target()},set_next_tip:function(){this.settings.$next_tip=e(".joyride-tip-guide[data-index='"+this.settings.$li.index()+"']"),this.settings.$next_tip.data("closed","")},set_target:function(){var t=this.settings.$li.attr("data-class"),r=this.settings.$li.attr("data-id"),i=function(){return r?e(n.getElementById(r)):t?e("."+t).first():e("body")};this.settings.$target=i()},scroll_to:function(){var n,r;n=e(t).height()/2,r=Math.ceil(this.settings.$target.offset().top-n+this.outerHeight(this.settings.$next_tip)),r>0&&this.scrollTo(e("html, body"),r,this.settings.scrollSpeed)},paused:function(){return e.inArray(this.settings.$li.index()+1,this.settings.pauseAfter)===-1},restart:function(){this.hide(),this.settings.$li=r,this.show("init")},pos_default:function(n,r){var i=Math.ceil(e(t).height()/2),s=this.settings.$next_tip.offset(),o=this.settings.$next_tip.find(".joyride-nub"),u=Math.ceil(this.outerWidth(o)/2),a=Math.ceil(this.outerHeight(o)/2),f=n||!1;f&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),typeof r=="undefined"&&(r=!1);if(!/body/i.test(this.settings.$target.selector)){if(this.bottom()){var l=this.settings.$target.offset().left;Foundation.rtl&&(l=this.settings.$target.offset().width-this.settings.$next_tip.width()+l),this.settings.$next_tip.css({top:this.settings.$target.offset().top+a+this.outerHeight(this.settings.$target),left:l}),this.nub_position(o,this.settings.tipSettings.nubPosition,"top")}else if(this.top()){var l=this.settings.$target.offset().left;Foundation.rtl&&(l=this.settings.$target.offset().width-this.settings.$next_tip.width()+l),this.settings.$next_tip.css({top:this.settings.$target.offset().top-this.outerHeight(this.settings.$next_tip)-a,left:l}),this.nub_position(o,this.settings.tipSettings.nubPosition,"bottom")}else this.right()?(this.settings.$next_tip.css({top:this.settings.$target.offset().top,left:this.outerWidth(this.settings.$target)+this.settings.$target.offset().left+u}),this.nub_position(o,this.settings.tipSettings.nubPosition,"left")):this.left()&&(this.settings.$next_tip.css({top:this.settings.$target.offset().top,left:this.settings.$target.offset().left-this.outerWidth(this.settings.$next_tip)-u}),this.nub_position(o,this.settings.tipSettings.nubPosition,"right"));!this.visible(this.corners(this.settings.$next_tip))&&this.settings.attempts<this.settings.tipSettings.tipLocationPattern.length&&(o.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),this.settings.tipSettings.tipLocation=this.settings.tipSettings.tipLocationPattern[this.settings.attempts],this.settings.attempts++,this.pos_default())}else this.settings.$li.length&&this.pos_modal(o);f&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_phone:function(t){var n=this.outerHeight(this.settings.$next_tip),r=this.settings.$next_tip.offset(),i=this.outerHeight(this.settings.$target),s=e(".joyride-nub",this.settings.$next_tip),o=Math.ceil(this.outerHeight(s)/2),u=t||!1;s.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),u&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),/body/i.test(this.settings.$target.selector)?this.settings.$li.length&&this.pos_modal(s):this.top()?(this.settings.$next_tip.offset({top:this.settings.$target.offset().top-n-o}),s.addClass("bottom")):(this.settings.$next_tip.offset({top:this.settings.$target.offset().top+i+o}),s.addClass("top")),u&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_modal:function(e){this.center(),e.hide(),this.show_modal()},show_modal:function(){if(!this.settings.$next_tip.data("closed")){var t=e(".joyride-modal-bg");t.length<1&&e("body").append(this.settings.template.modal).show(),/pop/i.test(this.settings.tipAnimation)?t.show():t.fadeIn(this.settings.tipAnimationFadeSpeed)}},expose:function(){var n,r,i,s,o,u="expose-"+Math.floor(Math.random()*1e4);if(arguments.length>0&&arguments[0]instanceof e)i=arguments[0];else{if(!this.settings.$target||!!/body/i.test(this.settings.$target.selector))return!1;i=this.settings.$target}if(i.length<1)return t.console&&console.error("element not valid",i),!1;n=e(this.settings.template.expose),this.settings.$body.append(n),n.css({top:i.offset().top,left:i.offset().left,width:this.outerWidth(i,!0),height:this.outerHeight(i,!0)}),r=e(this.settings.template.exposeCover),s={zIndex:i.css("z-index"),position:i.css("position")},o=i.attr("class")==null?"":i.attr("class"),i.css("z-index",parseInt(n.css("z-index"))+1),s.position=="static"&&i.css("position","relative"),i.data("expose-css",s),i.data("orig-class",o),i.attr("class",o+" "+this.settings.exposeAddClass),r.css({top:i.offset().top,left:i.offset().left,width:this.outerWidth(i,!0),height:this.outerHeight(i,!0)}),this.settings.$body.append(r),n.addClass(u),r.addClass(u),i.data("expose",u),this.settings.postExposeCallback(this.settings.$li.index(),this.settings.$next_tip,i),this.add_exposed(i)},un_expose:function(){var n,r,i,s,o,u=!1;if(arguments.length>0&&arguments[0]instanceof e)r=arguments[0];else{if(!this.settings.$target||!!/body/i.test(this.settings.$target.selector))return!1;r=this.settings.$target}if(r.length<1)return t.console&&console.error("element not valid",r),!1;n=r.data("expose"),i=e("."+n),arguments.length>1&&(u=arguments[1]),u===!0?e(".joyride-expose-wrapper,.joyride-expose-cover").remove():i.remove(),s=r.data("expose-css"),s.zIndex=="auto"?r.css("z-index",""):r.css("z-index",s.zIndex),s.position!=r.css("position")&&(s.position=="static"?r.css("position",""):r.css("position",s.position)),o=r.data("orig-class"),r.attr("class",o),r.removeData("orig-classes"),r.removeData("expose"),r.removeData("expose-z-index"),this.remove_exposed(r)},add_exposed:function(t){this.settings.exposed=this.settings.exposed||[],t instanceof e||typeof t=="object"?this.settings.exposed.push(t[0]):typeof t=="string"&&this.settings.exposed.push(t)},remove_exposed:function(t){var n,r;t instanceof e?n=t[0]:typeof t=="string"&&(n=t),this.settings.exposed=this.settings.exposed||[],r=this.settings.exposed.length;for(var i=0;i<r;i++)if(this.settings.exposed[i]==n){this.settings.exposed.splice(i,1);return}},center:function(){var n=e(t);return this.settings.$next_tip.css({top:(n.height()-this.outerHeight(this.settings.$next_tip))/2+n.scrollTop(),left:(n.width()-this.outerWidth(this.settings.$next_tip))/2+this.scrollLeft(n)}),!0},bottom:function(){return/bottom/i.test(this.settings.tipSettings.tipLocation)},top:function(){return/top/i.test(this.settings.tipSettings.tipLocation)},right:function(){return/right/i.test(this.settings.tipSettings.tipLocation)},left:function(){return/left/i.test(this.settings.tipSettings.tipLocation)},corners:function(n){var r=e(t),i=r.height()/2,s=Math.ceil(this.settings.$target.offset().top-i+this.settings.$next_tip.outerHeight()),o=r.width()+this.scrollLeft(r),u=r.height()+s,a=r.height()+r.scrollTop(),f=r.scrollTop();return s<f&&(s<0?f=0:f=s),u>a&&(a=u),[n.offset().top<f,o<n.offset().left+n.outerWidth(),a<n.offset().top+n.outerHeight(),this.scrollLeft(r)>n.offset().left]},visible:function(e){var t=e.length;while(t--)if(e[t])return!1;return!0},nub_position:function(e,t,n){t==="auto"?e.addClass(n):e.addClass(t)},startTimer:function(){this.settings.$li.length?this.settings.automate=setTimeout(function(){this.hide(),this.show(),this.startTimer()}.bind(this),this.settings.timer):clearTimeout(this.settings.automate)},end:function(){this.settings.cookieMonster&&e.cookie(this.settings.cookieName,"ridden",{expires:this.settings.cookieExpires,domain:this.settings.cookieDomain}),this.settings.timer>0&&clearTimeout(this.settings.automate),this.settings.modal&&this.settings.expose&&this.un_expose(),this.settings.$next_tip.data("closed",!0),e(".joyride-modal-bg").hide(),this.settings.$current_tip.hide(),this.settings.postStepCallback(this.settings.$li.index(),this.settings.$current_tip),this.settings.postRideCallback(this.settings.$li.index(),this.settings.$current_tip),e(".joyride-tip-guide").remove()},outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},off:function(){e(this.scope).off(".joyride"),e(t).off(".joyride"),e(".joyride-close-tip, .joyride-next-tip, .joyride-modal-bg").off(".joyride"),e(".joyride-tip-guide, .joyride-modal-bg").remove(),clearTimeout(this.settings.automate),this.settings={}},reflow:function(){}}}(Foundation.zj,this,this.document),function(e,t,n,r){"use strict";var i=function(){},s=function(i,s){if(i.hasClass(s.slides_container_class))return this;var f=this,l,c=i,h,p,d,v=0,m,g,y=!1,b=!1;c.children().first().addClass(s.active_slide_class),f.update_slide_number=function(t){s.slide_number&&(h.find("span:first").text(parseInt(t)+1),h.find("span:last").text(c.children().length)),s.bullets&&(p.children().removeClass(s.bullets_active_class),e(p.children().get(t)).addClass(s.bullets_active_class))},f.update_active_link=function(t){var n=e('a[data-orbit-link="'+c.children().eq(t).attr("data-orbit-slide")+'"]');n.parents("ul").find("[data-orbit-link]").removeClass(s.bullets_active_class),n.addClass(s.bullets_active_class)},f.build_markup=function(){c.wrap('<div class="'+s.container_class+'"></div>'),l=c.parent(),c.addClass(s.slides_container_class),s.navigation_arrows&&(l.append(e('<a href="#"><span></span></a>').addClass(s.prev_class)),l.append(e('<a href="#"><span></span></a>').addClass(s.next_class))),s.timer&&(d=e("<div>").addClass(s.timer_container_class),d.append("<span>"),d.append(e("<div>").addClass(s.timer_progress_class)),d.addClass(s.timer_paused_class),l.append(d)),s.slide_number&&(h=e("<div>").addClass(s.slide_number_class),h.append("<span></span> "+s.slide_number_text+" <span></span>"),l.append(h)),s.bullets&&(p=e("<ol>").addClass(s.bullets_container_class),l.append(p),c.children().each(function(t,n){var r=e("<li>").attr("data-orbit-slide",t);p.append(r)})),s.stack_on_small&&l.addClass(s.stack_on_small_class),f.update_slide_number(0),f.update_active_link(0)},f._goto=function(t,n){if(t===v)return!1;typeof g=="object"&&g.restart();var r=c.children(),i="next";y=!0,t<v&&(i="prev"),t>=r.length?t=0:t<0&&(t=r.length-1);var o=e(r.get(v)),u=e(r.get(t));o.css("zIndex",2),o.removeClass(s.active_slide_class),u.css("zIndex",4).addClass(s.active_slide_class),c.trigger("orbit:before-slide-change"),s.before_slide_change(),f.update_active_link(t);var a=function(){var e=function(){v=t,y=!1,n===!0&&(g=f.create_timer(),g.start()),f.update_slide_number(v),c.trigger("orbit:after-slide-change",[{slide_number:v,total_slides:r.length}]),s.after_slide_change(v,r.length)};c.height()!=u.height()&&s.variable_height?c.animate({height:u.height()},250,"linear",e):e()};if(r.length===1)return a(),!1;var l=function(){i==="next"&&m.next(o,u,a),i==="prev"&&m.prev(o,u,a)};u.height()>c.height()&&s.variable_height?c.animate({height:u.height()},250,"linear",l):l()},f.next=function(e){e.stopImmediatePropagation(),e.preventDefault(),f._goto(v+1)},f.prev=function(e){e.stopImmediatePropagation(),e.preventDefault(),f._goto(v-1)},f.link_custom=function(t){t.preventDefault();var n=e(this).attr("data-orbit-link");if(typeof n=="string"&&(n=e.trim(n))!=""){var r=l.find("[data-orbit-slide="+n+"]");r.index()!=-1&&f._goto(r.index())}},f.link_bullet=function(t){var n=e(this).attr("data-orbit-slide");typeof n=="string"&&(n=e.trim(n))!=""&&f._goto(parseInt(n))},f.timer_callback=function(){f._goto(v+1,!0)},f.compute_dimensions=function(){var t=e(c.children().get(v)),n=t.height();s.variable_height||c.children().each(function(){e(this).height()>n&&(n=e(this).height())}),c.height(n)},f.create_timer=function(){var e=new o(l.find("."+s.timer_container_class),s,f.timer_callback);return e},f.stop_timer=function(){typeof g=="object"&&g.stop()},f.toggle_timer=function(){var e=l.find("."+s.timer_container_class);e.hasClass(s.timer_paused_class)?(typeof g=="undefined"&&(g=f.create_timer()),g.start()):typeof g=="object"&&g.stop()},f.init=function(){f.build_markup(),s.timer&&(g=f.create_timer(),g.start()),m=new a(s,c),s.animation==="slide"&&(m=new u(s,c)),l.on("click","."+s.next_class,f.next),l.on("click","."+s.prev_class,f.prev),l.on("click","[data-orbit-slide]",f.link_bullet),l.on("click",f.toggle_timer),s.swipe&&l.on("touchstart.fndtn.orbit",function(e){e.touches||(e=e.originalEvent);var t={start_page_x:e.touches[0].pageX,start_page_y:e.touches[0].pageY,start_time:(new Date).getTime(),delta_x:0,is_scrolling:r};l.data("swipe-transition",t),e.stopPropagation()}).on("touchmove.fndtn.orbit",function(e){e.touches||(e=e.originalEvent);if(e.touches.length>1||e.scale&&e.scale!==1)return;var t=l.data("swipe-transition");typeof t=="undefined"&&(t={}),t.delta_x=e.touches[0].pageX-t.start_page_x,typeof t.is_scrolling=="undefined"&&(t.is_scrolling=!!(t.is_scrolling||Math.abs(t.delta_x)<Math.abs(e.touches[0].pageY-t.start_page_y)));if(!t.is_scrolling&&!t.active){e.preventDefault();var n=t.delta_x<0?v+1:v-1;t.active=!0,f._goto(n)}}).on("touchend.fndtn.orbit",function(e){l.data("swipe-transition",{}),e.stopPropagation()}),l.on("mouseenter.fndtn.orbit",function(e){s.timer&&s.pause_on_hover&&f.stop_timer()}).on("mouseleave.fndtn.orbit",function(e){s.timer&&s.resume_on_mouseout&&g.start()}),e(n).on("click","[data-orbit-link]",f.link_custom),e(t).on("resize",f.compute_dimensions),e(t).on("load",f.compute_dimensions),e(t).on("load",function(){l.prev(".preloader").css("display","none")}),c.trigger("orbit:ready")},f.init()},o=function(e,t,n){var r=this,i=t.timer_speed,s=e.find("."+t.timer_progress_class),o,u,a=-1;this.update_progress=function(e){var t=s.clone();t.attr("style",""),t.css("width",e+"%"),s.replaceWith(t),s=t},this.restart=function(){clearTimeout(u),e.addClass(t.timer_paused_class),a=-1,r.update_progress(0)},this.start=function(){if(!e.hasClass(t.timer_paused_class))return!0;a=a===-1?i:a,e.removeClass(t.timer_paused_class),o=(new Date).getTime(),s.animate({width:"100%"},a,"linear"),u=setTimeout(function(){r.restart(),n()},a),e.trigger("orbit:timer-started")},this.stop=function(){if(e.hasClass(t.timer_paused_class))return!0;clearTimeout(u),e.addClass(t.timer_paused_class);var n=(new Date).getTime();a-=n-o;var s=100-a/i*100;r.update_progress(s),e.trigger("orbit:timer-stopped")}},u=function(t,n){var r=t.animation_speed,i=e("html[dir=rtl]").length===1,s=i?"marginRight":"marginLeft",o={};o[s]="0%",this.next=function(e,t,n){t.animate(o,r,"linear",function(){e.css(s,"100%"),n()})},this.prev=function(e,t,n){t.css(s,"-100%"),t.animate(o,r,"linear",function(){e.css(s,"100%"),n()})}},a=function(t,n){var r=t.animation_speed,i=e("html[dir=rtl]").length===1,s=i?"marginRight":"marginLeft";this.next=function(e,t,n){t.css({margin:"0%",opacity:"0.01"}),t.animate({opacity:"1"},r,"linear",function(){e.css("margin","100%"),n()})},this.prev=function(e,t,n){t.css({margin:"0%",opacity:"0.01"}),t.animate({opacity:"1"},r,"linear",function(){e.css("margin","100%"),n()})}};Foundation.libs=Foundation.libs||{},Foundation.libs.orbit={name:"orbit",version:"4.3.2",settings:{animation:"slide",timer_speed:1e4,pause_on_hover:!0,resume_on_mouseout:!1,animation_speed:500,stack_on_small:!1,navigation_arrows:!0,slide_number:!0,slide_number_text:"of",container_class:"orbit-container",stack_on_small_class:"orbit-stack-on-small",next_class:"orbit-next",prev_class:"orbit-prev",timer_container_class:"orbit-timer",timer_paused_class:"paused",timer_progress_class:"orbit-progress",slides_container_class:"orbit-slides-container",bullets_container_class:"orbit-bullets",bullets_active_class:"active",slide_number_class:"orbit-slide-number",caption_class:"orbit-caption",active_slide_class:"active",orbit_transition_class:"orbit-transitioning",bullets:!0,timer:!0,variable_height:!1,swipe:!0,before_slide_change:i,after_slide_change:i},init:function(t,n,r){var i=this;Foundation.inherit(i,"data_options"),typeof n=="object"&&e.extend(!0,i.settings,n);if(e(t).is("[data-orbit]")){var o=e(t),u=i.data_options(o);new s(o,e.extend({},i.settings,u))}e("[data-orbit]",t).each(function(t,n){var r=e(n),o=i.data_options(r);new s(r,e.extend({},i.settings,o))})}}}(Foundation.zj,this,this.document),function(e,t,n){"use strict";Foundation.libs.section={name:"section",version:"4.3.2",settings:{deep_linking:!1,small_breakpoint:768,one_up:!0,multi_expand:!1,section_selector:"[data-section]",region_selector:"section, .section, [data-section-region]",title_selector:".title, [data-section-title]",resized_data_attr:"data-section-resized",small_style_data_attr:"data-section-small-style",content_selector:".content, [data-section-content]",nav_selector:'[data-section="vertical-nav"], [data-section="horizontal-nav"]',active_class:"active",callback:function(){}},init:function(t,n,r){var i=this;return Foundation.inherit(this,"throttle data_options position_right offset_right"),typeof n=="object"&&e.extend(!0,i.settings,n),typeof n!="string"?(this.events(),!0):this[n].call(this,r)},events:function(){var r=this,i=[],s=r.settings.section_selector,o=r.settings.region_selector.split(","),u=r.settings.title_selector.split(",");for(var a=0,f=o.length;a<f;a++){var l=o[a];for(var c=0,h=u.length;c<h;c++){var p=s+">"+l+">"+u[c];i.push(p+" a"),i.push(p)}}e(r.scope).on("click.fndtn.section",i.join(","),function(t){var n=e(this).closest(r.settings.title_selector);r.close_navs(n),n.siblings(r.settings.content_selector).length>0&&r.toggle_active.call(n[0],t)}),e(t).on("resize.fndtn.section",r.throttle(function(){r.resize()},30)).on("hashchange.fndtn.section",r.set_active_from_hash),e(n).on("click.fndtn.section",function(t){if(t.isPropagationStopped&&t.isPropagationStopped())return;if(t.target===n)return;r.close_navs(e(t.target).closest(r.settings.title_selector))}),e(t).triggerHandler("resize.fndtn.section"),e(t).triggerHandler("hashchange.fndtn.section")},close_navs:function(t){var n=Foundation.libs.section,r=e(n.settings.nav_selector).filter(function(){return!e.extend({},n.settings,n.data_options(e(this))).one_up});if(t.length>0){var i=t.parent().parent();if(n.is_horizontal_nav(i)||n.is_vertical_nav(i))r=r.filter(function(){return this!==i[0]})}r.children(n.settings.region_selector).removeClass(n.settings.active_class)},toggle_active:function(t){var n=e(this),r=Foundation.libs.section,i=n.parent(),s=n.siblings(r.settings.content_selector),o=i.parent(),u=e.extend({},r.settings,r.data_options(o)),a=o.children(r.settings.region_selector).filter("."+r.settings.active_class);!u.deep_linking&&s.length>0&&t.preventDefault(),t.stopPropagation();if(!i.hasClass(r.settings.active_class)){if(!r.is_accordion(o)||r.is_accordion(o)&&!r.settings.multi_expand)a.removeClass(r.settings.active_class),a.trigger("closed.fndtn.section");i.addClass(r.settings.active_class),r.resize(i.find(r.settings.section_selector).not("["+r.settings.resized_data_attr+"]"),!0),i.trigger("opened.fndtn.section")}else if(i.hasClass(r.settings.active_class)&&r.is_accordion(o)||!u.one_up&&(r.small(o)||r.is_vertical_nav(o)||r.is_horizontal_nav(o)||r.is_accordion(o)))i.removeClass(r.settings.active_class),i.trigger("closed.fndtn.section");u.callback(o)},check_resize_timer:null,resize:function(t,n){var r=Foundation.libs.section,i=e(r.settings.section_selector),s=r.small(i),o=function(e,t){return!r.is_accordion(e)&&!e.is("["+r.settings.resized_data_attr+"]")&&(!s||r.is_horizontal_tabs(e))&&t===(e.css("display")==="none"||!e.parent().is(":visible"))};t=t||e(r.settings.section_selector),clearTimeout(r.check_resize_timer),s||t.removeAttr(r.settings.small_style_data_attr),t.filter(function(){return o(e(this),!1)}).each(function(){var t=e(this),i=t.children(r.settings.region_selector),s=i.children(r.settings.title_selector),o=i.children(r.settings.content_selector),u=0;if(n&&t.children(r.settings.region_selector).filter("."+r.settings.active_class).length==0){var a=e.extend({},r.settings,r.data_options(t));!a.deep_linking&&(a.one_up||!r.is_horizontal_nav(t)&&!r.is_vertical_nav(t)&&!r.is_accordion(t))&&i.filter(":visible").first().addClass(r.settings.active_class)}if(r.is_horizontal_tabs(t)||r.is_auto(t)){var f=0;s.each(function(){var t=e(this);if(t.is(":visible")){t.css(r.rtl?"right":"left",f);var n=parseInt(t.css("border-"+(r.rtl?"left":"right")+"-width"),10);n.toString()==="Nan"&&(n=0),f+=r.outerWidth(t)-n,u=Math.max(u,r.outerHeight(t))}}),s.css("height",u),i.each(function(){var t=e(this),n=t.children(r.settings.content_selector),i=parseInt(n.css("border-top-width"),10);i.toString()==="Nan"&&(i=0),t.css("padding-top",u-i)}),t.css("min-height",u)}else if(r.is_horizontal_nav(t)){var l=!0;s.each(function(){u=Math.max(u,r.outerHeight(e(this)))}),i.each(function(){var n=e(this);n.css("margin-left","-"+(l?t:n.children(r.settings.title_selector)).css("border-left-width")),l=!1}),i.css("margin-top","-"+t.css("border-top-width")),s.css("height",u),o.css("top",u),t.css("min-height",u)}else if(r.is_vertical_tabs(t)){var c=0;s.each(function(){var t=e(this);if(t.is(":visible")){t.css("top",c);var n=parseInt(t.css("border-top-width"),10);n.toString()==="Nan"&&(n=0),c+=r.outerHeight(t)-n}}),o.css("min-height",c+1)}else if(r.is_vertical_nav(t)){var h=0,p=!0;s.each(function(){h=Math.max(h,r.outerWidth(e(this)))}),i.each(function(){var n=e(this);n.css("margin-top","-"+(p?t:n.children(r.settings.title_selector)).css("border-top-width")),p=!1}),s.css("width",h),o.css(r.rtl?"right":"left",h),t.css("width",h)}t.attr(r.settings.resized_data_attr,!0)}),e(r.settings.section_selector).filter(function(){return o(e(this),!0)}).length>0&&(r.check_resize_timer=setTimeout(function(){r.resize(t.filter(function(){return o(e(this),!1)}),!0)},700)),s&&t.attr(r.settings.small_style_data_attr,!0)},is_vertical_nav:function(e){return/vertical-nav/i.test(e.data("section"))},is_horizontal_nav:function(e){return/horizontal-nav/i.test(e.data("section"))},is_accordion:function(e){return/accordion/i.test(e.data("section"))},is_horizontal_tabs:function(e){return/^tabs$/i.test(e.data("section"))},is_vertical_tabs:function(e){return/vertical-tabs/i.test(e.data("section"))},is_auto:function(e){var t=e.data("section");return t===""||/auto/i.test(t)},set_active_from_hash:function(){var n=Foundation.libs.section,r=t.location.hash.substring(1),i=e(n.settings.section_selector),s;i.each(function(){var t=e(this),i=t.children(n.settings.region_selector);i.each(function(){var i=e(this),o=i.children(n.settings.content_selector).data("slug");if((new RegExp(o,"i")).test(r))return s=t,!1});if(s!=null)return!1}),s!=null&&i.each(function(){if(s==e(this)){var t=e(this),i=e.extend({},n.settings,n.data_options(t)),o=t.children(n.settings.region_selector),u=i.deep_linking&&r.length>0,a=!1;o.each(function(){var t=e(this);if(a)t.removeClass(n.settings.active_class);else if(u){var i=t.children(n.settings.content_selector).data("slug");i&&(new RegExp(i,"i")).test(r)?(t.hasClass(n.settings.active_class)||t.addClass(n.settings.active_class),a=!0):t.removeClass(n.settings.active_class)}else t.hasClass(n.settings.active_class)&&(a=!0)}),!a&&(i.one_up||!n.is_horizontal_nav(t)&&!n.is_vertical_nav(t)&&!n.is_accordion(t))&&o.filter(":visible").first().addClass(n.settings.active_class)}})},reflow:function(){var t=Foundation.libs.section;e(t.settings.section_selector).removeAttr(t.settings.resized_data_attr),t.throttle(function(){t.resize()},30)()},small:function(t){var n=e.extend({},this.settings,this.data_options(t));return this.is_horizontal_tabs(t)?!1:t&&this.is_accordion(t)?!0:e("html").hasClass("lt-ie9")?!0:e("html").hasClass("ie8compat")?!0:e(this.scope).width()<n.small_breakpoint},off:function(){e(this.scope).off(".fndtn.section"),e(t).off(".fndtn.section"),e(n).off(".fndtn.section")}},e.fn.reflow_section=function(e){var t=this,n=Foundation.libs.section;return t.removeAttr(n.settings.resized_data_attr),n.throttle(function(){n.resize(t,e)},30)(),this}}(Foundation.zj,window,document),function(e,t,n,r){"use strict";Foundation.libs.topbar={name:"topbar",version:"4.3.2",settings:{index:0,stickyClass:"sticky",custom_back_text:!0,back_text:"Back",is_hover:!0,mobile_show_parent_link:!1,scrolltop:!0,init:!1},init:function(n,r,i){Foundation.inherit(this,"data_options addCustomRule");var s=this;return typeof r=="object"?e.extend(!0,this.settings,r):typeof i!="undefined"&&e.extend(!0,this.settings,i),typeof r!="string"?(e(".top-bar, [data-topbar]").each(function(){e.extend(!0,s.settings,s.data_options(e(this))),s.settings.$w=e(t),s.settings.$topbar=e(this),s.settings.$section=s.settings.$topbar.find("section"),s.settings.$titlebar=s.settings.$topbar.children("ul").first(),s.settings.$topbar.data("index",0);var n=s.settings.$topbar.parent();n.hasClass("fixed")||n.hasClass(s.settings.stickyClass)?(s.settings.$topbar.data("height",s.outerHeight(n)),s.settings.$topbar.data("stickyoffset",n.offset().top)):s.settings.$topbar.data("height",s.outerHeight(s.settings.$topbar));var r=e("<div class='top-bar-js-breakpoint'/>").insertAfter(s.settings.$topbar);s.settings.breakPoint=r.width(),r.remove(),s.assemble(),s.settings.is_hover&&s.settings.$topbar.find(".has-dropdown").addClass("not-click"),s.addCustomRule(".f-topbar-fixed { padding-top: "+s.settings.$topbar.data("height")+"px }"),s.settings.$topbar.parent().hasClass("fixed")&&e("body").addClass("f-topbar-fixed")}),s.settings.init||this.events(),this.settings.init):this[r].call(this,i)},toggle:function(){var n=this,r=e(".top-bar, [data-topbar]"),i=r.find("section, .section");n.breakpoint()&&(n.rtl?(i.css({right:"0%"}),i.find(">.name").css({right:"100%"})):(i.css({left:"0%"}),i.find(">.name").css({left:"100%"})),i.find("li.moved").removeClass("moved"),r.data("index",0),r.toggleClass("expanded").css("height","")),n.settings.scrolltop?r.hasClass("expanded")?r.parent().hasClass("fixed")&&(n.settings.scrolltop?(r.parent().removeClass("fixed"),r.addClass("fixed"),e("body").removeClass("f-topbar-fixed"),t.scrollTo(0,0)):r.parent().removeClass("expanded")):r.hasClass("fixed")&&(r.parent().addClass("fixed"),r.removeClass("fixed"),e("body").addClass("f-topbar-fixed")):(r.parent().hasClass(n.settings.stickyClass)&&r.parent().addClass("fixed"),r.parent().hasClass("fixed")&&(r.hasClass("expanded")?(r.addClass("fixed"),r.parent().addClass("expanded")):(r.removeClass("fixed"),r.parent().removeClass("expanded"),n.updateStickyPositioning())))},timer:null,events:function(){var r=this;e(this.scope).off(".fndtn.topbar").on("click.fndtn.topbar",".top-bar .toggle-topbar, [data-topbar] .toggle-topbar",function(e){e.preventDefault(),r.toggle()}).on("click.fndtn.topbar",".top-bar li.has-dropdown",function(t){var n=e(this),i=e(t.target),s=n.closest("[data-topbar], .top-bar"),o=s.data("topbar");if(i.data("revealId")){r.toggle();return}if(r.breakpoint())return;if(r.settings.is_hover&&!Modernizr.touch)return;t.stopImmediatePropagation(),i[0].nodeName==="A"&&i.parent().hasClass("has-dropdown")&&t.preventDefault(),n.hasClass("hover")?(n.removeClass("hover").find("li").removeClass("hover"),n.parents("li.hover").removeClass("hover")):n.addClass("hover")}).on("click.fndtn.topbar",".top-bar .has-dropdown>a, [data-topbar] .has-dropdown>a",function(n){if(r.breakpoint()&&e(t).width()!=r.settings.breakPoint){n.preventDefault();var i=e(this),s=i.closest(".top-bar, [data-topbar]"),o=s.find("section, .section"),u=i.next(".dropdown").outerHeight(),a=i.closest("li");s.data("index",s.data("index")+1),a.addClass("moved"),r.rtl?(o.css({right:-(100*s.data("index"))+"%"}),o.find(">.name").css({right:100*s.data("index")+"%"})):(o.css({left:-(100*s.data("index"))+"%"}),o.find(">.name").css({left:100*s.data("index")+"%"})),s.css("height",r.outerHeight(i.siblings("ul"),!0)+r.settings.$topbar.data("height"))}}),e(t).on("resize.fndtn.topbar",function(){if(typeof r.settings.$topbar=="undefined")return;var t=r.settings.$topbar.parent("."+this.settings.stickyClass),i;if(!r.breakpoint()){var s=r.settings.$topbar.hasClass("expanded");e(".top-bar, [data-topbar]").css("height","").removeClass("expanded").find("li").removeClass("hover"),s&&r.toggle()}t.length>0&&(t.hasClass("fixed")?(t.removeClass("fixed"),i=t.offset().top,e(n.body).hasClass("f-topbar-fixed")&&(i-=r.settings.$topbar.data("height")),r.settings.$topbar.data("stickyoffset",i),t.addClass("fixed")):(i=t.offset().top,r.settings.$topbar.data("stickyoffset",i)))}.bind(this)),e("body").on("click.fndtn.topbar",function(t){var n=e(t.target).closest("li").closest("li.hover");if(n.length>0)return;e(".top-bar li, [data-topbar] li").removeClass("hover")}),e(this.scope).on("click.fndtn",".top-bar .has-dropdown .back, [data-topbar] .has-dropdown .back",function(t){t.preventDefault();var n=e(this),i=n.closest(".top-bar, [data-topbar]"),s=i.find("section, .section"),o=n.closest("li.moved"),u=o.parent();i.data("index",i.data("index")-1),r.rtl?(s.css({right:-(100*i.data("index"))+"%"}),s.find(">.name").css({right:100*i.data("index")+"%"})):(s.css({left:-(100*i.data("index"))+"%"}),s.find(">.name").css({left:100*i.data("index")+"%"})),i.data("index")===0?i.css("height",""):i.css("height",r.outerHeight(u,!0)+r.settings.$topbar.data("height")),setTimeout(function(){o.removeClass("moved")},300)})},breakpoint:function(){return e(n).width()<=this.settings.breakPoint||e("html").hasClass("lt-ie9")},assemble:function(){var t=this;this.settings.$section.detach(),this.settings.$section.find(".has-dropdown>a").each(function(){var n=e(this),r=n.siblings(".dropdown"),i=n.attr("href");if(t.settings.mobile_show_parent_link&&i&&i.length>1)var s=e('<li class="title back js-generated"><h5><a href="#"></a></h5></li><li><a class="parent-link js-generated" href="'+i+'">'+n.text()+"</a></li>");else var s=e('<li class="title back js-generated"><h5><a href="#"></a></h5></li>');t.settings.custom_back_text==1?s.find("h5>a").html(t.settings.back_text):s.find("h5>a").html("&laquo; "+n.html()),r.prepend(s)}),this.settings.$section.appendTo(this.settings.$topbar),this.sticky()},height:function(t){var n=0,r=this;return t.find("> li").each(function(){n+=r.outerHeight(e(this),!0)}),n},sticky:function(){var n=e(t),r=this;n.scroll(function(){r.updateStickyPositioning()})},updateStickyPositioning:function(){var n="."+this.settings.stickyClass,r=e(t);if(e(n).length>0){var i=this.settings.$topbar.data("stickyoffset");e(n).hasClass("expanded")||(r.scrollTop()>i?e(n).hasClass("fixed")||(e(n).addClass("fixed"),e("body").addClass("f-topbar-fixed")):r.scrollTop()<=i&&e(n).hasClass("fixed")&&(e(n).removeClass("fixed"),e("body").removeClass("f-topbar-fixed")))}},off:function(){e(this.scope).off(".fndtn.topbar"),e(t).off(".fndtn.topbar")},reflow:function(){}}}(Foundation.zj,this,this.document);﻿(function(window){var groups={};groups.selectedItem=null;groups.currentSortDirection="";groups.currentSortBy="";groups.currentList=[];groups.init=function(){groups.selectedItem=null;groups.currentSortDirection="ASC";groups.currentSortBy="name";groups.currentList=[];$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleName').click(function(){groups.displayList("name")});$('#groupFilterText').on('input',function(){groups.displayList(groups.currentSortBy,groups.currentSortDirection);});groups.addEventListeners();groups.listItems();}
groups.listItems=function(){$("#loader").show();$("#dvGroupsList").empty();groups.selectedItem=null;var sc=new sd.ServerCall("ListGroups");sc.go({onSuccess:groups.handleList,onError:groups.handleError});}
groups.handleList=function(myData,status){groups.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.id=myData[idx].i;item.name=myData[idx].n;item.csid=myData[idx].ct;item.sg=myData[idx].sg;groups.currentList.push(item);}
groups.displayList(groups.currentSortBy,groups.currentSortDirection);}
groups.displayList=function(sortBy,sortDirection){if(groups.currentSortBy==sortBy){if(sortDirection!=groups.currentSortDirection){if(groups.currentSortDirection=="ASC")groups.currentSortDirection="DESC";else groups.currentSortDirection="ASC";}}
else{groups.currentSortBy=sortBy;groups.currentSortDirection=sortDirection||"ASC";if(groups.currentSortBy=="name")sd.Utils.sortArrayByString(groups.currentList,"name");}
$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(groups.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(groups.currentSortBy=="name")$('#sectionContainer .sectionTitleName > .'+sortArrow).show();var htmlOut="";var listCount=groups.currentList.length;var filterText=$('#groupFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=groups.currentList[idx];if(groups.currentSortDirection=="DESC")item=groups.currentList[listCount-(idx+1)];if(filterText!=""&&item.name.toLowerCase().indexOf(filterText)<0)continue;if(item.sg==1)
{}
else
{htmlOut+="<div class='row grid' data-groupname='"+item.name+"' data-groupid='"+item.id+"' data-groupcsid='"+item.csid+"'>   \
                                <div class='yui3-u-2-3 pa-l-1'><div class='section-list-field'>"+item.name+"</div></div> \
                                <div class='yui3-u-1-1'><div class='section-list-field'> \
                                <button class=\"admin-members-btn editGroupMembers_btn small-rnd brand ma-r-half\" title=\"Edit Group Members\"><i class=\"icon-group\"></i></button> \
                                <button class=\"admin-edit-btn editGroup_btn small-rnd brand ma-r-half\"  title=\"Edit Group\"><i class=\"icon-edit\"></i></button> \
                                <button class=\"admin-delete-btn deleteGroup_btn small-rnd brand ma-r-half\"  title=\"Remove Group\"><i class=\"icon-trash\"></i></button> \
                                </div></div> \
                            </div>";}}
$('#dvGroupList').html(htmlOut);$(".editGroupMembers_btn").click(function(){var groupID=$(this).parent().parent().parent().data('groupid');var groupName=$(this).parent().parent().parent().data('groupname');groups.editGroupMembers({id:groupID,name:groupName});});$(".editGroup_btn").click(function(){var groupID=$(this).parent().parent().parent().data('groupid');var groupName=$(this).parent().parent().parent().data('groupname');groups.editGroup({id:groupID,name:groupName});});$(".deleteGroup_btn").click(function(){var groupID=$(this).parent().parent().parent().data('groupid');var groupName=$(this).parent().parent().parent().data('groupname');groups.deleteGroup({id:groupID,name:groupName});});$("#loader").hide();}
groups.editGroup=function(objGroup){sd.component.messageBox.action({title:"Edit Group",width:400,height:182,loadCallback:function(){$("#groupDialogID").val(objGroup.id);$("#groupDialogName").val(objGroup.name);},template:sd.Configuration.templates.groupDetails,btn1callback:$.proxy(this.groupSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
groups.deleteGroup=function(objGroup){groups.selectedItem=objGroup;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deletedConfirmed,this),icon2:"icon-ban-circle",btn2:"No",height:171});}
groups.editGroupMembers=function(objGroup){$("#loader").css("z-index","10001")
$("#loader").show();groups.selectedItem=objGroup;var obj={};obj.groupID=objGroup.id;var sc=new sd.ServerCall("ListGroupMembers");sc.data(obj);sc.go({onSuccess:groups.handleGroupMembers,onError:groups.handleError});}
groups.handleGroupMembers=function(myData,status){sd.component.messageBox.action({title:"Edit Group Members",height:489,width:576,loadCallback:function(){$("#groupDialogID").val(groups.selectedItem.id);var item;for(i=0;i<myData.length;i++){item=myData[i];if(item.m=="1")
$('#lstUsers').append('<option value="'+item.un+'" selected="selected" data-type="user">'+item.dn+'</option>');else
$('#lstUsers').append('<option value="'+item.un+'" data-type="user">'+item.dn+'</option>');}
$('#searchable-form').multiSelect({selectableHeader:'<input style="width:100%;" type="text" id="search" value="" autocomplete = "off"/>',width:250,backgroundHeight:296,selBackgroundHeight:296,height:261,selHeight:298,applyIcons:true});$('input#search').quicksearch('#ms-searchable-form .ms-selectable li');$('#searchable-form').multiSelect();$('#search').focus();$("#loader").hide();$("#loader").css("z-index","9999")},template:sd.Configuration.templates.groupMembers,btn1callback:groups.updateSaveMembership,icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
groups.updateSaveMembership=function(){var value=$('#searchable-form').find('select').val();var users=value?""+value+"":"";var obj={};obj.groupID=$("#groupDialogID").val();obj.users=users;var sc=new sd.ServerCall("UpdateGroupMembers");sc.data(obj);sc.go({onSuccess:groups.refreshList,onError:groups.handleError});}
groups.deletedConfirmed=function(){var obj={};obj.groupID=groups.selectedItem.id;var sc=new sd.ServerCall("DeleteGroup");sc.data(obj);sc.go({onSuccess:groups.refreshList,onError:groups.handleError});}
groups.showDetailsDialog=function(error){sd.component.messageBox.action({title:"Create Group",width:400,height:182,template:sd.Configuration.templates.groupDetails,btn1callback:$.proxy(this.groupSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
groups.groupSave=function(error){if($("#groupDialogName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}
else{var action="AddGroup";var obj={};obj.groupName=$("#groupDialogName").val();if($("#groupDialogID").val()!=""){action="EditGroup";obj.groupID=$("#groupDialogID").val();}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:groups.refreshList,onError:groups.handleError});}}
groups.refreshList=function(error){sd.component.messageBox.close();var sc=new sd.ServerCall("ListGroups");sc.go({onSuccess:groups.handleList,onError:groups.handleError});}
groups.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
groups.handleSaveError=function(error){sd.component.messageBox.showError(error);}
groups.addEventListeners=function(){$("#groupAdminAdd_btn").bind("click",function(){groups.showDetailsDialog();});$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});}
window.groups=groups;}(window));﻿(function(window){var header={};header.init=function(){$("#dvGoHome").css("background-image","url(\"images/mccann/logo/"+sd.Configuration.csLogo+"\")");$("#dvHeaderSearchOptions").toggle();$(".js-login-msg").text("Hi, "+sd.Session.user.FullName);header.addEventListeners();header.menuConfig={over:header.topNavExpand,timeout:500,out:header.topNavContract};header.loadTopNavigation();favourites.init();links.init();mccann.quicksearch();$("#searchStartDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Start Date"});$("#searchEndDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"End Date"});mccann.refreshCollabData();$(window).resize(function(){if($('.header-option--mobile').is(':hidden')){$('.mc-bottom-nav').show();}});var sc=new sd.ServerCall("GetUserDetails");var obj={};obj.uid=sd.Session.user.userID;sc.data(obj);sc.go({onSuccess:function(data){var item=data[0];if(item.csImage!=null&&item.csImage!=0){item.Image=item.csImage;}
if(item.Image!=null&&item.Image>0){if(String(item.Image).indexOf("base64")>-1){$(".portrait").css('background-image','url('+item.Image+')');$(".portrait").css('background-size','cover');}
else{$(".portrait").css({'background-image':'url('+sd.Configuration.vault+"/"+item.Image+"/bigthumb.jpg"+')','background-size':'cover'});}}
else{var fullName=item.FullName.split(' ');if(item.colour==null){item.colour=users.UpdateColour(item.userid);}
var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();$(".portrait").html(userInitials).attr("style",'background-color:'+item.colour+'').css({"text-align":"center","color":"white","line-height":"35px"});}},onError:function(){console.log("Error on getting user image")}});};header.loadTopNavigation=function(){var obj={};obj.inode=sd.Configuration.libraryInode;obj.limit=100;obj.level=1;var sc=new sd.ServerCall("FolderTraverse");sc.data(obj);sc.go({onSuccess:header.handleMenuItems,onError:header.handleError});};header.addEventListeners=function(){$('#headerSearchFieldInput').keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){event.preventDefault();header.simpleSearch();}});$("#mainSection").bind("click",function(){header.restAll();});$(".js-portrait").bind("click",function(){channel.getUserDetails({userID:sd.Session.user.userID,userName:sd.Session.user.username});});$(".mc-logo-wrap").bind("click",function(){if($('.portal-brand').is(':visible')){header.restAll();}
else{header.restAll();var sc=new sd.ServerCall("ListUserCollabSpaces");sc.go({onSuccess:header.handleCollabList,onError:header.handleError});}});$(".js-admin-btn").bind("click",function(){header.restAll();LoadSection("admin",false);});$("header .js-loadFav").unbind("click").bind("click",function(){if($("#header .js-favList").is(':visible')){header.restAll();}
else{header.restAll();favourites.init();$("#header .js-favList").show();$("header .js-loadFav").addClass("nav-selected");}});$(".js-uLinks").unbind("click").bind("click",function(){if($('#dvLinksList').is(':visible')){header.restAll();}
else{header.restAll();$("#dvLinksList").show();$(".js-uLinks").addClass("nav-selected");}});$("#tableTopNavMenu_btn").on("click",function(){if($(".header-menu").is(':visible')){$(".header-menu").css('display','none');}else{$(".header-menu").css('display','block');}});$("#dvExpandedLinksList").mouseleave(function(){header.restAll();});$('#dvHeaderInfo').mouseleave(function(){header.restAll();});$("#headerInfo_btn").on("click",function(){if($('#dvHeaderInfo').is(':visible')){header.restAll();}
else{header.restAll();$("#dvHeaderInfo").show();$("#headerInfo_btn").addClass("nav-selected");}});$("#info-ok").on("click",function(){header.restAll();});$("#userGuide").on("click",function(){previewer.open(sd.Configuration.userGuide);});$("#info-terms").on("click",function(){previewer.open(sd.Configuration.terms);});$("#relaunchOverlay").on("click",function(){LoadSection("mccann",true);trainingOverlays.relaunchOverlay();});$("#dvGoHome").on("click",function(){LoadSection("mccann",true);});$("#headerSearchRun_btn").on("click",function(){var searchString=$('#headerSearchFieldInput').val();var errMsg=runSearch.validSearchTerm(searchString);if(errMsg!=""){sd.component.messageBox.action({title:"Search",height:150,text:errMsg,btn1:"Ok"});return;}
header.simpleSearch();});$("#footer .js-fAbout").unbind("click").bind("click",function(){window.open(sd.Configuration.footerAboutURL,"_blank");});$("#quickSearchDropDown .quickSearchClose").unbind("click").bind("click",function(){$("#quickSearchDropDown").hide();})};header.simpleSearch=function(){var searchString=$('#headerSearchFieldInput').val();if(searchString.length==0){sd.component.messageBox.action({title:"Search",width:400,height:150,text:"Please enter a search term.",btn1:"OK",icon1:"icon-check"});return;}
if(searchString.length<3){sd.component.messageBox.action({title:"Search",width:400,height:150,text:"Your first search term '"+searchString+"' must be greater than 2 characters.",btn1:"OK",icon1:"icon-check"});return;}
LoadSection("search",true,{mode:"simple"});};header.handleMenuItems=function(myData,status){$("#nvHorizontalMenu").html('');header.appendToTopNav($("#nvHorizontalMenu"),myData,0);$('#nvHorizontalMenu').append("<a id=\"headerReady\"></a>");$("#footer .exploreSite div").remove();header.appendToFooter($("#footer .exploreSite"),myData,0);$('#nvHorizontalMenu li a').click(function(){if($(this).attr("data-type")=="link"){window.open(sd.Configuration.folderLink[$(this).attr('data-inode')].url,'_blank');return;}
if($('.header-option--mobile').is(':visible')){$('.mc-bottom-nav').slideToggle();}
header.restAll();header.loadTopNavigation();var obj={};obj.f_node=$(this).attr('data-inode');obj.al=$(this).attr('data-al');if(sd.Configuration.libraryInode==$(this).attr('data-fnode')){obj.f_node=$(this).attr('data-inode');obj.ParentID=$(this).attr('data-inode');}
else{obj.f_node=$(this).attr('data-inode');obj.ParentID=$(this).attr('data-parent');}
obj.type=$(this).attr('data-type');obj.template=$(this).attr('data-template');obj.item=$(this).attr('data-item');if((obj.item=="Dream Crew")&&($(this).parent().children().length>0)){return;}
obj.standalone=false;if(obj.template=="article"||obj.template=="map"||obj.template=="social"){if($(this).hasClass("nav-top-a")==true&&$(this).parent().find(".nav-child").length==0){obj.standalone=true;}}
$(".brand-current").removeClass("brand-current");$(this).parent().parent().parent().addClass("brand-current");var sc=new sd.ServerCall("LogContentMetric");sc.data({inode:obj.f_node,metricType:"SECTION_OPEN"});sc.cbData({obj:obj});sc.go({onSuccess:header.handleAddMetric,onError:metrics.handleError});});$(".nav-top-a").on("click",function(){var item=$($(this).parent().find("a")[0]).attr("data-item");if((item=="Dream Crew")&&($(this).parent().children().length>0)){$(this).removeClass("brand-current");return;}
$(".brand-current").removeClass("brand-current");$(this).parent().addClass("brand-current");});$('#footer .exploreSite a').click(function(){if($(this).attr("data-type")=="link"){window.open(sd.Configuration.folderLink[$(this).attr('data-inode')].url,'_blank');return;}
header.restAll();header.loadTopNavigation();var obj={};obj.f_node=$(this).attr('data-inode');obj.al=$(this).attr('data-al');if(sd.Configuration.libraryInode==$(this).attr('data-fnode')){obj.f_node=$(this).attr('data-inode');obj.ParentID=$(this).attr('data-inode');}
else{obj.f_node=$(this).attr('data-inode');obj.ParentID=$(this).attr('data-parent');}
obj.type=$(this).attr('data-type');obj.template=$(this).attr('data-template');obj.item=$(this).attr('data-item');var sc=new sd.ServerCall("LogContentMetric");sc.data({inode:obj.f_node,metricType:"SECTION_OPEN"});sc.cbData({obj:obj});sc.go({onSuccess:header.handleAddMetric,onError:metrics.handleError});});};header.appendToTopNav=function(parent,menu,level){for(var i=0;i<menu.length;i++){var item=menu[i];if(sd.Configuration.folderLink[menu[i].i]!=undefined){item.t="link";}
if(level==0){var submenu1=parent.append("<li class=\"box-sizing nav-top-level\" id = 'ulTopNav"+item.i+"' color = '"+i+"'><a class=\"nav-top-a\" data-inode =  '"+item.i+"' data-fnode =  '"+item.f+"' data-type =  '"+item.t+"' data-template =  '"+item.tpl+"' data-item =  '"+item.im+"' data-parent =  '"+item.f+"' data-al =  '"+item.a+"'>"+item.im+'</a></li>').find("li:last");$("#ulTopNav"+menu[i].i).hoverIntent(header.menuConfig);}
else{submenu1=parent.append("<li class=\"box-sizing nav-child \"  id = 'ulChildNav"+item.i+"'><a class=\"nav-top-a-side\"  data-inode =  '"+item.i+"' data-fnode =  '"+item.f+"' data-type =  '"+item.t+"' data-template =  '"+item.tpl+"' data-item =  '"+item.im+"' data-parent =  '"+item.f+"' data-al =  '"+item.a+"'>"+item.im+'</a></li>').find("li:last");}
if(menu[i].menu!=undefined&&menu[i].menu.length>0){submenu1=submenu1.append("<i class=\"fa icon-plus right \"></i><ul class=\"box-sizing nav-ul dropdown\" id ='ulChildNav"+i+"'></ul>").find("ul");$("#ulChildNav"+i).hide();header.appendToTopNav(submenu1,menu[i].menu,level+1);}}};header.appendToFooter=function(parent,menu,level){var htmlOut="";htmlOut+="<div class='flex flex-1 ma-t-half'>";if(menu!=undefined){for(var i=0;i<menu.length;i++){if(i==0){htmlOut+="<div class=\"flex flex-1 flex-column\">";}
if(i%4==0&&i>0){htmlOut+="</div><div class=\"flex flex-1 flex-column\">";}
var item=menu[i];if(sd.Configuration.folderLink[menu[i].i]!=undefined){item.t="link";}
htmlOut+="<a  data-inode =  '"+item.i+"' data-fnode =  '"+item.f+"' data-type =  '"+item.t+"' data-template =  '"+item.tpl+"' data-item =  '"+item.im+"' data-parent =  '"+item.f+"' data-al =  '"+item.a+"'>"+item.im+'</a>';}}
htmlOut+="</div>";parent.append(htmlOut);};header.handleCollabList=function(myData,status){var newWidth=0;var htmlOut="";for(var i=0;i<myData.length;i++){if(myData[i].n!=sd.Configuration.csName){var logo_filename=encodeURI(myData[i].l);htmlOut+="<div class=\"mc-logo each-brand hdrSelectCollab ma-tb-1\" data-csid=\""+myData[i].i+"\" title=\""+myData[i].n+"\" id=\"imgCollabIcon"+i+"\" style=\"background-image:url(images/mccann/logo/"+logo_filename+");\">";htmlOut+="</div>";}}
$("#dvUserCollabList").html(htmlOut);$(".portal-brand").css('display','flex');$('.hdrSelectCollab').click(function(){var options={};var metric={};metric.a="USER_LOGON";metric.i=0;metric.im="";metric.d="False";metric.u="";metric.dt="";metric.c=$(this).attr('data-csid');options.metric=metric;options.onSuccess=header.collabRedirect;metrics.add(options);});$('html, body').css({overflow:'hidden',height:'100%'});};header.collabRedirect=function(myData,status){var url=sd.Configuration.ws.replace("ws","login.aspx");window.location.href=url;};header.restAll=function(){$(".portal-brand").hide();$("html").css("overflow","");$("html").css("height","");$("body").css("overflow","");$("body").css("height","");$("#dvHeaderSearchOptions").hide();$("#headerSearchOptions_btn").removeClass("nav-selected");$('.header-links').hide();$(".js-uLinks").removeClass("nav-selected");$('.header-favs').hide();$("#headerFavs_btn").removeClass("nav-selected");$("#dvHeaderInfo").hide();$("#headerInfo_btn").removeClass("nav-selected");};header.topNavExpand=function(){$(this).children('ul').fadeIn('fast');$(this).children('i').removeClass("icon-plus").addClass("icon-minus");if($('.icon-minus').is(':visible')&&$(this).children('ul').length>0){$(this).css('background-color','#e9e9e9;');}};header.topNavContract=function(){$(this).children('ul').fadeOut('fast');$(this).children('i').removeClass("icon-minus").addClass("icon-plus");$(this).css('background-color','white');};header.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:100,text:error,btn1:"Ok"});};header.handleAddMetric=function(myData,status,cbData){var obj=cbData.obj;switch(obj.template){case"team":LoadSection(obj.template,true,obj);break;case"job":LoadSection(obj.template,true,obj);break;case"dreamteam":case"expert":case"artist":LoadSection("crew",true,obj);break;case"boxEmbed":LoadSection(obj.template,true);break;case"egnyteEmbed":LoadSection(obj.template,true);break;case"client":LoadSection(obj.template,true,obj);break;case"newletter":LoadSection("client",true,obj);break;case"article":LoadSection(obj.template,true,obj);break;case"map":LoadSection(obj.template,true,obj);break;case"social":LoadSection(obj.template,true,obj);break;default:LoadSection("library",true,obj);}};window.header=header;}(window));﻿
var globalSection="";var globalBrowserDetails;function init(){$('link[rel=stylesheet][href~="sass/maccann.css"]').prop('disabled',true);$('#main-loader').show();if(sd.Configuration.siteTitle!=undefined)
$("title").html(sd.Configuration.siteTitle);else
$("title").html("HTML Unity");$.each(sd.Configuration.templates,function(key,value){sd.Configuration.templates[key]=sd.Configuration.templates[key]+"?v="+sd.Configuration.buildVersion;});if(sd.Session.user==null)
sd.Session.getUserDetails(sessionUserDetailsSet);else
sessionUserDetailsSet();if(sd.Configuration.csData!=null){var arrTmp=sd.Configuration.csData.split(";");for(var idx=0;idx<arrTmp.length;idx++){var item=arrTmp[idx].split(":");sd.Global.collabData[item[0]]=item[1].replace(/%3A/g,":").replace(/%27/g,"'");}}
globalBrowserDetails=sd.Utils.getBrowserDetails();window.onbeforeunload=confirmExit;SetupSiteSections();sd.FileUploader.init();}
function confirmExit()
{if(previewer.changeLog.length>0)
{previewer.close()
return sd.Configuration.confirmExitMessagePreviewEmail;}
else if(sd.Configuration.confirmExitMessage!="")return sd.Configuration.confirmExitMessage;else return null;}
function SetupSiteSections()
{var buttonHTML="";for(var i=0;i<sd.Configuration.sections.length;i++)
{buttonHTML+='<div class="button_wrap"><div id="mainNavButton_'+sd.Configuration.sections[i].type+'" class="mainNavButton">'+sd.Configuration.sections[i].label+'</div></div>';}
$('#mainNavigation').append(buttonHTML);$(".mainNavButton").click(function(){var section=$(this).attr('id').replace("mainNavButton_","");LoadSection(section,true);});}
function LoadSection(section,addToHistory,objData){$("html").css("overflow","");window.scrollTo(0,0);if(globalBrowserDetails.agent=="MSIE"||globalBrowserDetails.agent=="Firefox"){window.onbeforeunload=confirmExit;}
if($.isEmptyObject(objData))
{if(admin.adminUser()||sd.Session.user.superAdmin)
{objData={};objData.al=3;}
else{objData={};objData.al=0;}}
else if(objData.al==undefined)
{if(admin.adminUser()||sd.Session.user.superAdmin)
{objData.al=3;}
else{objData.al=0;}}
var historySet=0;if($.isEmptyObject(objData)==false&&objData.csid!=""&&objData.csid!=undefined&&objData.csid!=sd.Configuration.csid){var sc=new sd.ServerCall("CheckCollabSpaceAccess");sc.data({csID:objData.csid});sc.go({onSuccess:function(myData,status){if(myData.length==0){accessDeniedToItem("This item belongs to a portal which you cannot access, you will be redirected.");return;}
else{var options={};var metric={};metric.a="USER_LOGON";metric.i=0;metric.im="";metric.d="False";metric.u="";metric.dt="";metric.c=objData.csid;options.metric=metric;options.onSuccess=redirectUser;metrics.add(options);}},onError:header.handleError});}
else{$('.call-to-action').css("display","none");$('.call-to-action-multi').css("display","none");$("#homeIFrame").hide();$(".modal-overlay-iframe").hide();$(".close-iframe").hide();$(".jsCarouselContainer").hide();$(".jsCarouselContainer ul").empty();$(".jsCarouselContainer1").hide();$(".jsCarouselContainer1 ul").empty();sd.Utils.killAllVideos();globalSection=section;switch(section){case"mccann":$('#sectionContainer').load(sd.Configuration.templates.dashboard,function(){myDashboard.init();});$('#loader').hide();break;case"social":$('#sectionContainer').load(sd.Configuration.templates.mccann,function(){channel.init();});break;case"library":$('#sectionContainer').load(sd.Configuration.templates.library,function(){library.init(objData);});break;case"article":if(objData.standalone==true){page.init({inode:objData.f_node,container:"#sectionContainer"});}
else{$('#sectionContainer').load(sd.Configuration.templates.library,function(){library.init(objData);});}
break;case"map":$('#sectionContainer').load(sd.Configuration.templates.library,function(){library.init(objData);});break;case"admin":$('#sectionContainer').load(sd.Configuration.templates.admin,function(){admin.init();});break;case"adminGroups":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminGroups,function(){groups.init();});break;case"adminUsers":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminUsers,function(){users.init();});break;case"adminMetaAttributes":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminMetaAttributes,function(){metaAttributes.init();});break;case"adminSectionMetaAttributes":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminSectionMetaAttributes,function(){sectionMetaAttributes.init();});break;case"team":$('#sectionContainer').load(sd.Configuration.templates.team,function(){team.init(objData);});if(objData.userID!=null)addToHistory=false;break;case"userProfile":$('#sectionContainer').load(sd.Configuration.templates.userProfile,function(){team.showUser(objData);});break;case"crew":$('#sectionContainer').load(sd.Configuration.templates.crewList,function(){crew.init(objData);});if(objData.i_node!=null)addToHistory=false;break;case"job":$('#sectionContainer').load(sd.Configuration.templates.jobList,function(){job.init(objData);});break;case"crewItem":$('#sectionContainer').load(sd.Configuration.templates.crewItem,function(){if(objData!=undefined)crew.getItemDetails(objData.i_node);else crew.getItemDetails();});if(addToHistory)sd.Utils.historyAdd({'section':section,'inode':crew.id});historySet=1;break;case"mccannGlobalSearch":$('#sectionContainer').load(sd.Configuration.templates.mccannGlobalSearch,function(){team.initMcCannGlobalSearch(objData.searchString);});break;case"adminLinks":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminLinks,function(){links.initSectionsAdmin();});break;case"boxEmbed":if(sd.Session.user.boxRefreshToken==""){var url=window.location.protocol+"//";url+=window.location.host;url+=window.location.pathname;url+="?section=boxEmbed";var boxManager=sd.Configuration.ws+"/boxManager.aspx?source_uri="+url;window.location.replace(boxManager);}
else
$('#sectionContainer').load(sd.Configuration.templates.boxEmbed,function(){$("#loader").hide();});break;case"egnyteEmbed":$('#sectionContainer').load(sd.Configuration.templates.egnyteEmbed,function(){$("#loader").show();var sc=new sd.ServerCall("GenerateEmbedURL");sc.go({onSuccess:function(myData,status){var embed='<iframe id="js-eiframe" src="'+myData[0].embed+'" width="100%" height="600px" />';$("#dvEgnyteEmbed").html(embed);$('#js-eiframe').load(function(){setTimeout(function(){$("#loader").hide();},5000);});},onError:function(error){sd.component.messageBox.action({title:"Egnyte Embed",text:error,height:150,width:400,icon2:"icon-ok-sign",btn2:"Ok"});}});});break;case"adminCollabSpaces":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminCollabSpaces,function(){collabSpaces.init();});break;case"adminAnnouncements":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminAnnouncements,function(){announcements.initAdmin();});break;case"adminMenu":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminMenu,function(){adminMenu.init();});break;case"adminSA":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminSA,function(){sectionAdmins.init();});break;case"adminTO":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminTO,function(){trainingOverlays.init();});break;case"adminEmail":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminEmail,function(){adminEmail.init();});break;case"adminUserSettings":$('#sectionContainer').load(sd.Configuration.templates.adminUserSettings,function(){adminUserSettings.init();});break;case"adminMetrics":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminMetrics,function(){adminMetrics.init();});break;case"search":$('#sectionContainer').load(sd.Configuration.templates.search,function(){runSearch.init(objData);});break;case"channel":$('#sectionContainer').load(sd.Configuration.templates.mccann,function(){channel.initChannel(objData.i_node);});break;case"comment":var pathItems=objData.path.split(';');var channelID=pathItems[2].split(':')[1];if(pathItems.length>4)
{comment=pathItems[3].split(':')[1];}
else
{comment=objData.i_node;}
$('#sectionContainer').load(sd.Configuration.templates.mccann,function(){channel.initChannel(channelID);channel.locateComment(comment,channelID);});break;case"client":$('#sectionContainer').load(sd.Configuration.templates.clientList,function(){client.init(objData);});break;case"adminDisclaimers":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminDisclaimers,function(){disclaimer.initAdmin();});break;case"expandedLinks":$('#sectionContainer').load(sd.Configuration.templates.expandedLinks,function(){links.populateExpandedLinks();});break;case"adminIFrame":if(admin.adminUser()==false){accessDeniedToItem("Only administrators are permitted to access this module.");}
else
$('#sectionContainer').load(sd.Configuration.templates.adminIFrame,function(){collabSpaces.loadIFrameAdmin();});break;default:}
if(historySet==0)
{if(addToHistory&&section=="search")
{var searchString=$('#headerSearchFieldInput').val();var mode;if(objData.mode=="preset"){searchString=objData.searchString;mode="simple";""}
else
mode=objData.mode;sd.Utils.historyAdd({'section':section,'term':searchString,'mode':mode,'fnode':objData.searchRootNode});}
else if(addToHistory&&(objData!=undefined))sd.Utils.historyAdd({'csid':sd.Configuration.csid,'section':section,'inode':objData.i_node,'template':objData.template,'ParentID':objData.ParentID,'fnode':objData.f_node,'mode':objData.mode,'userID':objData.userID});else if(addToHistory)sd.Utils.historyAdd({'section':section,'csid':sd.Configuration.csid});}
$('#main-loader').hide();if(objData&&objData.ParentID>0)
{waitUntilExists("ulTopNav"+objData.ParentID,function(){$("#ulTopNav"+objData.ParentID).addClass("brand-current");});}}}
function JumpToItem(inode){if(globalBrowserDetails.agent=="MSIE"||globalBrowserDetails.agent=="Firefox"){window.onbeforeunload=confirmExit;}
var sc=new sd.ServerCall("GetJumpToDetails");var obj=new Object();obj.i_node=inode;sc.data(obj);sc.go({onSuccess:HandleJumpToItem,onError:HandleJumpToError});}
function HandleJumpToItem(myData,status){var item=myData[0];if(item===undefined){accessDeniedToItem("Error: item does not exist.");return;}
var type=item.type.toLowerCase();if(item.csid!=sd.Configuration.csid)
{var sc=new sd.ServerCall("CheckCollabSpaceAccess");sc.data({csID:item.csid});sc.go({onSuccess:function(myData,status){if(myData.length==0){accessDeniedToItem("You are trying to access an item in a portal you have no access to. You will be redirected.");return;}
else{var options={};var metric={};metric.a="USER_LOGON";metric.i=0;metric.im="";metric.d="False";metric.u="";metric.dt="";metric.c=item.csid;options.metric=metric;options.onSuccess=redirectUser;metrics.add(options);}},onError:header.handleError});return;}
else
{$(".nav-top-level").removeClass("brand-current");$("#homeIFrame").hide();$(".modal-overlay-iframe").hide();$(".close-iframe").hide();$('.toggle-filters').bind("click",function(){$('.sidebar').toggleClass('toggled')});switch(type){case"bestcase":case"document":case"newsletter":var arrTmp=item.path.split(';');var ParentID=arrTmp[2];arrTmp=ParentID.split(':');item.ParentID=arrTmp[1];item.template=item.type;LoadSection("library",true,item);$("#ulTopNav"+arrTmp[1]).addClass("brand-current");break;case"folder":var arrTmp=item.path.split(';');var ParentID=arrTmp[2];arrTmp=ParentID.split(':');var obj={};obj.f_node=item.i_node;if(sd.Configuration.libraryInode==item.f_node){obj.f_node=item.i_node;obj.ParentID=item.i_node;}
else{obj.f_node=item.i_node;obj.ParentID=item.f_node;}
obj.standalone=false;if(obj.template=="article"||obj.template=="map"||obj.template=="social"){if(item.children>0&&sd.Configuration.libraryInode==item.f_node){obj.standalone=true;}}
obj.type=item.type;obj.template=item.template;obj.item=item.item;LoadSection("library",true,obj);$("#ulTopNav"+arrTmp[1]).addClass("brand-current");break;case"dreamteam":case"expert":case"artist":var arrTmp=item.path.split(';');var ParentID=arrTmp[2];arrTmp=ParentID.split(':');item.template=item.type;item.ParentID=arrTmp[1];LoadSection("crew",true,item);$("#ulTopNav"+arrTmp[1]).addClass("brand-current");break;case"discussion":LoadSection("channel",true,item);break;case"job":LoadSection("job",true,item);break;case"comment":LoadSection("comment",true,item);break;default:sd.component.messageBox.action({title:"Item Unavailable",text:"Unknown Item",height:150,width:400,icon2:"icon-ok-sign",btn2:"Ok"});}}}
function HandleJumpToError(error){sd.component.messageBox.action({title:"Item Unavailable",text:error,height:150,width:400,icon2:"icon-ok-sign",btn2:"Ok"});}
function sessionUserDetailsSet(){var csid=sd.Utils.GetURLParameter("csID");if(csid!=""&&csid!=null){var sc=new sd.ServerCall("CheckCollabSpaceAccess");sc.data({csID:csid});sc.go({onSuccess:function(myData,status){if(myData.length==0){accessDeniedToItem("You are trying to access an item in a portal you have no access to. You will be redirected.");}
else{continueCollabAccess();}}});}
else{continueCollabAccess();}}
function continueCollabAccess(){var sc=new sd.ServerCall("GetSessionDetails");sc.go({onSuccess:function(myData){if(myData[0].csid==sd.Configuration.csid)
{var csid=sd.Utils.GetURLParameter("csID");if(csid!=""&&csid!=undefined&&csid!=myData[0].csid)
{accessDeniedToItem("Error: There is an issue loading this item. You will be redirected");}
else
{mccann.collabDetails={};var sc=new sd.ServerCall("GetCollabSpaceDetails");sc.data({id:sd.Configuration.csid});sc.go({onSuccess:function(myData){mccann.handleCollabData(myData);var sc=new sd.ServerCall("GetUserMetaFilters");sc.data({});sc.go({onSuccess:handleUserMetaFilters,onError:handleError});var csid=sd.Utils.GetURLParameter("csID");var inode=sd.Utils.GetURLParameter("inode");var section=sd.Utils.GetURLParameter("section");var template=sd.Utils.GetURLParameter("template");var fnode=sd.Utils.GetURLParameter("fnode");var ParentID=sd.Utils.GetURLParameter("ParentID");var mode=sd.Utils.GetURLParameter("mode");var userID=sd.Utils.GetURLParameter("userID");$('#header').load(sd.Configuration.templates.header,function(){header.init();});if(inode!=""&&inode!=null)
JumpToItem(inode);else if(section!="")
LoadSection(section,true,{csid:csid,f_node:fnode,template:template,i_node:inode,ParentID:ParentID,mode:mode,userID:userID});else
LoadSection(sd.Configuration.sections[0].type,true,{csid:csid});disclaimer.showLoginDisclaimer();},onError:mccann.handleError});}}
else
{redirectUser();}}});}
function accessDeniedToItem(message){if(message==""||message===undefined)
message="You are trying to access an item which you do not have permission for. You will be redirected.";var url=sd.Configuration.ws.replace("ws","login.aspx");sd.component.messageBox.action({title:"Error",height:150,text:message,btn1:"Ok",btn1callback:function(){window.location.href=url;},closeCallback:function(){window.location.href=url;}});}
function redirectUser(){var section=window.location.href.split("?");var url=sd.Configuration.ws.replace("ws","login.aspx?ReturnUrl=index.aspx?"+encodeURIComponent(section[1]));window.location.href=url;}
function handleUserMetaFilters(myData){sd.Session.userMetaFilters=myData;}
function handleError(error){sd.component.messageBox.action({title:"Action Unavailable",height:100,text:error,btn1:"Ok"});}﻿(function(window){var job={};job.MenuData=null;job.item={};job.currentList=[];job.filteredList=[];job.currentSortDirection="";job.currentSortBy="";job.itemsPerPage=16;job.totalPages=0;job.inodeList=[];job.limit=400;job.pagingOptions={};job.jumpTo=false;job.adminUser=0;job.rootPerm=0;job.fnode=0;job.allUniqueMetaAttributes=[];job.allMetaAttributes=[];job.appliedFilters=[];job.filteredMetaAttributes=[];job.MenuArray=[];job.selectedItem={};job.breadcrumb=[];job.downloadInode;job.currFolderContracted=true;job.expandedFolders=[];job.formCheckLists=[{attribute:"location",checklist:"dvLocationList",title:"Location"},{attribute:"level",checklist:"dvLevelList",title:"Level"},{attribute:"languages",checklist:"dvLanguageList",title:"Languages"}];job.init=function(obj){job.item=obj;job.i_node=(obj==undefined)?0:obj.i_node;job.adminUser=(obj==undefined)?0:obj.al;job.rootPerm=job.adminUser;job.fnode=(obj==undefined)?0:obj.f_node;job.currentSortDirection="DESC";job.currentSortBy="createdate";job.viewMode="list";job.totalPages=0;job.currentPage=1;job.currentList=[];job.filteredList=[];job.inodeList=[];job.MenuArray=[];job.pagingOptions={};job.allUniqueMetaAttributes=[];job.allMetaAttributes=[];job.appliedFilters=[];job.filteredMetaAttributes=[];job.currFolderContracted=true;job.expandedFolders=[];$("#newjobItem_btn").hide();$("#dvjobMetaFilters").hide();$("#jobReset_btn").hide();$('#tbjobListHeader .sectionTitleTitle').click(function(){job.createList("name")});$('#tbjobListHeader .sectionTitleCreator').click(function(){job.createList("creator")});$('#tbjobListHeader .sectionTitleDate').click(function(){job.createList("createdate")});$('#tbjobListHeader .icon-chevron-up').hide();$('#tbjobListHeader .icon-chevron-down').hide();job.addEventListeners();if(job.i_node>0){job.jumpTo=true;$(".list-header").hide();$("#dvjobFilter").hide();$("#dvjobPagingHeader").hide();$("#tbjobListHeader").hide();}
if(jQuery.isEmptyObject(job.item)==true){job.rootNode=sd.Configuration.jobInode;job.LoadMenu();if(job.jumpTo==false)
job.ListItems(job.rootNode);else
job.currFnode=job.rootNode;}else{job.rootNode=job.item.ParentID;job.LoadMenu();if(job.jumpTo==false){job.ListItems(job.item.f_node);}
else
job.currFnode=job.item.f_node;}
if(job.jumpTo==true){var obj={};obj.id=job.i_node;obj.type=job.item.template;job.loadItem(obj);}
var title=$('#ulTopNav'+job.rootNode+' [data-inode='+job.rootNode+']').text();$("#jobFilterText").attr("placeholder","Search "+title);$("#jobFilterText").attr("title","Search "+title);}
job.ListItems=function(fnode){$('#dvjobFilter').show();$('#dvjobPagingHeader').show();$('#tbListHeader').show();$('#dvjobPagingFooter').show();$("#loader").show();$("#jobList").empty();$("#jobList_btn").addClass("view-as-selected");sd.Utils.killAllVideos();var obj={};var sc=new sd.ServerCall("ListJobs");sc.data({fnode:fnode});sc.go({onSuccess:job.handleList,onError:job.handleError});}
job.handleList=function(myData,status){job.currentList=[];job.inodeList=[];$('#jobList').empty();$('#loader').show();for(var idx=0;idx<myData.length;idx++){var item={};item.id=myData[idx].i;item.thumb=myData[idx].i;item.name=myData[idx].t;item.description=myData[idx].d;item.createdate=myData[idx].ct;item.creator=myData[idx].a;item.type=myData[idx].tp;item.format=myData[idx].f;item.path=myData[idx].p;item.authorName=myData[idx].an;item.authorID=myData[idx].ai;item.disc=myData[idx].disc;item.filled=myData[idx].ft;job.inodeList.push(item.id);job.currentList.push(item);}
$('#dvjobFilter').show();$('#dvjobPagingHeader').show();$('#tbjobListHeader').show();$('#dvjobPagingFooter').show();$(".list-header").show();$("#newjobItem_btn").hide();$("#dvjobMetaFilters").hide();if(sd.Session.user.superAdmin==true||job.adminUser>1||admin.adminUser()){$("#newjobItem_btn").show();}
job.createList(null,null)}
job.buildFilterMenu=function(myData,status){var item;var htmlOut="";var currentMetaType="";job.allUniqueMetaAttributes=[];job.allMetaAttributes=[];for(var idx=0;idx<myData.length;idx++){item=myData[idx];var obj={};obj.id=myData[idx].i;obj.type=myData[idx].t;obj.value=myData[idx].v;if(myData[idx].t.toLowerCase()=="segment")
obj.sort="segmenta";else if(myData[idx].t.toLowerCase()=="product")
obj.sort="segmentb";else
obj.sort=myData[idx].t;job.allUniqueMetaAttributes.push(obj);obj.inode=myData[idx].nd;job.allMetaAttributes.push(obj);}
job.allUniqueMetaAttributes=sd.Utils.removeObjectArrayDuplicates(job.allUniqueMetaAttributes,"id");job.allUniqueMetaAttributes.sort(sd.Utils.dynamicSortMultiple("sort","value"));for(var idx=0;idx<job.allUniqueMetaAttributes.length;idx++){item=job.allUniqueMetaAttributes[idx];if(item.type!=currentMetaType){if(currentMetaType!="")htmlOut+="</div>";currentMetaType=item.type;htmlOut+="<h3><span class=\"accordionHead\">"+currentMetaType.charAt(0).toUpperCase()+currentMetaType.slice(1)+"</span></h3><div>";}
htmlOut+="<div class=\"accordion-menu\">";htmlOut+="<label class = \"filterText\" data-id=\""+item.id+"\" data-value=\""+item.value+"\" data-type=\""+item.type+"\">";htmlOut+="<input type=\"checkbox\" id=\"chk"+item.id+"\" value=\""+item.id+"\"/>"+item.value+"</label>";htmlOut+="</div>";}
$("#dvjobMetaFilters").empty();$("#dvjobMetaFilters").show();$("#dvjobMetaFilters").append("<div class=\"accordion-text list-text\">Filter Results by:</div><div id=\"dvBCFilterAccordion\" class=\"accordion-menu\"></div>");if(myData.length==0){$("#dvjobMetaFilters").hide();}else{$("#dvjobMetaFilters").show();}
$(".filterText").click(function(){var id=$(this).data('id');var type=$(this).data('type');var value=$(this).data('value');if($("#chk"+id).prop("checked")==true){var obj={};obj.id=id;obj.type=type;obj.value=value;job.appliedFilters.push(obj);}else{job.removeFilterFromArray(id)}
job.currentPage=1;job.createList(null,null);});job.createList(null,null);}
job.createList=function(sortBy,sortDirection){job.filterList();job.pagingOptions={prev_text:"<i class=\"icon-double-angle-left\"></i> Prev",next_text:"Next <i class=\"icon-double-angle-right\"></i>",num_display_entries:9,current_page:job.currentPage-1,num_edge_entries:1,callback:job.changePage,items_per_page:job.itemsPerPage}
var listCount=job.filteredList.length;var endIndex=(job.currentPage)*job.itemsPerPage;var startIndex=endIndex-job.itemsPerPage;if(endIndex>listCount)endIndex=listCount;var direction="";if(sortBy==null){if(job.currentSortDirection=="DESC"){direction="-";}}else{if(job.currentSortBy==sortBy){if(sortDirection!=job.currentSortDirection){if(job.currentSortDirection=="ASC"){job.currentSortDirection="DESC";direction="-";}else job.currentSortDirection="ASC";}}else{job.currentSortBy=sortBy;job.currentSortDirection=sortDirection||"ASC";if(job.currentSortDirection=="DESC"){direction="-";}}}
if(job.currentSortBy=="name")job.filteredList.sort(sd.Utils.dynamicSortMultiple("-filled",direction+"name"));else if(job.currentSortBy=="creator")job.filteredList.sort(sd.Utils.dynamicSortMultiple("-filled",direction+"creator"));else if(job.currentSortBy=="createdate")job.filteredList.sort(sd.Utils.dynamicSortMultiple("-filled",direction+"createdate"));$('#tbjobListHeader .icon-chevron-up').hide();$('#tbjobListHeader .icon-chevron-down').hide();var sortArrow="icon-chevron-up";if(job.currentSortDirection=="DESC")sortArrow="icon-chevron-down";$('#tbjobListHeader .sectionListField').removeClass("theme-list-sort-active");if(job.currentSortBy=="name"){$('#tbjobListHeader .sectionTitleTitle > .'+sortArrow).show();$('#tbjobListHeader .sectionTitleTitle').addClass("theme-list-sort-active");}
sd.Utils.killAllVideos();$("#jobList").empty();job.totalPages=Math.ceil(listCount/job.itemsPerPage);$("#dvjobPagingHeader").empty();$("#dvjobPagingFooter").empty();$("#dvjobPagingHeader").pagination(listCount,job.pagingOptions);$("#dvjobPagingFooter").pagination(listCount,job.pagingOptions);job.displayListView(startIndex,endIndex);}
job.filterList=function(){for(var k=0;k<job.allUniqueMetaAttributes.length;k++)
$("#chk"+job.allUniqueMetaAttributes[k].id).prop("checked",false);$("#dvjobSelectedMetaFilters").empty();var listCount=job.currentList.length;var item;var html="";var filterData=[];var filterText=$("#jobFilterText").val();if(job.appliedFilters.length>0)$("#dvjobSelectedMetaFilters").show();if(job.appliedFilters.length>0||filterText!="")
$("#jobReset_btn").show();if(job.appliedFilters.length==0&&filterText=="")
$("#jobReset_btn").hide();for(var k=0;k<job.appliedFilters.length;k++){item=job.appliedFilters[k];if(k==0)html="Selected Filters: <br>";html+="<i class=\"icon-remove-sign\" title=\"Remove Filter\" onClick=\"job.removeFilterFromPanel("+item.id+")\"></i><label onClick=\"job.removeFilterFromPanel("+item.id+")\">";html+=" "+item.value;$("#chk"+item.id).prop("checked",true);html+="</label><br>";if(filterData[job.appliedFilters[k].type]==undefined)
filterData[job.appliedFilters[k].type]=[];filterData[job.appliedFilters[k].type].push(job.appliedFilters[k]);}
$("#dvjobSelectedMetaFilters").html(html);var listCount=job.currentList.length;job.filteredList=[];if(job.appliedFilters.length==0)
job.filteredMetaAttributes=job.allMetaAttributes;else
job.filteredMetaAttributes=[];var arrUniqueTypes=sd.Utils.removeObjectArrayDuplicates(job.appliedFilters,"type");var uniqueTypes=arrUniqueTypes.length;for(var idx=0;idx<listCount;idx++){item=job.currentList[idx];var match=false;if(job.appliedFilters.length>0){var matchCount=0;var typeMatch;if(Object.keys(filterData).length>0){var filter;for(var key in filterData){typeMatch=false;for(var i=0;i<filterData[key].length;i++){filter=filterData[key][i];for(var j=0;j<job.allMetaAttributes.length;j++){if((job.allMetaAttributes[j].inode==item.id)&&(job.allMetaAttributes[j].id==filter.id)){matchCount++;typeMatch=true;break;}}
if(typeMatch==true)break;}}
if(matchCount==uniqueTypes)match=true;}
if(!match)continue;for(var i=0;i<job.allMetaAttributes.length;i++){if(item.id==job.allMetaAttributes[i].inode){var obj={};obj.id=job.allMetaAttributes[i].id;obj.value=job.allMetaAttributes[i].value;obj.type=job.allMetaAttributes[i].type;job.filteredMetaAttributes.push(obj);}}}
job.filteredList.push(item);}}
job.updateFilterCounts=function(){var filterText=$('#jobFilterText').val().toLowerCase();for(var k=0;k<job.allUniqueMetaAttributes.length;k++){var count=0;if(job.appliedFilters.length==0&&filterText=="")
count=sd.Utils.countObjectArrayValues(job.allMetaAttributes,"id",job.allUniqueMetaAttributes[k].id);else
count=sd.Utils.countObjectArrayValues(job.filteredMetaAttributes,"id",job.allUniqueMetaAttributes[k].id);if(count>0){$("#lblFilterCount"+job.allUniqueMetaAttributes[k].id).parent().show();$("#lblFilterCount"+job.allUniqueMetaAttributes[k].id).text(" ("+count+")");}
else{$("#lblFilterCount"+job.allUniqueMetaAttributes[k].id).parent().hide();}}}
job.displayListView=function(startIdx,endIdx){var fragmentWrap=document.createDocumentFragment();$(".guide .docListGuide .docList-Wrapper").clone().appendTo(fragmentWrap);$("#jobList").empty().show();$("#jobList").html(fragmentWrap);$("#jobList").foundation();var fragmentLib=document.createDocumentFragment();var cloneLib;for(var idx=startIdx;idx<endIdx;idx++){var item=job.filteredList[idx];cloneLib=$(".guide .docListGuide .list-item").clone().appendTo(fragmentLib);cloneLib.attr("data-id",item.id);cloneLib.attr("data-type",item.type);cloneLib.find(".pic-list").attr("data-id",item.id);cloneLib.find(".pic-list").attr("data-type",item.type);if(item.filled==1||(item.status=="draft")){if(item.filled==1)
cloneLib.find(".libraryFavItem").attr("src",'images/mccann/featured_badge.png')
if(item.status=="draft")
cloneLib.find(".libraryFavItem").attr("src",'images/mccann/draftNewsletter.png')}else{cloneLib.find(".libraryFavItem").remove();}
if(sd.Utils.isVideo(item.format)){var html="<video class='videoClass' id='"+item.thumb+"' style=\"width: 100%; height: 100%;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.thumb+"/"+item.thumb+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";cloneLib.find(".js-image").append(html);}
else{var image=sd.Configuration.vault+"/"+item.thumb+"/bigthumb.jpg";cloneLib.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}
cloneLib.find(".js-file-name").attr("data-id",item.id);cloneLib.find(".js-file-name").attr("data-type",item.type);cloneLib.find(".js-file-name").attr("id","thumb-name-"+item.id);cloneLib.find(".js-file-name").addClass("listHeaderClick");cloneLib.find(".js-file-name").html(item.name);cloneLib.find(".js-file-desc").html(item.description);cloneLib.find("js-file-author").html(item.creator);cloneLib.find(".js-file-author").attr("data-id",item.authorID);cloneLib.find(".js-file-author").attr("data-name",item.authorName);cloneLib.find(".js-file-date").html(item.createdate);cloneLib.find(".listHeaderClick").unbind("click").bind("click",function(event){var obj={};obj.id=$(this).data('id');obj.type=$(this).data('type');library.loadItem(obj);});if(!(library.listTemplate=="bestcase"||library.listTemplate=="newsletter")){cloneLib.append($(".guide .docListGuide .downloads").clone());cloneLib.find(".library-preview").attr("data-id",item.id);cloneLib.find(".library-preview").attr("data-type",item.type);cloneLib.find(".library-download").attr("data-id",item.id);cloneLib.find(".library-download").attr("data-disc",item.disc);}
if(library.listTemplate=="newsletter"){cloneLib.append($(".guide .docListGuide .linksPreview").clone());if(item.access>1){cloneLib.find(".library-edit").attr("data-id",item.id);cloneLib.find(".library-edit").attr("data-type",item.type);}
else{cloneLib.find(".library-edit").remove()}
cloneLib.find(".library-preview").attr("data-id",item.id);cloneLib.find(".library-preview").attr("data-type",item.type);if(item.status=="draft"){cloneLib.find(".library-link").remove()}
else{cloneLib.find(".library-link").attr("data-id",item.id);}}}
if(job.jumpTo==false){$("#jobList .docList-Wrapper").empty().show();$("#jobList .docList-Wrapper").html(fragmentLib);$("#jobList .docList-Wrapper").foundation();}
$('#jobList').append("<div id=\"done\"></div>").find('video').bind("loadeddata",function(){$('#jobList').find('video').attr('poster','');});$('#jobList .list-table-top').dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:25});$('#jobList span').dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:55});$(".job-link").click(function(){sd.Utils.shareFileLink($(this).data('id'));});$(".job-download").click(function(){job.downloadFile($(this).data('id'));});$(".listHeaderClick").click(function(){var obj={id:$(this).data('id'),type:$(this).data('type')};job.loadItem(obj);});$(".list-item-creator").click(function(){var obj={userID:$(this).data('id'),userName:$(this).data('name')};channel.getUserDetails(obj);});$(".list-thumb-img").click(function(){var obj={id:$(this).data('id'),type:$(this).data('type')};job.loadItem(obj);});$(".job-edit").click(function(){var obj={inode:$(this).data('id'),mode:"edit",fnode:job.fnode};newsletterBuilder.loadForm(obj);});$('#loader').hide();}
job.loadItem=function(obj){job.PreviewJob(obj.id);}
job.LoadMenu=function(){var obj=new Object();obj.limit=job.limit;obj.level=15;obj.inode=job.rootNode;var sc=new sd.ServerCall("FolderTraverse");sc.data(obj);sc.go({onSuccess:job.handleMenu});}
job.addToMenuArray=function(arrayIn){var item;for(var idx=0;idx<arrayIn.length;idx++){item={};item.i=arrayIn[idx].i;item.f=arrayIn[idx].f;item.t=arrayIn[idx].im;item.tpl=arrayIn[idx].tpl;item.p=arrayIn[idx].p;item.l=arrayIn[idx].l;item.a=arrayIn[idx].a;if(arrayIn[idx].menu.length>0){item.c=true;job.MenuData.push(item);job.addToMenuArray(arrayIn[idx].menu);}else{item.c=false;job.MenuData.push(item);}}}
job.handleMenu=function(myData,status){job.MenuData=[];var item;for(var idx=0;idx<myData.length;idx++){item={};item.f=myData[idx].f;item.i=myData[idx].i;item.t=myData[idx].im;item.tpl=myData[idx].tpl;item.p=myData[idx].p;item.l=myData[idx].l;item.a=myData[idx].a;if(myData[idx].menu.length>0){item.c=true;job.MenuData.push(item);job.addToMenuArray(myData[idx].menu);}else{item.c=false;job.MenuData.push(item);}}
job.drawMenu();}
job.drawMenu=function(){var title=$('#ulTopNav'+job.rootNode+' [data-inode='+job.rootNode+']').text();var homeButtonHTML="<div class='jobMenuItem' data-fnode='"+job.rootNode+"' data-inode='"+job.rootNode+"' id='menuHOME'><div class='jobMenuButton' id='menuButtonHOME' data-jobinode='"+job.rootNode+"' data-jobtemplate='"+job.rootTemplate+"'>Browse "+title+"</div></div>";$('#jobMenu').html(homeButtonHTML);job.rootTitle=title;$("#jobFilterText").attr("placeholder","Search "+title);$("#jobFilterText").attr("title","Search "+title);$('#jobTitle').text(title);var template;var htmlOut="";var styleClass="";for(var idx=0;idx<job.MenuData.length;idx++){if(job.MenuData[idx].l==0)
styleClass="parent-menu ";else
styleClass="child-menu child-level-"+job.MenuData[idx].l;if((job.MenuData[idx].tpl==null)||(job.MenuData[idx].tpl==""))job.MenuData[idx].tpl="Document";htmlOut+="<div class='"+styleClass+"' data-children= '"+job.MenuData[idx].c+"' data-fnode='"+job.MenuData[idx].f+"' data-inode='"+job.MenuData[idx].i+"'>";htmlOut+="      <div class='jobMenuButton' data-mode='c' data-jobtemplate='"+job.MenuData[idx].tpl+"' data-jobinode='"+job.MenuData[idx].i+"'  data-jobfnode='"+job.MenuData[idx].f+"' title='"+job.MenuData[idx].t+"'><i class=\"\"></i>"+job.MenuData[idx].t+"</div>";htmlOut+="</div>";}
$('#jobMenu').append(htmlOut);$(".jobMenuButton").click(function(){sd.Utils.killAllVideos();job.currentPage=1;var obj={};obj.ParentID=$(this).data('jobfnode');obj.f_node=$(this).data('jobinode');obj.item=$(this).html();obj.type=$(this).data('jobtemplate');obj.template=$(this).data('jobtemplate');var mode=$(this).attr('data-mode');if(mode=="e")
job.currFolderContracted=false;else
job.currFolderContracted=true;switch($(this).data('jobtemplate')){case"team":LoadSection(obj.template,true);break;case"dreamteam":case"expert":case"artist":LoadSection("crew",true,obj);break;default:job.displayPublishedNewsletter=true;$("#dvBestCaseHeader").hide();job.OpenMenuToInode($(this).data('jobinode'));job.listTemplate=$(this).data('jobtemplate');if((job.listTemplate=="")||(job.listTemplate=="0")||(job.listTemplate=="folder")||(job.listTemplate=="Document"))
job.listTemplate='Document';sd.Utils.historyAdd({'csid':sd.Configuration.csid,'section':'job','template':'folder','ParentID':job.fnode,'fnode':obj.f_node});job.ListItems($(this).data('jobinode'));}});if(jQuery.isEmptyObject(job.item)==false)
job.OpenMenuToInode(job.item.f_node);else
job.OpenMenuToInode(job.rootNode);}
job.OpenMenuToInode=function(inode){$(".child-menu").hide();job.breadcrumb=[];job.adminUser=job.rootPerm;$('#jobMenu i').removeClass();$('#jobMenu .parent-menu').removeClass("parent-menu-selected");$('#jobMenu .child-menu').removeClass("parent-menu-selected");$('#jobMenu i').addClass("menu-spacer");var selectedPath;for(var idx=0;idx<job.MenuData.length;idx++){if(job.MenuData[idx].c==true){$('#jobMenu [data-inode='+job.MenuData[idx].i+'] i').removeClass("menu-spacer");$('#jobMenu [data-inode='+job.MenuData[idx].i+'] i').addClass("icon-chevron-right menu-icon-spacer");}
if(job.MenuData[idx].i==inode){$('#jobTitle').text(job.MenuData[idx].t);selectedPath=job.MenuData[idx].p+" ID:"+inode+";";job.adminUser=job.MenuData[idx].a}
$('#jobMenu [data-jobinode='+job.MenuData[idx].i+']').attr('data-mode','c');}
if(selectedPath!=undefined){var arrPaths=[];arrPaths=selectedPath.split(";");job.breadcrumb.push({"inode":job.rootNode,"title":job.rootTitle,"template":job.rootTemplate});for(var i=2;i<arrPaths.length;i++){var tmp=arrPaths[i].split(":");$('#jobMenu [data-inode='+tmp[1]+'] i').removeClass("menu-spacer");$('#jobMenu [data-inode='+tmp[1]+'] i').addClass("icon-chevron-down menu-icon-spacer");$('#jobMenu [data-inode='+tmp[1]+']').show();$('#jobMenu [data-fnode='+tmp[1]+']').show();if(tmp[1]==inode){$('#jobMenu [data-inode='+tmp[1]+']').addClass("parent-menu-selected");if($('#jobMenu [data-inode='+tmp[1]+']').data('children')==false){$('#jobMenu [data-inode='+tmp[1]+'] i').addClass("menu-spacer");$('#jobMenu [data-inode='+tmp[1]+'] i').removeClass("icon-chevron-down menu-icon-spacer");}
if(job.currFolderContracted==false){$('#jobMenu [data-jobinode='+tmp[1]+']').attr('data-mode','c');$('#jobMenu [data-fnode='+tmp[1]+']').hide();$('#jobMenu [data-inode='+tmp[1]+'] i').removeClass("icon-chevron-down");if($('#jobMenu [data-inode='+tmp[1]+']').data('children')==true){$('#jobMenu [data-inode='+tmp[1]+'] i').addClass("icon-chevron-rights");}}
else{$('#jobMenu [data-jobinode='+tmp[1]+']').attr('data-mode','e');}}
else{$('#jobMenu [data-jobinode='+tmp[1]+']').attr('data-mode','e');}
for(var idx=0;idx<job.MenuData.length;idx++){if(job.MenuData[idx].i==tmp[1]){job.breadcrumb.push({"inode":job.MenuData[idx].i,"title":job.MenuData[idx].t,"template":job.MenuData[idx].tpl});}}}}else{job.breadcrumb.push({"inode":job.rootNode,"title":job.rootTitle,"template":job.rootTemplate});$('#jobTitle').text(job.rootTitle);}
var html="";var crumbClass="";var arrow="";for(var i=0;i<job.breadcrumb.length&&job.breadcrumb.length>1;i++){var item=job.breadcrumb[i];var itemTitle="";if(item.title.length>18)
itemTitle=item.title.substring(0,18)+"...";else
itemTitle=item.title;if((i+1)<job.breadcrumb.length){crumbClass="breadcrumb-active";arrow="<i class=\"icon-angle-right\"></i>"}else{arrow="";crumbClass="breadcrumb-inactive";}
html+="<a class = \""+crumbClass+"\" data-fnode='"+job.rootNode+"' data-inode='"+item.inode+"'  data-template='"+item.template+"' title='"+item.title.toUpperCase()+"'>"+itemTitle.toUpperCase()+"</a>"+arrow;}
$('#dvjobFilter .breadcrumb').html(html);$("#dvjobFilter .breadcrumb a").click(function(){var inode=$(this).data('inode');var fnode=$(this).data('fnode');job.listTemplate=$(this).data('template');sd.Utils.historyAdd({'section':'job','fnode':inode,'template':job.listTemplate,'ParentID':fnode,'csid':sd.Configuration.csid});job.OpenMenuToInode(inode);job.ListItems(inode);});}
job.changePage=function(newPage){job.currentPage=newPage+1;job.createList(null,null);}
job.PreviewJob=function(inode){var obj={};obj.inode=inode;obj.logView=true;$('#loader').show();sd.Utils.killAllVideos();var sc=new sd.ServerCall("GetJob");sc.data(obj);sc.go({onSuccess:job.handleItem,onError:job.handleError});}
job.handleItem=function(myData,Status){var item=myData[0];job.selectedItem=item;job.adminUser=item.al;if(!job.jumpTo)
sd.Utils.historyAdd({'section':'job','inode':item.i,'fnode':item.f,'csid':sd.Configuration.csid});job.jumpTo=false;$('#jobList').load(sd.Configuration.templates.jobItem,function(){$('#dvJobFilter').hide();$("#btnDeleteItem").hide();$("#btnEditItem").hide();$('#dvJobPagingHeader').hide();$('#tbJobListHeader').hide();$('#dvJobPagingFooter').hide();$('#loader').hide();$(".list-header").hide();if(sd.Session.user.superAdmin==true||job.adminUser>1||admin.adminUser()||job.selectedItem==3){$("#btnDeleteItem").show();$("#btnEditItem").show();}
window.scrollTo(0,0);$(".mail-link").bind("click",function(){sd.Utils.sendEmailLink(job.selectedItem.i);});$(".share-link").bind("click",function(){sd.Utils.shareFileLink(job.selectedItem.i);});$("#btnEditItem").bind("click",function(){job.loadForm();});$("#btnDeleteItem").bind("click",function(){job.deleteItem();});$("#btnCloseItem").bind("click",function(){window.history.go(-1);});var locationPath=(item.pf!=undefined&&item.pf!="")?item.pn+" > "+item.pf:item.pn;$("#hSectionHeader").text(locationPath);$("#dvJobTitle").html(item.t);$("#dvJobOwner").html(item.a);$("#dvJobCreateDate").html(item.ct);$("#dvJobDescription").html(item.d);var jsonMeta=$.parseJSON(item.ma);var meta=[];var htmlOut="<table>";meta=sd.Utils.getItemsFromObject(jsonMeta,"t","location","v");if(meta.length>0){htmlOut+="<tr data-type=\"location\">";htmlOut+="<td class = \"td-align-top\">Location:</td>";htmlOut+="<td><span class=\"tag-link brand-color\">"+meta.join(' </span><span class="brand-color">, </span><span class=\"tag-link brand-color\">')+"</span></td>";htmlOut+="</tr>";}
meta=sd.Utils.getItemsFromObject(jsonMeta,"t","languages","v");if(meta.length>0){htmlOut+="<tr data-type=\"languages\">";htmlOut+="<td class = \"td-align-top\">Languages:</td>";htmlOut+="<td><span class=\"tag-link brand-color\">"+meta.join(' </span><span class="brand-color">, </span><span class=\"tag-link brand-color\">')+"</span></td>";htmlOut+="</tr>";}
meta=sd.Utils.getItemsFromObject(jsonMeta,"t","level","v");if(meta.length>0){htmlOut+="<tr data-type=\"level\">";htmlOut+="<td class = \"td-align-top\">Level:</td>";htmlOut+="<td><span class=\"tag-link brand-color\">"+meta.join(' </span><span class="brand-color">, </span><span class=\"tag-link brand-color\">')+"</span></td>";htmlOut+="</tr>";}
htmlOut+="</table>";$("#dvJobDetails").html(htmlOut);$(".tag-link").click(function(){var tag=$(this).html();var type=$(this).parent().parent().data('type');var tagText=$(this).text();$('#headerSearchFieldInput').val(tagText);var obj={};obj.mode="preset"
obj.onError=$.proxy(runSearch.handleError);obj.onSuccess=$.proxy(runSearch.handleResults);obj.searchString=tagText;obj.searchUsers=false;obj.searchEgnyte=false;obj.searchMetaData="<metadata><meta><label>"+type+"</label><value>"+tag+"</value></meta></metadata>";LoadSection("search",true,obj);});});}
job.addEventListeners=function(){$("#newJobItem_btn").bind("click",function(){job.addNew();});$("#jobListPanel #iconSearch").bind("click",function(){job.runSearch();});$('#jobListPanel #jobFilterText').keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){job.runSearch();}});$("#jobReset_btn").bind("click",function(){job.appliedFilters=[];$('#txtFilterCrew').val("");job.currentPage=1;job.createList("sortname",null);$("#jobReset_btn").hide();});$("#jobReset_btn").hide();}
job.refreshList=function(){$("#loader").show();$("#jobList").empty();sd.component.messageBox.close();var obj={};obj.fnode=job.fnode;var sc=new sd.ServerCall("ListJobs");sc.data(obj);sc.go({onSuccess:job.handleList,onError:job.handleError});}
job.runSearch=function(){var filterText=$('#jobFilterText').val();var errMsg=runSearch.validSearchTerm(filterText);if(errMsg!=""){sd.component.messageBox.action({title:"Search",height:150,text:errMsg,btn1:"Ok"});return;}
var obj={};obj.mode="preset"
obj.onError=$.proxy(runSearch.handleError);obj.onSuccess=$.proxy(runSearch.handleResults);obj.searchString=filterText;obj.searchUsers=false;obj.searchRootNode=job.rootNode;obj.searchBox=false;obj.searchEgnyte=false;LoadSection("search",true,obj);}
job.addNew=function(){job.selectedItem.i=0;job.loadForm();}
job.loadForm=function(){var action="";if(job.selectedItem.i>0)
action="Update Job";else
action="Add New Job";sd.Utils.killAllVideos();sd.component.messageBox.action({title:action,height:600,width:960,cssClass:"msg-box-front-end",headerClass:"msg-box-front-end-header",bodyClass:"msg-box-front-end-body",loadCallback:function(){var item;$("#jobID").val(job.selectedItem.i);$('#dvjobForm').keypress(function(e){if(e.which==13){e.preventDefault();}});$("#jobFormStartDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Start Date"});if(job.selectedItem.i>0){$("#txtTitle").val(job.selectedItem.t);sd.Utils.initWYSIWYG({id:"txtDescription",text:job.selectedItem.d});sd.Utils.initWYSIWYG({id:"txtExperience",text:job.selectedItem.exp});$("#jobFormStartDate").val(job.selectedItem.st);if(job.selectedItem.ft==1){$("#chkFilledJob").prop("checked",true);}else{$("#chkFilledJob").prop("checked",false);}}
else
{sd.Utils.initWYSIWYG({id:"txtDescription",text:''});sd.Utils.initWYSIWYG({id:"txtExperience",text:''});}
obj={};obj.types="location,level,languages";obj.returnAll=false;sc=new sd.ServerCall("ListMetaAttributes");sc.data(obj);sc.go({onSuccess:job.handleMetaAttributes,onError:job.handleError});var scUsers=new sd.ServerCall("ListActiveUsers");scUsers.go({onSuccess:job.handleContactUsers,onError:job.handleError});},template:sd.Configuration.templates.jobForm,btn1callback:job.saveForm,btn1:"Save",btn2:"Cancel",btn2callback:job.cancelForm});}
job.handleContactUsers=function(myData,status){var item;var arrContacts=[];for(var idx=0;idx<myData.length;idx++){var item={};item.userid=myData[idx].i;item.fullname=myData[idx].fn+' '+myData[idx].ln;arrContacts.push(item);}
sd.Utils.sortArrayByString(arrContacts,"fullname");var optOut="<option value=\"0\">Select Contact</option>";for(var idx=0;idx<arrContacts.length;idx++){optOut+="<option value=\""+arrContacts[idx].userid+"\"";if(arrContacts[idx].userid==crew.selectedExpert)optOut+=" selected ";optOut+="\">"+arrContacts[idx].fullname+"</option>";}
$("#cboJobContact").html(optOut);}
job.handleAssociatedFileSearch=function(myData,status){var count=myData.length;var arrText=[];var arrIds=[];$("#lstRelatedFiles option:selected").each(function(){arrIds.push($(this).val());arrText.push($(this).text());});$('#lstRelatedFiles').empty();var item;var addItem;for(i=0;i<myData.length;i++){item=myData[i];addItem=true;for(j=0;j<arrIds.length;j++){if(item.id==arrIds[j]){addItem=false;count--;break;}}
if(addItem==true)
$('#lstRelatedFiles').append('<option value="'+item.id+'">'+item.name+'</option>');}
for(j=0;j<arrIds.length;j++){$('#lstRelatedFiles').append('<option selected="selected" value="'+arrIds[j]+'">'+arrText[j]+'</option>');}
$("#lblSearchCount").html(" ("+count+")");$('#lstRelatedFiles').multiSelect('refresh');}
job.handleMetaAttributes=function(myData,status){var title="";var item;var type,checklist,lstJSON;for(i=0;i<job.formCheckLists.length;i++){type=job.formCheckLists[i].attribute;chkList=job.formCheckLists[i].checklist;$('#'+chkList).checkList({listItems:{},onChange:job.selChange});lstJSON="[]";for(j=0;j<myData.length;j++){if(j==0)lstJSON="[";item=myData[j];if(item.t!=type)
continue;title=item.v.replace(/"/g,'\'');lstJSON+='{ text: "'+title+'", value: "'+item.i+'", ';if(job.selectedItem.i>0){var jsonMeta=$.parseJSON(job.selectedItem.ma);for(k=0;k<jsonMeta.length;k++){if(jsonMeta[k].i==item.i){lstJSON+='selected: "1" ';}}}else
lstJSON+='selected: "0" ';lstJSON+='}';lstJSON+=',';}
if(lstJSON.match("\]$")){}
else lstJSON+=']';var obj=eval('('+lstJSON+')');if(lstJSON!="[]")$('#'+chkList).checkList('setData',obj);else $('#'+chkList).parent().hide();}}
job.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
job.handleFormError=function(error){sd.component.messageBox.showError(error);}
job.removeFilterFromArray=function(id){for(var j=0;j<job.appliedFilters.length;j++){if(job.appliedFilters[j].id==id){job.appliedFilters.splice(j,1);break;}}}
job.selChange=function(){}
job.cancelForm=function(){sd.FileUploader.cancel();}
job.saveForm=function(){var errString=job.validForm();if(errString!=""){sd.component.messageBox.showError("Please complete the following field(s): "+errString);return;}
var action="";var obj={};obj.fnode=job.fnode;if($("#jobID").val()==0){action="AddJob";}else{action="UpdateJob";}
obj.item=$("#txtTitle").val();obj.description=CKEDITOR.instances.txtDescription.getData();obj.startDate=$("#jobFormStartDate").val();if($("#chkFilledJob").prop("checked")==true)
obj.filled=1;else
obj.filled=0;var lstData;var item;var meta="";for(i=0;i<job.formCheckLists.length;i++){lstData=$('#'+job.formCheckLists[i].checklist).checkList('getSelection');for(j=0;j<lstData.length;j++){item=lstData[j];meta+="<meta><type><![CDATA["+job.formCheckLists[i].attribute+"]]></type><value><![CDATA["+item.text+"]]></value><id><![CDATA["+item.value+"]]></id></meta>";}}
meta="<metadata>"+meta+"</metadata>";obj.metaAttributes=meta;obj.metaData=meta;var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:job.refreshItem,onError:job.handleFormError});}
job.showEmailDialog=function(myData){sd.component.messageBox.action({fade:false,height:450,width:700,title:"Email New Best Case Details",template:"templates/mccann/email.htm",loadCallback:function(){$('#txtSubject').val(sd.Configuration.messages.emailNewUploadSubject);var url=encodeURIComponent(window.location.protocol)+"//";url+=encodeURIComponent(window.location.host);url+=encodeURIComponent(window.location.pathname);url+="?inode="+job.imageid;var body=sd.Configuration.messages.emailNewUploadBody;body+="%0D%0A%0D%0A";body+=url+" %0D%0A%0D%0A";$('#txtBody').val(decodeURIComponent(body));var obj={};obj.inode=job.fnode;;var sc=new sd.ServerCall("GetEmailList");sc.data(obj);sc.go({onSuccess:job.handleRecipients,onError:job.handleFormError});},btn1callback:job.sendEmail,btn1:"Send",icon1:"icon-mail-forward",btn2:"Cancel",icon2:"icon-ban-circle",btn2callback:job.refreshList});}
job.validForm=function(){var valid;var message="";if($("#txtTitle").val()==""||$("#txtTitle").val().length<3){message+="Title is required and must be greater than 3 characters in length, ";}
if(message!="")
message=message.slice(0,-2)+".";return message;}
job.deleteItem=function(){sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deletedConfirmed,this),icon2:"icon-ban-circle",btn2:"No"});}
job.deletedConfirmed=function(){var obj={};obj.inodes=job.selectedItem.i;var sc=new sd.ServerCall("DeleteItems");sc.data(obj);sc.go({onSuccess:job.refreshList,onError:job.handleSaveError});}
job.refreshItem=function(myData,status){sd.component.messageBox.close();job.PreviewJob(myData.i_node);}
job.removeFilterFromPanel=function(id){job.removeFilterFromArray(id);job.createList("name",null);}
job.removeFilterFromArray=function(id){for(var j=0;j<job.appliedFilters.length;j++){if(job.appliedFilters[j].id==id){job.appliedFilters.splice(j,1);break;}}}
job.removeItemFromArray=function(arrayIn,item){for(var j=0;j<arrayIn.appliedFilters.length;j++){if(arrayIn[j]==item){arrayIn.splice(j,1);break;}}}
window.job=job;}(window));(function(window){var library={};library.MenuData=null;library.item={};library.rootNode;library.rootTitle;library.rootTemplate="";library.listTemplate="";library.currentList=[];library.filteredList=[];library.currentSortDirection="";library.currentSortBy="";library.viewMode="list";library.itemsPerPage=9;library.totalPages=0;library.inodeList=[];library.currFnode=0;library.formFnode=0;library.imageid=0;library.limit=400;library.itemParentTitle;library.pagingOptions={};library.jumpTo=false;library.adminUser=0;library.rootPerm=0;library.allUniqueMetaAttributes=[];library.allMetaAttributes=[];library.appliedFilters=[];library.filteredMetaAttributes=[];library.MenuArray=[];library.selectedItem={};library.breadcrumb=[];library.downloadInode;library.currFolderContracted=true;library.expandedFolders=[];library.formCheckLists=[];library.init=function(obj){$("#loader").show();disclaimer.listDisclaimers();library.item=obj;library.adminUser=(obj==undefined)?0:obj.al;library.i_node=(obj==undefined)?0:obj.i_node;library.rootPerm=library.adminUser;library.displayPublishedNewsletter=true;if(obj!=undefined){library.displayPublishedNewsletter=(library.displayPublishedNewsletter==undefined)?true:library.displayPublishedNewsletter;}
library.currentSortDirection="DESC";library.currentSortBy="createdate";library.viewMode="list";library.totalPages=0;library.currentPage=1;library.currentList=[];library.filteredList=[];library.inodeList=[];library.MenuArray=[];library.pagingOptions={};library.allUniqueMetaAttributes=[];library.allMetaAttributes=[];library.appliedFilters=[];library.filteredMetaAttributes=[];library.currFolderContracted=true;library.expandedFolders=[];library.formCheckLists=[];$("#libraryContent .js-filt h5").html("Filter");$("#libraryContent .js-libt").html("Browse");$("#newLibraryItem_btn").hide();$("#bestCaseAdd_btn").hide();$("#addUrl_btn").hide();$("#editArticle_btn").hide();$("#dvBestCaseHeader").hide();$("#dvBestCaseHeaderDesc").hide();$(".crw-side-media").hide();$("#libraryReset_btn").hide();$('#tbLibraryListHeader .sectionTitleTitle').click(function(){library.createList("name");});$('#tbLibraryListHeader .sectionTitleCreator').click(function(){library.createList("creator");});$('#tbLibraryListHeader .sectionTitleDate').click(function(){library.createList("createdate");});$('#tbLibraryListHeader .icon-chevron-up').hide();$('#tbLibraryListHeader .icon-chevron-down').hide();library.getSectionMetaInfo();}
library.getSectionMetaInfo=function(){var sc=new sd.ServerCall("ListSectionMetaTags");var obj={};obj.section='document';sc.data(obj);sc.go({onSuccess:library.handleMeta,onError:library.handleError});}
library.handleMeta=function(myData){library.formCheckLists=[];var metaItem;for(var m=0;m<myData.length;m++){metaItem=myData[m];library.formCheckLists.push({attribute:metaItem.type,checklist:"dv"+metaItem.type+"List",title:metaItem.label,id:metaItem.attrID});}
library.checkAccess();}
library.checkAccess=function(){if(library.item!=undefined&&isNaN(library.item.al)){library.open();}else{var sc=new sd.ServerCall("GetItemAccess");var scObj={};scObj.inode=library.item.f_node;sc.data(scObj);sc.go({onSuccess:function(myData){library.adminUser=myData;library.rootPerm=library.adminUser;library.open();},onError:library.handleError})}}
library.open=function(){library.addEventListeners();library.setUpDisplayArea(library.item.template);if(library.i_node>0){library.jumpTo=true;$("#dvBestCaseHeader").hide();$(".list-header").hide();$("#dvLibraryFilter").hide();$("#dvLibraryPagingHeader").hide();$("#tbLibraryListHeader").hide();}
if(jQuery.isEmptyObject(library.item)==true){library.rootNode=sd.Configuration.libraryInode;library.LoadMenu();library.rootTemplate='Document';library.listTemplate='Document';if(library.jumpTo==false)
library.ListItems(library.rootNode);else
library.currFnode=library.rootNode;}else{library.setUpDisplayArea(library.item.template);library.rootNode=library.item.ParentID;library.LoadMenu();if((library.item.template=="")||(library.item.template=="0")||(library.item.template=="folder")){library.listTemplate='Document';library.rootTemplate='Document';}else{library.listTemplate=library.item.template;library.rootTemplate=library.item.template;}
if(library.item.template=="map"){library.loadMap(library.item.f_node);}else if(library.item.template=="article"){page.init({inode:library.item.f_node,container:"#libraryList"});library.OpenMenuToInode($(this).data('libraryinode'));if(sd.Session.user.superAdmin==true||library.adminUser>1||admin.adminUser()){$("#editArticle_btn").show();}}else{if(library.jumpTo==false){library.ListItems(library.item.f_node);}else
library.currFnode=library.item.f_node;}}
if(library.jumpTo==true){var obj={};obj.id=library.i_node;obj.type=library.item.template;library.loadItem(obj);}
var title=$('#ulTopNav'+library.rootNode+' [data-inode='+library.rootNode+']').text();$("#libraryFilterText").attr({"placeholder":"Search "+title,"title":"Search "+title});$("a#aBCSubmit").attr('href','mailto:'+sd.Configuration.csBCEmail+'?subject=MWG Global Portal Best Case Proposal');}
library.ListItems=function(inode){$('#dvLibraryFilter').show();$('#dvLibraryPagingHeader').show();$('#tbListHeader').show();$('#dvLibraryPagingFooter').show();$("#loader").show();$("#libraryList").empty();$("#libraryList_btn").addClass("view-as-selected");library.currFnode=inode;sd.Utils.killAllVideos();var obj={};if(library.listTemplate=="newsletter"){var sc=new sd.ServerCall("ListNewsletters");sc.data({fnode:inode});}else{obj.depth="deep";obj.inode=inode;obj.limit=library.limit;obj.type=library.listTemplate;var sc=new sd.ServerCall("ListItems");sc.data(obj);}
sc.go({onSuccess:library.handleList,onError:library.handleError});}
library.handleList=function(myData,status){library.currentList=[];library.inodeList=[];$('#libraryList').empty();$('#loader').show();for(var idx=0;idx<myData.length;idx++){var item={};if(library.listTemplate=="newsletter"){item.id=myData[idx].i;item.name=myData[idx].n;item.description=myData[idx].d;item.createdate=myData[idx].cd;item.creator=myData[idx].cb;item.type=myData[idx].tp;item.format=myData[idx].tf;item.path=myData[idx].p;item.authorName=myData[idx].cb;item.authorID=myData[idx].cbi;item.disc="";item.thumb=myData[idx].t;item.type=myData[idx].ty;item.latestPublished=myData[idx].lp;item.status=myData[idx].s;item.featured=item.latestPublished;item.access=myData[idx].a;item.expired=0;}else{item.id=myData[idx].i;item.thumb=myData[idx].tb;item.name=myData[idx].t;item.description=myData[idx].d;item.createdate=myData[idx].ct;item.creator=myData[idx].a;item.type=myData[idx].tp;item.format=myData[idx].f;item.path=myData[idx].p;item.authorName=myData[idx].an;item.authorID=myData[idx].ai;item.disc=myData[idx].disc;item.featured=myData[idx].ft;item.expired=myData[idx].exp;item.access=myData[idx].al;}
library.inodeList.push(item.id);library.currentList.push(item);}
$('#dvLibraryFilter').show();$('#dvLibraryPagingHeader').show();$('#tbLibraryListHeader').show();$('#dvLibraryPagingFooter').show();$(".list-header").show();$("#libraryList_btn").show();$("#libraryThumb_btn").show();$("#newLibraryItem_btn").hide();$("#bestCaseAdd_btn").hide();$("#addUrl_btn").hide();$("#editArticle_btn").hide();$(".crw-side-media").hide();$('#dvBestCaseHeaderDesc').hide();$('#dvBestCaseHeader').hide();if(library.listTemplate=="bestcase"){var sc=new sd.ServerCall("GetFolderDetails");sc.data({inode:library.currFnode});sc.go({onSuccess:function(myData,status){var folder=myData[0];if(folder.dsd==true){$('#dvBestCaseHeaderDesc').html(folder.sd);$('#dvBestCaseHeaderDesc').show();}else{$('#dvBestCaseHeader').show();}}});if(sd.Session.user.superAdmin==true||library.adminUser>1||admin.adminUser()){$("#bestCaseAdd_btn").show();$("#addUrl_btn").show();}
library.inodeList.push(-1);var sc=new sd.ServerCall("GetItemMetaAttributes");var obj={};obj.inodes=library.inodeList.join(",");obj.returnAll=false;sc.data(obj);sc.go({onSuccess:library.buildFilterMenu,onError:library.handleError});}else{$('#dvBestCaseHeaderDesc').hide();$('#dvBestCaseHeader').hide();if(library.listTemplate=="newsletter"){$("#dvLibrarySelectedMetaFilters").hide();$("#libraryReset_btn").hide();$("#libraryList_btn").hide();$("#libraryThumb_btn").hide();library.appliedFilters=[];}else{library.inodeList.push(-1);var sc=new sd.ServerCall("GetItemMetaAttributes");var obj={};obj.inodes=library.inodeList.join(",");obj.returnAll=false;sc.data(obj);sc.go({onSuccess:library.buildFilterMenu,onError:library.handleError});}
if(sd.Session.user.superAdmin==true||library.adminUser>1||admin.adminUser()){$("#newLibraryItem_btn").show();if(library.listTemplate!="newsletter"){$("#addUrl_btn").show();}}
var latestLoad=false;if(library.displayPublishedNewsletter==true&&library.listTemplate=="newsletter"){for(var idx=0;idx<library.currentList.length;idx++){var item=library.currentList[idx];if(item.latestPublished==true){newsletter.init({inode:item.id});latestLoad=true;}}
if(latestLoad==false)
library.createList(null,null);}else{library.createList(null,null);}}}
library.buildFilterMenu=function(myData,status){var item;var htmlOut="";var currentMetaType="";library.allUniqueMetaAttributes=[];library.allMetaAttributes=[];library.appliedFilters=[];for(var idx=0;idx<myData.length;idx++){item=myData[idx];var obj={};obj.id=myData[idx].i;obj.type=myData[idx].t;obj.value=myData[idx].v;obj.label=myData[idx].l;if(obj.type=="startdate"||obj.type=="enddate")
continue;if(myData[idx].t.toLowerCase()=="segment")
obj.sort="segmenta";else if(myData[idx].t.toLowerCase()=="product")
obj.sort="segmentb";else
obj.sort=myData[idx].t;library.allUniqueMetaAttributes.push(obj);obj.inode=myData[idx].nd;library.allMetaAttributes.push(obj);}
library.allUniqueMetaAttributes=sd.Utils.removeObjectArrayDuplicates(library.allUniqueMetaAttributes,"id");library.allUniqueMetaAttributes.sort(sd.Utils.dynamicSortMultiple("sort","value"));for(var idx=0;idx<library.allUniqueMetaAttributes.length;idx++){item=library.allUniqueMetaAttributes[idx];if(item.type!=currentMetaType){if(currentMetaType!="")htmlOut+="</div>";currentMetaType=item.type;htmlOut+="<h3><span class=\"accordionHead\">"+item.label+"</span></h3><div>";}
htmlOut+="<div class=\"accordion-menu\">";htmlOut+="<label class = \"filterText\" data-id=\""+item.id+"\" data-value=\""+item.value+"\" data-type=\""+item.type+"\">";htmlOut+="<input type=\"checkbox\" id=\"chk"+item.id+"\" ";htmlOut+=" value=\""+item.id+"\"/>"+item.value+"</label>";htmlOut+="</div>";if(library.listTemplate!="newsletter"){for(var k=0;k<sd.Session.userMetaFilters.length;k++){if(item.id==sd.Session.userMetaFilters[k].id){var exists=false;$.each(library.appliedFilters,function(){if($(this).id==sd.Session.userMetaFilters[k].id)exists=true;})
if(!exists)library.appliedFilters.push(sd.Session.userMetaFilters[k]);}}}}
$(".js-filtc").empty().append("<div class=\"accordion-text list-text  flex flex-1 flex-column pa-l-1-half pa-t-0 pa-b-0\"></div><div id=\"metaAccord\" class=\"accordion-menu \"></div>");$("#metaAccord").append(htmlOut);for(var idx=0;idx<library.appliedFilters.length;idx++){$('#chk'+library.appliedFilters[idx].i).attr("checked","checked");}
$("#metaAccord").accordion({heightStyle:"content",active:false,collapsible:true});if(myData.length==0){$(".js-filt").hide();}else{$(".js-filt").fadeIn("fast");}
$(".filterText").click(function(){var id=$(this).data('id');var type=$(this).data('type');var value=$(this).data('value');if($("#chk"+id).prop("checked")==true){var obj={};obj.id=id;obj.type=type;obj.value=value;library.appliedFilters.push(obj);}else{library.removeFilterFromArray(id)}
library.currentPage=1;library.createList(null,null);});library.createList(null,null);}
library.createList=function(sortBy,sortDirection){library.filterList();library.pagingOptions={prev_text:"<button class='prev-next-btn brand-btn-pagination ma-r-half pa-lr-1'>\
                        <span class='current prev'>Prev</span>\
                        </button>",next_text:"<button class='prev-next-btn brand-btn-pagination ma-r-half pa-lr-1'>\
                        <span class='current next'>Next</span>\
                        </button>",num_display_entries:3,current_page:library.currentPage-1,num_edge_entries:3,callback:library.changePage,items_per_page:library.itemsPerPage}
var listCount=library.filteredList.length;var endIndex=(library.currentPage)*library.itemsPerPage;var startIndex=endIndex-library.itemsPerPage;if(endIndex>listCount)endIndex=listCount;var direction="";if(sortBy==null){if(library.currentSortDirection=="DESC"){direction="-";}}else{if(library.currentSortBy==sortBy){if(sortDirection!=library.currentSortDirection){if(library.currentSortDirection=="ASC"){library.currentSortDirection="DESC";direction="-";}else library.currentSortDirection="ASC";}}else{library.currentSortBy=sortBy;library.currentSortDirection=sortDirection||"ASC";if(library.currentSortDirection=="DESC"){direction="-";}}}
if(library.currentSortBy=="name")library.filteredList.sort(sd.Utils.dynamicSortMultiple("-featured",direction+"name"));else if(library.currentSortBy=="creator")library.filteredList.sort(sd.Utils.dynamicSortMultiple("-featured",direction+"creator"));else if(library.currentSortBy=="createdate")library.filteredList.sort(sd.Utils.dynamicSortMultiple("-featured",direction+"createdate"));$('#tbLibraryListHeader .icon-chevron-up').hide();$('#tbLibraryListHeader .icon-chevron-down').hide();var sortArrow="icon-chevron-up";if(library.currentSortDirection=="DESC")sortArrow="icon-chevron-down";$('#tbLibraryListHeader .sectionListField').removeClass("theme-list-sort-active");if(library.currentSortBy=="name"){$('#tbLibraryListHeader .sectionTitleTitle > .'+sortArrow).show();$('#tbLibraryListHeader .sectionTitleTitle').addClass("theme-list-sort-active");}
if(library.currentSortBy=="creator"){$('#tbLibraryListHeader .sectionTitleCreator > .'+sortArrow).show();$('#tbLibraryListHeader .sectionTitleCreator').addClass("theme-list-sort-active");}
if(library.currentSortBy=="createdate"){$('#tbLibraryListHeader .sectionTitleDate > .'+sortArrow).show();$('#tbLibraryListHeader .sectionTitleDate').addClass("theme-list-sort-active");}
sd.Utils.killAllVideos();$("#libraryList").empty();library.totalPages=Math.ceil(listCount/library.itemsPerPage);$("#dvLibraryPagingHeader").empty();$("#dvLibraryPagingFooter").empty();if(library.totalPages>1){$("#dvLibraryPagingHeader").pagination(listCount,library.pagingOptions);$("#dvLibraryPagingFooter").pagination(listCount,library.pagingOptions);}
if(library.viewMode=="list")
library.displayListView(startIndex,endIndex);else
library.displayThumbView(startIndex,endIndex);$('button.current').each(function(){if($(this).find('span')[0].innerHTML==""){$(this).remove();}})}
library.filterList=function(){for(var k=0;k<library.allUniqueMetaAttributes.length;k++)
$("#chk"+library.allUniqueMetaAttributes[k].id).prop("checked",false);$("#dvLibrarySelectedMetaFilters").empty();var listCount=library.currentList.length;var item;var html="";var filterData=[];var filterText=$("#libraryFilterText").val();if(library.appliedFilters.length>0)$("#dvLibrarySelectedMetaFilters").show();if(library.appliedFilters.length>0)
$("#libraryReset_btn").show();if(library.appliedFilters.length==0)
$("#libraryReset_btn").hide();for(var k=0;k<library.appliedFilters.length;k++){item=library.appliedFilters[k];if(k==0)html="<div class='flex flex-1 '><h6 class=\"ma-t-2 ma-b-1\">Selected Filters:</h6></div>";html+="<span class='tag'>";html+="<i class='icon-remove-sign filter-remove' title=\"Remove Filter\" onClick=\"library.removeFilterFromPanel("+item.id+")\"></i>";html+="<label onClick=\"library.removeFilterFromPanel("+item.id+")\">";html+=" "+item.value;$("#chk"+item.id).prop("checked",true);html+="</label>";html+="</span>";if(filterData[library.appliedFilters[k].type]==undefined)
filterData[library.appliedFilters[k].type]=[];filterData[library.appliedFilters[k].type].push(library.appliedFilters[k]);}
$("#dvLibrarySelectedMetaFilters").html(html);var listCount=library.currentList.length;library.filteredList=[];if(library.appliedFilters.length==0)
library.filteredMetaAttributes=library.allMetaAttributes;else
library.filteredMetaAttributes=[];var arrUniqueTypes=sd.Utils.removeObjectArrayDuplicates(library.appliedFilters,"type");var uniqueTypes=arrUniqueTypes.length;for(var idx=0;idx<listCount;idx++){item=library.currentList[idx];if($('#libraryFilterText').val()!=""){var filterText=$('#libraryFilterText').val().toLowerCase();}
if(filterText!=""&&item.name.toLowerCase().indexOf(filterText)<0)continue;var match=false;if(library.appliedFilters.length>0){var matchCount=0;var typeMatch;if(Object.keys(filterData).length>0){var filter;for(var key in filterData){typeMatch=false;for(var i=0;i<filterData[key].length;i++){filter=filterData[key][i];for(var j=0;j<library.allMetaAttributes.length;j++){if((library.allMetaAttributes[j].inode==item.id)&&(library.allMetaAttributes[j].id==filter.id)){matchCount++;typeMatch=true;break;}}
if(typeMatch==true)break;}}
if(matchCount==uniqueTypes)match=true;}
if(!match)continue;for(var i=0;i<library.allMetaAttributes.length;i++){if(item.id==library.allMetaAttributes[i].inode){var obj={};obj.id=library.allMetaAttributes[i].id;obj.value=library.allMetaAttributes[i].value;obj.type=library.allMetaAttributes[i].type;library.filteredMetaAttributes.push(obj);}}}
library.filteredList.push(item);}}
library.updateFilterCounts=function(){var filterText=$('#libraryFilterText').val().toLowerCase();for(var k=0;k<library.allUniqueMetaAttributes.length;k++){var count=0;if(library.appliedFilters.length==0&&filterText=="")
count=sd.Utils.countObjectArrayValues(library.allMetaAttributes,"id",library.allUniqueMetaAttributes[k].id);else
count=sd.Utils.countObjectArrayValues(library.filteredMetaAttributes,"id",library.allUniqueMetaAttributes[k].id);if(count>0){$("#lblFilterCount"+library.allUniqueMetaAttributes[k].id).parent().show();$("#lblFilterCount"+library.allUniqueMetaAttributes[k].id).text(" ("+count+")");}else{$("#lblFilterCount"+library.allUniqueMetaAttributes[k].id).parent().hide();}
$("#dvBCFilterAccordion h3").each(function(index){var count=0;$(this).next("div").children().each(function(index){if($(this).css("display")=="none")count++;});if(count==$(this).next("div").children().length){$(this).hide();}else{$(this).show();}});}}
library.displayListView=function(startIdx,endIdx){var fragmentWrap=document.createDocumentFragment();$(".guide .docListGuide .docList-Wrapper").clone().appendTo(fragmentWrap);$("#libraryList").empty().show().html(fragmentWrap).foundation();var fragmentLib=document.createDocumentFragment();var cloneLib;for(var idx=startIdx;idx<endIdx;idx++){var item=library.filteredList[idx];cloneLib=$(".guide .docListGuide .list-item").clone().appendTo(fragmentLib);cloneLib.data({"id":item.id,"type":item.type});if(item.featured==1||(library.listTemplate=="newsletter"&&item.status=="draft")){if(item.featured==1)
cloneLib.find(".libraryFavItem").attr("src",'images/mccann/featured_badge.png');if(library.listTemplate=="newsletter"&&item.status=="draft")
cloneLib.find(".libraryFavItem").attr("src",'images/mccann/draftNewsletter.png');}else{cloneLib.find(".libraryFavItem").remove();}
if(sd.Utils.isVideo(item.format)){var html="<video class='videoClass' id='"+item.thumb+"' style=\"width: 100%; height: 100%;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.thumb+"/"+item.thumb+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";cloneLib.find(".js-image").append(html);}
else{var image=sd.Configuration.vault+"/"+item.thumb+"/bigthumb.jpg";if(item.type=="Link"&&item.thumb==0){var url="https://api.embed.ly/1/oembed?key=9c59af118a744a588186e6264d1da748&url="+encodeURIComponent(String(item.name).split("||")[1]);$.getJSON(url,function(data){var img=data.thumbnail_url;var desc=data.description;var title=data.title;if(img==""){cloneLib.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}else{cloneLib.find(".js-image").css({"background-image":"url("+img+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}});}
else{cloneLib.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}}
cloneLib.find(".js-file-name").addClass("fullName");if(item.type=='Link'){cloneLib.data({"link":String(item.name).split("||")[1]});cloneLib.find(".js-file-name").html(String(item.name).split("||")[0]);}else{var name=(item.expired==0)?item.name:"(Expired) "+item.name;cloneLib.find(".js-file-name").html(name);}
cloneLib.find(".js-file-desc").html(item.description);cloneLib.find(".js-file-author").html(item.creator).data({"id":item.authorID,"uname":item.authorName});cloneLib.find(".js-file-date").html(item.createdate);if(library.listTemplate=="newsletter"||item.type=="Link"||item.listTemplate=="bestcase"){cloneLib.find(".js-download").hide();}
if(item.type=="Link"&&item.access>1){cloneLib.find(".js-link").show();}
if(library.listTemplate=="newsletter"){cloneLib.find(".js-newsletter").show();cloneLib.find(".library-preview").hide();if(item.access<2){cloneLib.find(".library-nedit").remove();}
if(item.status=="draft"){cloneLib.find(".js-nlink").remove();}}}
if(library.jumpTo==false){$("#libraryList .docList-Wrapper").empty().show().html(fragmentLib).foundation();}
$('#libraryList').append("<div id=\"done\"></div>");$('#libraryList').find('video').bind("loadeddata",function(){$('#libraryList').find('video').attr('poster','');});$('#libraryList .js-file-name').dotdotdot({ellipsis:'... ',wrap:'letter',fallbackToLetter:true,watch:true,height:25});$('#libraryList .js-file-desc').dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:110});$("#libraryList .js-nlink").unbind("click").bind("click",function(){sd.Utils.shareFileLink($(this).closest(".list-item").data('id'));});$("#libraryList .js-download").unbind("click").bind("click",function(){library.downloadFile($(this).closest(".list-item").data('id'));});$("#libraryList .js-click").unbind("click").bind("click",function(){var obj={id:$(this).closest(".list-item").data('id'),type:$(this).closest(".list-item").data('type'),link:$(this).closest(".list-item").data('link')};library.loadItem(obj);});$("#libraryList .js-file-author").click(function(){LoadSection("userProfile",true,{userID:$(this).data('id'),username:$(this).data('uname')});});$("#libraryList .js-nedit").unbind("click").bind("click",function(){var obj={inode:$(this).closest(".list-item").data('id'),mode:"edit",fnode:library.currFnode};newsletterBuilder.loadForm(obj);});$("#libraryList .js-ledit").unbind("click").bind("click",function(){library.editURL($(this).closest(".list-item").data('id'));});$('#loader').hide();}
library.displayThumbView=function(startIdx,endIdx){var fragmentWrap=document.createDocumentFragment();$(".guide .docThumbGuide .docThumb-Wrapper").clone().appendTo(fragmentWrap);$("#libraryList").empty().show();$("#libraryList").html(fragmentWrap);$("#libraryList").foundation();var fragmentLib=document.createDocumentFragment();var cloneLib;for(var idx=startIdx;idx<endIdx;idx++){var item=library.filteredList[idx];cloneLib=$(".guide .docThumbGuide .thumb-item").clone().appendTo(fragmentLib);cloneLib.data({"id":item.id,"type":item.type});if(item.featured==1||(library.listTemplate=="newsletter"&&item.status=="draft")){if(item.featured==1)
cloneLib.find(".libraryFavItem").attr("src",'images/mccann/featured_badge.png')
if(library.listTemplate=="newsletter"&&item.status=="draft")
cloneLib.find(".libraryFavItem").attr("src",'images/mccann/draftNewsletter.png')}else{cloneLib.find(".libraryFavItem").remove();}
if(sd.Utils.isVideo(item.format)){var html="<video class='videoClass' id='"+item.thumb+"' style=\"width: 100%; height: 100%;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.thumb+"/"+item.thumb+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";cloneLib.find(".js-image").append(html);}
else{var image=sd.Configuration.vault+"/"+item.thumb+"/bigthumb.jpg";if(item.type=="Link"&&item.thumb==0){var url="https://api.embed.ly/1/oembed?key=9c59af118a744a588186e6264d1da748&url="+encodeURIComponent(String(item.name).split("||")[1]);$.getJSON(url,function(data){var img=data.thumbnail_url;var desc=data.description;var title=data.title;if(img==""){cloneLib.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}else{cloneLib.find(".js-image").css({"background-image":"url("+img+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}});}
else{cloneLib.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}}
cloneLib.find(".js-file-name").attr("id","thumb-name-"+item.id);if(item.type=='Link'){cloneLib.data({"link":String(item.name).split("||")[1]});cloneLib.find(".js-file-name").html(String(item.name).split("||")[0]);}else{var name=(item.expired==0)?item.name:"(Expired) "+item.name;cloneLib.find(".js-file-name").html(name);}
cloneLib.find(".js-file-name").addClass("fullName");cloneLib.find(".js-file-desc").html(item.description);cloneLib.find(".js-file-author").html(item.creator).data({"id":item.authorID,"uname":item.authorName});cloneLib.find(".js-file-date").html(item.createdate);if(library.listTemplate=="newsletter"||item.type=="Link"||item.listTemplate=="bestcase"){cloneLib.find(".js-download").hide();}}
if(library.jumpTo==false){$("#libraryList .docThumb-Wrapper").empty().show();$("#libraryList .docThumb-Wrapper").html(fragmentLib);$("#libraryList .docThumb-Wrapper").foundation();}
$("#libraryList .js-click").unbind("click").bind("click",function(){var obj={id:$(this).closest(".thumb-item").data('id'),type:$(this).closest(".thumb-item").data('type'),link:$(this).closest(".thumb-item").data('link')};library.loadItem(obj);});$("#libraryList .newsletterLink").unbind("click").bind("click",function(event){sd.Utils.shareFileLink($(this).closest(".thumb-item").data('id'));});$('#libraryList').append("<div id='done'></div>");$('#libraryList .js-file-desc').dotdotdot({ellipsis:'... ',wrap:'letter',fallbackToLetter:true,watch:true,height:55});$("#libraryList .js-file-author").click(function(){LoadSection("userProfile",true,{userID:$(this).data('id'),username:$(this).data('uname')});});$("#libraryList .js-download").unbind("click").bind("click",function(){library.downloadFile($(this).closest(".thumb-item").data('id'));});$('#libraryList').find('video').bind("loadeddata",function(){$('#libraryList').find('video').attr('poster','');});$('#loader').hide();}
library.loadItem=function(obj){if(obj.type=="bestcase")
bestCase.preview(obj.id);else if(obj.type=="Link")
window.open(obj.link,'_blank');else if(obj.type=="newsletter")
newsletter.init({inode:obj.id});else
library.PreviewFile(obj.id);$('#loader').hide();$('.wsnw').hide();}
library.LoadMenu=function(){var obj=new Object();obj.limit=library.limit;obj.level=15;obj.inode=library.rootNode;var sc=new sd.ServerCall("FolderTraverse");sc.data(obj);sc.go({onSuccess:library.handleMenu});}
library.addToMenuArray=function(arrayIn){var item;for(var idx=0;idx<arrayIn.length;idx++){item={};item.i=arrayIn[idx].i;item.f=arrayIn[idx].f;item.t=arrayIn[idx].im;item.tpl=arrayIn[idx].tpl;item.p=arrayIn[idx].p;item.l=arrayIn[idx].l;item.a=arrayIn[idx].a;if(arrayIn[idx].menu.length>0){item.c=true;library.MenuData.push(item);library.addToMenuArray(arrayIn[idx].menu);}else{item.c=false;library.MenuData.push(item);}}}
library.handleMenu=function(myData,status){library.MenuData=[];var item;for(var idx=0;idx<myData.length;idx++){item={};item.f=myData[idx].f;item.i=myData[idx].i;item.t=myData[idx].im;item.tpl=myData[idx].tpl;item.p=myData[idx].p;item.l=myData[idx].l;item.a=myData[idx].a;if(myData[idx].menu.length>0){item.c=true;library.MenuData.push(item);library.addToMenuArray(myData[idx].menu);}else{item.c=false;library.MenuData.push(item);}}
library.drawMenu();}
library.drawMenu=function(){var title=$('#ulTopNav'+library.rootNode+' [data-inode='+library.rootNode+']').text();var homeButtonHTML="<div class='libraryMenuItem pa-t-2' data-fnode='"+library.rootNode+"' data-inode='"+library.rootNode+"' id='menuHOME'>";htmlOut+="<div class='libraryMenuButton dd-menu--text pa-l-1 pa-b-qtr' id='menuButtonHOME' data-libraryinode='"+library.rootNode+"' data-librarytemplate='"+library.rootTemplate+"'>Browse "+title+"</div>";htmlOut+="</div>";$('#libraryMenu').html(homeButtonHTML);library.rootTitle=title;$("#libraryFilterText").attr({"placeholder":"Search "+title,"title":"Search "+title});$('.libraryTitle').text(title);var template;var htmlOut="";var styleClass="";htmlOut+="<div class=''>";htmlOut+="<div class='flex flex-1 flex-column dd-menu ma-b-0 pa-b-1'>";if(library.MenuData!=undefined){for(var idx=0;idx<library.MenuData.length;idx++){if(library.MenuData[idx].l==0)
styleClass="parent-menu ";else
styleClass="child-menu child-level-"+library.MenuData[idx].l;if((library.MenuData[idx].tpl==null)||(library.MenuData[idx].tpl==""))library.MenuData[idx].tpl="Document";if(sd.Configuration.folderLink[library.MenuData[idx].i]!=undefined){library.MenuData[idx].tpl="link";}
htmlOut+="<div class='"+styleClass+"' data-children= '"+library.MenuData[idx].c+"' data-fnode='"+library.MenuData[idx].f+"' data-inode='"+library.MenuData[idx].i+"'>";htmlOut+="<div class='flex flex-1'>";htmlOut+="<div class='libraryMenuButton dd-menu--text' data-mode='c' data-librarytemplate='"+library.MenuData[idx].tpl+"' data-libraryinode='"+library.MenuData[idx].i+"'  data-libraryfnode='"+library.MenuData[idx].f+"' title='"+library.MenuData[idx].t+"'>";htmlOut+=""+library.MenuData[idx].t+'</div>';htmlOut+="<i class='dd-menu-icon'></i>";htmlOut+="</div>";htmlOut+="</div>";}}
htmlOut+="</div>";htmlOut+="</div>";$('#libraryMenu').append(htmlOut);$(".libraryMenuButton").click(function(){library.setUpDisplayArea($(this).data('librarytemplate'));sd.Utils.killAllVideos();library.currentPage=1;var obj={};obj.ParentID=$(this).data('libraryfnode');obj.f_node=$(this).data('libraryinode');obj.item=$(this).html();obj.type=$(this).data('librarytemplate');obj.template=$(this).data('librarytemplate');var mode=$(this).attr('data-mode');if(mode=="e")
library.currFolderContracted=false;else
library.currFolderContracted=true;switch($(this).data('librarytemplate')){case"team":LoadSection(obj.template,true,obj);break;case"egnyteEmbed":$('#sectionContainer').load(sd.Configuration.templates.egnyteEmbed,function(){var sc=new sd.ServerCall("GenerateEmbedURL");sc.go({onSuccess:function(myData,status){var embed='<iframe src="'+myData[0].embed+'" width="100%" height="600px" />';$("#dvEgnyteEmbed").html(embed);},onError:function(error){sd.component.messageBox.action({title:"Egnyte Embed",text:error,height:150,width:400,icon2:"icon-ok-sign",btn2:"Ok"});}});});break;case"dreamteam":case"expert":case"artist":LoadSection("crew",true,obj);break;case"map":library.loadMap(obj.f_node);break;case"article":page.init({inode:obj.f_node,container:"#libraryList"});library.OpenMenuToInode($(this).data('libraryinode'));if(sd.Session.user.superAdmin==true||library.adminUser>1||admin.adminUser()){$("#editArticle_btn").show();}
break;case"link":window.open(sd.Configuration.folderLink[$(this).data('libraryinode')].url,'_blank');return;default:library.displayPublishedNewsletter=true;$("#dvBestCaseHeader").hide();library.OpenMenuToInode($(this).data('libraryinode'));library.listTemplate=$(this).data('librarytemplate');if((library.listTemplate=="")||(library.listTemplate=="0")||(library.listTemplate=="folder")||(library.listTemplate=="Document"))
library.listTemplate='Document';sd.Utils.historyAdd({'csid':sd.Configuration.csid,'section':'library','template':library.listTemplate,'ParentID':library.rootNode,'fnode':obj.f_node});library.ListItems($(this).data('libraryinode'));}});if(jQuery.isEmptyObject(library.item)==false)
library.OpenMenuToInode(library.item.f_node);else
library.OpenMenuToInode(library.rootNode);}
library.OpenMenuToInode=function(inode){$(".child-menu").hide();library.breadcrumb=[];library.adminUser=library.rootPerm;$('#libraryMenu i').removeClass();$('#libraryMenu .parent-menu').removeClass("parent-menu-selected");$('#libraryMenu .child-menu').removeClass("parent-menu-selected");$('#libraryMenu i').addClass("menu-spacer");var selectedPath;if(library.MenuData!=undefined){for(var idx=0;idx<library.MenuData.length;idx++){if(library.MenuData[idx].c==true){$('#libraryMenu [data-inode='+library.MenuData[idx].i+'] i').removeClass("menu-spacer");$('#libraryMenu [data-inode='+library.MenuData[idx].i+'] i').addClass("icon-chevron-down");$('#libraryMenu [data-inode='+library.MenuData[idx].i+'] i').addClass("dd-menu--icon");}
if(library.MenuData[idx].i==inode){$('.libraryTitle').text(library.MenuData[idx].t);selectedPath=library.MenuData[idx].p+" ID:"+inode+";";library.adminUser=library.MenuData[idx].a}
$('#libraryMenu [data-libraryinode='+library.MenuData[idx].i+']').attr('data-mode','c');}}
if(selectedPath!=undefined){var arrPaths=[];arrPaths=selectedPath.split(";");library.breadcrumb.push({"inode":library.rootNode,"title":library.rootTitle,"template":library.rootTemplate});for(var i=2;i<arrPaths.length;i++){var tmp=arrPaths[i].split(":");$('#libraryMenu [data-inode='+tmp[1]+'] i').removeClass("menu-spacer");$('#libraryMenu [data-inode='+tmp[1]+'] i').addClass("icon-chevron-up");$('#libraryMenu [data-inode='+tmp[1]+']').show();$('#libraryMenu [data-fnode='+tmp[1]+']').show();if(tmp[1]==inode){$('#libraryMenu [data-inode='+tmp[1]+']').addClass("parent-menu-selected");if($('#libraryMenu [data-inode='+tmp[1]+']').data('children')==false){$('#libraryMenu [data-inode='+tmp[1]+'] i').addClass("menu-spacer");$('#libraryMenu [data-inode='+tmp[1]+'] i').removeClass("icon-chevron-up");}
if(library.currFolderContracted==false){$('#libraryMenu [data-libraryinode='+tmp[1]+']').attr('data-mode','c');$('#libraryMenu [data-fnode='+tmp[1]+']').hide();$('#libraryMenu [data-inode='+tmp[1]+'] i').removeClass("icon-chevron-up");if($('#libraryMenu [data-inode='+tmp[1]+']').data('children')==true){$('#libraryMenu [data-inode='+tmp[1]+'] i').addClass("icon-chevron-up");}}else{$('#libraryMenu [data-libraryinode='+tmp[1]+']').attr('data-mode','e');}}else{$('#libraryMenu [data-libraryinode='+tmp[1]+']').attr('data-mode','e');}
if(library.MenuData!=undefined){for(var idx=0;idx<library.MenuData.length;idx++){if(library.MenuData[idx].i==tmp[1]){library.breadcrumb.push({"inode":library.MenuData[idx].i,"title":library.MenuData[idx].t,"template":library.MenuData[idx].tpl});}}}}}else{library.breadcrumb.push({"inode":library.rootNode,"title":library.rootTitle,"template":library.rootTemplate});$('.libraryTitle').text(library.rootTitle);}
var html="";var crumbClass="";var arrow="";for(var i=0;i<library.breadcrumb.length&&library.breadcrumb.length>1;i++){var item=library.breadcrumb[i];var itemTitle="";if(item.title.length>18)
itemTitle=item.title.substring(0,18)+"...";else
itemTitle=item.title;if((i+1)<library.breadcrumb.length){crumbClass="breadcrumb-active";arrow="<i class=\"icon-angle-right\"></i>"}else{arrow="";crumbClass="breadcrumb-inactive";}
html+="<a class = \""+crumbClass+"\" data-fnode='"+library.rootNode+"' data-inode='"+item.inode+"'  data-template='"+item.template+"' title='"+item.title.toUpperCase()+"'>"+itemTitle.toUpperCase()+"</a>"+arrow;}
$('#dvLibraryFilter .breadcrumb').html(html);$("#dvLibraryFilter .breadcrumb a").click(function(){var inode=$(this).data('inode');var fnode=$(this).data('fnode');library.listTemplate=$(this).data('template');sd.Utils.historyAdd({'section':'library','fnode':inode,'template':library.listTemplate,'ParentID':fnode,'csid':sd.Configuration.csid});library.OpenMenuToInode(inode);library.ListItems(inode);});}
library.changePage=function(newPage){library.currentPage=newPage+1;var current=$('.brand-btn-pagination').find('.current').length;library.createList(null,null);}
library.PreviewFile=function(inode){var obj={};obj.inode=inode;obj.logView=true;$('#loader').show();sd.Utils.killAllVideos();var sc=new sd.ServerCall("GetLibraryItem");sc.data(obj);sc.go({onSuccess:library.handleItem,onError:library.handleError});}
library.handleItem=function(myData,Status){var item=myData[0];library.selectedItem=item;library.adminUser=item.al;if(!library.jumpTo)
sd.Utils.historyAdd({'section':'library','inode':item.i,'fnode':item.f,'csid':sd.Configuration.csid,'template':library.listTemplate,'ParentID':library.rootNode});library.jumpTo=false;$('#libraryList').load(sd.Configuration.templates.libraryItem,function(){$('#dvLibraryFilter').hide();$("#btnDeleteItem").hide();$("#btnEditItem").hide();$('#dvBestCaseHeader').hide();$('#dvLibraryPagingHeader').hide();$('#tbLibraryListHeader').hide();$('#dvLibraryPagingFooter').hide();$('#loader').hide();$(".list-header").hide();if(sd.Session.user.superAdmin==true||library.adminUser>1||admin.adminUser()||library.selectedItem==3){$("#btnDeleteItem").show();$("#btnEditItem").show();for(var i=0;i<sd.Configuration.blockEdit.length;i++){if(item.f==sd.Configuration.blockEdit[i]||item.p.indexOf('ID:'+String(sd.Configuration.blockEdit[i])+';')>-1){$("#btnEditItem").hide();break;}}}
window.scrollTo(0,0);$("#dvLibraryItem .download-link").unbind("bind").bind("click",function(){library.downloadFile(library.selectedItem.i);});$("#dvLibraryItem .mail-link").bind("click",function(){sd.Utils.sendEmailLink({inode:library.selectedItem.i,fnode:library.selectedItem.f});});$("#dvLibraryItem .share-link").bind("click",function(){sd.Utils.shareFileLink(library.selectedItem.i);});$("#btnEditItem").bind("click",function(){library.loadForm();});$("#btnDeleteItem").bind("click",function(){library.deleteItem();});$("#btnCloseItem").unbind("click").bind("click",function(){if(library.currFnode!=undefined)
{if(library.currFnode==library.i_node)
$("#dvGoHome").click();else
JumpToItem(library.currFnode);}
else
window.history.go(-1);});$("#dvLibraryOwner").unbind("click").bind("click",function(){LoadSection("userProfile",true,{userID:item.uid,username:item.u});});if(sd.Utils.isVideo(item.ff)==false){$("#dvLibraryImage").css({"background-image":"url("+sd.Configuration.vault+"/"+item.i+"/bigthumb.jpg)","background-repeat":"no-repeat ","background-size":"cover","background-position":"center"});$("#dvLibraryImage").bind("click",function(){previewer.open(item.i);});}else{var html="<video class='videoClass' id='"+item.i+"' style=\"width: 100%; height: 100%;\" controls autoplay> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.i+"/"+item.i+".mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";$("#dvLibraryImage").html(html);$("#dvLibraryImage").find('video').bind("loadeddata",function(){$("#dvLibraryImage").find('video').attr('poster','');});}
var locationPath=(item.pf!=undefined&&item.pf!="")?item.pn+" > "+item.pf:item.pn
$("#hSectionHeader").text(locationPath);$("#dvLibraryTitle").html(item.t);$("#spFavCount").html(item.tf);if(item.uf==1)
$("#iconFav").addClass("ico-heart-fav");if(item.ft==1){$("#dvLibraryItem .js-featured-tag").show();}
$(".add-favourites").click(function(){if(item.uf==1){item.uf=0;item.tf=item.tf-1;$("#iconFav").removeClass("ico-heart-fav");$("#spFavCount").html(item.tf);favourites.removeFavourite(item.i);}else{item.uf=1;item.tf=item.tf+1;$("#iconFav").addClass("ico-heart-fav");$("#spFavCount").html(item.tf);favourites.addFavourite(item.i);}});$("#dvLibraryOwner").html(item.a);if(item.aci!=null&&item.aci!=0){item.ai=item.aci;}
if(item.ai!=null&&item.ai>0){if(String(item.ai).indexOf("base64")>-1){$(".js-aPic").css({'background-image':'url('+item.ai+')','background-size':'cover','background-position':'center'});}
else{$(".js-aPic").css({'background-image':'url('+sd.Configuration.vault+"/"+item.ai+"/bigthumb.jpg"+')','background-size':'cover','background-position':'center'});}}
else{var fullName=item.a.split(' ');if(item.ac==null){item.ac=users.UpdateColour(item.uid);}
var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();$(".js-aPic").html(userInitials).attr("style",'background-color:'+item.ac+'').css({"text-align":"center","color":"white","line-height":"35px"}).addClass("white-text");}
$("#dvLibraryCreateDate").html(item.ct);var jsonMeta=$.parseJSON(item.ma);var htmlOut="<ul class='item-details'>";htmlOut+="<li>";htmlOut+="<label>Description</label>";htmlOut+="<span>"+channel.formatEmbeddedLinks(item.d).replace(/\n/g,"<br/>")+"</span>";htmlOut+="</li></ul>";htmlOut+="<ul class='item-details flex'>";htmlOut+="<li>";htmlOut+="<label>File Size</label>";htmlOut+="<span>"+item.s+"</span>";htmlOut+="</li>";htmlOut+="<li>";htmlOut+="<label>File Format</label>";htmlOut+="<span>."+item.fn.split('.').pop().toLowerCase();+"</span>";htmlOut+="</li>";htmlOut+="<li>";htmlOut+="<label>Expiry Date</label>";if(item.et==null)
htmlOut+="<span>N/A</span>";else
htmlOut+="<span>"+item.et+"</span>";htmlOut+="</li>";var usageRights="";var xmlDOM=$.parseXML(item.xml);$(xmlDOM).find("meta").each(function(){switch($(this).find("type").text()){case"usageRights":usageRights=$(this).find("value").text();break;default:}});if(usageRights=="")usageRights="None."
htmlOut+="<li style=\"flex-basis:100%\">";htmlOut+="<label>Usage Rights</label>";htmlOut+="<span class = \"td-align-top\">"+usageRights+"</span>";htmlOut+="</li>";var meta=[];for(var m=0;m<library.formCheckLists.length;m++){meta=sd.Utils.getItemsFromObject(jsonMeta,"t",library.formCheckLists[m].attribute,"v");if(meta.length>0){htmlOut+="<li>";htmlOut+="<label class = \"td-align-top\">"+library.formCheckLists[m].title+":</label>";htmlOut+="<div data-type=\""+library.formCheckLists[m].attribute+"\"><span class=\"tag tag-link\">"+meta.join(' </span><span class=\"tag tag-link\">')+"</span></div>";htmlOut+="</li>"}}
for(var i=0;i<sd.Configuration.QMSCustomMeta.length;i++){if(item.f==sd.Configuration.QMSCustomMeta[i]||item.p.indexOf('ID:'+String(sd.Configuration.blockEdit[i])+';')>-1){var arrMeta=$.parseJSON(item.xml);if(arrMeta!=null){for(var j=0;j<arrMeta.length;j++){htmlOut+="<li>";htmlOut+="<label>"+arrMeta[j].label+":</label>";if(arrMeta[j].controlType=="Date"){var arrDate=arrMeta[j].value.split("-");var date=new Date(Number(arrDate[2]),Number(arrDate[0])-1,Number(arrDate[1]));htmlOut+="<span class = \"td-align-top\">"+sd.Utils.formatDate(date,"dd mmm yy")+"</span>";}else{htmlOut+="<span class = \"td-align-top\">"+arrMeta[j].value+"</span>";}}}
htmlOut+="<li>";htmlOut+="<label>Version</label>";htmlOut+="<span class = \"td-align-top\">"+item.v+"."+item.r+"</span>";htmlOut+="</li>";break;}}
htmlOut+="</ul>";$("#dvLibraryDetails").html(htmlOut);$("#dvLibraryDetails .tag").unbind("click").bind("click",function(){var tag=$(this).html();var type=$(this).closest("div").data('type');var tagText=$(this).text();$('#headerSearchFieldInput').val(tagText);var obj={};obj.mode="preset"
obj.onError=$.proxy(runSearch.handleError);obj.onSuccess=$.proxy(runSearch.handleResults);obj.searchUsers=false;obj.searchEgnyte=false;obj.metaOnlySearch=true;obj.searchString=tagText;obj.searchMetaData="<metadata><meta><label>"+type+"</label><value>"+tag+"</value></meta></metadata>";LoadSection("search",true,obj);});htmlOut="";if(item.rf.length==0){$('#dvLibraryRelatedFiles').parent('div').css("display","none")}else{for(i=0;i<item.rf.length;i++){htmlOut="<div class=' pa-r-2 large-3 w-3'>";htmlOut+="<div class='related-tbl flex-ellipsis'>";htmlOut+='<div class="xlarge-sqr"><img onClick="previewer.open('+item.rf[i].i+', {logMetric: true, logSection: \'Associated File\'} );" onmouseover="$(this).css(\'cursor\',\'pointer\')" src = "images/docIcons/'+sd.Utils.getFileIcon({fmt:item.rf[i].ft,size:"med"})+'" title = "'+item.rf[i].t+'"/></div>';htmlOut+="<div class=''>";htmlOut+='<div class="flex item-desc related-file-name brand-color flex-ellipsis" onClick="previewer.open('+item.rf[i].i+', {logMetric: true, logSection: \'Associated File\'});">'+item.rf[i].t+'</div>';htmlOut+='<div class="item-desc related-file-date">'+item.rf[i].a+'</div>';htmlOut+='<div class="item-desc related-file-date">'+item.rf[i].ct+'</div>';htmlOut+="</div>";htmlOut+="</div></div>";$("#lib-rel-left").append(htmlOut);}}});}
library.addEventListeners=function(){$("#libraryList_btn").on("click",function(){$("#tbListHeader").show();library.viewMode="list";library.createList(null,null);$("#libraryThumb_btn").removeClass("view-as-selected ")
$("#libraryList_btn").addClass("view-as-selected ");$(".list-content").addClass("list-view");$(".list-content").removeClass("thumb-view");});$("#libraryThumb_btn").on("click",function(){$("#tbListHeader").hide();library.viewMode="thumb";library.createList(null,null);$("#libraryList_btn").removeClass("view-as-selected ")
$("#libraryThumb_btn").addClass("view-as-selected ");$(".list-content").addClass("thumb-view");});if(sd.Configuration.csid!=1){$("#bestCaseTemplate_btn").hide();}
$("#bestCaseTemplate_btn").bind("click",function(){window.open("docs/best case submission.pptx");});$("#bestCaseAdd_btn").bind("click",function(){library.addNew();});$("#newLibraryItem_btn").bind("click",function(){library.addNew();});$("#addUrl_btn").bind("click",function(){library.addNewURL();});$(".search-icon").bind("click",function(){library.runSearch();});$('#libraryFilterText').unbind().bind('input',function(){library.currentPage=1;library.shuffle=false;library.createList();}).bind("keypress",function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){library.runSearch();}});$("#libraryReset_btn").unbind("click").bind("click",function(){library.appliedFilters=[];$('#txtFilterCrew').val("");library.currentPage=1;library.createList("sortname",null);$("#libraryReset_btn").hide();}).hide();$("#editArticle_btn").unbind("click").bind("click",function(){page.edit();});}
library.refreshList=function(){$("#loader").show();$("#libraryList").empty();sd.component.messageBox.close();var obj={};if(library.listTemplate=="newsletter"){var sc=new sd.ServerCall("ListNewsletters");sc.data({fnode:library.currFnode});}else{obj.depth="deep";obj.inode=library.currFnode;obj.limit=library.limit;obj.type=library.listTemplate;var sc=new sd.ServerCall("ListItems");sc.data(obj);}
sc.go({onSuccess:library.handleList,onError:library.handleError});}
library.runSearch=function(){var filterText=$('#libraryFilterText').val();var errMsg=runSearch.validSearchTerm(filterText);if(errMsg!=""){sd.component.messageBox.action({title:"Search",height:150,text:errMsg,btn1:"Ok"});return;}
var obj={};obj.mode="preset"
obj.onError=$.proxy(runSearch.handleError);obj.onSuccess=$.proxy(runSearch.handleResults);obj.searchString=filterText;obj.searchUsers=false;obj.searchRootNode=library.rootNode;obj.searchBox=false;obj.searchEgnyte=false;LoadSection("search",true,obj);}
library.addNew=function(){if(library.listTemplate=="bestcase"){var obj={};obj.inode=0;obj.action="new";obj.fnode=library.currFnode;bestCase.loadForm(obj);}else if(library.listTemplate=="newsletter"){var obj={};obj.inode=0;obj.action="new";obj.fnode=library.currFnode;newsletterBuilder.loadForm(obj);}else{library.selectedItem.i=0;library.loadForm();}}
library.addNewURL=function(){var addGlobalLink=1;var parentID=library.currFnode;sd.component.messageBox.action({title:"Add URL Link",width:"500",height:"480",loadCallback:function(){$('#isGlobal').val(addGlobalLink);$('#parentID').val(parentID);$('#linkUpload').bind("click",links.uploadLinkImage);},template:sd.Configuration.templates.linksDetails,btn1callback:$.proxy(links.saveLinkLibrary,this),btn1:"Add Link",btn2:"Cancel",});}
library.editURL=function(inode){var sc=new sd.ServerCall("GetLinkDetails",0);sc.data({inode:inode});sc.go({onSuccess:library.showLinkDialog,onError:library.handleError});}
library.showLinkDialog=function(myData,status){var item=myData[0];sd.component.messageBox.action({title:"Update URL Details",width:"500",height:"480",loadCallback:function(){$("#LinkID").val(item.i_node);$('#linkUpload').bind("click",links.uploadLinkImage);$("#linkTitle").val(String(item.item).split("||")[0]);$("#linkDesc").val(item.description);$("#linkURL").val(String(item.item).split("||")[1]);$("#linkImage").val(item.filename);$("#linkThumbID").val(item.thumbID);$(".messageBoxBtn2").click(function(){links.deleteLinkLibrary(item.i_node);});},template:sd.Configuration.templates.linksDetails,btn1callback:$.proxy(links.saveLinkLibrary,this),btn1:"Save",btn2:"Delete",btn2close:false});}
library.loadForm=function(){var action="";if(library.selectedItem.i>0)
action="Update Library Item";else
action="Add New Library Item";sd.Utils.killAllVideos();sd.component.messageBox.action({title:action,height:600,width:960,cssClass:"msg-box-front-end",headerClass:"msg-box-front-end-header",bodyClass:"msg-box-front-end-body",loadCallback:function(){var item;var htmlOut="<div class='flex pa-b-half'>";htmlOut+="<input type=\"radio\" name = \"rdoDisclaimer\" class='rdoDisclaimer flex self-center ma-r-half' id=\"rdoDisclaimer0\" value=\"0\">";htmlOut+="<span class=\"rdo-disclaimer\">None </span>";htmlOut+="</div>";if(disclaimer.currentList.length>0){for(var i=0;i<disclaimer.currentList.length;i++){item=disclaimer.currentList[i];htmlOut+="<div class='flex flex-1 pa-b-half'>";htmlOut+="<input type=\"radio\" name = \"rdoDisclaimer\" class='rdoDisclaimer flex slef-center ma-r-half' id=\"rdoDisclaimer"+item.id+"\" value=\""+item.id+"\">";htmlOut+="<span class=\"rdo-disclaimer\">"+item.name+"</span>";htmlOut+="</div>";}
$('#rdoDisclaimers').html(htmlOut);}else{$('.libraryDisclaimer').hide();$('#rdoDisclaimers').html("");}
$("#libraryID").val(library.selectedItem.i);tinymce.init({selector:"#txtDescription",init_instance_callback:function(){if(library.selectedItem.i>0){tinyMCE.activeEditor.setContent(library.selectedItem.d);}
window.setTimeout(function(){$(".messageBoxMainBody").scrollTop(0);},500);},content_style:"html {height:81%} #tinymce {height:100%;}"});library.formFnode=0;library.imageid=library.selectedItem.i;$('#lstRelatedFiles').multiSelect({keepOrder:true,width:270,backgroundHeight:102,selBackgroundHeight:102,height:100,selHeight:100});if(library.formCheckLists.length==0)$('#dvLibraryForm .chk-list').html("No Tags configured.");var fragment;var clone;for(i=0;i<library.formCheckLists.length;i++){fragment=document.createDocumentFragment();clone=$('#dvLibraryForm .guide .checkListItem').clone().appendTo(fragment);clone.attr('id',"dv"+library.formCheckLists[i].attribute+"Container");clone.find('span').html(library.formCheckLists[i].title);clone.find('div').attr('id',library.formCheckLists[i].checklist);$('#dvLibraryForm .chk-list').append(fragment);$('#'+library.formCheckLists[i].checklist).checkList({listItems:{},onChange:library.selChange});}
$('#dvLibraryForm').keypress(function(e){if(e.which==13){e.preventDefault();}});$("#libraryFormStartDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Start Date"});$("#libraryFormEndDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"End Date"});if(library.selectedItem.i>0){$("#rdoDisclaimer"+library.selectedItem.did).attr('checked','checked');library.imageid=library.selectedItem.i;$("#txtTitle").val(library.selectedItem.t);$("#spLibraryAsset").html(library.selectedItem.fn);$("#libraryFormStartDate").val(library.selectedItem.st);$("#libraryFormEndDate").val(library.selectedItem.et);if(library.selectedItem.ft==1){$("#chkFeaturedItem").prop("checked",true);}else{$("#chkFeaturedItem").prop("checked",false);}
var xmlMeta=$.parseXML(library.selectedItem.xml);$(xmlMeta).find("meta").each(function(){switch($(this).find("type").text()){case"usageRights":$("#txtUsageRights").val($(this).find("value").text());break;default:}});for(j=0;j<library.selectedItem.rf.length;j++){var file=library.selectedItem.rf[j];$('#lstRelatedFiles').append('<option selected="selected" value="'+file.i+'">'+file.t+'</option>');$('#div.ms-lstRelatedFiles > div.ms-selection > ul.ms-list').append('<li class="ms-elem-selected" ms-value="'+file.i+' style="">'+file.t+'</li>');}
$('#lstRelatedFiles').multiSelect('refresh');}else{$("#rdoDisclaimer0").attr('checked','checked');}
var obj={};obj.inode=library.rootNode;obj.limit=library.limit;obj.level=15;var sc=new sd.ServerCall("FolderTraverse");sc.data(obj);sc.go({onSuccess:library.handleLocationItems,onError:library.handleError});var types="";$.each(library.formCheckLists,function(){types+=$(this)[0].id+", ";})
if(types.length>2)types=types.substring(0,types.length-2);obj={};obj.types=types;obj.returnAll=false;obj.userAttr=false;sc=new sd.ServerCall("ListMetaAttributes");sc.data(obj);sc.go({onSuccess:library.handleMetaAttributes,onError:library.handleError});$("#relatedFileSearch_btn").bind("click",function(){var searchTerm=$("#txtRelatedFileSearch").val();if(searchTerm==""){library.handleFormError("Please enter a search term for the related file search.");return;}
var obj={};obj.searchString=searchTerm;obj.onError=library.handleFormError;obj.onSuccess=library.handleAssociatedFileSearch;obj.searchUsers=false;obj.searchBox=false;obj.searchEgnyte=false;obj.searchType="any";obj.searchContent=true;obj.searchTitleOnly=false;obj.searchOrder="rank";obj.searchOrderDirection="DESC";obj.searchLimitResults=50;obj.searchCategories="document,bestcase,artist,expert,dreamteam";var rfSearch=new sd.Search(obj);rfSearch.runSearch();});$("#libraryUpload_btn").bind("click",function(){sd.FileUploader.browse({'destinationInode':-90,'onComplete':library.uploadComplete,'onSelect':function(lastFile){$("#spLibraryAsset").html("uploading ...");sd.FileUploader.upload();},'onError':function(msg){$("#spLibraryAsset").html("Upload Failed. Try Again");}});});$("#relatedFileUpload_btn").bind("click",function(){sd.FileUploader.browse({'destinationInode':-2,'onComplete':library.rfUploadComplete,'onError':function(fileName){}});});$(".publishing-rule .icon-calendar").click(function(){$(this).closest("div").find(".ui-datepicker-trigger").click()});},template:sd.Configuration.templates.libraryForm,btn1callback:library.saveForm,btn1:"Save",btn2:"Cancel",btn2callback:library.cancelForm});}
library.handleAssociatedFileSearch=function(myData,status){var count=myData.length;var arrText=[];var arrIds=[];$("#lstRelatedFiles option:selected").each(function(){arrIds.push($(this).val());arrText.push($(this).text());});$('#lstRelatedFiles').empty();var item;var addItem;for(i=0;i<myData.length;i++){item=myData[i];addItem=true;for(j=0;j<arrIds.length;j++){if(item.id==arrIds[j]){addItem=false;count--;break;}}
if(addItem==true)
$('#lstRelatedFiles').append('<option value="'+item.id+'">'+item.name+'</option>');}
for(j=0;j<arrIds.length;j++){$('#lstRelatedFiles').append('<option selected="selected" value="'+arrIds[j]+'">'+arrText[j]+'</option>');}
$("#lblSearchCount").html(" ("+count+")");$('#lstRelatedFiles').multiSelect('refresh');}
library.handleMetaAttributes=function(myData,status){var title="";var item;var type,checklist,lstJSON;for(i=0;i<library.formCheckLists.length;i++){type=library.formCheckLists[i].attribute;chkList=library.formCheckLists[i].checklist;$('#'+chkList).checkList({listItems:{},onChange:library.selChange});lstJSON="[]";for(j=0;j<myData.length;j++){if(j==0)lstJSON="[";item=myData[j];if(item.t!=type)
continue;title=item.v.replace(/"/g,'\'');lstJSON+='{ text: "'+title+'", value: "'+item.i+'", ';if(library.selectedItem.i>0){var jsonMeta=$.parseJSON(library.selectedItem.ma);for(k=0;k<jsonMeta.length;k++){if(jsonMeta[k].i==item.i){lstJSON+='selected: "1" ';}}}else
lstJSON+='selected: "0" ';lstJSON+='}';lstJSON+=',';}
if(lstJSON.match("\]$")){}
else lstJSON+=']';var obj=eval('('+lstJSON+')');if(lstJSON!="[]")$('#'+chkList).checkList('setData',obj);else $('#'+chkList).parent().remove();}}
library.handleLocationItems=function(myData,status){var item;var data=[];data.push({i:library.rootNode,im:library.rootTitle});for(var i=0;i<myData.length;i++){item=myData[i];if(item.a==3&&item.tpl=="folder")
data.push(item);}
library.appendMenu($(".location"),data,0);$('#locationDD').fgmenu({content:$('#locationDD').next().html(),backLink:false,label:$('#locationLbl').attr('id'),value:$('#hdnLocationID').attr('id'),width:200});}
library.appendMenu=function(parent,menu,level){for(var i=0;i<menu.length;i++){var fnode;if(library.selectedItem.i==0)
fnode=library.currFnode;else
fnode=library.selectedItem.f;library.formFnode=fnode;if(menu[i].i==fnode){$("#hdnLocationID").text(menu[i].i);$("#locationLbl").text(menu[i].n);library.locationChange(menu[i].i);}
var submenu=parent.append('<li><a data-template= "library" id="'+menu[i].i+'" href="#" >'+menu[i].im+'</a></li>').find("li:last");if(menu[i].menu!=undefined&&menu[i].menu.length>0){submenu=submenu.append('<ul></ul>').find("ul");library.appendMenu(submenu,menu[i].menu,level+1);}}}
library.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
library.handleFormError=function(error){sd.component.messageBox.showError(error);}
library.removeFilterFromArray=function(id){for(var j=0;j<library.appliedFilters.length;j++){if(library.appliedFilters[j].id==id){library.appliedFilters.splice(j,1);break;}}}
library.selChange=function(){}
library.locationChange=function(folderID){var obj={};obj.inode=folderID;var sc=new sd.ServerCall("GetFolderDetails",0);sc.data(obj);sc.go({onSuccess:library.updateLocationIndicator});$("#lblNoLocation").hide();}
library.updateLocationIndicator=function(myData,status){var item=myData[0];library.formFnode=item.i_node;var html="";html+="<li id=\"liLocation"+item.i_node+"\" class=\"liLocation ma-tb-1\"><a class='folder-location--remove' onclick = \"library.removeLocation("+item.i_node+");\"><i id=\"icon-remove\" class=\"icon-remove\" title=\"Remove This Location\"></i></a><span class ='ddLbl dd-lbl'>"+item.FullPath+item.item+"</span></li>";$("#ulFolderLocations").html(html);}
library.removeLocation=function(folderID){library.formFnode=0;$("#liLocation"+folderID).remove();if($("#ulFolderLocations").html()==""){$("#lblNoLocation").fadeIn();}}
library.cancelForm=function(){sd.FileUploader.cancel();if($("#dvLibraryImage video").length){videoID=$("#dvLibraryImage video").attr("id");var html="<video class='videoClass' id='"+videoID+"' style=\"width: 100%; height: 100%;\" controls autoplay> ";html+="<source src = '"+sd.Configuration.ws+"/"+videoID+"/"+videoID+".mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";$("#dvLibraryImage").html(html);$("#dvLibraryImage").find('video').bind("loadeddata",function(){$("#dvLibraryImage").find('video').attr('poster','');});}}
library.saveForm=function(){var errString=library.validForm();if(errString!=""){sd.component.messageBox.showError("Please complete the following field(s): "+errString);return;}
var action="";var obj={};obj.fnode=library.formFnode;if($("#libraryID").val()==0){action="AddFormLibraryItem";obj.type="Document";obj.inode=library.imageid;}else{action="UpdateFormLibraryItem";obj.orgInode=$("#libraryID").val();obj.inode=library.imageid;}
obj.item=$("#txtTitle").val();obj.description=tinyMCE.activeEditor.getContent();obj.disclaimer=$('input:radio[name=rdoDisclaimer]:checked').val()||0;obj.startDate=$("#libraryFormStartDate").val();obj.endDate=$("#libraryFormEndDate").val();if($("#chkFeaturedItem").prop("checked")==true)
obj.featured=1;else
obj.featured=0;var lstData;var item;var meta="";for(i=0;i<library.formCheckLists.length;i++){lstData=$('#'+library.formCheckLists[i].checklist).checkList('getSelection');for(j=0;j<lstData.length;j++){item=lstData[j];meta+="<meta><type><![CDATA["+library.formCheckLists[i].attribute+"]]></type><value><![CDATA["+item.text+"]]></value><id><![CDATA["+item.value+"]]></id></meta>";}}
meta="<metadata>"+meta+"</metadata>";obj.metaAttributes=meta;meta="";meta+="<meta><type><![CDATA[usageRights]]></type><value><![CDATA["+$("#txtUsageRights").val()+"]]></value></meta>";meta="<metadata>"+meta+"</metadata>";obj.metaData=meta;var attachedFiles=$("#lstRelatedFiles").val();obj.relatedFiles=attachedFiles+"";var sc=new sd.ServerCall(action);sc.data(obj);if($("#libraryID").val()==0)
sc.go({onSuccess:library.showEmailDialog,onError:library.handleFormError});else
sc.go({onSuccess:library.refreshItem,onError:library.handleFormError});}
library.showEmailDialog=function(myData){sd.component.messageBox.action({fade:false,height:450,width:700,title:"Email New Best Case Details",template:"templates/mccann/email.htm",loadCallback:function(){$('#txtSubject').val(sd.Configuration.messages.emailNewUploadSubject);var url=encodeURIComponent(window.location.protocol)+"//";url+=encodeURIComponent(window.location.host);url+=encodeURIComponent(window.location.pathname);url+="?inode="+library.imageid;var body=sd.Configuration.messages.emailNewUploadBody;body+="%0D%0A%0D%0A";body+=url+" %0D%0A%0D%0A";$('#txtBody').val(decodeURIComponent(body));var obj={};obj.inode=library.formFnode;;var sc=new sd.ServerCall("GetEmailList");sc.data(obj);sc.go({onSuccess:library.handleRecipients,onError:library.handleFormError});},btn1callback:library.sendEmail,btn1:"Send",icon1:"icon-mail-forward",btn2:"Cancel",icon2:"icon-ban-circle",btn2callback:library.refreshList});}
library.sendEmail=function(){var emailSubject=$('#txtSubject').val();var emailBody=$('#txtBody').val();var recipientUsers=[];var recipientGroups=[];$('.ms-elem-selected').each(function(){if(($(this).attr('data-type')!=undefined)&&(($(this).attr('ms-value')!=undefined))){if($(this).attr('data-type')=="user")
recipientUsers.push($(this).attr("ms-value").replace("user",""));else
recipientGroups.push($(this).attr("ms-value").replace("group",""));}});if((emailSubject=="")||(emailBody=="")||(recipientGroups.length<1&&recipientUsers.length<1)){var errStr="<span class='errMsg'>";errStr+="Required Field(s) *, 'Subject', 'Body' and at least one 'Recipient' must be entered.";errStr+="</span>";$("#dvValidationError").show();$("#dvValidationError").html(errStr);}else{var obj={};obj.subject=emailSubject;obj.body=emailBody;obj.recipientUsers=recipientUsers;obj.recipientGroups=recipientGroups;obj.source="library";obj.emailFrom="";var sc=new sd.ServerCall("SendEmail",0);sc.data(obj);sc.go({onSuccess:library.refreshList,onError:library.handleFormError});}}
library.handleRecipients=function(myData,status){var type="";var item;var name;var id;for(i=0;i<myData.length;i++){item=myData[i];name=item.n;if(item.g==true){type="group";id=item.i;}else{type="user";id=item.id;}
$('#lstUsers').append('<option data-type ="'+type+'"  value="'+id+'">'+name+'</option>');}
$('#searchable-form').multiSelect({selectableHeader:'<input class="box-sizing" placeholder="Select Users and Groups" style="width:100%;" type="text" id="search" value="" autocomplete = "off"/>',width:304,backgroundHeight:200,selBackgroundHeight:200,height:166,selHeight:198,applyIcons:true});$('input#search').quicksearch('#ms-searchable-form .ms-selectable li');$('#searchable-form').multiSelect();$('#search').focus();}
library.validForm=function(){var valid;var message="";if($("#txtTitle").val()==""||$("#txtTitle").val().length<3){message+="Title is required and must be greater than 3 characters in length, ";}
if(library.imageid==0)
message+="Asset, ";if(library.formFnode==0)
message+="Location, ";if($("#libraryFormStartDate").datepicker("getDate")>$("#libraryFormEndDate").datepicker("getDate")){message+="Publish Start Date must be before Publish End Date, ";}
var relatedFileCount=$('#ms-lstRelatedFiles > div.ms-selection > ul.ms-list > li').length;if(message!="")
message=message.slice(0,-2)+".";return message;}
library.uploadComplete=function(newFiles){var count=newFiles.length-1;library.imageid=newFiles[count].i_node;var html=newFiles[count].name+" <i id=\"icon-remove\" class=\"icon-remove removeAsset\" title=\"Remove This Asset\"></i>";$("#spLibraryAsset").html(html);$("#spLibraryAsset .removeAsset").click(function(){library.imageid=0;$("#spLibraryAsset").html("");});}
library.rfUploadComplete=function(newFiles){for(var i=0;i<newFiles.length;i++){$('#lstRelatedFiles').append('<option value="'+newFiles[i].i_node+'" selected="selected">'+newFiles[i].name+'</option>');$('#ms-lstRelatedFiles > div.ms-selection > ul.ms-list').append('<li class="ms-elem-selected" ms-value="'+newFiles[i].i_node+'" style="">'+newFiles[i].name+'</li>');}
$('#lstRelatedFiles').multiSelect('refresh');}
library.deleteItem=function(){sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(this.deletedConfirmed,this),icon2:"icon-ban-circle",btn2:"No"});}
library.deletedConfirmed=function(){var obj={};obj.inodes=library.selectedItem.i;var sc=new sd.ServerCall("DeleteItems");sc.data(obj);sc.go({onSuccess:library.refreshList,onError:library.handleSaveError});}
library.refreshItem=function(){sd.component.messageBox.close();library.jumpTo=true;library.OpenMenuToInode(library.formFnode);library.PreviewFile(library.imageid);}
library.removeFilterFromPanel=function(id){library.removeFilterFromArray(id);library.createList("name",null);}
library.removeFilterFromArray=function(id){for(var j=0;j<library.appliedFilters.length;j++){if(library.appliedFilters[j].id==id){library.appliedFilters.splice(j,1);break;}}}
library.removeItemFromArray=function(arrayIn,item){for(var j=0;j<arrayIn.appliedFilters.length;j++){if(arrayIn[j]==item){arrayIn.splice(j,1);break;}}}
library.downloadFile=function(inode){library.downloadInode=inode;var obj={};obj.i_node=library.downloadInode;var sc=new sd.ServerCall("GetItemDisclaimer");sc.data(obj);sc.go({onSuccess:library.populateDisclaimer,onError:library.handleError});}
library.populateDisclaimer=function(myData,status){if(myData.length>0){sd.component.messageBox.action({title:"Disclaimer Information",height:360,width:800,cssClass:"msg-box-front-end-disc",headerClass:"msg-box-front-end-header",bodyClass:"msg-box-front-end-disclaimer",loadCallback:function(){$('.messageBoxBtn1').hide();$('.messageBoxBtn2').hide();$('#disclaimerChk').bind("change",function(){if($('#disclaimerChk').prop("checked",true)){$('.messageBoxBtn1').show();}else{$('.messageBoxBtn1').hide();}});$('#disclaimerText').html(myData[0].description);$('#disclaimerID').val(myData[0].disclaimer_id);$('#disclaimerDL').val(myData[0].canDownload);if(myData[0].canDownload==1){$('.disclaimer-check').show();$('#disclaimerAccept').show();}else{$('.messageBoxBtn2').show();}
$('#termsLink').unbind();$('#termsLink').bind('click',function(){previewer.open(sd.Configuration.terms);});},template:sd.Configuration.templates.disclaimer,btn1callback:function(){var obj={};obj.i_node=library.downloadInode;obj.disclaimer_id=$('#disclaimerID').val();obj.disclaimer_text=$('#disclaimerText').html();var sc=new sd.ServerCall("AddAuditTrail");sc.data(obj);sc.go({onSuccess:function(){sd.component.messageBox.close();library.startDownload(library.downloadInode);},onError:library.handleError});},btn1:"Ok",btn2:"Close"});}else{library.startDownload(library.downloadInode);}}
library.startDownload=function(inode){var now=new Date().getTime();var url=sd.Configuration.ws+'/DownloadFile.aspx?inode='+inode+"&timestamp"+now;location.href=url;}
library.loadMap=function(inode){var map=new sd.Map({inode:inode,container:"#libraryMap",height:500,width:$("#libraryListPanel").width()});map.load();$("#libraryContent .js-libt").html("Search by Location");$("#libraryContent .js-filt").hide();$("#libraryContent .js-filt h5").html("Search Results");$('#loader').hide();}
library.setUpDisplayArea=function(mode){$("#libraryMap").empty().hide();$("#editArticle_btn").hide();if(mode=="map"){$("#newLibraryItem_btn").hide();$("#libraryListPanel").hide();$("#libraryMap").show();$("#libraryList_btn").hide();$("#libraryThumb_btn").hide();}else if(mode=="article"){$("#newLibraryItem_btn").hide();$(".list-header").show();$("#dvLibraryFilter").show();$("#libraryListPanel").show();$("#dvLibraryPagingHeader").hide();$("#tbLibraryListHeader").hide();$("#dvLibraryPagingFooter").hide();$(".top-icon").hide();$("#libraryList_btn").hide();$("#libraryThumb_btn").hide();}else{$("#libraryListPanel").show();$(".top-icon").show();$("#dvLibraryPagingHeader").show();$("#tbLibraryListHeader").show();$("#dvLibraryPagingFooter").show();$("#libraryList_btn").show();$("#libraryThumb_btn").show();}}
window.library=library;}(window));﻿(function(window){var links={};var addGlobalLink=0;var urlPrefixes=new Array("http://","https://","mailto:","www.");links.selectedItem=null;links.currentSortDirection="";links.currentSortBy="";links.currentSectionsSortDirection="";links.currentSectionsSortBy="";links.currentList=[];links.currentLinkSections=[];parentID=0;links.init=function(){links.listLinks();};links.initSectionsAdmin=function(){links.selectedItem=null;links.currentSectionsSortDirection="ASC";links.currentSectionsSortBy="Title";links.currentLinkSections=[];parentID=0;$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('.sectionTitleURL').html("&nbsp;&nbsp;&nbsp;");$('.sectionTitleDesc').html("&nbsp;&nbsp;&nbsp;");$('.sectionTitleImage').html("&nbsp;&nbsp;&nbsp;");$('#linkAdminAdd_btn').hide();$('#linkAddSection').show();$('#menuBreadCrumb').hide();$('#sectionContainer .sectionTitleTitle').click(function(){links.displayLinkSections("Title");});$("#linkDisplayOrder").unbind();$("#linkDisplayOrder").bind("click",function(){links.editDisplayOrderDialog();});$('#linkFilterText').on('input',function(){links.displayLinkSections(links.currentSectionsSortBy,links.currentSectionsSortDirection);});links.addEventListeners();links.getAdminLinkSections();}
links.initAdminLinks=function(sectionID,sectionTitle){links.selectedItem=null;links.currentSectionsSortDirection="ASC";links.currentSectionsSortBy="Title";links.currentLinkSections=[];$('.sectionTitleURL').html("URL &nbsp;&nbsp;<i class='icon-chevron-down'></i><i class='icon-chevron-up'></i>");$('.sectionTitleDesc').html("Description");$('.sectionTitleImage').html("Image");$('#linkAdminAdd_btn').show();$('#linkAddSection').hide();$('#menuBreadCrumb').show();$('#parentID').val(sectionID);$('#currentSection').html(sectionTitle);parentID=sectionID;$('#dvLinksContent .icon-chevron-up').hide();$('#dvLinksContent .icon-chevron-down').hide();$('#sectionsHome').bind("click",function(){links.initSectionsAdmin();});$('#sectionContainer .sectionTitleTitle').click(function(){links.displayList("Title");});$('#sectionContainer .sectionTitleURL').click(function(){links.displayList("URL");});$('#linkFilterText').on('input',function(){links.displayList(links.currentSortBy,links.currentSortDirection);});links.addEventListeners();links.getAdminLinks(sectionID);}
links.displayLinkSections=function(sortBy,sortDirection){$('#dvLinksContent .icon-chevron-up').hide();$('#dvLinksContent .icon-chevron-down').hide();if(sortBy!=undefined||sortDirection!=undefined){if(links.currentSectionsSortBy==sortBy){if(links.currentSectionsSortBy=="Title")sd.Utils.sortArrayByString(links.currentLinkSections,"t");if(sortDirection!=links.currentSectionsSortDirection){if(links.currentSectionsSortDirection=="ASC")links.currentSectionsSortDirection="DESC";else links.currentSectionsSortDirection="ASC";}}else{links.currentSectionsSortBy=sortBy;links.currentSectionsSortDirection=sortDirection||"ASC";}}
if(links.currentSectionsSortBy=="Title")sd.Utils.sortArrayByString(links.currentLinkSections,"t");var sortArrow="icon-chevron-up";if(links.currentSectionsSortDirection=="DESC")sortArrow="icon-chevron-down";if(links.currentSectionsSortBy=="Title")$('#dvLinksContent .sectionTitleTitle .'+sortArrow).show();var htmlOut="";var listCount=links.currentLinkSections.length;var filterText=$('#linkFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=links.currentLinkSections[idx];if(links.currentSectionsSortDirection=="DESC")item=links.currentLinkSections[listCount-(idx+1)];if(filterText!=""&&item.t.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<div class='row grid' data-title=\""+item.t+"\" data-sectionid='"+item.id+"'>   \
                            <div class='yui3-u-2-3'><div class='section-list-field item-name brand-text pa-l-1'>"+item.t+"</div></div> \
                            <div class='yui3-u-1-3'><div class='section-list-field'> \
                            <button class='adminSection small-rnd brand ma-r-half' data-title='"+item.t+"' data-id='"+item.id+"'><i class=\"icon-edit\"></i></button> \
                            <button class='delSection small-rnd brand ma-r-half' data-title='"+item.t+"' data-id='"+item.id+"'><i class=\"icon-trash\"></i></button> \
                            </div></div> \
                        </div>";}
$('#dvAdminLinksList').html(htmlOut);$('#loader').hide();$(".item-name").click(function(){var sectionID=$(this).parent().parent().data('sectionid');var sectionTitle=$(this).parent().parent().data('title');links.initAdminLinks(sectionID,sectionTitle);});$(".adminSection").click(function(){var id=$(this).data('id');var title=$(this).data('title');links.editSection({id:id,title:title});});$(".delSection").click(function(){var id=$(this).data('id');links.removeSection(id);});}
links.displayList=function(sortBy,sortDirection){$('#dvLinksContent .icon-chevron-up').hide();$('#dvLinksContent .icon-chevron-down').hide();if(sortBy!=undefined||sortDirection!=undefined){if(links.currentSortBy==sortBy){if(links.currentSortBy=="Title")sd.Utils.sortArrayByString(links.currentList,"t");if(links.currentSortBy=="URL")sd.Utils.sortArrayByString(links.currentList,"u");if(sortDirection!=links.currentSortDirection){if(links.currentSortDirection=="ASC")links.currentSortDirection="DESC";else links.currentSortDirection="ASC";}}else{links.currentSortBy=sortBy;links.currentSortDirection=sortDirection||"ASC";}}
if(links.currentSortBy=="Title")sd.Utils.sortArrayByString(links.currentList,"t");if(links.currentSortBy=="URL")sd.Utils.sortArrayByString(links.currentList,"u");var sortArrow="icon-chevron-up";if(links.currentSortDirection=="DESC")sortArrow="icon-chevron-down";if(links.currentSortBy=="Title")$('#dvLinksContent .sectionTitleTitle .'+sortArrow).show();if(links.currentSortBy=="URL")$('#dvLinksContent .sectionTitleURL .'+sortArrow).show();var htmlOut="";var listCount=links.currentList.length;var filterText=$('#linkFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=links.currentList[idx];if(links.currentSortDirection=="DESC")item=links.currentList[listCount-(idx+1)];if(filterText!=""&&item.t.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<div class='row grid' data-title='"+decodeURIComponent(item.t)+"' data-linkid='"+item.id+"' data-linkurl='"+decodeURIComponent(item.u)+"'>   \
                            <div class='yui3-u-1-6'><div class='section-list-field item-name brand-text  pa-l-1 title'>"+decodeURIComponent(item.t)+"</div></div> \
                            <div class='yui3-u-1-6'><div class='section-list-field url'>"+decodeURIComponent(item.u)+"</div></div> \
                            <div class='yui3-u-1-6'><div class='section-list-field desc'>"+item.d+"</div></div> \
                            <div class='yui3-u-1-6'><div class='section-list-field image'>"+item.img+"</div></div> \
                            <div class='yui3-u-2-6'><div class='section-list-field'> \
                            <button class='adminEditLink small-rnd brand ma-r-half' data-imgid = '"+item.imgId+"' data-title='"+item.t+"' data-url= '"+item.u+"' data-id='"+item.id+"'><i class=\"icon-edit\"></i></button> \
                            <button class='delLink small-rnd brand ma-r-half' data-title='"+item.t+"' data-url= '"+item.u+"' data-id='"+item.id+"'><i class=\"icon-trash\"></i></button> \
                            <button class='testLink small-rnd brand ma-r-half' data-url='"+item.u+"'><i class=\"icon-external-link\"></i></button> \
                            </div></div> \
                        </div>";}
$('#dvAdminLinksList').html(htmlOut);$(".adminEditLink").click(function(){addGlobalLink=1;var id=$(this).data('id');var url=$(this).data('url');var title=$(this).data('title');var desc=$(this).parent().closest('.row').find('.desc').html();var img=$(this).parent().closest('.row').find('.image').html();var imgId=$(this).data('imgid');links.editLink({id:id,url:url,title:title,desc:desc,img:img,imgId:imgId});});$(".delLink").click(function(){var id=$(this).data('id');links.removeLink(id);});$(".testLink").click(function(){var url=$(this).data('url');window.open(url);});}
links.uploadLinkImage=function(){sd.FileUploader.browse({'destinationInode':'-999','onComplete':$.proxy(links.uploadLinkImageComplete,this)});}
links.uploadLinkImageComplete=function(newFiles){var i=newFiles.length-1;$('#linkImgID').val(newFiles[i].i_node);$('#linkImage').val(newFiles[i].name);$('#linkThumbID').val(newFiles[i].i_node);}
links.listLinks=function(){var sc=new sd.ServerCall("ListLinks");sc.go({onSuccess:links.populateLinksList,onError:links.handleError});};links.getAdminLinks=function(sectionID){var sc=new sd.ServerCall("ListLinks");sc.data({sectionID:sectionID});sc.go({onSuccess:links.handleList,onError:links.handleError});};links.getAdminLinkSections=function(){var sc=new sd.ServerCall("ListPortalLinkSections");sc.go({onSuccess:links.handleSectionList,onError:links.handleError});};links.handleSectionList=function(myData,status){links.currentLinkSections=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.id=myData[idx].SectionID;item.t=decodeURIComponent(myData[idx].title);item.cbid=decodeURIComponent(myData[idx].CreatedBy);item.cd=myData[idx].CreatedDate;item.sort=myData[idx].sortorder;links.currentLinkSections.push(item);}
links.displayLinkSections();links.init();}
links.handleList=function(myData,status){links.currentList=[];links.currentSortBy="Title"
links.currentSortDirection="ASC";for(var idx=0;idx<myData.length;idx++){if(myData[idx].isGlobal=="1"&&myData[idx].ParentID==parentID){var item={}
item.id=myData[idx].LinkID;item.t=decodeURIComponent(myData[idx].Title);item.u=decodeURIComponent(myData[idx].URL);item.g=myData[idx].isGlobal;item.d=myData[idx].description||"";item.img=myData[idx].image||"";item.imgId=myData[idx].imageID||"";links.currentList.push(item);}}
links.displayList(links.currentSortBy,links.currentSortDirection);links.init();};links.updateLinks=function(myData,status){links.populateLinksList(myData);links.populateManageLinks(myData);links.handleList(myData);}
links.editSection=function(sectionObj){sd.component.messageBox.action({title:"Edit Section",width:"400",height:"230",template:sd.Configuration.templates.sectionDetails,loadCallback:function(){$('#sectionTitle').val(sectionObj.title);$('#sectionID').val(sectionObj.id);},btn1callback:$.proxy(links.saveSection,this),btn1:"Save",icon1:"icon-edit",btn2:"Close",icon2:"icon-ban-circle"});}
links.editLink=function(linkObj){sd.component.messageBox.action({title:"Edit Link",width:"400",height:"230",template:sd.Configuration.templates.linksDetails,loadCallback:function(){$('#isGlobal').val(addGlobalLink);$('#parentID').val(parentID);$('#linkTitle').val(decodeURIComponent(linkObj.title));$('#linkURL').val(decodeURIComponent(linkObj.url));$('#LinkID').val(linkObj.id);$('#linkImgID').val(linkObj.imgId);$('#linkDesc').val(linkObj.desc);$('#linkImage').val(linkObj.img);if(!addGlobalLink){$('#linkDesc').parent().hide();$('#linkImage').parent().hide();$('#linkUpload').hide();}
$('#linkUpload').bind("click",links.uploadLinkImage);},btn1callback:$.proxy(links.saveLink,this),btn1:"Save Link",icon1:"icon-edit",btn2:"Close",icon2:"icon-ban-circle"});}
links.deleteLinkLibrary=function(linkID){links.selectedItem=linkID;sd.component.messageBox.action({title:"Delete Link",text:"Are you sure you want to delete this link?",height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:$.proxy(links.deleteLinkLibraryConfirmed,this),icon2:"icon-ban-circle",btn2:"No",TxtFields:null,template:null,});}
links.deleteLinkLibraryConfirmed=function(){var sc=new sd.ServerCall("DeleteLink");sc.data({inode:links.selectedItem});sc.go({onSuccess:library.refreshList,onError:library.handleError});}
links.saveLinkLibrary=function(){if($("#linkTitle").val()==""){sd.component.messageBox.showError("Title is a required field.");return;}else if($('#linkURL').val()==""){sd.component.messageBox.showError("URL is a required field.");return;}else if(!(sd.Utils.isValidURLFormat($('#linkURL').val()))){sd.component.messageBox.showError("Please enter a URL with a valid format.");return;}else{var action="";var obj={};var url=$("#linkURL").val();if(url.substring(0,3).toLowerCase()=="www"){url="http://"+url;}
obj.description=$('#linkDesc').val();if($("#LinkID").val()!=""){action="UpdateLink";obj.inode=$("#LinkID").val();}else{action="CreateLink";obj.inode=$("#parentID").val();}
var sc=new sd.ServerCall(action);sc.data({inode:obj.inode,name:encodeURIComponent($("#linkTitle").val()).replace(/'/g,"%27")+"||"+url,description:$('#linkDesc').val(),thumbID:$('#linkThumbID').val()||0});sc.cbData({url:url});sc.go({onSuccess:library.refreshList(),onError:links.handleError});sd.component.messageBox.close();}}
links.saveSection=function(){if($("#sectionTitle").val()==""){sd.component.messageBox.showError("Title is a required field.");return;}
var action="AddLinkSection";var obj={};obj.title=$("#sectionTitle").val();if($("#sectionID").val()!=""){action="EditLinkSection";obj.id=$("#sectionID").val();}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:links.initSectionsAdmin,onError:links.handleError});sd.component.messageBox.close();}
links.saveLink=function(){if($("#linkTitle").val()==""){sd.component.messageBox.showError("Title is a required field.");return;}else if($('#linkURL').val()==""){sd.component.messageBox.showError("URL is a required field.");return;}else if(!(sd.Utils.isValidURLFormat($('#linkURL').val()))){sd.component.messageBox.showError("Please enter a URL with a valid format.");return;}else{var action="AddLink";var obj={};var url=$("#linkURL").val();obj.title=encodeURIComponent($("#linkTitle").val()).replace(/'/g,"%27");if(url.substring(0,3).toLowerCase()=="www"){url="http://"+url;}
obj.url=encodeURIComponent(url).replace(/'/g,"%27");obj.description=$('#linkDesc').val();obj.imgID=$('#linkImgID').val()||0;obj.isGlobal=$("#isGlobal").val();obj.parentID=$("#parentID").val();if($("#LinkID").val()!=""){action="EditLink";obj.id=$("#LinkID").val();}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:links.updateLinks,onError:links.handleError});}
if($("#isGlobal").val()=="0")links.openManageLinks();else sd.component.messageBox.close();}
links.removeLink=function(linkID){links.selectedItem=linkID;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,btn1:"Yes",btn1callback:links.deleteConfirmed,btn2:"No"});};links.removeSection=function(sectionID){links.selectedItem=sectionID;sd.component.messageBox.action({title:sd.Configuration.messages.confirmDeleteSelectedTitle,text:sd.Configuration.messages.confirmDeleteSelected,height:150,width:400,btn1:"Yes",btn1callback:links.deleteSectionConfirmed,btn2:"No"});};links.deleteSectionConfirmed=function(){var sc=new sd.ServerCall("RemoveLinkSection");var obj={};obj.sectionID=links.selectedItem;sc.data(obj);sc.go({onSuccess:links.handleSectionList,onError:links.handleError});}
links.deleteConfirmed=function(){var sc=new sd.ServerCall("RemoveLink");var obj={};obj.linkID=links.selectedItem;obj.parentID=parentID;sc.data(obj);sc.go({onSuccess:links.updateLinks,onError:links.handleError});}
links.populateLinksList=function(myData,status){var item;var htmlOut='';var yourLinks='';var currentSection="";htmlOut+="<div class=\"head-fav pa-all-1\">Links</div>";htmlOut+='<div class="opt-scroll pa-lr-1">';htmlOut+='<div class="list-links">';for(var i=0;i<myData.length;i++){item=myData[i];currentSection=item.title1;if(i>=1&&currentSection!=myData[i-1].title1){htmlOut+='<h6 class="head-link pa-b-half pa-t-half">'+currentSection+'</h6>';}else if(i==0)
htmlOut+='<h6 class="head-link pa-b-half pa-t-half">'+currentSection+'</h6>';htmlOut+='<a class="flex pa-b-half" data-url="'+decodeURIComponent(item.URL)+'"><i class="pa-r-half"><svg role="img" class="svg-icon-nano" ><use xlink:href=\"#shape-link\"></use></svg></i><span class="links-item">'+decodeURIComponent(item.Title)+'</span></a>';}
htmlOut+='</div>';htmlOut+='</div>';htmlOut+='<div class="edit-head-opt pa-all-1 flex justify-center">';htmlOut+='<button class="standard-mc-btn right brand w-12" id="manageLinksBtn" >Manage your Links</button>';htmlOut+='</div>';$('#dvLinksList').html(htmlOut);$(".links-item").click(function(){header.restAll();var url=$(this).parent().data('url');window.open(url);});$("#manageLinksBtn").click(function(){$("#headerLinks_btn").removeClass("nav-selected");links.openManageLinks();});$("#expandLinksBtn").click(function(){$("#dvLinksList").hide();LoadSection("expandedLinks",true);});};links.populateExpandedLinks=function(){$('#loader').hide();$(".brand-current").removeClass("brand-current");var sc=new sd.ServerCall("ListLinks");sc.go({onSuccess:links.handleExpandedLinks,onError:links.handleError});}
links.handleExpandedLinks=function(myData,status){var item;var group="";var currentGroup="";var counter=1;var html="<header class=\"expand-link-header theme-list-header\">Links</header>";var url="";var title="";var imgSrc="";for(var i=0;i<myData.length;i++){item=myData[i];currentGroup=item.ParentID;url=decodeURIComponent(item.URL);title=decodeURIComponent(item.Title);if(item.description==null)item.description="";if(item.ParentID==null)item.ParentID=-1;if(i>0&&item.ParentID!=myData[i-1].ParentID){html+="<div class=\"clear\"></div>";html+="</section>";}
if(group!=item.ParentID){html+="<section class=\"expand-link-wrap\">";html+="<hr class = \"expandedLinkHR\">";html+="<header class=\"brand-color\">"+item.title1+"</header>";html+="<hr class = \"expandedLinkHR\">";}
html+="<div class=\"yui3-u-1-2 expand-link-set\">";html+="<div class=\"expand-link-wrap\">";html+="     <a href=\""+url+"\" target=\"_blank\"> <div class=\"yui3-u-1-3 linkimage\" ";if(item.imageID!=0&&item.imageID!=null)
imgSrc=sd.Configuration.vault+"/"+item.imageID+"/bigthumb.jpg";else
imgSrc="images/docicons/link.png";html+=" style=\"width:130px;height:100px;margin-right:10px;background:url("+imgSrc+") no-repeat\;background-size:cover\" >";html+="     </div></a>";html+="     <div class=\"yui3-u-2-3 expand-link-details\">";html+="         <span class=\"title\">"+title+"</span>";html+="         <span class=\"description\">"+item.description+"</span>";html+="         <a href=\""+url+"\" target=\"_blank\" class=\"brand-color\"> <i class='icon-angle-right'></i> "+url+"  <i class='icon-external-link'></i></a>";html+="     </div>";html+="     <div class=\"clear\"></div>";html+="</div>";html+="</div>";group=item.ParentID;counter++;}
$('#dvExpandedLinks').html(html);$('#loader').hide();}
links.openManageLinks=function(){$('#dvLinksList').hide();sd.component.messageBox.action({title:"Manage Your Links",width:"500",height:"378",template:sd.Configuration.templates.linksList,loadCallback:function(){addGlobalLink=0;var sc=new sd.ServerCall("ListLinks",0);var obj=new Object();sc.data(obj);sc.go({onSuccess:$.proxy(links.populateManageLinks,this),onError:$.proxy(links.linksError,this)});},btn1callback:$.proxy(links.addLinkDialog,this),btn1:"Add New",icon1:"icon-plus",btn2:"Cancel",icon2:"icon-ban-circle"});}
links.addSectionDialog=function(){sd.component.messageBox.action({title:"Add New Section",width:"400",height:"230",template:sd.Configuration.templates.sectionDetails,btn1callback:$.proxy(links.saveSection,this),btn1:"Add Section",icon1:"icon-plus",btn2:"Cancel",icon2:"icon-ban-circle"});}
links.addLinkDialog=function(){sd.component.messageBox.action({title:"Add New Link",width:"400",height:"230",loadCallback:function(){$('#isGlobal').val(addGlobalLink);$('#parentID').val(parentID);if(!addGlobalLink){$('#linkDesc').parent().hide();$('#linkImage').parent().hide();$('#linkUpload').hide();}
$('#linkUpload').bind("click",links.uploadLinkImage);},template:sd.Configuration.templates.linksDetails,btn1callback:$.proxy(links.saveLink,this),btn1:"Add Link",icon1:"icon-plus",btn2:"Cancel",icon2:"icon-ban-circle"});}
links.populateManageLinks=function(myData,status){var item;var htmlOut='';var yourLinks='';for(var i=0;i<myData.length;i++){item=myData[i];if(item.isGlobal!=1){yourLinks+='<tr><td>'+decodeURIComponent(item.Title)+'</td><td>'+decodeURIComponent(item.URL)+'</td>';yourLinks+='<td><a class="editLink" data-title="'+decodeURIComponent(item.Title)+'" data-url= "'+decodeURIComponent(item.URL)+'" data-id="'+item.LinkID+'" ><svg role="img" class="svg-icon-nano" ><use xlink:href=\"#shape-mcann-edit-icon\"></use></svg></a></td>';yourLinks+='<td><a class="delLink" data-title="'+decodeURIComponent(item.Title)+'" data-url= "'+decodeURIComponent(item.URL)+'" data-id="'+item.LinkID+'"><svg role="img" class="svg-icon-nano" ><use xlink:href=\"#shape-trash\"></use></svg></a></td></tr>';}}
htmlOut+='<tr><th>Title</th><th>URL</th><th>Edit</th><th>Delete</th></tr>';htmlOut+=yourLinks;$('#manageLinksTbl').html(htmlOut);$(".editLink").click(function(){addGlobalLink=0;var id=$(this).data('id');var url=$(this).data('url');var title=$(this).data('title');links.editLink({id:id,url:url,title:title});});$(".delLink").click(function(){var id=$(this).data('id');links.removeLink(id);});};links.addEventListeners=function(){$('#linkAddSection').unbind();$('#linkAddSection').bind("click",function(){links.addSectionDialog();});$("#linkAdminAdd_btn").unbind()
$("#linkAdminAdd_btn").bind("click",function(){addGlobalLink=1;links.addLinkDialog();});$(".admin-close-btn").unbind();$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});};links.editDisplayOrderDialog=function(){sd.component.messageBox.action({title:"Edit Display Order",loadCallback:function(){if(parentID==0){var sc=new sd.ServerCall("ListPortalLinkSections",0);}else{var sc=new sd.ServerCall("ListLinks",0);}
sc.go({onSuccess:links.displaySortMenu,onError:links.handleError});},width:500,height:375,template:sd.Configuration.templates.linkSectionDisplayOrder,btn1:"Save",icon1:"icon-save",btn1callback:$.proxy(this.saveDisplayOrder,this),btn2:"Cancel",icon2:"icon-ban-circle"});}
links.displaySortMenu=function(myData,status){var item;var htmlOut;for(i=0;i<myData.length;i++){item=myData[i];if(parentID==0){$('#sortable').append("<li id = '"+item.SectionID+"'>"+decodeURIComponent(item.title));}else if(parentID==item.ParentID){$('#sortable').append("<li id = '"+item.LinkID+"'>"+decodeURIComponent(item.Title));}}
$('#sortable').sortable();}
links.saveDisplayOrder=function(){var displayObject="";var count=1;$('#sortable li').each(function(){displayObject+=this.id+";"+count+":";count++;});if(displayObject!="")
displayObject=displayObject.slice(0,-1);if(parentID==0)
var sc=new sd.ServerCall("UpdateLinkSectionDisplayOrder",0);else
var sc=new sd.ServerCall("UpdateLinkDisplayOrder",0);var objTemp=new Object();objTemp.displayObject=displayObject;sc.data(objTemp);if(parentID==0)
sc.go({onSuccess:links.handleSectionList,onError:links.handleError});else
sc.go({onSuccess:links.handleList,onError:links.handleError});sd.component.messageBox.close();}
links.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.links=links;}(window));﻿(function(window){var mccann={};var bestcases;var backgrounds;var itemLinks;var timer;mccann.collabDetails={};mccann.init=function(){}
mccann.setBestCase=function(myData,status){if(myData[0].del!=1){var htmlOut="<span class=\"call-to-action-text \">"+myData[0].pn+":: </span> <span class=\"brand-color one-link-title\"><a href="+sd.Global.collabData.itemlink0+"> "+sd.Global.collabData.bestcase0+"</span>";$('.action-link').html(htmlOut);if($('#mc-back').css("display")!="none")
$('.call-to-action').show();}}
mccann.handleCollabData=function(myData,status){mccann.collabDetails=myData[0];}
mccann.refreshCollabData=function(){var item=mccann.collabDetails;var xmlMeta=$.parseXML(item.metaData);sd.Global.collabData.quickLinks=[];$(xmlMeta).find("meta").each(function(){switch($(this).find("label").text()){case"numBackgrounds":sd.Global.collabData.numBackgrounds=$(this).find("value").text();break;case"background0":sd.Global.collabData.background0=$(this).find("value").text();break;case"background1":sd.Global.collabData.background1=$(this).find("value").text();break;case"background2":sd.Global.collabData.background2=$(this).find("value").text();break;case"bestcase0":sd.Global.collabData.bestcase0=$(this).find("value").text();break;case"bestcase1":sd.Global.collabData.bestcase1=$(this).find("value").text();break;case"bestcase2":sd.Global.collabData.bestcase2=$(this).find("value").text();break;case"itemlink0":sd.Global.collabData.itemlink0=$(this).find("value").text();break;case"itemlink1":sd.Global.collabData.itemlink1=$(this).find("value").text();break;case"itemlink2":sd.Global.collabData.itemlink2=$(this).find("value").text();break;}
sd.Global.collabData.quickLinks=item.quickLinks;});backgrounds=[sd.Global.collabData.background0,sd.Global.collabData.background1,sd.Global.collabData.background2];bestcases=[sd.Global.collabData.bestcase0,sd.Global.collabData.bestcase1,sd.Global.collabData.bestcase2];itemLinks=[sd.Global.collabData.itemlink0,sd.Global.collabData.itemlink1,sd.Global.collabData.itemlink2];for(var i=backgrounds.length;i>0;i--)
{if(backgrounds[i-1]==undefined||backgrounds[i-1]=="")
{backgrounds.pop();bestcases.pop();itemLinks.pop();}}
var numBackgrounds=backgrounds.length;if(Number(numBackgrounds)>0)
{item.homepageCarousel=true;}else{item.homepageCarousel=false;}
if(item.toolStackLink!=undefined&&item.toolStackLink!="")
{if(item.toolStackLink.indexOf("://")<0&&item.toolStackLink.indexOf(":\\")<0){item.toolStackLink="http://"+item.toolStackLink;}
$("#supportLink").attr("title",item.toolStackTitle);$("#supportLink1").attr("title",item.toolStackTitle);$("#supportLink").unbind("click").bind("click",function(event){window.open(item.toolStackLink);});$("#supportLink1").unbind("click").bind("click",function(event){window.open(item.toolStackLink);});$("#supportLink").show();$("#supportLink1").show();}else{$("#supportLink").hide();$("#supportLink1").hide();}
if(item.homepageCarousel==true&&globalSection=="mccann"){$("#mc-back").hide();$(".call-to-action-multi, .call-to-action").hide();var fragment1=document.createDocumentFragment();var item1;var clone1;for(var j=0;j<numBackgrounds;j++){clone1=$('.guide .js_carousel1').clone().appendTo(fragment1);clone1.data("link",itemLinks[j]);var url="images/mccann/background/"+backgrounds[j];clone1.css("background-image","url("+url+") ");clone1.css("background-size","cover");clone1.find('div').html(bestcases[j]);if(itemLinks[j]!=undefined||itemLinks[j]!="")
{clone1.addClass("js_click");}}
$(".jsCarouselContainer1").show();$(".jsCarouselContainer1"+" ul").empty().show();$(".jsCarouselContainer1"+" ul").html(fragment1);$(".jsCarouselContainer1").foundation();$(".jsCarouselContainer1"+" .js_click").unbind("click");$(".jsCarouselContainer1"+" .js_click").click(function(){var link=$(this).closest(".js_carousel1").data("link");window.open(link);});}
else{$(".jsCarouselContainer").hide().empty();$(".jsCarouselContainer1").hide().empty();if(numBackgrounds==1){if(sd.Global.collabData.bestcase0==""){$(".call-to-action").hide();}
$(".mc-backround").css('background-image','url(images/mccann/background/'+sd.Global.collabData.background0+')');if(globalSection=='mccann'){$("#mc-back").css("display","flex");}}
else{$('.call-to-action').hide();var positions=["main","topright","bottomright"];htmlOut="";for(var i=0;i<numBackgrounds;i++){htmlOut+="<div class=\"multi-back flex flex-1 flex-column "+positions[i]+"\" id=\"background"+i+"\"></div>";}
$("#mc-back").html(htmlOut);for(var j=0;j<numBackgrounds;j++){if(itemLinks[j]=="")
$("#background"+j).html("<img style=\"height:100%; width:100%;\" src=\"images/mccann/background/"+backgrounds[j]+"\"></img>");else
$("#background"+j).html("<a href=\""+itemLinks[j]+"\" target=\"blank\"><img style=\"height:100%; width:100%;\" src=\"images/mccann/background/"+backgrounds[j]+"\"></img></a>");}
if(globalSection=='mccann')$("#mc-back").css("display","flex");}}
$("#mc-back").unbind("click");var siteUrl="^"+window.location.protocol+"\/\/";siteUrl+=window.location.host+"*";var regex=new RegExp(siteUrl);if(numBackgrounds>1){var b=0;for(b=0;b<bestcases.length;b++){var bcText=bestcases[b];var bcLink=itemLinks[b];if(bcLink.match(regex)){$('#action-link-multi'+b).html("<a href='"+bcLink+"'  target=\"blank\">"+bcText+"</a>");$(".jsCarouselContainer .js_car"+b+" a").attr("href",bcLink);var sURLVariables=bcLink.split('?')[1].split('&');var inode;for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split('=');if(sParameterName[0]=="inode"){inode=sParameterName[1];}}
if(inode||inode>0){var obj={};obj.inode=inode;obj.logView=false;var sc=new sd.ServerCall("GetLibraryItem",0);sc.data(obj);sc.go({onSuccess:function(myData,status){var link=sd.Configuration.ws.replace("ws","index.aspx?inode="+myData[0].i);$("#action-link-multi-name"+itemLinks.indexOf(link)).html(myData[0].pn+":: ");$(".jsCarouselContainer .js_car"+itemLinks.indexOf(link)+" .js_carCap a").text(myData[0].pn+":: "+bestcases[itemLinks.indexOf(link)]);if(itemLinks.indexOf(link)==0)
$('#action-link-multi0').width($('.call-to-action-main').width()-$('#action-link-multi-name0').width()-12);},onError:mccann.handleError});}
else{var htmlOut="<span class=\"call-to-action-text \"></span> <span class=\"brand-color one-link-title\"><a href="+bcLink+"> "+bcText+"</a></span>";$('#action-link-multi'+b).html(htmlOut);$(".jsCarouselContainer .js_car"+b+" a").attr("href",bcLink);}}
else{if(bcLink!="")
$('#action-link-multi'+b).html("<a href='"+bcLink+"' target=\"_blank\">"+bcText+"</a>");else
$('#action-link-multi'+b).html(bcText);$(".jsCarouselContainer .js_car"+b+" a").attr("href",bcLink);}
if($('#mc-back').css("display")!="none"&&item.homepageCarousel==false){for(i=0;i<bestcases.length;i++){if(bestcases[i]!="")$('#action-link-multi-name'+i).parent().show();}}}}
else{if(sd.Global.collabData.itemlink0==""){$('.call-to-action').hide();}
else if(sd.Global.collabData.itemlink0.match(regex)){var sURLVariables=sd.Global.collabData.itemlink0.split('?')[1].split('&');var inode;for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split('=');if(sParameterName[0]=="inode"){inode=sParameterName[1];}}
if(inode||inode>0){var obj={};obj.inode=inode;obj.logView=false;var sc=new sd.ServerCall("GetLibraryItem",0);sc.data(obj);sc.go({onSuccess:mccann.setBestCase,onError:mccann.handleError});}
else{var htmlOut="<span class=\"call-to-action-text \"></span> <span class=\"brand-color one-link-title\"><a href="+sd.Global.collabData.itemlink0+"  target=\"blank\"> "+sd.Global.collabData.bestcase0+"</a></span>";$('.action-link').html(htmlOut);$(".jsCarouselContainer .js_car0 a").attr("href",sd.Global.collabData.itemlink0);if($('#mc-back').css("display")!="none"&&item.homepageCarousel==false&&sd.Global.collabData.bestcase0!="")
$('.call-to-action').show();}}
else{var htmlOut="";if(sd.Global.collabData.itemlink0!="")
htmlOut="<span class=\"call-to-action-text \"></span> <span class=\"brand-color one-link-title\"><a href="+sd.Global.collabData.itemlink0+" target=\"_blank\"> "+sd.Global.collabData.bestcase0+"</a></span>";else
htmlOut="<span class=\"call-to-action-text \"></span> <span class=\"brand-color one-link-title\"> "+sd.Global.collabData.bestcase0+"</span>";$('.action-link').html(htmlOut);$(".jsCarouselContainer .js_car0 a").attr("href",sd.Global.collabData.itemlink0);if($('#mc-back').css("display")!="none"&&item.homepageCarousel==false&&sd.Global.collabData.bestcase0!="")
$('.call-to-action').show();}
if(sd.Global.collabData.itemlink0!=""){$("#mc-back").bind("click",function(){window.open(sd.Global.collabData.itemlink0);});}}
if(item.displayIFrame==true){$("#homeIFrame").show();$(".modal-overlay-iframe").show();$(".close-iframe").show();$(".close-iframe").unbind("click");$(".close-iframe").bind("click",function(){$("#homeIFrame").hide();$(".modal-overlay-iframe").hide();$(".close-iframe").hide();});$("#homeIFrame .iFrameContainer").html(item.iFrameEmbed);}
var html="No Links Set";if(sd.Global.collabData.quickLinks!=null){html="";var links=JSON.parse(sd.Global.collabData.quickLinks);for(i=0;i<links.length;i++){if(i==0){html+="<div class=\"flex flex-1 flex-column\">";}
if(i%4==0&&i>0){html+="</div><div class=\"flex flex-1 flex-column\">";}
var link=links[i];html+="<a  href =  '"+link.url+"' target=_blank>"+link.title+'</a>';}}
$("#footer .js-qlinks").empty().html(html);$('#footer').append("<a id=\"footerReady\"></a>");}
mccann.quicksearch=function(){$("#quickSearchDropDown").hide();$('#headerSearchFieldInput').keyup(function(){var phrase=$('#headerSearchFieldInput').val();var sectionFilter={};if(phrase.length<3){$("#quickSearchDropDown").hide();}
else{runSearch.quickSearchCount++;if($("#dvSearch").is(':visible')==false){$(".titleResults span").html("\""+phrase+"\"");var obj={};obj.searchString=phrase;obj.searchUsers=true;obj.descriptionLength=100;obj.searchEgnyte=false;obj.op="QuickSearch";obj.searchOrder="v.createdtime";obj.searchOrderDirection="DESC";obj.searchStartDate="";obj.searchEndDate="";obj.searchMetaData="";obj.metaOnlySearch=false;obj.searchTitleOnly=true;obj.searchContent=false;obj.searchLimitResults=0;obj.searchRootNode=0;obj.searchCategories="";obj.searchFormats="";obj.searchUsersOnly=false;obj.searchEgnyteOnly=false;var sc=new sd.ServerCall("RunSearch");sc.data({options:obj});sc.cbData({num:runSearch.quickSearchCount});sc.go({onSuccess:function(myData,status,cbData){if(runSearch.quickSearchCount!=cbData.num){return;}
var results=new sd.Search({onSuccess:runSearch.handleQuickSearch});results.handleSearchResults(myData);},onError:runSearch.handleQuickSearchError});}
$(".js-mccann-main-search").unbind("click").bind("click",function(){header.simpleSearch();$("#quickSearchDropDown").hide();});}});}
window.mccann=mccann;}(window));﻿(function(window){var metaAttributes={};metaAttributes.currentSortDirection="";metaAttributes.currentSortBy="";metaAttributes.currentList=[];metaAttributes.types=[];metaAttributes.init=function(){metaAttributes.currentSortDirection="ASC";metaAttributes.currentSortBy="name";metaAttributes.currentList=[];metaAttributes.types=[];$('#dvMetaTitle').html("Manage Tags / Communication Source");var sc=new sd.ServerCall("ListMetaAttributeTypes");sc.go({onSuccess:metaAttributes.handleAttributeTypes,onError:metaAttributes.handleError});$('#metaAdminAddType_btn').show();$('#metaAdminAddAttribute_btn').hide();$('.icon-bg').hide();$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleName').click(function(){metaAttributes.displayTypesList("name")});$('#sectionContainer .sectionTitleDisabled').click(function(){metaAttributes.displayTypesList("disabled")});$('#metaFilterText').on('input',function(){metaAttributes.displayTypesList(metaAttributes.currentSortBy,metaAttributes.currentSortDirection);});$('#csMetaTagChk').unbind("change");$('#csMetaTagChk').bind("change",function(){metaAttributes.refreshTypeList();});metaAttributes.addEventListeners();}
metaAttributes.loadAttributes=function(){metaAttributes.currentSortDirection="ASC";metaAttributes.currentSortBy="name";metaAttributes.currentList=[];metaAttributes.types=[];var sc=new sd.ServerCall("ListMetaAttributes");var obj={};obj.types=$('#dvMetaID').val();obj.returnAll=true;obj.userAttr=false;sc.data(obj);sc.go({onSuccess:metaAttributes.handleList,onError:metaAttributes.handleError});$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleName').click(function(){metaAttributes.displayList("name")});$('#sectionContainer .sectionTitleDisabled').click(function(){metaAttributes.displayList("disabled")});$('#metaFilterText').on('input',function(){metaAttributes.displayList(metaAttributes.currentSortBy,metaAttributes.currentSortDirection);});$('#csMetaTagChk').unbind("change");$('#csMetaTagChk').bind("change",function(){metaAttributes.displayList();});metaAttributes.addEventListeners();}
metaAttributes.listItems=function(type){$("#loader").show();$("#dvMetaList").empty();var sc=new sd.ServerCall("ListMetaAttributes");var obj={};obj.types=type;obj.returnAll=true;obj.userAttr=false;sc.data(obj);sc.go({onSuccess:metaAttributes.handleList,onError:metaAttributes.handleError});}
metaAttributes.handleList=function(myData,status){$("#loader").hide();metaAttributes.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.id=myData[idx].i;item.name=myData[idx].v;item.type=myData[idx].t;item.csid=myData[idx].c;item.disabled=myData[idx].d;metaAttributes.currentList.push(item);}
metaAttributes.displayList(metaAttributes.currentSortBy,metaAttributes.currentSortDirection);}
metaAttributes.displayList=function(sortBy,sortDirection){if(metaAttributes.currentSortBy=="name")sd.Utils.sortArrayByString(metaAttributes.currentList,"name");if(metaAttributes.currentSortBy=="disabled")sd.Utils.sortArrayByString(metaAttributes.currentList,"disabled");if(metaAttributes.currentSortBy==sortBy){if(sortDirection!=groups.currentSortDirection){if(metaAttributes.currentSortDirection=="ASC")metaAttributes.currentSortDirection="DESC";else metaAttributes.currentSortDirection="ASC";}}
else{metaAttributes.currentSortBy=sortBy;metaAttributes.currentSortDirection=sortDirection||"ASC";if(metaAttributes.currentSortBy=="name")sd.Utils.sortArrayByString(metaAttributes.currentList,"name");if(metaAttributes.currentSortBy=="disabled")sd.Utils.sortArrayByString(metaAttributes.currentList,"disabled");}
$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(metaAttributes.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(metaAttributes.currentSortBy=="name")$('#sectionContainer .sectionTitleName > .'+sortArrow).show();if(metaAttributes.currentSortBy=="disabled")$('#sectionContainer .sectionTitleDisabled > .'+sortArrow).show();var htmlOut="";var listCount=metaAttributes.currentList.length;var filterText=$('#metaFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=metaAttributes.currentList[idx];if(metaAttributes.currentSortDirection=="DESC")item=metaAttributes.currentList[listCount-(idx+1)];if(filterText!=""&&item.name.toLowerCase().indexOf(filterText)<0)continue;if(item.disabled=="True"&&$('#csMetaTagChk').is(':checked')==false)continue;htmlOut+="<div class='row grid' data-metaname='"+item.name+"' data-metaid='"+item.id+"' data-metacsid='"+item.csid+"' data-metadisabled='"+item.disabled+"'>   \
                            <div class='yui3-u-2-5'><div class='section-list-field pa-l-1 brand-text'>"+item.name+"</div></div> \
                            <div class='yui3-u-1-5'><div class='section-list-field'>"+item.disabled+"</div></div> \
                            <div class='yui3-u-2-5'><div class='section-list-field'> \
                            <button class=\"small-rnd brand ma-r-half admin-edit-btn\"><i class=\"icon-edit\"></i></button></div></div> \
                        </div>";}
$('#dvMetaList').html(htmlOut);$(".admin-edit-btn").click(function(){var id=$(this).parent().parent().parent().data('metaid');var name=$(this).parent().parent().parent().data('metaname');var csid=$(this).parent().parent().parent().data('metacsid');var disabled=$(this).parent().parent().parent().data('metadisabled');metaAttributes.editMeta({id:id,name:name,csid:csid,disabled:disabled});});}
metaAttributes.displayTypesList=function(sortBy,sortDirection){if(metaAttributes.currentSortBy=="label")sd.Utils.sortArrayByString(metaAttributes.types,"label");if(metaAttributes.currentSortBy=="disabled")sd.Utils.sortArrayByString(metaAttributes.types,"disabled");if(metaAttributes.currentSortBy==sortBy){if(sortDirection!=metaAttributes.currentSortDirection){if(metaAttributes.currentSortDirection=="ASC")metaAttributes.currentSortDirection="DESC";else metaAttributes.currentSortDirection="ASC";}}
else{metaAttributes.currentSortBy=sortBy;metaAttributes.currentSortDirection=sortDirection||"ASC";if(metaAttributes.currentSortBy=="name")sd.Utils.sortArrayByString(metaAttributes.types,"label");if(metaAttributes.currentSortBy=="disabled")sd.Utils.sortArrayByString(metaAttributes.types,"disabled");}
$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(metaAttributes.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(metaAttributes.currentSortBy=="label")$('#sectionContainer .sectionTitleName > .'+sortArrow).show();if(metaAttributes.currentSortBy=="disabled")$('#sectionContainer .sectionTitleDisabled > .'+sortArrow).show();var htmlOut="";var listCount=metaAttributes.types.length;var filterText=$('#metaFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=metaAttributes.types[idx];if(metaAttributes.currentSortDirection=="DESC")item=metaAttributes.types[listCount-(idx+1)];if(filterText!=""&&item.label.toLowerCase().indexOf(filterText)<0)continue;if(item.disabled&&$('#csMetaTagChk').is(':checked')==false)continue;htmlOut+="<div class='row grid' data-metatype='"+item.type+"' data-metaname='"+item.label+"' data-metaid='"+item.id+"' data-metacsid='"+item.csid+"' data-metadisabled='"+item.disabled+"'>   \
                            <div class='yui3-u-2-5'><div class='section-list-field pa-l-1 brand-text'>"+item.label+"</div></div> \
                            <div class='yui3-u-1-5'><div class='section-list-field'>"+item.disabled+"</div></div> \
                            <div class='yui3-u-2-5'><div class='section-list-field'> \
                            <button class=\"admin-edit-btn small-rnd brand ma-r-half\" title='Edit'><i class=\"icon-edit\"></i></button> \
                            <button class=\"small-rnd brand ma-r-half admin-editAttribute-btn\" title='Edit Attribute'><i class=\"icon-plus\"></i></button></div></div> \
                        </div>";}
$('#dvMetaList').html(htmlOut);$(".admin-edit-btn").click(function(){var id=$(this).parent().parent().parent().data('metaid');var label=$(this).parent().parent().parent().data('metaname');var csid=$(this).parent().parent().parent().data('metacsid');var disabled=$(this).parent().parent().parent().data('metadisabled');metaAttributes.editMetaType({id:id,name:label,csid:csid,disabled:disabled});});$(".admin-editAttribute-btn").click(function(){var label=$(this).parent().parent().parent().data('metaname');var id=$(this).parent().parent().parent().data('metaid');var type=$(this).parent().parent().parent().data('metatype');$('#dvMetaTitle').html('Manage Tags / '+label);$('.icon-bg').show();$('#metaAdminAddType_btn').hide();$('#metaAdminAddAttribute_btn').show();$('#dvMetaID').val(id);$('#dvMetaType').val(type);$('.icon-bg').unbind("click");$('.icon-bg').bind("click",function(){metaAttributes.init();});metaAttributes.loadAttributes();});}
metaAttributes.editMeta=function(objMeta){sd.component.messageBox.action({title:"Edit Meta Attribute",height:220,width:400,loadCallback:function(){$("#metaDialogID").val(objMeta.id);$("#metaDialogName").val(objMeta.name);if(objMeta.disabled=="True")
$("input[name=chkDisabled]").prop("checked",true);else
$("input[name=chkDisabled]").prop("checked",false);},template:sd.Configuration.templates.metaAttributeDetails,btn1callback:$.proxy(this.metaSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
metaAttributes.editMetaType=function(objMeta){sd.component.messageBox.action({title:"Edit Meta Tag",height:220,width:400,loadCallback:function(){$("#metaDialogID").val(objMeta.id);$("#metaDialogName").val(objMeta.name);if(objMeta.disabled)
$("input[name=chkDisabled]").prop("checked",true);else
$("input[name=chkDisabled]").prop("checked",false);},template:sd.Configuration.templates.metaAttributeDetails,btn1callback:$.proxy(this.metaTypeSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
metaAttributes.showDetailsDialog=function(error){sd.component.messageBox.action({title:"Create Meta Attribute",height:220,width:400,template:sd.Configuration.templates.metaAttributeDetails,btn1callback:$.proxy(this.metaSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
metaAttributes.addTypeDialog=function(error){sd.component.messageBox.action({title:"Create Attribute",height:220,width:400,template:sd.Configuration.templates.metaAttributeDetails,btn1callback:$.proxy(this.metaTypeSave,this),icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
metaAttributes.metaSave=function(error){if($("#metaDialogName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}
else if($("#metaDialogName").val().length>50){sd.component.messageBox.showError("Name is too long, 50 character max.");return;}
else{var action="AddMetaAttribute";var obj={};obj.value=$("#metaDialogName").val();obj.typeID=$('#dvMetaID').val();obj.type=$('#dvMetaType').val();if($("input[name=chkDisabled]").prop("checked")==true){obj.disabled=1;}else{obj.disabled=0}
if($("#metaDialogID").val()!=""){action="EditMetaAttribute";obj.id=$("#metaDialogID").val();}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:metaAttributes.refreshList,onError:metaAttributes.handleError});}}
metaAttributes.metaTypeSave=function(error){if($("#metaDialogName").val()==""){sd.component.messageBox.showError("Name is a required field.");return;}
else if($("#metaDialogName").val().length>100){sd.component.messageBox.showError("Name is too long, 100 character max.");return;}
else if($("#metaDialogName").val().replace(/\W+/g,'').length==0){sd.component.messageBox.showError("Tag must contain alphanumeric characters.")}
else{var action="AddMetaType";var obj={};obj.label=$("#metaDialogName").val();obj.type=obj.label.toLowerCase().replace(/\W+/g,'');if($("input[name=chkDisabled]").prop("checked")==true){obj.disabled=1;}else{obj.disabled=0}
if($("#metaDialogID").val()!=""){action="EditMetaType";obj.id=$("#metaDialogID").val();}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:metaAttributes.refreshTypeList,onError:metaAttributes.handleError});}}
metaAttributes.refreshList=function(){sd.component.messageBox.close();var sc=new sd.ServerCall("ListMetaAttributes");var obj={};obj.types=$('#dvMetaID').val();obj.returnAll=true;obj.userAttr=false;sc.data(obj);sc.go({onSuccess:metaAttributes.handleList,onError:metaAttributes.handleError});}
metaAttributes.refreshTypeList=function(){sd.component.messageBox.close();var sc=new sd.ServerCall("ListMetaAttributeTypes");sc.go({onSuccess:metaAttributes.handleAttributeTypes,onError:metaAttributes.handleError});}
metaAttributes.handleAttributeTypes=function(myData,status){$("#loader").hide();metaAttributes.types=[];for(var idx=0;idx<myData.length;idx++){metaAttributes.types.push(myData[idx]);}
metaAttributes.displayTypesList(metaAttributes.currentSortBy,metaAttributes.currentSortDirection);}
metaAttributes.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:220,width:400,text:error,btn1:"Ok"});}
metaAttributes.handleSaveError=function(error){sd.component.messageBox.showError(error);}
metaAttributes.addEventListeners=function(){$("#metaAdminAddType_btn").bind("click",function(){metaAttributes.addTypeDialog();});$("#metaAdminAddAttribute_btn").bind("click",function(){metaAttributes.showDetailsDialog();});$(".admin-close-btn").unbind("click");$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});}
window.metaAttributes=metaAttributes;}(window));﻿(function(window){var metrics={};metrics.add=function(options){metrics.options=options||{};metrics.options.onSuccess=metrics.options.onSuccess||function(){};var obj={};obj.metric=options.metric;var sc=new sd.ServerCall("LogMetric");sc.data(obj);sc.go({onSuccess:metrics.options.onSuccess,onError:metrics.handleError});}
metrics.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.metrics=metrics;}(window));﻿(function(window){var myDashboard={};myDashboard.dashboardItems=[];myDashboard.megamenudetailsloaded=false
myDashboard.projectSections=[];myDashboard.numberOfWidgets;myDashboard.socialMedia=false;myDashboard.widgetCounter;myDashboard.allowLoad=true;myDashboard.lastlogin=new Date();myDashboard.selectedItem=null;myDashboard.init=function(fromchannels,channelSection){$("#loader").show();mccann.refreshCollabData();$(".nav-top-level").removeClass("brand-current");trainingOverlays.getUserOverlay();announcements.init();myDashboard.allowLoad=false;myDashboard.lastlogin=new Date();myDashboard.numberOfWidgets=0;myDashboard.socialMedia=false;myDashboard.widgetCounter=0;myDashboard.dashboardItems=[];myDashboard.projectSections=[];for(var i=0;i<sd.Configuration.sections.length;i++){if(sd.Configuration.sections[i].fnode>0){myDashboard.projectSections.push(sd.Configuration.sections[i].label);}}
$('#loader').css('display','flex');$("#addnew_btn").hide();if(sd.Session.user.superAdmin||admin.adminUser()){$("#addnew_btn").show();}
myDashboard.getDashboardLayout();$("html").css("overflow","auto");if(fromchannels){$('#myDashboard .jsDashboardSwitch').show();$('#myDashboard .jsChannelButton').unbind('click');$('#myDashboard .jsChannelButton').bind('click',function(){master.loadSection(channelSection);});}
else{$('#myDashboard .jsDashboardSwitch').hide();}
$(document).on('click',function(e){if(!$(e.target).closest('#quickSearchDropDown').length){$('#quickSearchDropDown').hide();}});header.restAll();}
myDashboard.addEventListeners=function(type){$("#myDashboard ."+type+" .widgetPrevBtn").click(function(e){e.preventDefault();e.stopPropagation();$("#myDashboard ."+type+" .widgetNextBtn").prop("disabled",false);$("#myDashboard ."+type+" .widgetLastBtn").prop("disabled",false);var pageNo=parseInt($("#myDashboard ."+type+" .currentPage").html());pageNo--;$("#myDashboard ."+type+" .currentPage").html(pageNo);for(i=0;i<myDashboard.dashboardItems.length;i++){if(myDashboard.dashboardItems[i].type.indexOf(type)>=0){if(myDashboard.dashboardItems[i].endItem==myDashboard.dashboardItems[i].itemList.length){if((myDashboard.dashboardItems[i].itemList.length%sd.Configuration.widgetResultLimit)>0){myDashboard.dashboardItems[i].endItem=myDashboard.dashboardItems[i].endItem-(myDashboard.dashboardItems[i].itemList.length%sd.Configuration.widgetResultLimit);}
else{myDashboard.dashboardItems[i].endItem=myDashboard.dashboardItems[i].endItem-sd.Configuration.widgetResultLimit;}
myDashboard.dashboardItems[i].startItem=myDashboard.dashboardItems[i].endItem-sd.Configuration.widgetResultLimit;myDashboard.dashboardItems[i].reDisplayList();}
else if(myDashboard.dashboardItems[i].startItem-sd.Configuration.widgetResultLimit<=0){$("#myDashboard ."+type+" .widgetPrevBtn").prop("disabled",true);$("#myDashboard ."+type+" .widgetFirstBtn").prop("disabled",true);myDashboard.dashboardItems[i].startItem=0;myDashboard.dashboardItems[i].endItem=sd.Configuration.widgetResultLimit;myDashboard.dashboardItems[i].reDisplayList();}
else{myDashboard.dashboardItems[i].startItem-=sd.Configuration.widgetResultLimit;myDashboard.dashboardItems[i].endItem-=sd.Configuration.widgetResultLimit;myDashboard.dashboardItems[i].reDisplayList();}}}
return false;});$("#myDashboard ."+type+" .widgetNextBtn").click(function(e){e.preventDefault();e.stopPropagation();$("#myDashboard ."+type+" .widgetPrevBtn").prop("disabled",false);$("#myDashboard ."+type+" .widgetFirstBtn").prop("disabled",false);var pageNo=parseInt($("#myDashboard ."+type+" .currentPage").html());pageNo++;$("#myDashboard ."+type+" .currentPage").html(pageNo);for(i=0;i<myDashboard.dashboardItems.length;i++){if(myDashboard.dashboardItems[i].type.indexOf(type)>=0){var lastItem=myDashboard.dashboardItems[i].endItem+sd.Configuration.widgetResultLimit;if(lastItem>=myDashboard.dashboardItems[i].itemList.length){$("#myDashboard ."+type+" .widgetNextBtn").prop("disabled",true);$("#myDashboard ."+type+" .widgetLastBtn").prop("disabled",true);myDashboard.dashboardItems[i].endItem=myDashboard.dashboardItems[i].itemList.length;if((myDashboard.dashboardItems[i].itemList.length%sd.Configuration.widgetResultLimit)>0){myDashboard.dashboardItems[i].startItem=myDashboard.dashboardItems[i].endItem-(myDashboard.dashboardItems[i].itemList.length%sd.Configuration.widgetResultLimit);}
else{myDashboard.dashboardItems[i].startItem=myDashboard.dashboardItems[i].endItem-sd.Configuration.widgetResultLimit;}
myDashboard.dashboardItems[i].reDisplayList();}
else{myDashboard.dashboardItems[i].startItem+=sd.Configuration.widgetResultLimit;myDashboard.dashboardItems[i].endItem+=sd.Configuration.widgetResultLimit;myDashboard.dashboardItems[i].reDisplayList();}}}
return false;});$("#myDashboard ."+type+" .widgetFirstBtn").click(function(){$("#myDashboard ."+type+" .widgetPrevBtn").prop("disabled",true);$("#myDashboard ."+type+" .widgetFirstBtn").prop("disabled",true);$("#myDashboard ."+type+" .widgetNextBtn").prop("disabled",false);$("#myDashboard ."+type+" .widgetLastBtn").prop("disabled",false);$("#myDashboard ."+type+" .currentPage").html("1");for(i=0;i<myDashboard.dashboardItems.length;i++){if(myDashboard.dashboardItems[i].type.indexOf(type)>=0){myDashboard.dashboardItems[i].startItem=0;myDashboard.dashboardItems[i].endItem=sd.Configuration.widgetResultLimit;myDashboard.dashboardItems[i].reDisplayList();}}});$("#myDashboard ."+type+" .widgetLastBtn").click(function(){$("#myDashboard ."+type+" .widgetLastBtn").prop("disabled",true);$("#myDashboard ."+type+" .widgetNextBtn").prop("disabled",true);$("#myDashboard ."+type+" .widgetPrevBtn").prop("disabled",false);$("#myDashboard ."+type+" .widgetFirstBtn").prop("disabled",false);for(i=0;i<myDashboard.dashboardItems.length;i++){if(myDashboard.dashboardItems[i].type.indexOf(type)>=0){$("#myDashboard ."+type+" .currentPage").html(Math.ceil(myDashboard.dashboardItems[i].itemList.length/sd.Configuration.widgetResultLimit));myDashboard.dashboardItems[i].endItem=myDashboard.dashboardItems[i].itemList.length;if((myDashboard.dashboardItems[i].itemList.length%sd.Configuration.widgetResultLimit)>0){myDashboard.dashboardItems[i].startItem=myDashboard.dashboardItems[i].endItem-(myDashboard.dashboardItems[i].itemList.length%sd.Configuration.widgetResultLimit);}
else{myDashboard.dashboardItems[i].startItem=myDashboard.dashboardItems[i].endItem-sd.Configuration.widgetResultLimit;}
myDashboard.dashboardItems[i].reDisplayList();}}});$("#myDashboard ."+type+" .admin-edit-btn").click(function(e){e.preventDefault();e.stopPropagation();var id=$(this).parents().find('.widgetContent').attr("data-id");var type=$(this).parents().find('.widgetBody div').attr("class");var title=$(this).parents().find(".myDashboardTitle")[0].innerHTML;var inode=$(this).parents().find('#featuredContent_btn').attr("data-id")
myDashboard.editModule(title,type,id,inode);return false;});$("#myDashboard ."+type+" .guide-row .listHeaderClick").click(function(){var obj={};var type=$(this).closest(".guide-row").data('type');obj.link=$(this).closest(".guide-row").data('link');switch(type){case"social":obj.type=$(this).closest(".featuredContent_btn").data('section');break;case"bestcase":obj.type="library";obj.ParentID=$(this).closest(".guide-row").data('id');obj.f_node=$(this).closest(".guide-row").data('id');obj.i_node=$(this).closest(".guide-row").data('id');obj.template=$(this).closest(".guide-row").data('type');break;case"Document":obj.type="library";obj.ParentID=$(this).closest(".guide-row").data('id');obj.f_node=$(this).closest(".guide-row").data('id');obj.i_node=$(this).closest(".guide-row").data('id');obj.template=$(this).closest(".guide-row").data('type');break;case"article":obj.type=$(this).closest(".guide-row").data('type');obj.standalone=true;break;case"userProfile":team.fromSearch=true;obj.type=$(this).closest(".guide-row").data('type');obj.userID=$(this).closest(".guide-row").data('id');break;case"Link":window.open(obj.link,'_blank');}
LoadSection(obj.type,true,obj);});if(type.indexOf("myRecentlyAdded")>=0){myDashboard.socialMedia=true;}}
myDashboard.addNewModule=function(){sd.component.messageBox.action({title:"Add New Module",width:"500",height:"480",loadCallback:function(){$('#menuTemplatesList').append("<option value='social'>'Social Media'</option>");$('#menuTemplatesList').append("<option value='article'>'Article'</option>");$('#menuTemplatesList').append("<option value='bestcase'>'Best Case'</option>");$('#menuTemplatesList').append("<option value='folder'>'Folder'</option>");$('#menuTemplatesList').append("<option value='team'>'Team'</option>");$("#menuTemplatesList").unbind("change");$("#menuTemplatesList").change(function(e){var option=$(this).find('option:selected').val();if(option!="social"){$("#dvDashboardForm .location").empty();var obj={};obj.inode=sd.Configuration.libraryInode;obj.limit=100;obj.level=15;var sc=new sd.ServerCall("FolderTraverseDashboard");sc.data(obj);sc.go({onSuccess:myDashboard.handleLocationItems,onError:myDashboard.handleError});$('#dvDashboardForm .dashboardLocation').show();}
else{$('#dvDashboardForm .dashboardLocation').hide();}});},template:sd.Configuration.templates.dashboardDetails,btn1callback:$.proxy(myDashboard.saveNewModule,this),btn1:"Save",});}
myDashboard.editModule=function(title,type,id,inode){sd.component.messageBox.action({title:"Edit Module",width:"500",height:"480",loadCallback:function(){$('#dashboardID').val(id);$('#dashboardType').val(type);$('#dashboardTitle').val(title);if(type=="myRecentlyAdded"){$('#menuTemplatesList').append("<option selected=selected value='social'>'Social Media'</option>");$('#dvDashboardForm .dashboardLocation').hide();}else{myDashboard.locationChange(inode);$('#dvDashboardForm .dashboardLocation').show();if(myDashboard.socialMedia){$('#menuTemplatesList').append("<option value='social'>'Social Media'</option>");}}
if(type.indexOf("myBestCases")>=0){$('#menuTemplatesList').append("<option selected=selected value='bestcase'>'Best Case'</option>");}else{$('#menuTemplatesList').append("<option value='bestcase'>'Best Case'</option>");}
if(type.indexOf("myBestFolders")>=0){$('#menuTemplatesList').append("<option selected=selected value='folder'>'Folder'</option>");}else{$('#menuTemplatesList').append("<option value='folder'>'Folder'</option>");}
if(type.indexOf("myBestTeam")>=0){$('#menuTemplatesList').append("<option selected=selected value='team'>'Team'</option>");}else{$('#menuTemplatesList').append("<option value='team'>'Team'</option>");}
if(type.indexOf("myBestArticle")>=0){$('#menuTemplatesList').append("<option selected=selected value='article'>'Article'</option>");}else{$('#menuTemplatesList').append("<option value='article'>'Article'</option>");}
$(".messageBoxBtn2").click(function(){myDashboard.deleteModule(id);});$("#menuTemplatesList").unbind("change");$("#menuTemplatesList").change(function(e){var option=$(this).find('option:selected').val();if(option!="social"){var obj={};obj.inode=sd.Configuration.libraryInode;obj.limit=100;obj.level=15;var sc=new sd.ServerCall("FolderTraverseDashboard");sc.data(obj);sc.go({onSuccess:myDashboard.handleLocationItems,onError:myDashboard.handleError});$("#dvDashboardForm .location").empty();$("#dvDashboardForm .fg-menu-container").empty();$('#dvDashboardForm .dashboardLocation').show();}
else{$('#dvDashboardForm .dashboardLocation').hide();}});$("#menuTemplatesList").trigger("change");},template:sd.Configuration.templates.dashboardDetails,btn1callback:$.proxy(myDashboard.saveNewModule,this),btn1:"Save",btn2:"Delete",btn2close:false});}
myDashboard.locationChange=function(folderID){var obj={};obj.inode=folderID;var sc=new sd.ServerCall("GetFolderDetails",0);sc.data(obj);sc.go({onSuccess:myDashboard.updateLocationIndicator});$("#lblNoLocation").hide();}
myDashboard.updateLocationIndicator=function(myData,status){var item=myData[0];var html="";html+="<li id=\"liLocation"+item.i_node+"\" class=\"liLocation ma-tb-1\"><a class='folder-location--remove' onclick = \"bestCase.removeLocation("+item.i_node+");\"><i id=\"icon-remove\" class=\"icon-remove\" title=\"Remove This Location\"></i></a><label class = \"ddLbl dd-lbl\">"+item.FullPath+item.item+"</label></li>";$("#ulFolderLocations").html(html);}
myDashboard.handleLocationItems=function(myData,status){var item;var data=[];for(var i=0;i<myData.length;i++){item=myData[i];if(item.a==3)
data.push(item);}
myDashboard.appendMenu($(".location"),data,0);$('#locationDD').fgmenu({content:$('#locationDD').next().html(),backLink:false,label:$('#locationLbl').attr('id'),value:$('#hdnLocationID').attr('id'),width:438});}
myDashboard.appendMenu=function(parent,menu,level){for(var i=0;i<menu.length;i++){var submenu=parent.append('<li><a data-template="bestcase" id="'+menu[i].i+'" href="#" >'+menu[i].im+'</a></li>').find("li:last");if(menu[i].menu!=undefined&&menu[i].menu.length>0){submenu=submenu.append('<ul></ul>').find("ul");myDashboard.appendMenu(submenu,menu[i].menu,level+1);}}}
myDashboard.saveNewModule=function(error){if($("#dashboardTitle").val()==""){sd.component.messageBox.showError("Title is a required field.");return;}
else if($("#menuTemplatesList").val()=="social"&&myDashboard.socialMedia&&$("#dashboardType").val()!="myRecentlyAdded"){sd.component.messageBox.showError("Social Media dashboard has been added before.");return;}
else if($('#dvDashboardForm .dashboardLocation').is(":visible")&&($("#ulFolderLocations").html()=="")){sd.component.messageBox.showError("Location is a required field.");return;}else{var obj={};var type=$("#menuTemplatesList").find('option:selected').val();obj.label=$("#dashboardTitle").val();if($('#messageBox').find('h6').text().indexOf("Edit")>-1){action="EditDashboardItem";obj.layoutID=$("#dashboardID").val();}else{action="AddDashboardItem";obj.layoutID=sd.Configuration.csid;obj.section="middleRight";if(type=="social"){obj.width=8;}else{obj.width=3;}}
switch(type)
{case"social":obj.data=sd.Configuration.libraryInode;obj.type="myRecentlyAdded";break;case"bestcase":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestCases";break;case"folder":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestFolders";break;case"article":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestArticle";break;case"artist":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestArtist";break;case"boxEmbed":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestBoxEmbed";break;case"client":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestClient";break;case"dreamteam":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestDreamTeam";break;case"egnyteEmbed":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestEgnyteEmbed";break;case"expert":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestExpert";break;case"map":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestMap";break;case"newsletter":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestNewsletter";break;case"team":obj.data="{\"inode\":"+$("#ulFolderLocations").find("li")[0].id.replace('liLocation','')+"}";obj.type="myBestTeam";break;}
var sc=new sd.ServerCall(action);sc.data(obj);sc.go({onSuccess:myDashboard.handleHomepageUpdate,onError:myDashboard.handleError});}}
myDashboard.deleteModule=function(dashboardItemID){myDashboard.selectedItem=dashboardItemID;sd.component.messageBox.action({title:"Delete Module",text:"Are you sure you want to delete this module?",height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:myDashboard.deleteConfirmed,icon2:"icon-ban-circle",btn2:"No",TxtFields:null,template:null,});}
myDashboard.deleteConfirmed=function(){var sc=new sd.ServerCall("DeleteDashboardItem");var obj={};obj.itemID=myDashboard.selectedItem;sc.data(obj);sc.go({onSuccess:myDashboard.handleHomepageUpdate,onError:myDashboard.handleError});}
myDashboard.handleHomepageUpdate=function(myData,status){sd.component.messageBox.close();LoadSection("mccann",true);}
myDashboard.getDashboardLayout=function(){var sc=new sd.ServerCall("GetDashboardLayout");sc.data({layoutID:sd.Configuration.csid});sc.go({onSuccess:myDashboard.handleDashLayout,onError:myDashboard.handleError});}
myDashboard.handleDashLayout=function(myData,status){myDashboard.timeFrames=myData[0].timeframes;setTimeout(function(){$("#loader").hide();},3000);$(".slider-visibility").click(function(){$(".topSection").toggle();if($(this).hasClass("hide")){$(this).removeClass("hide");$(this).addClass("show");}else{$(this).removeClass("show");$(this).addClass("hide");}});$("#myDashboard").foundation();if(myData[0].topSection!=""){$('.topSection').addClass(myData[0].topSection);if(myData[0].topSection!="tab"){$(".topSection").find(".section-container").hide();}
$('.topSection').show();}
if(myData[0].bottomSection!=""){$('.bottomSection').addClass(myData[0].bottomSection);if(myData[0].bottomSection!="tab"){$(".bottomSection").find(".section-container").hide();}
$('.bottomSection').show();}
if(myData[0].middleLeftSection!=""){if(myData[0].middleRightSection!=""){$('.leftSection').find(".columns").removeClass("large-12").addClass("large-6");}
$('.leftSection').addClass(myData[0].middleLeftSection);if(myData[0].middleLeftSection!="tab"){$(".leftSection").find(".section-container").hide();}
$('.leftSection').show();}
if(myData[0].middleRightSection!=""){if(myData[0].middleLeftSection!=""){$('.rightSection').find(".columns").removeClass("large-12").addClass("large-6");}
$('.rightSection').addClass(myData[0].middleRightSection);if(myData[0].middleRightSection!="tab"){$(".rightSection").find(".section-container").hide();}
$('.rightSection').show();}
myDashboard.getDashboardItems(myData[0].layoutID,myData[0]);}
myDashboard.getDashboardItems=function(layoutID,layout){var dashSections=[];if(layout.topSection!=null&&layout.topSection!=""){dashSections.push("top")}
if(layout.middleLeftSection!=null&&layout.middleLeftSection!=""){dashSections.push("middleLeft")}
if(layout.middleRightSection!=null&&layout.middleRightSection!=""){dashSections.push("middleRight");}
if(layout.bottomSection!=null&&layout.bottomSection!=""){dashSections.push("bottom");}
$("#addnew_btn").unbind("click");$("#addnew_btn").bind("click",function(){myDashboard.addNewModule();});var sc=new sd.ServerCall("GetDashboardItems");var obj={};obj.lid=layoutID;obj.dashSections=dashSections;sc.data(obj);sc.go({onSuccess:myDashboard.handleDashItems,onError:myDashboard.handleError});}
myDashboard.handleDashItems=function(myData,status){var objWidget={}
objWidget.autohide=false;objWidget.deleted=false;objWidget.layoutID=sd.Configuration.csid;objWidget.section="middleLeft";objWidget.sortIndex=1;objWidget.type="myQuickLinks"
objWidget.width=3;myData[0].widgets.push(objWidget);myDashboard.numberOfWidgets=myData[0].widgets.length;myDashboard.widgetCounter=0;topItems=[];leftItems=[];rightItems=[];bottomItems=[];myDashboard.lastlogin=myData[0].LastLogin[0].LastLogin;var widgets=myData[0].widgets;for(i=0;i<widgets.length;i++){if(widgets[i].section=="top"){topItems.push(widgets[i]);}
else if(widgets[i].section=="middleLeft"){if($(".rightSection").hasClass("tab")||$(".rightSection").hasClass("widget")||$(".rightSection").hasClass("homepage")){if(widgets[i].width>6){widgets[i].width=12;}
else if(widgets[i].width<=6){widgets[i].width=widgets[i].width*2;}}
leftItems.push(widgets[i]);}
else if(widgets[i].section=="middleRight"){if($(".leftSection").hasClass("tab")||$(".leftSection").hasClass("widget")||$(".leftSection").hasClass("homepage")){if(widgets[i].width>6){widgets[i].width=12;}
else if(widgets[i].width<=6){widgets[i].width=widgets[i].width*2;}}
rightItems.push(widgets[i]);}
else if(widgets[i].section=="bottom"){bottomItems.push(widgets[i]);}}
if(topItems.length>0){myDashboard.loadSection(".topSection",topItems);}
if(leftItems.length>0){myDashboard.loadSection(".leftSection",leftItems);}
if(rightItems.length>0){myDashboard.loadSection(".rightSection",rightItems);}
if(bottomItems.length>0){myDashboard.loadSection(".bottomSection",bottomItems);}
Foundation.libs.section.reflow();}
myDashboard.loadSection=function(sectionClass,sectionData){if($(sectionClass).hasClass("tab")){for(i=0;i<sectionData.length;i++){var dashItem=new sd.DashboardItem({container:sectionClass+" .section-container",itemClass:"#myDashboard .guide .dashboardTabSection",itemID:sectionData[i].itemID,label:sectionData[i].label,type:sectionData[i].type,data:sectionData[i].data,sortIndex:sectionData[i].sortIndex,width:sectionData[i].width,itemType:"tab",startItem:0,firstTime:true,projectSections:myDashboard.projectSections,callback:myDashboard.checkLoadComplete});if(sectionData.length<2){dashItem.container=sectionClass+" .homepage";dashItem.itemType="singleItem";dashItem.itemClass=sectionClass+" .homepage";}
myDashboard.dashboardItems.push(dashItem);dashItem.draw();}}
else if($(sectionClass).hasClass("widget")){for(i=0;i<sectionData.length;i++){var dashItem=new sd.DashboardItem({container:sectionClass+" .widgetRow",itemClass:"#myDashboard .guide .dashboardWidget",itemID:sectionData[i].itemID,label:sectionData[i].label,type:sectionData[i].type,data:sectionData[i].data,sortIndex:sectionData[i].sortIndex,width:sectionData[i].width,itemType:"widget",startItem:0,firstTime:true,projectSections:myDashboard.projectSections,callback:myDashboard.checkLoadComplete});myDashboard.dashboardItems.push(dashItem);dashItem.draw();}}
else if($(sectionClass).hasClass("homepage")){for(i=0;i<sectionData.length;i++){var dashItem=new sd.DashboardItem({container:sectionClass+" .homepage",itemClass:sectionClass,itemID:sectionData[i].itemID,label:sectionData[i].label,type:sectionData[i].type,data:sectionData[i].data,sortIndex:sectionData[i].sortIndex,width:sectionData[i].width,itemType:"homepage",startItem:0,firstTime:true,projectSections:myDashboard.projectSections,callback:myDashboard.checkLoadComplete});myDashboard.dashboardItems.push(dashItem);dashItem.draw();}}
for(i=0;i<sectionData.length;i++){if(sectionData[i].welcomeMessage!=""){if(sectionData[i].welcomeMessage=="top"){if(sd.Session.user.lastLogin==""){$(sectionClass+" .welcomeMessageTop").html("<div class='titleTop topBannerLeft'>Dashboard</div><div class='topBannerRight'><div data-id="+sd.Session.user.userID+" class='dashUserImage'></div><div class='welcomeText'><span>Welcome <label class='userNameClick' data-id="+sd.Session.user.userID+">"+sd.Session.user.FullName+"</label></span><span> this is your first login.</span></div></div>").show();}
else{$(sectionClass+" .welcomeMessageTop").html("<div class='titleTop topBannerLeft'>Dashboard</div><div class='topBannerRight'><div data-id="+sd.Session.user.userID+" class='dashUserImage'></div><div class='welcomeText'><span>Welcome back <label class='userNameClick' data-id="+sd.Session.user.userID+">"+sd.Session.user.FullName+"</label></span><span> your last login was on "+sd.Utils.formatDate(myDashboard.lastlogin,"dd M yy")+".</span></div></div>").show();}}
else if(sectionData[i].welcomeMessage=="bottom"){if(sd.Session.user.lastLogin==""){$(sectionClass+" .welcomeMessageTop").html("<div class='titleTop topBannerLeft'>Dashboard</div><div class='topBannerRight'><div data-id="+sd.Session.user.userID+" class='dashUserImage'></div><div data-id="+sd.Session.user.userID+" class='dashUserImage'></div><div class='welcomeText'><span>Welcome <label class='userNameClick' data-id="+sd.Session.user.userID+">"+sd.Session.user.FullName+"</label></span><span> this is your first login.</span></div></div>").show();}
else{$(sectionClass+" .welcomeMessageTop").html("<div class='titleTop topBannerLeft'>Dashboard</div><div class='topBannerRight'><div data-id="+sd.Session.user.userID+" class='dashUserImage'></div><div class='welcomeText'><span>Welcome back <label class='userNameClick' data-id="+sd.Session.user.userID+">"+sd.Session.user.FullName+"</label></span><span> your last login was on "+sd.Utils.formatDate(myDashboard.lastlogin,"dd M yy")+".</span></div></div>").show();}}
if(sd.Session.user.image!=null&&sd.Session.user.image>0){var image=sd.Configuration.vault+"/"+sd.Session.user.image+"/thumb.jpg";$(sectionClass).find(".dashUserImage").css("background","url("+image+") no-repeat");$(sectionClass).find(".dashUserImage").css("background-size","cover");}
else{var username=sd.Session.user.FullName.split(' ');var userInitials=username[0].substring(0,1).toUpperCase()+username[1].substring(0,1).toUpperCase();$(sectionClass).find(".dashUserImage").html('<span class="user-no-image scale-med" prefix="'+userInitials+'"></span>');$(".dashUserImage .user-no-image").attr("style",'background-color:'+sd.Session.user.colour+'');}
$(sectionClass+" .dashUserImage").click(function(){var id=$(this).data("id");profile.init({id:id});});$(sectionClass+" .userNameClick").click(function(){var id=$(this).data("id");profile.init({id:id});});}}}
myDashboard.checkLoadComplete=function(){myDashboard.widgetCounter++;if(myDashboard.widgetCounter>=myDashboard.numberOfWidgets){myDashboard.allowLoad=true;}}
myDashboard.handleAddMetric=function(myData,status,cbData){var obj=cbData.obj;LoadSection(obj.section,true,obj);};myDashboard.handleError=function(error){sd.component.messageBox.action({title:"Dashboard",height:150,text:error,btn1:"Ok"});}
window.myDashboard=myDashboard;}(window));﻿(function(window){var newsletter={};newsletter.options={};newsletter.item={};newsletter.returnScroll=0;newsletter.init=function(obj){var sc=new sd.ServerCall("LogContentMetric");sc.data({inode:obj.inode,metricType:"NEWSLETTER_VIEW"});sc.cbData({obj:obj});sc.go({onSuccess:newsletter.handleNewsletterMetric,onError:newsletter.handleError});}
newsletter.handleNewsletterMetric=function(myData,status,cbData){var obj=cbData.obj;newsletter.item={};newsletter.options=obj;newsletter.returnScroll=0;sd.Utils.killAllVideos();var sc=new sd.ServerCall("GetNewsletter");sc.data({inode:newsletter.options.inode});sc.go({onSuccess:newsletter.displayNewsletter,onError:newsletter.handleError});}
newsletter.displayNewsletter=function(myData,status){newsletter.item=myData[0];$('#libraryList').load(sd.Configuration.templates.newsletter,function(){$('#dvLibraryFilter').hide();$("#btnDeleteItem").hide();$("#btnEditItem").hide();$('#dvBestCaseHeader').hide();$('#dvLibraryPagingHeader').hide();$('#tbLibraryListHeader').hide();$('#dvLibraryPagingFooter').hide();$('#loader').hide();window.scrollTo(0,0);$('#dvNewsletter .title').html(newsletter.item.n);var structure=$.parseJSON(newsletter.item.st);var fragment=document.createDocumentFragment();var elem;var clone;var jumpTo=[];var videos={};videos.firstTime={};videos.title={};for(var i=0;i<structure.length;i++){elem=structure[i];switch(elem.type){case'contact':clone=$("#dvNewsletter .guide .newsletter-contact").clone().appendTo(fragment);clone.attr("data-recipients",elem.data.recipients);clone.attr("data-guid",elem.guid);clone.addClass(elem.guid);break;case'jumpto':clone=$("#dvNewsletter .guide .newsletter-jumpto").clone().appendTo(fragment);clone.attr("id",elem.guid);jumpTo.push(elem);break;case'upload':var ext=elem.data.filename.split('.').pop();if(sd.Utils.isVideo(ext)==true){clone=$("#dvNewsletter .guide .newsletter-video").clone().appendTo(fragment);clone.attr("data-guid",elem.guid);clone.addClass(elem.guid);var placeholder="images\\mccann\\play-icon.png";if(elem.data.placeholder!=undefined){placeholder=sd.Configuration.vault+"/"+elem.data.placeholder+"/originalImage.jpg"}
var src=sd.Utils.buildAssetSource({prefix:"nlv",videoPoster:placeholder,videoOptions:"controls mute",width:620,height:300,inode:elem.data.inode,format:ext});clone.html(src);videos.firstTime[""+elem.data.inode]=true;videos.title[""+elem.data.inode]=elem.data.filename;}
else{clone=$("#dvNewsletter .guide .newsletter-image").clone().appendTo(fragment);clone.attr("data-guid",elem.guid);clone.addClass(elem.guid);var src=sd.Configuration.vault+"/"+elem.data.inode+"/originalImage.jpg";clone.find("img").attr("src",src);}
break;case'text':clone=$("#dvNewsletter .guide .newsletter-text").clone().appendTo(fragment);clone.html(elem.data.text);clone.attr("data-guid",elem.guid);clone.addClass(elem.guid);break;case'editor':clone=$("#dvNewsletter .guide .newsletter-wysiwig").clone().appendTo(fragment);var bodyText=newsletter.updateHREFTarget(elem.data.html);clone.html(bodyText);clone.attr("data-guid",elem.guid);clone.addClass(elem.guid);break;default:console.log("Unknown Element");}}
$("#dvNewsletter .body").append(fragment);for(var key in videos.firstTime){var vid=document.getElementById("nlv"+key);vid.onplay=function(){var vidID=$(this).attr("id").replace("nlv","");if(videos.firstTime[""+vidID]){var options={};var metric={};metric.a="ITEM_VIEW";metric.i=vidID;metric.im=videos.title[""+vidID]
metric.d="";metric.u="";metric.dt="";metric.c=sd.Configuration.csid;options.metric=metric;options.onSuccess=function(){};metrics.add(options);}
videos.firstTime[""+vidID]=false;}}
fragment=document.createDocumentFragment();for(var i=0;i<jumpTo.length;i++){clone=$("#dvNewsletter .jumpto-nav .jumpto-item").clone().appendTo(fragment);clone.find("a").attr("href","#"+jumpTo[i].guid);clone.find(".navTitle").html(jumpTo[i].data.text);clone.find(".image").removeClass('icomoon-home').addClass(jumpTo[i].data.image);}
clone=$("#dvNewsletter .jumpto-nav .jumpto-item").clone().appendTo(fragment);$(".jumpto-nav").stick_in_parent();clone.find("a").addClass("archive");clone.find(".navTitle").html("Archive");clone.find(".image").removeClass('icomoon-archive-data-icon').addClass('icomoon-archive-data-icon');$("#dvNewsletter .jumpto-nav").append(fragment);$("#dvNewsletter .newsletter-archive, #btnCloseItem").unbind("click").bind("click",function(){library.displayPublishedNewsletter=false;library.jumpTo=false;library.refreshList();});$("#dvNewsletter video").unbind("click").bind("click",function(){$(this).get(0).play();});$("#dvNewsletter .newsletter-contact-btn").unbind("click").bind("click",function(){var subject="BrandLounge Newsletter";var body=$(this).parent().find(".newsletter-contact-text textarea").val();var recipientUsers=$(this).closest(".newsletter-contact").data("recipients").split(',');var obj={};obj.subject=subject;obj.body=body;obj.recipientUsers=recipientUsers;obj.recipientGroups=[];obj.emailFrom="user";obj.source="newsletter";var sc=new sd.ServerCall("SendEmail",0);sc.data(obj);sc.go({onSuccess:newsletter.emailSent})});$("#dvNewsletter .jumpto-nav a").unbind("click").bind("click",function(){if($(this).hasClass("archive")==true){library.displayPublishedNewsletter=false;library.jumpTo=false;library.refreshList();}
else{setTimeout(function(){var scroll=$(document).scrollTop();$(document).scrollTop(scroll-70);},10);}});$("#btnCloseItem").bind("click",function(){window.history.go(-1);});});}
newsletter.emailSent=function(){sd.component.messageBox.action({title:"Email Success",height:150,text:"Your email has been sent, thank you!",btn1:"Ok"});$('#dvNewsletter .newsletter-contact-text textarea').val("");}
newsletter.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
newsletter.videoPreview=function(href){var link=$(href).data("link")
newsletter.returnScroll=window.pageYOffset;sd.component.messageBox.action({header:false,escape:false,height:410,width:782,topOffset:window.pageYOffset,bodyClass:"video-previewer",loadCallback:function(){$('#dvVideoDownload').hide();link.match(/^(http|https):\/\/(?:.*?\.?)(youtube|vimeo|youtu)\.(com|be)\/(watch\?[^#]*v=([a-zA-Z0-9\-_]+)|([a-zA-Z0-9\-_]+))*/);type=RegExp.$2;if(type=="youtube"){vid=RegExp.$5;}
else if(type=="youtu"){vid=RegExp.$4;}
else if(type=="vimeo"){vid=RegExp.$4;}
else{vid="unknown";}
if(type=="youtube"||type=="youtu"){apiURL="https://www.googleapis.com/youtube/v3/videos?id="+vid+"&key=AIzaSyDj92u8Rl055X3_p1tBB1w9bKJ83A3rHpo&part=snippet,statistics";$.getJSON(apiURL,function(data){title=data.items[0].snippet.title;desc=data.items[0].snippet.description;views=data.items[0].statistics.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");vid=data.items[0].id;if(desc==""||desc==null){desc="No Description Provided"};output='<table class="external-video"><tr><td><br><iframe allowtransparency="true" height="380px" width="780px" class="youtube-player" type="text/html" src="https://www.youtube.com/embed/'+vid+'?autoplay=1" allowfullscreen frameborder="0"></iframe>\
                                            </td></tr></table>';$("#dvVideoPreview").html(output);});}
else if(type=="vimeo"){apiURL="https://vimeo.com/api/oembed.json?url=https://vimeo.com/"+vid+"&callback=?";$.getJSON(apiURL,function(data){title=data.title;desc=data.description;vid=data.video_id;if(desc==""||desc==null){desc="No Description Provided"};thumb=data.thumbnail_url;output='<table class="external-video"><tr><td><br><iframe style="height: 380px; width: 780px; block; margin: 0 auto;" src="https://player.vimeo.com/video/'+vid+'" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);});}
$('#vidCloseItem').on('click',function(){sd.component.messageBox.close();});$(".video-previewer").parent().css("border","0");$(".video-previewer").parent().css("background","#000");},template:sd.Configuration.templates.videoPreview,closeCallback:function(){window.scrollTo(0,newsletter.returnScroll)}});}
newsletter.updateHREFTarget=function(htmlIn){var htmlBody=$('<div />',{html:htmlIn});htmlBody.find('a').each(function(){var link=$(this).attr('href');if(link.match(/^(http|https):\/\/(?:.*?\.?)(youtube|vimeo|youtu)\.(com|be)\/(watch\?[^#]*v=([a-zA-Z0-9\-_]+)|([a-zA-Z0-9\-_]+))*/)!=null){$(this).attr('href','javascript:');$(this).attr('data-link',link);$(this).addClass('js_vidLink');$(this).attr('onclick',"newsletter.videoPreview(this);");$(this).attr('onbeforeunload',"return false;");if(globalBrowserDetails.agent=="MSIE"||globalBrowserDetails.agent=="Firefox"){window.onbeforeunload=null;}}
else{$(this).attr("target","_blank");}});return htmlBody.html();}
window.newsletter=newsletter;}(window));﻿(function(window){var newsletterBuilder={};newsletterBuilder.options={};newsletterBuilder.structure=[];newsletterBuilder.status="";newsletterBuilder.publish=false;newsletterBuilder.lastEditor;newsletterBuilder.loadForm=function(obj){newsletterBuilder.structure=[];newsletterBuilder.options=obj;newsletterBuilder.status="draft";newsletterBuilder.publish=false;sd.Utils.killAllVideos();var action;if(newsletterBuilder.options.inode>0)
action="Update Newsletter";else
action="Create Newsletter";sd.component.messageBox.action({containerClass:"fullscreen",overlay:true,title:action,height:600,width:960,fade:false,cssClass:"msg-box-front-end",headerClass:"msg-box-front-end-header",bodyClass:"msg-box-front-end-body",loadCallback:function(){if(newsletterBuilder.options.inode==0){$("#dvNewsletterForm .publish").hide();$("#dvNewsletterForm .delete").hide();}
else{var sc=new sd.ServerCall("GetNewsletter");sc.data({inode:newsletterBuilder.options.inode});sc.go({onSuccess:newsletterBuilder.populateForm,onError:newsletterBuilder.handleError});}
newsletterBuilder.addFormListeners();},template:sd.Configuration.templates.newsletterForm,btn1callback:newsletterBuilder.saveForm,btn1:"Save",btn2callback:library.cancelForm,btn2:"Cancel"});}
newsletterBuilder.saveForm=function(){var elems=[];var elem={};if($("#dvNewsletterForm .title").val()==""){$("#dvNewsletterForm .errorMessage").html("Please enter a Newsletter 'Title' before saving or publishing.");return;}
var htmlElems=$(".sectionList").find(".formItem");for(var i=0;i<htmlElems.length;i++){elem={};elem.guid=$(htmlElems[i]).data("guid");elem.type=$(htmlElems[i]).data("type");elem.label=$(htmlElems[i]).find(".formLabel").text();switch(elem.type){case'contact':elem.data={recipients:$(htmlElems[i]).find(".recipients").val()};break;case'jumpto':elem.data={image:$(htmlElems[i]).find(".selectedFont").data("value"),text:$(htmlElems[i]).find(".jumpToText").val()};break;case'text':elem.data={text:$(htmlElems[i]).find(".text").val()};break;case'upload':elem.data={inode:$(htmlElems[i]).data("inode"),filename:$(htmlElems[i]).find(".filename").text(),placeholder:$(htmlElems[i]).data("placeholder"),placeholderName:$(htmlElems[i]).find(".placeholderName").text()};break;case'editor':elem.data={html:CKEDITOR.instances[elem.guid].getData()};break;default:console.log("Unknown Element");}
elems.push(elem);}
var obj={};obj.elements=JSON.stringify(elems);obj.fnode=newsletterBuilder.options.fnode;obj.title=$("#dvNewsletterForm .title").val();obj.description=$("#dvNewsletterForm .description").val();if($("#dvNewsletterForm #newsletterThumb").val()=="")obj.thumb=0;else obj.thumb=$("#dvNewsletterForm #newsletterThumb").val();obj.latestPublished=newsletterBuilder.publish;if(newsletterBuilder.options.action=="new"){var sc=new sd.ServerCall("CreateNewsletter");obj.status=newsletterBuilder.status;}
else{obj.inode=newsletterBuilder.options.inode;obj.status=newsletterBuilder.status;var sc=new sd.ServerCall("UpdateNewsletter");}
sc.data(obj);sc.go({onSuccess:newsletterBuilder.saveComplete,onError:newsletterBuilder.handleError});}
newsletterBuilder.saveComplete=function(myData,status){if(newsletterBuilder.publish==true){var data=myData[0];newsletterBuilder.showEmailDialog(data);}
else
library.refreshList();}
newsletterBuilder.showEmailDialog=function(data){sd.component.messageBox.action({fade:false,height:450,width:700,title:"Email Newsletter Details",template:"templates/mccann/email.htm",loadCallback:function(){$('#txtSubject').val(sd.Configuration.messages.newsletterEmailSubject);var url=encodeURIComponent(window.location.protocol)+"//";url+=encodeURIComponent(window.location.host);url+=encodeURIComponent(window.location.pathname);url+="?inode="+data.i;var body=sd.Configuration.messages.newsletterEmailBody;body+="%0D%0A%0D%0A";body+=url+" %0D%0A%0D%0A";$('#txtBody').val(decodeURIComponent(body));var obj={};obj.inode=newsletterBuilder.options.fnode;var sc=new sd.ServerCall("GetEmailList");sc.data(obj);sc.go({onSuccess:library.handleRecipients,onError:library.handleFormError});},btn1callback:library.sendEmail,btn1:"Send",icon1:"icon-mail-forward",btn2:"Cancel",icon2:"icon-ban-circle",btn2callback:library.refreshList});}
newsletterBuilder.addFormListeners=function(){$("#dvNewsletterForm .formAddElement").unbind("click").on("click",function(){newsletterBuilder.showElemSettingsDialog({mode:"new"});});$("#dvNewsletterForm .publish").unbind("click").on("click",function(){newsletterBuilder.status="published";newsletterBuilder.publish=true;newsletterBuilder.saveForm();});$("#dvNewsletterForm .delete").unbind("click").on("click",function(){var sc=new sd.ServerCall("DeleteNewsletter");sc.data({inode:newsletterBuilder.options.inode});sc.go({onSuccess:library.refreshList,onError:newsletterBuilder.handleError});});$("#dvNewsletterForm .upload").unbind("click").bind("click",function(){sd.FileUploader.browse({'destinationInode':-91,'onComplete':function(data){var file=data[0];$("#dvNewsletterForm #newsletterThumb").val(file.i_node);$("#dvNewsletterForm .thumbUpload .filename").text(file.name);},'onSelect':function(lastFile){sd.FileUploader.upload();},'onError':function(msg){console.log("Thumb Upload Failed!");}});});}
newsletterBuilder.showElemSettingsDialog=function(details){$("#dvNewsletterForm #newsletterElement .save").unbind("click").on("click",function(){var label=$("#dvNewsletterForm #newsletterElement .sectionLabel").val();var type=$("#dvNewsletterForm #newsletterElement .elementSelect").val();if(label==""||type=="-1"){$("#dvNewsletterForm .error").text("Please enter a label and select a section type.");return;}
if(details.mode=="edit"){$("#dvNewsletterForm ."+details.guid+" .formLabel").html(label);for(var i=0;i<newsletterBuilder.structure.length;i++){if(newsletterBuilder.structure[i].guid==details.guid){newsletterBuilder.structure[i].label=label;}}}
else
newsletterBuilder.addFormElement({label:label,type:type,mode:"new"});$("#dvNewsletterForm #newsletterElement").hide();});$("#dvNewsletterForm #newsletterElement .cancel").unbind("click").on("click",function(){$("#newsletterElement").hide();});$("#dvNewsletterForm #newsletterElement .close").unbind("click").on("click",function(){$("#newsletterElement").hide();});if(details.mode=="new"){$("#dvNewsletterForm #newsletterElement .elementSelect").show();$("#dvNewsletterForm #newsletterElement .sectionLabel").val('');$("#dvNewsletterForm #newsletterElement .elementSelect").val('-1');$("#dvNewsletterForm #newsletterElement .save").html("Add");}
else{$("#dvNewsletterForm #newsletterElement .save").html("Save");$("#dvNewsletterForm #newsletterElement .elementSelect").hide();var elem;for(var i=0;i<newsletterBuilder.structure.length;i++){elem=newsletterBuilder.structure[i];if(elem.guid==details.guid)break;}
$("#dvNewsletterForm #newsletterElement .sectionLabel").val(elem.label);$("#dvNewsletterForm #newsletterElement .elementSelect").val(elem.type);}
$("#dvNewsletterForm #newsletterElement").show();$("#dvNewsletterForm .error").text('');}
newsletterBuilder.addFormElement=function(details,scrollTop){var fragment=document.createDocumentFragment();var elemClone;var clone=$("#dvNewsletterForm .guide .formItem").clone().appendTo(fragment);clone.find(".formLabel").html(details.label);clone.attr("data-type",details.type);details.guid=details.guid||sd.Utils.generateGUID();clone.attr("data-guid",details.guid);clone.addClass(details.guid);clone.find(".expand").hide();if(details.mode=="new"){newsletterBuilder.structure.push({guid:details.guid,label:details.label,type:details.type});}
switch(details.type){case'contact':elemClone=$("#dvNewsletterForm .guide .contactElem").clone();if(details.mode=="edit"){elemClone.find(".recipients").val(details.data.recipients);}
clone.find(".formElementBody").append(elemClone);$("#dvNewsletterForm .sectionList").append(fragment);break;case'jumpto':elemClone=$("#dvNewsletterForm .guide .jumptoElem").clone();if(details.mode=="edit"){elemClone.find(".jumpToText").val(details.data.text);elemClone.find("."+details.data.image).parent().addClass("selectedFont");}else{elemClone.find(".none").parent().addClass("selectedFont");}
clone.find(".formElementBody").append(elemClone);$("#dvNewsletterForm .sectionList").append(fragment);$("#dvNewsletterForm ."+details.guid+" .fontMenu li").click(function(){$("#dvNewsletterForm ."+details.guid+" .fontMenu li").removeClass("selectedFont");$(this).addClass("selectedFont");});break;case'text':elemClone=$("#dvNewsletterForm .guide .textElem").clone();if(details.mode=="edit"){elemClone.find(".text").val(details.data.text);}
clone.find(".formElementBody").append(elemClone);$("#dvNewsletterForm .sectionList").append(fragment);break;case'upload':elemClone=$("#dvNewsletterForm .guide .uploadElem").clone();if(details.mode=="edit"){elemClone.find(".filename").text(details.data.filename);clone.data("inode",details.data.inode);elemClone.find(".placeholderName").text(details.data.placeholderName);clone.data("placeholder",details.data.placeholder);}
clone.find(".formElementBody").append(elemClone);$("#dvNewsletterForm .sectionList").append(fragment);$("#dvNewsletterForm ."+details.guid+" .uploadAsset").bind("click",function(){sd.FileUploader.browse({'destinationInode':-91,'onComplete':function(data){var file=data[0];$("#dvNewsletterForm ."+details.guid+" .status").html("Upload Complete");$("#dvNewsletterForm ."+details.guid).data("inode",file.i_node);$("#dvNewsletterForm ."+details.guid+" .filename").text(file.name);$("#dvNewsletterForm ."+details.guid+" .status").html("");},'onSelect':function(lastFile){$("#dvNewsletterForm ."+details.guid+" .status").html("Uploading ...");sd.FileUploader.upload();},'onError':function(msg){$("#dvNewsletterForm ."+details.guid+" .status").html("Upload failed. Please try again");}});});$("#dvNewsletterForm ."+details.guid+" .uploadPlaceholder").bind("click",function(){sd.FileUploader.browse({'destinationInode':-91,'onComplete':function(data){var file=data[0];$("#dvNewsletterForm ."+details.guid+" .status").html("Upload Complete");$("#dvNewsletterForm ."+details.guid).data("placeholder",file.i_node);$("#dvNewsletterForm ."+details.guid+" .placeholderName").text(file.name);$("#dvNewsletterForm ."+details.guid+" .status").html("");$("#dvNewsletterForm ."+details.guid+" .removePlaceholder").show();},'onSelect':function(lastFile){$("#dvNewsletterForm ."+details.guid+" .status").html("Uploading ...");sd.FileUploader.upload();},'onError':function(msg){$("#dvNewsletterForm ."+details.guid+" .status").html("Upload failed. Please try again");}});});if(details.mode=="edit"&&(details.data.placeholder!=undefined&&details.data.placeholder!="")){$("#dvNewsletterForm ."+details.guid+" .removePlaceholder").show();}
else{$("#dvNewsletterForm ."+details.guid+" .removePlaceholder").hide();}
$("#dvNewsletterForm ."+details.guid+" .removePlaceholder").bind("click",function(){$("#dvNewsletterForm ."+details.guid).data("placeholder","");$("#dvNewsletterForm ."+details.guid+" .placeholderName").text("");$("#dvNewsletterForm ."+details.guid+" .removePlaceholder").hide();});break;case'editor':elemClone=$("#dvNewsletterForm .guide .editorElem").clone();elemClone.find(".tiny-editor").attr("id",details.guid);clone.find(".formElementBody").append(elemClone);$("#dvNewsletterForm .sectionList").append(fragment);CKEDITOR.replace(details.guid,{on:{instanceReady:function(){if(details.mode=="edit"){if(scrollTop){}}},startupFocus:false}});if(details.mode=="edit"){CKEDITOR.instances[details.guid].setData(details.data.html);}
$('body').css({"overflow-y":"auto"});break;default:console.log("Unknown Element");}
$("#dvNewsletterForm .formItem .deleteFormEntry").unbind("click");$("#dvNewsletterForm .formItem .deleteFormEntry").on("click",function(){$(this).closest(".formItem").remove();});$("#dvNewsletterForm .formItem .expand").unbind("click");$("#dvNewsletterForm .formItem .expand").on("click",function(){$(this).parent().parent().find(".formElementBody").toggle();$(this).toggle();$(this).parent().find(".collapse").toggle();});$("#dvNewsletterForm .formItem .collapse").unbind("click");$("#dvNewsletterForm .formItem .collapse").on("click",function(){$(this).parent().parent().find(".formElementBody").toggle();$(this).toggle();$(this).parent().find(".expand").toggle();});$("#dvNewsletterForm .formItem .editFormEntry").unbind("click");$("#dvNewsletterForm .formItem .editFormEntry").on("click",function(){var guid=$(this).closest('.formItem').data("guid")
newsletterBuilder.showElemSettingsDialog({mode:"edit",guid:guid});});$("#dvNewsletterForm .sectionList").sortable({handle:".dragFormEntry",axis:"y",containment:"parent"});if(details.mode=="new"){var $t=$('.sectionList');$t.animate({"scrollTop":$('.sectionList')[0].scrollHeight},"fast");}}
newsletterBuilder.populateForm=function(myData,status){var item=myData[0];$("#dvNewsletterForm .errorMessage").empty();newsletterBuilder.status=item.s;$("#dvNewsletterForm .title").val(item.n);$("#dvNewsletterForm .description").val(item.d);$("#dvNewsletterForm #newsletterThumb").val(item.t);$("#dvNewsletterForm .thumbUpload .filename").text(item.tn);newsletterBuilder.structure=$.parseJSON(item.st);for(var i=newsletterBuilder.structure.length-1;i>=0;i--)
{if(newsletterBuilder.structure[i].type=="editor"){newsletterBuilder.lastEditor=i;break;}}
var elem;for(var i=0;i<newsletterBuilder.structure.length;i++){elem=newsletterBuilder.structure[i];elem.mode="edit";if(i==newsletterBuilder.lastEditor){newsletterBuilder.addFormElement(elem,true);}
else{newsletterBuilder.addFormElement(elem,false);}}}
newsletterBuilder.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.newsletterBuilder=newsletterBuilder;}(window));﻿(function(window){var page={};page.options={};page.currentPage={};page.init=function(options){$("html").css("overflow","");window.scrollTo(0,0);$("#loader").show();page.options={};page.options.inode=options.inode;page.options.container=options.container;page.logMetric(options.inode);var sc=new sd.ServerCall("GetPageContent");sc.data({inode:page.options.inode});sc.go({onSuccess:page.load,onError:page.handleError});}
page.load=function(myData,status){$("#loader").show();page.currentPage=myData[0];$(page.options.container).load(sd.Configuration.templates.article,function(){$("#dvArticle").html(page.currentPage.content);});$('#loader').hide();}
page.edit=function(){sd.component.messageBox.action({title:"Edit Article",width:800,height:500,loadCallback:function(){$('#messageBox .js_wysiwyg').show();CKEDITOR.replace('txtWYSIWYG',{customConfig:'/ckeditor/configWYSIWYG.js',filebrowserImageUploadUrl:sd.Configuration.ws+'/ckEditorUpload.ashx'});CKEDITOR.instances.txtWYSIWYG.setData(page.currentPage.content);},template:sd.Configuration.templates.wysiwygDialog,btn1:"Save",icon1:"icon-save",btn1callback:page.save,btn2:"Cancel",icon2:"icon-ban-circle"});}
page.save=function(){var sc=new sd.ServerCall("UpdatePageContent");sc.data({inode:page.options.inode,content:CKEDITOR.instances.txtWYSIWYG.getData()});sc.go({onSuccess:page.refresh,onError:page.handleError});}
page.refresh=function(myData,status){$("#loader").show();page.currentPage=myData[0];$(page.options.container).load(sd.Configuration.templates.article,function(){$("#dvArticle").html(page.currentPage.content);});$("#loader").hide();}
page.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
page.logMetric=function(inode){var sc=new sd.ServerCall("LogContentMetric");sc.data({inode:inode,metricType:"ARTICLE_VIEW"});sc.go();}
window.page=page;}(window));﻿(function(window){var previewer={};previewer.inode=null;previewer.fnode=null
previewer.oid=null;previewer.notify=false;previewer.busy=false;previewer.fileDetails=null;previewer.deepzoom=null;previewer.deepzoom=null;previewer.videoplayer=null;previewer.onSuccess=null;previewer.onError=null;previewer.room=null;previewer.openInfo=null
previewer.animationTriggeredByTableTop=false;previewer.annotations=null;previewer.selectedPin="red";previewer.currentAnnotation=null;previewer.changeLog=[];previewer.pixelColor;previewer.collapsed=false;previewer.drawType=null;previewer.savedID=null;previewer.showingDetails=false;previewer.quickSearchCount=0;previewer.resizeTimeout;previewer.thumbScroller=false;previewer.standaloneWindowCount=0;previewer.shareFile=false;previewer.AddNoteButtonLabel=["Add Note","Hide Notes"];previewer.returnScroll=0;previewer.open=function(inode,options){previewer.inode=inode;options=options||{};previewer.container=options.container||"#previewContainer";previewer.onClose=options.onClose||function(){};previewer.onSuccess=options.onSuccess||function(){};previewer.onError=options.onError||function(){};previewer.room=options.room||null;previewer.oid=options.oid||null;previewer.notify=options.notify||false;previewer.showingDetails=options.showingDetails||false;previewer.annotations=new sd.Annotations();previewer.deepzoom=null;previewer.videoplayer=null;previewer.standalone=options.standalone||false;previewer.fnode=options.fnode||null;previewer.openInfo=options.openInfo||null;previewer.PageToOpen=options.PageToOpen||1;previewer.returnScroll=options.returnScroll||0;previewer.logMetric=options.logMetric||false;previewer.logSection=options.logSection||"";previewer.changeLog=[];var obj={};obj.inode=previewer.inode;obj.logMetric=previewer.logMetric;obj.logSection=previewer.logSection;var sc=new sd.ServerCall("FilePreviewDetails");sc.data(obj);sc.go({onSuccess:function(myData,status){previewer.fileDetails=myData[0];if(sd.Utils.isVideo(previewer.fileDetails.fmt))
{sd.component.messageBox.action({title:previewer.fileDetails.item,height:453,width:800,headerClass:"update-pro-front-header",loadCallback:function(){var obj={};obj.prefix="VP";obj.inode=previewer.inode;obj.format=previewer.fileDetails.fmt;obj.height=380;obj.width=780;obj.videoOptions="controls autoplay";var src=sd.Utils.buildAssetSource(obj);$("#dvVideoPreview").html(src);$("#dvVideoDownload").bind('click',function(){var now=new Date().getTime();var url=sd.Configuration.ws+'/DownloadFile.aspx?inode='+previewer.inode+"&timestamp"+now;window.open(url);});$('#vidCloseItem').hide();},template:sd.Configuration.templates.videoPreview,closeCallback:function(){window.scrollTo(0,previewer.returnScroll)}});return;}
else
{$(previewer.container).load(sd.Configuration.templates.previewer,previewer.previewerLoaded)}}});}
previewer.previewerLoaded=function(){$('html').css('overflow','hidden');$('link[rel=stylesheet][href~="sass/maccann.css"]').prop('disabled',false);window.scrollTo(0,0);$('body').css({"overflow":"hidden"});$("#previewer .topBar_AddNoteBtn.annotation_btn").html(previewer.AddNoteButtonLabel[0]);$("#previewer .title").text(previewer.fileDetails.item);if(previewer.standalone){$(document).attr("title",previewer.fileDetails.item);$("#previewer .previewerHeader .close").hide();}
$("#preview .annotationsCount").text(previewer.fileDetails.annotations);$("#preview .versionNum").text(previewer.fileDetails.version);if(previewer.fileDetails.status==="superseded"){$("#previewer .alert").html("A new version of this file exists");}
else if(previewer.fileDetails.status==="Checked Out"){$("#previewer .alert").html("This File is currently checked out by "+previewer.fileDetails.checkoutBy);}
else{$("#previewer .alert").hide();}
$("#previewer .download_btn").toggle(!previewer.fileDetails.BlockDownload);$("#previewer .infoLeft").hide();$(previewer.container).show();var pageCount=Number(previewer.fileDetails.pages);if(pageCount===0){if(sd.Utils.isFlv(previewer.fileDetails.fmt)){previewer.setupVideo("flv");}
else if(sd.Utils.isVideo(previewer.fileDetails.fmt)){previewer.setupVideo("mp4");}
else if(sd.Utils.isAudio(previewer.fileDetails.fmt)){previewer.setupVideo("mp3");}
else if(sd.Utils.isSwf(previewer.fileDetails.fmt)){previewer.setupSwf();}
$("#previewer .pageNavigation").hide();}
else{previewer.setupDeepZoom(pageCount);}
previewer.addEventListeners();previewer.updateAfterResize();if(previewer.room!=null&&previewer.notify)previewer.room.previewOpen(previewer.inode);previewer.onSuccess();previewer.initColourPicker();if(sd.Configuration.previewerShowToolButton==false)$("#previewer .tool-panel").hide();if(sd.Configuration.previewerShowAnnotationButtons==false)$("#previewer .annotationtoggle").hide();if(sd.Configuration.previewerShowAddNoteButton==false)$("#previewer .topBar_AddNoteBtn.annotation_btn").hide();if(sd.Configuration.previewerShowAnnotationLeftPanel==false)$("#previewer .left-hand-panel").hide();if(previewer.room!=null&&sd.Configuration.TTPreviewerHideBtns)
{$("#previewer .tools .share_btn").hide();$("#previewer .tools .associatedFiles_btn").hide();$("#previewer .tools .history_btn").hide();}
if(previewer.room!=null)previewer.refreshAnnotations();if(previewer.openInfo==true)previewer.info()}
previewer.addEventListeners=function(){$(window).on("resize",previewer.handleResize);$(window).on("resize",previewer.setThumbPager);$(window).on("orientationchange",previewer.orientationChange);$("#previewer .filecomment").focus(function(){$("#previewer .addCommentButton").removeClass("disabled");});$('#previewHolder').mousedown(function(){$(this).css({'cursor':'move'});});$('#previewHolder').mouseup(function(){$(this).css({'cursor':'default'});});$("#previewer .filecomment").focusout(function(){$("#previewer .addCommentButton").addClass("disabled");});$("#previewer .previewerHeader .close").bind("click",function(){previewer.close(true);});$("#previewer .download_btn").bind("click",previewer.download);$("#previewer .previewer-download").bind("click",previewer.download);$("#previewer .info_btn").bind("click",previewer.info);$("#previewer .enlargePreview").bind("click",previewer.info);$("#previewer .shrinkPreview").bind("click",previewer.info);$("#previewer .share_btn").bind("click",previewer.share);$("#previewer .history_btn").bind("click",previewer.history);$("#previewer .associatedFiles_btn").bind("click",previewer.fileAssociations);$("#addAssociatedFile .searchBut").bind("click",previewer.quickSearch);$("#previewer .previewer_quickSearchText").bind("keyup",previewer.quickSearch);$("#previewer .left-hand-panel").on('transitionend',function(){previewer.handleResize();});$("#previewer .thumbsBottomBar .closeThumbs").bind("click",function(){previewer.closeThumbs();});$('#previewer .moveThumbsRight').bind("click",function(){previewer.moveThumbsRight();});$('#previewer .moveThumbsLeft').bind("click",function(){previewer.moveThumbsLeft();});$("#previewer .toggle").bind("click",function(){if($("#previewer .left-hand-panel").hasClass("active")){$("#previewer .left-hand-panel").removeClass("active");$('#previewer .toggle').attr('title','Show Notes');Foundation.libs.tooltips.getTip($('#previewer .toggle')).remove();}
else{previewer.showAnnotations(true);$('#previewer .toggle').attr('title','Hide Notes');Foundation.libs.tooltips.getTip($('#previewer .toggle')).remove();}});$("#previewer .collapse").click(function(){$("#previewer .flyout").removeClass('active');$(this).siblings().removeClass('active');$(this).removeClass('active');previewer.hideAnnotations();});$("#previewer .thumbtoggle").parent().bind("click",previewer.showThumbs);$("#previewer .annotation_btn").bind("click",function(){if($("#previewer .tool-panel .annotation_btn").hasClass("active")){$("#previewer .topBar_AddNoteBtn.annotation_btn").removeClass('active');$("#previewer .topBar_AddNoteBtn.annotation_btn").html(previewer.AddNoteButtonLabel[0]);$("#previewer .tool-panel .annotation_btn").removeClass('active');$("#previewer .annotationTools").removeClass('active');$("#previewer .topTools").removeClass('active');$("#previewer .collapse").removeClass('active');$("#confirmAnnotation").hide();$("#previewer .div_colourPicker").hide();previewer.hideAnnotations();}
else{$("#previewer .topBar_AddNoteBtn.annotation_btn").addClass('active');$("#previewer .topBar_AddNoteBtn.annotation_btn").html(previewer.AddNoteButtonLabel[1]);$("#previewer .tool-panel .annotation_btn").addClass('active');$("#previewer .annotationTools").addClass('active');$("#previewer .topTools").addClass('active');$("#previewer .collapse").addClass('active');previewer.showAnnotations(false);previewer.annotationAddMode("rectangle");$(".scribbleAnnotation").toggle(!(sd.Utils.isAudio(previewer.fileDetails.fmt)));}});$("#previewer .annotationtoggle").bind("click",function(){previewer.showAnnotations(true);});$("#previewer .circleAnnotation").bind("click",function(){previewer.annotationAddMode("circle");});$("#previewer .rectangleAnnotation").bind("click",function(){previewer.annotationAddMode("rectangle");});$("#previewer .scribbleAnnotation").bind("click",function(){previewer.annotationAddMode("scribble");});$("#previewer .cancelAnnotation").bind("click",function(){previewer.annotationClearAddMode();});$("#confirmAnnotation .annotationConfirmButton").bind("click",function(){previewer.annotationSave();});$("#confirmAnnotation .annotationCancelButton").bind("click",function(){previewer.annotationClearAddMode();});$("#confirmAnnotation .icon-remove").bind("click",function(){previewer.annotationClearAddMode();});$("#previewer .colourAnnotation").click(function(e){$("#previewer .div_colourPicker").fadeToggle("slow","linear");});$("#previewer .annotationDetails").css('z-index','40');$("#previewer .annotationDetails").draggable({containment:"body"});$("#previewer .annotationDetails .close").bind("click",previewer.hideAnnotation);$("#previewer .annotationDetails .reply").bind("click",function(){$("#previewer .annotationDetails .replyDialog").show();});$("#previewer .annotationDetails .post").bind("click",previewer.postAnnotationReply);$("#previewer .annotationDetails .delete").bind("click",previewer.deleteAnnotation);}
previewer.setupVideo=function(format){previewer.info();previewer.videoplayer=new sd.VideoPlayer("jwplayerContainer",previewer.inode,{onTimeUpdate:previewer.displayVideoAnnotations,onResize:previewer.handleVideoResize,format:format});$("#previewerSwfContainer").hide();$("#previewer .navigationTools .bottomBartools").hide();$("#previewer .navigationTools .pageNavigation").hide();$("#previewer .thumbtoggle").hide();$("#previewer .annotationtoggle").addClass("active");previewer.annotations=new sd.Annotations({video:previewer.videoplayer});if(previewer.openInfo==true)previewer.info()}
previewer.displayVideoAnnotations=function(event){previewer.annotations.displayVideoAnnotations(event);}
previewer.handleVideoResize=function(event){previewer.annotations.createVideoAnnotations(previewer.annotations.displayStatus,"#previewer .div_videoAnnotations");}
previewer.setupSwf=function(){var swf=sd.Configuration.ws+"/DownloadFile.aspx?sendSwf=true&inode="+previewer.inode;swfobject.embedSWF(swf,"previewerSwfContainer","100%","100%","9.0.0");$("#previewer .navigationTools").hide();$("#previewer .thumbtoggle").hide();$("#previewer .annotationtoggle").hide();$("#previewer .annotation_btn").hide();$("#previewer .left-hand-panel .toggle").hide();if(previewer.openInfo==true)previewer.info();}
previewer.setupDeepZoom=function(pageCount){previewer.deepzoom=new sd.DeepZoomBook(pageCount,previewer.inode,{'onAnimationFinished':previewer.animationFinished,'onPageOpened':previewer.pageOpened});previewer.deepzoom.initPageContainers("#previewHolder");previewer.setCurrentPage(previewer.PageToOpen,false);previewer.annotations=new sd.Annotations({book:previewer.deepzoom});$("#previewer .prev").bind("click",function(){if(!$(this).hasClass("disabled")){previewer.setCurrentPage(previewer.deepzoom.currentPage-1,true);previewer.moveThumbsRight();}});$("#previewer .next").bind("click",function(){if(!$(this).hasClass("disabled")){previewer.setCurrentPage(previewer.deepzoom.currentPage+1,true);previewer.moveThumbsLeft();}});$("#previewer .zoomIn").parent().bind("click",function(){previewer.setBusy(true);previewer.deepzoom.zoomIn();});$("#previewer .zoomOut").parent().bind("click",function(){previewer.setBusy(true);previewer.deepzoom.zoomOut();});$("#previewer .zoomReset").parent().bind("click",function(){previewer.setBusy(true);previewer.deepzoom.zoomReset();});$("#previewer .rotateLeft").parent().bind("click",function(){previewer.deepzoom.rotateLeft()});$("#previewer .rotateRight").parent().bind("click",function(){previewer.deepzoom.rotateRight()});if(sd.Global.isTouchScreen){var book=document.getElementById('previewHolder');Hammer(book).on("swipeleft",function(event){previewer.setCurrentPage(previewer.deepzoom.currentPage+1,true);});Hammer(book).on("swiperight",function(event){previewer.setCurrentPage(previewer.deepzoom.currentPage-1,true);});Hammer(book).on("doubletap",function(event){previewer.deepzoom.zoomReset();previewer.setScrollPosition(previewer.deepzoom.currentPagePosition());event.gesture.preventDefault();});}}
previewer.setCurrentPage=function(page,notify){if(page==previewer.deepzoom.currentPage){previewer.pageOpened()}
else{var openPage=previewer.deepzoom.loadPage(page);if(previewer.room!=null&&notify)previewer.room.previewPageChanged(openPage,previewer.inode);previewer.setCurrentPageDisplay(openPage);}}
previewer.pageOpened=function(){previewer.deepzoom.zoomReset();previewer.setScrollPosition(previewer.deepzoom.currentPagePosition());if(previewer.annotations.displayStatus==true)
previewer.showAnnotations(false);}
previewer.setCurrentPageDisplay=function(page){$("#previewer .thumb").removeClass("currentThumb");$("#previewer .thumb[data-page='"+page+"']").addClass("currentThumb");$("#previewer .pageNumber").html(page+" of "+previewer.fileDetails.pages);if(page===1){$("#previewer .prev").addClass("disabled");}
else{$("#previewer .prev").removeClass("disabled");}
if(page===previewer.fileDetails.pages){$("#previewer .next").addClass("disabled");}
else{$("#previewer .next").removeClass("disabled");}}
previewer.setScrollPosition=function(pos){$("#previewer .deepZoomContainer").not("#preview_deepZoomContainer_pg"+previewer.deepzoom.currentPage).css('top','-2000px');$("#preview_deepZoomContainer_pg"+previewer.deepzoom.currentPage).css('top','0px');}
previewer.animationFinished=function(zoom,pan){}
previewer.info=function(){previewer.showingDetails=!previewer.showingDetails;if(previewer.showingDetails){$("#previewer .previewMainWindow .description").html(previewer.fileDetails.description);$("#previewer .previewMainWindow .size").html(previewer.fileDetails.size);$("#previewer .previewMainWindow .version").html(previewer.fileDetails.version);$('#previewer .shrinkPreview').hide();if(previewer.fileDetails.startdate==null)
$("#previewer .previewMainWindow .date").html(sd.Utils.formatDate(previewer.fileDetails.CreatedTime));else
$("#previewer .previewMainWindow .date").html(sd.Utils.formatDate(previewer.fileDetails.startdate));$("#previewer .previewMainWindow .creator").html(previewer.fileDetails.creator);$("#previewer .previewMainWindow .dialogItems").html("Loading");var img=sd.Configuration.vault+"/"+previewer.fileDetails.Image+"/thumb.jpg";$("#previewer .projectCreatorImage").css("background-image","url('"+img+"')");if(previewer.fileDetails.metaFormGUID){formDetails.init({guid:previewer.fileDetails.metaFormGUID,container:"#previewer .previewMainWindow .metadata",formInput:previewer.fileDetails.metaData,viewMode:true,onComplete:previewer.viewFormReady,isPreviewer:true});}
else{$("#previewer .previewMainWindow .metadata").hide();}
$("#previewHolder, #div_annotationsDrawCanvas").addClass("previewInfoMode");$("#previewer .info_btn").addClass("active");$("#previewer .infoWindow").css({'max-width':'99%'});$("#previewer .info").show();$("#previewer .infoLeft").show();}
else{$("#previewHolder, #div_annotationsDrawCanvas").removeClass("previewInfoMode");$("#previewer .info").hide();$("#previewer .infoWindow").css({'max-width':'100%'});$("#previewer .infoLeft").hide();if(previewer.videoplayer){$('#previewer .shrinkPreview').show();}
$("#previewer .info_btn").removeClass("active",1000);}
previewer.updateAfterResize();}
previewer.viewFormReady=function(){$("#previewer .previewMainWindow .metadata .error").hide();$("#previewer .previewMetaData").click(function(){master.showLoader();search.open($(this).html());previewer.close();});}
previewer.share=function(){var url=sd.Configuration.url+'?inode='+previewer.inode;url=encodeURIComponent(url);window.open("mailto:?Subject="+previewer.fileDetails.item+"&body="+url,"_self");previewer.shareFile=true;}
previewer.closeHistory=function(){$("#previewer .history").removeClass("visible");$("#previewer .history_btn").removeClass("active");}
previewer.history=function(){if($("#previewer .history").hasClass("visible")){previewer.closeHistory();}
else{$("#previewer .history").addClass("visible");$("#previewer .history_btn").addClass("active");$("#previewer .associatedFiles").removeClass("visible");$("#previewer .associatedFiles_btn").removeClass("active");$("#previewer .thumbsBottomBar").removeClass("visible");$("#previewer .thumbtoggle").parent().removeClass("active");var sc=new sd.ServerCall("FileVersionHistory");sc.data({inode:previewer.inode});sc.go({onSuccess:previewer.handleHistory});}}
previewer.handleHistory=function(myData){var fragment=document.createDocumentFragment();for(var i=0;i<myData.length;i++){var clone=$(".guide .preview_HistoryThumb").clone().appendTo(fragment);var img=sd.Configuration.vault+"/"+myData[i].i_node+"/thumb.jpg";clone.attr("data-inode",myData[i].i_node);clone.find(".thumbImg").css("background-image","url('"+img+"')");clone.find(".title").html(myData[i].item);clone.find(".version").html(myData[i].version);clone.find(".creator").html(myData[i].creator);clone.find(".date").html(sd.Utils.formatDate(myData[i].CreatedTime));}
var clone=$("#previewer .guide .hideHistory").clone().appendTo(fragment);$("#previewer .history").html(fragment);$("#previewer .preview_HistoryThumb").click(function(){var inode=$(this).data('inode');previewer.openStandalone(inode);});$("#previewer .history .closeHistory").click(function(){previewer.closeHistory();});}
previewer.closeFileAssociations=function(){$("#previewer .associatedFiles").removeClass("visible");$("#previewer .associatedFiles_btn").removeClass("active");}
previewer.closeThumbs=function(){$("#previewer .thumbsBottomBar").removeClass("visible");$("#previewer .thumbtoggle").parent().removeClass("active");}
previewer.fileAssociations=function(){if($("#previewer .associatedFiles").hasClass("visible")){previewer.closeFileAssociations();}
else{$("#previewer .associatedFiles").addClass("visible");$("#previewer .associatedFiles_btn").addClass("active");$("#previewer .history").removeClass("visible");$("#previewer .history_btn").removeClass("active");$("#previewer .thumbsBottomBar").removeClass("visible");$("#previewer .thumbtoggle").parent().removeClass("active");previewer.getFileAssociations();}}
previewer.getFileAssociations=function(){var sc=new sd.ServerCall("ListItemAssociations");sc.data({inode:previewer.inode});sc.go({onSuccess:previewer.handleFileAssociations});}
previewer.handleFileAssociations=function(myData){var fragment=document.createDocumentFragment();$(".numberOfAssociatedFiles").text(myData.length);for(var i=0;i<myData.length;i++){var clone=$("#previewer .guide .preview_AssociatedFile").clone().appendTo(fragment);var img=sd.Configuration.vault+"/"+myData[i].i_node+"/thumb.jpg";clone.attr("data-inode",myData[i].i_node);clone.find(".thumbImg").css("background-image","url('"+img+"')");clone.find(".title").html(myData[i].item);clone.find(".creator").html(myData[i].creator);clone.find(".location").html(myData[i].fullPath);clone.find(".date").html(sd.Utils.formatDate(myData[i].CreatedTime));}
var clone=$("#previewer .guide .addAssociatedFile").clone().appendTo(fragment);$("#previewer .associatedFilesList").html(fragment);$("#previewer .history").removeClass("visible");$("#previewer .associatedFiles").addClass("visible");var Width=$(".associatedFilesList li").length*$(".associatedFilesList li").outerWidth(true)
Width=Width+150;$(".associatedFilesList").css('width',Width+'px');$("#previewer .preview_AssociatedFile").click(function(){var inode=$(this).data('inode');previewer.openStandalone(inode);});$("#previewer .previewer_RemoveAssociatedFile").click(function(event){event.stopPropagation();event.preventDefault();associatedId=$(this).closest(".preview_AssociatedFile").data('inode');sd.component.messageBox.action({title:"Remove Associated File",text:"Are you sure you want to remove this associated file?",height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:function(){var sc=new sd.ServerCall("RemoveItemAssociation");sc.data({inode:previewer.inode,associatedInode:associatedId});sc.go({onSuccess:previewer.getFileAssociations});},icon2:"icon-ban-circle",btn2:"No"});});$("#previewer .addAssociatedFile").click(function(){$("#addAssociatedFile").foundation('reveal','open');$("#addAssociatedFile .previewer_quickSearchText").val("");$("#addAssociatedFile .previewer_quickSearchDropDown").hide();});$("#previewer .associatedFiles .closeAssociatedFiles ").click(function(){previewer.closeFileAssociations();});}
previewer.quickSearch=function(event){var phrase=$(".previewer_quickSearchText").val();if(event.type=="keyup"&&phrase.length<3){$(".previewer_quickSearchDropDown").hide();}
else{previewer.quickSearchCount++;var sc=new sd.ServerCall("QuickFileSearch");sc.data({phrase:phrase});sc.cbData({num:previewer.quickSearchCount});sc.go({onSuccess:previewer.handleQuickSearch});}};previewer.handleQuickSearch=function(myData,status,cb){if(previewer.quickSearchCount!=cb.num)return;if(myData.length>0){$("#addAssociatedFile .previewer_quickSearchDropDown").show();var fragment=document.createDocumentFragment();for(var i=0;i<myData.length;i++){if(myData[i].i_node==previewer.inode)continue;var clone=$('#addAssociatedFile .guide .previewer_quickSearchRecord').clone().appendTo(fragment);clone.attr("data-inode",myData[i].i_node);clone.find('.title').html(myData[i].item);clone.find(".location").html(myData[i].fullPath);clone.find('.creator').html(myData[i].createdBy);clone.find('.date').html(sd.Utils.formatDate(myData[i].CreatedTime));var img=sd.Configuration.vault+"/"+myData[i].i_node+"/thumb.jpg";clone.find(".thumbImg").attr("style","background-image:url('"+img+"')");}
$("#addAssociatedFile .previewer_quickSearchDropDown .results").html(fragment);}
else{$("#addAssociatedFile .previewer_quickSearchDropDown .results").empty();$("#addAssociatedFile .previewer_quickSearchDropDown").hide();}
$("#addAssociatedFile .previewer_quickSearchRecord").click(function(){associatedId=$(this).attr('data-inode');previewer.addAssociatedFile(associatedId);$("#addAssociatedFile").foundation('reveal','close');});}
previewer.addAssociatedFile=function(associatedId){var sc=new sd.ServerCall("AddItemAssociation");sc.data({inode:previewer.inode,associatedInode:associatedId});sc.go({onSuccess:previewer.getFileAssociations});}
previewer.download=function(){var now=new Date().getTime();var url=sd.Configuration.ws+'/DownloadFile.aspx?inode='+previewer.inode+"&timestamp"+now;window.open(url);}
previewer.showThumbs=function(){console.log();if($("#previewer .thumbsBottomBar").hasClass("visible")){previewer.closeThumbs();}
else{$("#previewer .thumbsBottomBar").addClass("visible");$("#previewer .thumbtoggle").parent().addClass("active");$("#previewer .history").removeClass("visible");$("#previewer .history_btn").removeClass("active");$("#previewer .associatedFiles").removeClass("visible");$("#previewer .associatedFiles_btn").removeClass("active");if($("#previewer .thumbs").html()==""){var fragment=document.createDocumentFragment();for(var i=1;i<=previewer.fileDetails.pages;i++){var img=sd.Configuration.vault+"/"+previewer.inode+"/"+i+"/pagethumb.jpg";var clone=$("#previewer .guide .thumb").clone().appendTo(fragment);clone.find(".thumbs__pageNumber").html(i);clone.attr("style","background-image:url('"+img+"')");clone.attr("data-page",i)}
$("#previewer .thumbs").html(fragment);$("#previewer .thumb").click(function(){var page=$(this).data('page');previewer.setCurrentPage(page,true);});}
previewer.setCurrentPageDisplay(previewer.deepzoom.currentPage);previewer.handleResize();previewer.setThumbPager();}}
previewer.setThumbPager=function(){var liWidth=$('#previewer .thumbs li').outerWidth(true);$('#previewer .thumbs').width((liWidth*$('#previewer .thumbs li').size()+2))
if($('#previewer .thumbs').width()>$('#previewer .thumbsContainer').width()){previewer.thumbScroller=true;if($('.thumbsContainer').position().left+$('.thumbsContainer').outerWidth()<$('.thumbs').position().left+$('.thumbs').outerWidth()){$('#previewer .moveThumbsLeft').show();}
if($('.thumbsContainer').position().left>$('.thumbs').position().left){$('#previewer .moveThumbsRight').show();}}
else{$('#previewer .moveThumbs').hide();previewer.thumbScroller=false;$('#previewer .thumbs').width('100%');}}
previewer.moveThumbsRight=function(){if($('.thumbsContainer').position().left<$('.thumbs').position().left){$('#previewer .moveThumbsRight').hide();}
else{var liWidth=$('#previewer .thumbs li').outerWidth();$('#previewer .thumbs').css({left:'+='+liWidth});$('#previewer .moveThumbsRight').show();}
if($('.thumbsContainer').position().left+$('.thumbsContainer').outerWidth()<$('.thumbs').position().left+$('.thumbs').outerWidth()){$('#previewer .moveThumbsLeft').show();}
if($('.thumbsContainer').position().left<$('.thumbs').position().left){$('#previewer .moveThumbsRight').hide();}}
previewer.moveThumbsLeft=function(){if($('.thumbsContainer').position().left+$('.thumbsContainer').outerWidth()>$('.thumbs').position().left+$('.thumbs').outerWidth()){$('#previewer .moveThumbsLeft').hide();}
else{var liWidth=$('#previewer .thumbs li').outerWidth();$('#previewer .thumbs').css({left:'-='+liWidth});$('#previewer .moveThumbsLeft').show();}
if($('.thumbsContainer').position().left>$('.thumbs').position().left){$('#previewer .moveThumbsRight').show();}
if($('.thumbsContainer').position().left+$('.thumbsContainer').outerWidth()>$('.thumbs').position().left+$('.thumbs').outerWidth()){$('#previewer .moveThumbsLeft').hide();}}
previewer.handleResize=function(){clearTimeout(previewer.resizeTimeout)
previewer.resizeTimeout=setTimeout(previewer.updateAfterResize,200);}
previewer.orientationChange=function(){clearTimeout(previewer.resizeTimeout)
setTimeout(previewer.updateAfterResize,500);}
previewer.updateAfterResize=function(){var top=$("#previewer .previewerHeader").position().top+$("#previewer .previewerHeader").height();if($("#previewer .annotationTools").hasClass("active")){top+=$("#previewer .annotationTools").height();}
var bottom=$("#previewer .navigationTools").height();var width=$(window).width();var height=$(window).height()-(top+bottom);$("#previewer .previewMainWindow").css({left:'0px',top:top+'px',bottom:bottom+'px',width:width+'px',height:height+'px'});$("#previewer .left-hand-panel").css({top:top+'px',bottom:bottom+'px',height:height+'px'});$("#previewer .annotations").css({top:top+'px',bottom:bottom+'px',height:height+'px'});if(previewer.showingDetails){$("#previewHolder, #div_annotationsDrawCanvas").css({height:'',width:''})}
else{$("#previewHolder, #div_annotationsDrawCanvas").css({width:width+'px',height:height+'px'});}
if(previewer.deepzoom){$(".deepZoomContainer").css({width:'100%',height:'100%',position:'absolute'});previewer.deepzoom.updateScrollPositions();setTimeout($.proxy(previewer.deepzoom.zoomReset,previewer.deepzoom),500);}
previewer.hideAnnotations();if(previewer.videoplayer)previewer.handleVideoResize();}
previewer.showAnnotations=function(openCallout){if(openCallout){$("#previewer .left-hand-panel").removeClass("thumbActive").addClass("annotationActive").addClass("active");$("#previewer .annotations").show();$("#previewer .annotationtoggle").addClass("active");}
previewer.refreshAnnotations();}
previewer.hideAnnotations=function(){if(!($("#previewer .annotationTools").hasClass("active")||($("#previewer .left-hand-panel").hasClass("active")&&$("#previewer .annotations").is(":visible")))){if(previewer.deepzoom){previewer.annotations.displayDeepZoomOverlays(false);}
else if(previewer.videoplayer){previewer.annotations.createVideoAnnotations(false);}}
previewer.annotationClearAddMode();}
previewer.refreshAnnotations=function(){previewer.annotations.listItems({onSuccess:previewer.displayAnnotations,onSelect:previewer.showAnnotation});previewer.hideAnnotation();}
previewer.displayAnnotations=function(){var annotationsHTML="";var currentPage=0;$("#preview .annotationsCount").text(previewer.annotations.annoList.length);var fragment=document.createDocumentFragment();for(var idx=0;idx<previewer.annotations.annoList.length;idx++){var anno=previewer.annotations.annoList[idx];var clone=$("#previewer .guide .annotations__item").clone().appendTo(fragment);clone.attr("style","border-color:"+anno.color);clone.attr("data-annotationid",anno.id);clone.find(".number").html(anno.refNum);clone.find(".annotation-color").attr("style","background-color:"+anno.color);clone.find(".date").html(anno.createdTime);clone.find(".author").html(anno.creator);clone.find(".body").html(anno.text);clone.find(".page").html(anno.page);clone.find(".div_annotationDetailsText_reply").hide();var comments=clone.find(".div_annotationDetailsText_reply").length;clone.find(".comments").html(comments);clone.find(".comments").toggle(comments>0);clone.find(".comments").click(function(event){event.stopPropagation();event.preventDefault();$(this).closest(".annotations__item").find(".div_annotationDetailsText_reply").toggle();});if(previewer.videoplayer){clone.find(".time").html(anno.timespan[0]);}}
$("#previewer .annotations").html(fragment);$("#previewer .annotations__item").click(function(){previewer.showAnnotation($(this).data('annotationid'),true);});if(previewer.annotations.annoList.length==0){$("#previewer .annotations").html("<li class='annotations__item empty'><i class='icon-plus-sign icon-3x'></i><span>Add Note</span></li>");$("#previewer .annotations__item.empty").click(function(){$("#previewer .topBar_AddNoteBtn").click();});}
if(previewer.deepzoom){previewer.annotations.displayDeepZoomOverlays(true);}
else if(previewer.videoplayer){previewer.annotations.createVideoAnnotations(true,"#previewer .div_videoAnnotations");}
if(previewer.annotations.annoList.length>0){$('#previewer .toggle .annotationCountPos span').html(previewer.annotations.annoList.length);$('#previewer .toggle .annotationCountPos').show();}else{$('#previewer .toggle .annotationCountPos').hide();}}
previewer.showAnnotation=function(id,jumpToPage){previewer.currentAnnotation=previewer.annotations.getAnnotationbyId(id);if(previewer.deepzoom&&jumpToPage){previewer.setCurrentPage(previewer.currentAnnotation.page,false,true);}
else if(previewer.videoplayer){previewer.videoplayer.jumpToTime(previewer.currentAnnotation.timespan[0])}
$("#previewer .annotationDetails .replyDialog").hide();$("#previewer .annotationDetails .replyText").val("");$("#previewer .annotationDetails .author").html(previewer.currentAnnotation.creator);$("#previewer .annotationDetails .date").html(previewer.currentAnnotation.createdTime);$("#previewer .annotationDetails .text").html(previewer.currentAnnotation.text);$("#previewer .annotationDetails .annotation-color").css('background-color',previewer.currentAnnotation.color);$("#previewer .annotationDetails").show();}
previewer.hideAnnotation=function(){$("#previewer .annotationDetails").hide();}
previewer.deleteAnnotation=function(){sd.component.messageBox.action({title:"Delete Note",text:"Are you sure you want to delete this note?",height:150,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:previewer.deleteConfirmed,icon2:"icon-ban-circle",btn2:"No",TxtFields:null,template:null});}
previewer.deleteConfirmed=function(){previewer.changeLog.push({'type':"delete",'page':previewer.currentAnnotation.page,'refNum':previewer.currentAnnotation.refNum});previewer.annotations.deleteAnnotation(previewer.currentAnnotation.id,{onSuccess:previewer.PreRefreshAnnotations});}
previewer.PreRefreshAnnotations=function(){if(previewer.room!=null)previewer.room.syncAnnotations();previewer.refreshAnnotations()}
previewer.postAnnotationReply=function(){var txt=$("#previewer .annotationDetails .replyText").val();previewer.annotations.postReply(previewer.currentAnnotation.id,txt,{onSuccess:previewer.refreshAnnotations});previewer.changeLog.push({'type':"reply",'refNum':previewer.currentAnnotation.refNum,'details':txt});}
previewer.annotationAddMode=function(type){previewer.drawType=type;var color=$("#previewer .colourAnnotation").css('border-bottom-color');$(".annotationTools").find("i").removeClass("selected");$(".annotationTools ."+type+"Annotation").addClass("selected");if(previewer.deepzoom){previewer.setScrollPosition(previewer.deepzoom.currentPagePosition());var pan=previewer.deepzoom.currentPan();var zoom=previewer.deepzoom.currentZoom();previewer.annotations.newAnnotation("#div_annotationsDrawCanvas",type,{'page':previewer.deepzoom.currentPage,'pan':pan,'zoom':zoom,onEndHandler:previewer.annotationEndHandler,color:color});}
else{previewer.videoplayer.pause(true);var time=jwplayer("jwplayerContainer").getPosition();var timespan=time+":"+(time+1);previewer.annotations.newAnnotation("#div_annotationsDrawCanvas",type,{'timespan':timespan,onEndHandler:previewer.annotationEndHandler,color:color});}
$("#confirmAnnotation").css('right','62px');if(previewer.inode!=null)
$("#previewer #confirmAnnotation").show();$("#confirmAnnotation").css('z-index','10');$("#previewer #confirmAnnotation").draggable({containment:"body"});}
previewer.annotationClearAddMode=function(){$("#previewer .cancelAnnotation").addClass("icon-muted");$("#previewer .saveAnnotation").addClass("icon-muted");$("#previewer .div_colourPicker").hide();if(previewer.annotations)previewer.annotations.clearNewAnnotation();$("#previewer .annotationComment").val("");$("#previewer #confirmAnnotation").hide();if(previewer.videoplayer)previewer.videoplayer.showControl();}
previewer.annotationSave=function(){var txt=$("#previewer #confirmAnnotation .annotationComment").val();previewer.annotations.saveCurrent(txt,{'onSave':previewer.annotationSaved});}
previewer.annotationSaved=function(text){previewer.changeLog.push({'type':"add",'page':previewer.annotations.newItem.page,'details':text});previewer.annotationClearAddMode();if(previewer.room!=null)previewer.room.syncAnnotations();previewer.refreshAnnotations();$('#previewer #confirmAnnotation').foundation('reveal','close');}
previewer.initColourPicker=function(){var canvas=document.getElementById('previewer_colourPicker');var ctx=canvas.getContext('2d');var image=new Image();image.onload=function(){ctx.drawImage(image,0,0,image.width,image.height);};var imageSrc='images/colorwheel1.png';image.src=imageSrc;$("#previewer_colourPicker").click(function(e){var canvasOffset=$(canvas).offset();var canvasX=Math.floor(e.pageX-canvasOffset.left);var canvasY=Math.floor(e.pageY-canvasOffset.top);var imageData=ctx.getImageData(canvasX,canvasY,1,1);var colorPickerPixel=imageData.data;$("#previewer .div_colourPicker").hide();previewer.pixelColor="rgba("+colorPickerPixel[0]+", "+colorPickerPixel[1]+", "+colorPickerPixel[2]+", .7)";$("#previewer .colourAnnotation").css('border-bottom-color',previewer.pixelColor);$("#previewer #confirmAnnotation .annotation-color").css('background',previewer.pixelColor);$("#confirmAnnotation .annotation-color").css('background-color',previewer.pixelColor);if(previewer.annotations.newItem)
previewer.annotations.updateAnnotationStyle({color:previewer.pixelColor});$("#previewer .div_colourPicker").hide();});}
previewer.isBusy=function(){return previewer.busy;}
previewer.setBusy=function(busy){if(previewer.room==null)return;previewer.busy=busy;}
previewer.close=function(notify){if(previewer.shareFile==true){previewer.shareFile=false
return}
else{if(previewer.changeLog.length>0&&previewer.room==null){sd.Session.getUserDetails({onSessionDetails:previewer.emailNotification});}
else{$('link[rel=stylesheet][href~="sass/maccann.css"]').prop('disabled',true);$('link[rel=stylesheet]:not([href~="sass/maccann.css"])').prop('disabled',false);$('body').css('overflow-y','scroll');$('html').css('overflow','');previewer.finishClose();previewer.onClose();}}}
previewer.emailNotification=function(){var bodyStr=sd.Session.user.FullName+" has made the following changes to this file:";for(var i=0;i<previewer.changeLog.length;i++){if(previewer.changeLog[i].type=="add")bodyStr+="<br><b>New Annotation on Page "+previewer.changeLog[i].page+":</b><br>"+previewer.changeLog[i].details;else if(previewer.changeLog[i].type=="delete")bodyStr+="<br><b>Annotation #"+previewer.changeLog[i].refNum+" Deleted on Page "+previewer.changeLog[i].page+"</b>";else if(previewer.changeLog[i].type=="reply")bodyStr+="<br><b>Reply to Annotation #"+previewer.changeLog[i].refNum+":</b><br>"+previewer.changeLog[i].details;}
var link=sd.Configuration.url+'?inode='+previewer.inode;bodyStr+="<br>Click <a href='"+link+"'>Here</a> to view file."
previewer.changeLog=[];var obj={};obj.subject="Annotations Updated to File "+previewer.fileDetails.item;obj.inode=previewer.inode;obj.fnode=previewer.fnode;obj.body=bodyStr;obj.source="previewer";emailNotification.init(obj);previewer.finishClose();}
previewer.finishClose=function(){if(previewer.deepzoom){previewer.deepzoom.clear();}
else{}
$(window).off("resize",previewer.handleResize);$(window).off("resize",previewer.setThumbPager);$(window).off("orientationchange",previewer.orientationChange);window.scrollTo(0,0);$(previewer.container).empty();$(previewer.container).hide();previewer.oid=null;previewer.inode=null;if(previewer.room!=null)previewer.room.previewClosed();}
previewer.openStandalone=function(inode){if(window.opener&&window.opener.previewer&&window.opener!=window){window.opener.previewer.openStandalone(inode);return;}
previewer.standaloneWindowCount++;var url=sd.Configuration.url+'?standaloneMode=1&inode='+inode;var new_window=window.open(url,"standaloneMode"+previewer.standaloneWindowCount,"toolbar=no,statusbar=no");}
previewer.closeStandalone=function(event,details){if(window.opener&&window.opener.previewer){window.opener.previewer.closeStandalone(event,previewer);return;}}
window.previewer=previewer;}(window));(function(window){var randomData={};randomData.init=function(){$.ajax({url:'https://randomuser.me/api/?results=16',dataType:'json',success:function(data){for(i=0;i<16;i++){name=data.results[i].name.first;last=data.results[i].name.last;randomPic=data.results[i].picture.large;$('.js-name:eq('+i+')').html(name+" "+last);$('.js-pic:eq('+i+')').css('background-image','url('+randomPic+')');}
$('.js-pic').css('background-size','cover')}});$.ajax({type:'GET',dataType:'json',url:'images.json',success:function(data){for(i=0;i<12;i++){filename=data[i].filename;image=data[i].post_url;date=data[i].date;author=data[i].author;desc=data[i].description;$('.js-file-name:eq('+i+')').html(filename);$('.js-file-date:eq('+i+')').html(date);$('.js-file-author:eq('+i+')').html(author);$('.js-file-desc:eq('+i+')').html(desc);$('.js-image:eq('+i+')').css('background-image',"url("+image+".jpeg)");}
$('.js-file-desc.file-desc-thumb').each(function(index,element){$clamp(element,{clamp:2,useNativeClamp:false});});$('.js-file-desc.list-width').each(function(index,element){$clamp(element,{clamp:3,useNativeClamp:false});});$('.js-file-name.list-width').each(function(index,element){$clamp(element,{clamp:2,useNativeClamp:false});});$('.js-image').css('background-size','cover')}});}
window.randomData=randomData;}(window));(function(window){var runSearch={};var searchObj;runSearch.currentSortDirection="";runSearch.currentSortBy="";runSearch.currentList=[];runSearch.filteredList=[];runSearch.allUniqueMetaAttributes=[];runSearch.allMetaAttributes=[];runSearch.appliedFilters=[];runSearch.viewMode="";runSearch.itemsPerPage=16;runSearch.totalPages=0;runSearch.currentPage=1;runSearch.pagingOptions={};runSearch.quickSearchCount=0;runSearch.init=function(options){runSearch.currentList=[];runSearch.filteredList=[];runSearch.allUniqueMetaAttributes=[];runSearch.allMetaAttributes=[];runSearch.appliedFilters=[];runSearch.viewMode="list";runSearch.totalPages=0;runSearch.currentPage=1;runSearch.currentSortDirection="ASC";runSearch.pagingOptions={};$('#loader').show();$("#quickSearchDropDown").hide();var searchString=$('#headerSearchFieldInput').val();$('#dvSearch #dvNameSort').click(function(){runSearch.createList("name","");});$('#dvSearch #dvLocationSort').click(function(){runSearch.createList("location","");});$('#dvSearch #dvCreatorSort').click(function(){runSearch.createList("createdby","");});$('#dvSearch #dvDateSort').click(function(){runSearch.createList("createdate","");});$('#dvSearch .icon-chevron-up').hide();$('#dvSearch .icon-chevron-down').hide();$(".nav-top-level").removeClass("brand-current");runSearch.addEventListeners();$("#advSearchStartDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/grey-calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"Start Date"});$("#advSearchEndDate").datepicker({dateFormat:'dd M yy',changeYear:true,changeMonth:true,buttonImage:'images/form/grey-calendar.png',buttonImageOnly:true,showOn:'both',buttonText:"End Date"});runSearch.locationOptions();if(options.mode=="simple"){runSearch.SimpleSearch(searchString,options.searchRootNode);}
else{searchString=options.searchString;$('#txtSearchTerm').val(options.searchString);$('#hSearchString').text("Search Term ("+options.searchString+")");searchObj=new sd.Search(options);searchObj.runSearch();}
$(".icon-calendar").unbind("click").bind("click",function(){$(this).closest("div").find(".ui-datepicker-trigger").click();});};runSearch.SimpleSearch=function(searchTerm,searchRootNode){$('#txtSearchTerm').val(searchTerm);$('#hSearchString').text("Search Term ("+searchTerm+")");var obj={};obj.onError=$.proxy(this.handleError,this);obj.onSuccess=$.proxy(this.handleResults,this);obj.searchString=searchTerm;obj.searchUsers=true;obj.descriptionLength=100;if(searchRootNode!=null){obj.searchRootNode=searchRootNode;obj.searchUsers=false;}
searchObj=new sd.Search(obj);sd.Utils.killAllVideos();searchObj.runSearch();};runSearch.AdvancedSearch=function(searchTerm){var errMsg=runSearch.validSearchTerm(searchTerm);if(errMsg!=""){sd.component.messageBox.action({title:"Search",height:150,text:errMsg,btn1:"Ok"});return;}
$('#loader').show();$('#txtSearchTerm').val(searchTerm);$('#hSearchString').text("Search Term ("+searchTerm+")");var obj={};var docTypes=[];obj.onError=$.proxy(this.handleError,this);obj.onSuccess=$.proxy(this.handleResults,this);obj.searchString=$('#txtSearchTerm').val();obj.searchUsers=true;obj.searchEgnyte=true;if($("#advSearchLocation").val()!="0"){obj.searchUsers=false;obj.searchEgnyte=false;var template=$('#advSearchLocation option:selected').data('template');template=template.toLowerCase();if(template=="egnyteembed"){obj.searchEgnyte=true;obj.searchEgnyteOnly=true;}
else if(template=="team"){obj.searchUsers=true;obj.searchUsersOnly=true;}
else{obj.searchRootNode=$("#advSearchLocation").val();}}
obj.searchType=$('input:radio[name=advSearchType]:checked').val();obj.searchContent=($('input:checkbox[name=advSearchContent]:checked').length>0)?true:false;obj.searchStartDate=$("#advSearchStartDate").val();obj.searchEndDate=$("#advSearchEndDate").val();obj.searchTitleOnly=($('input:checkbox[name=advSearchTitle]:checked').length>0)?true:false;if($('input:checkbox[name=advSearchVideo]:checked').length>0)docTypes.push("video");if($('input:checkbox[name=advSearchDoc]:checked').length>0)docTypes.push("document");if($('input:checkbox[name=advSearchPres]:checked').length>0)docTypes.push("presentation");if($('input:checkbox[name=advSearchImage]:checked').length>0)docTypes.push("image");obj.searchFormats=docTypes.toString();obj.searchEgnyte=($('input:checkbox[name=advSearchEgnyte]:checked').length>0)?true:false;if(docTypes.length>0){obj.searchUsers=false;}
if(obj.searchStartDate!=""||obj.searchEndDate!=""){obj.searchUsers=false;}
searchObj=new sd.Search(obj);sd.Utils.killAllVideos();searchObj.runSearch();obj.location=$("#advSearchLocation").val();sd.Global.searchData.push(obj);};runSearch.handleQuickSearch=function(results){if($("#dvSearch").is(':visible')==true){$("#quickSearchDropDown").hide();return;}
if(results!=undefined){if(results.length==0){$("#quickSearchDropDown").hide();return;}
$("#quickSearchDropDown .results").html("");$("#quickSearchDropDown").show();var dropResults=[];for(var result=0;result<results.length;result++){var addNew=true;for(var dropResult=0;dropResult<dropResults.length;dropResult++){if(dropResults[dropResult].hasOwnProperty("type")&&dropResults[dropResult].type===results[result].type){var resultLine=JSON.parse('{ "name":"'+results[result].name+'","id":"'+results[result].id+'","location":"'+results[result].location+'","thumb":"'+results[result].image+'","creator":"'+results[result].createdby+'","date":"'+results[result].createdate+'"}');dropResults[dropResult].results.push(resultLine);addNew=false;}}
if(addNew==true){var resultLine='{ "name":"'+results[result].name+'","id":"'+results[result].id+'","location":"'+results[result].location+'","thumb":"'+results[result].image+'","creator":"'+results[result].createdby+'","date":"'+results[result].createdate+'"}';var myObjs=JSON.parse('{ "type":"'+results[result].type+'","results":['+resultLine+'] }')
dropResults.push(myObjs);}}
var htmlResult="";for(var dropResult=0;dropResult<dropResults.length;dropResult++){htmlResult+="<div class='quickSearchRecordType'>";htmlResult+="<div class='typeTitle type-title'>"+dropResults[dropResult].type+"</div>";htmlResult+="<div class='typeRecords'>";for(var result=0;result<dropResults[dropResult].results.length;result++){htmlResult+="<div class='quickSearchRecord quickClick flex' data-type='"+dropResults[dropResult].type+"' data-id='"+dropResults[dropResult].results[result].id+"'>";htmlResult+="<div class='title flex-1 self-center'>"+dropResults[dropResult].results[result].name+"</div>";htmlResult+="<div class='path flex flex-1 self-center'>"+dropResults[dropResult].results[result].location+"/</div>";htmlResult+="<div class='Creator flex flex-1 self-center'>"+dropResults[dropResult].results[result].creator+"</div>";htmlResult+="<div class='date flex flex-1 self-center'>"+((dropResults[dropResult].results[result].date!="")?sd.Utils.formatDate(dropResults[dropResult].results[result].date,"dd mmm yy"):"")+"</div>";htmlResult+="</div>";}
htmlResult+="</div>";htmlResult+="</div>";}
$("#quickSearchDropDown .results").append(htmlResult);$(".quickClick").unbind("click").bind("click",function(event){var type=$(this).data('type');if(type=="user"){$("li").find("[data-template='team']").addClass("brand-current");LoadSection("team",true,{userID:$(this).data('id'),userName:$(this).data('username')});}
else if(type=="attachment"){previewer.open($(this).data('id'));}
else{JumpToItem($(this).data('id'));}
$("#quickSearchDropDown").hide();});}else{return;}};runSearch.handleQuickSearchError=function(){$("#quickSearchDropDown").hide();}
runSearch.handleResults=function(results){runSearch.currentList=results;runSearch.currentPage=1;var listCount=runSearch.currentList.length;var countHeader=listCount;$("#dvSearchCount").html(countHeader);if(searchObj.inodeList.length>0){var sc=new sd.ServerCall("GetItemMetaAttributes");var obj={};obj.inodes=searchObj.inodeList.join(",");obj.returnAll=false;sc.data(obj);sc.go({onSuccess:runSearch.buildFilterMenu,onError:runSearch.handleError});}
else{runSearch.createList(runSearch.currentSortBy,null);}};runSearch.buildFilterMenu=function(myData,status){var item;var htmlOut="";var currentMetaType="";runSearch.allUniqueMetaAttributes=[];runSearch.allMetaAttributes=[];for(var idx=0;idx<myData.length;idx++){item=myData[idx];var obj={};obj.id=myData[idx].i;obj.type=myData[idx].t;obj.value=myData[idx].v;if(obj.type=="startdate"||obj.type=="enddate")
continue;runSearch.allUniqueMetaAttributes.push(obj);obj.inode=myData[idx].nd;runSearch.allMetaAttributes.push(obj);}
runSearch.allUniqueMetaAttributes=sd.Utils.removeObjectArrayDuplicates(runSearch.allUniqueMetaAttributes,"id");runSearch.allUniqueMetaAttributes.sort(sd.Utils.dynamicSortMultiple("type","value"));htmlOut="";for(var idx=0;idx<runSearch.allUniqueMetaAttributes.length;idx++){item=runSearch.allUniqueMetaAttributes[idx];if(item.type!=currentMetaType){if(currentMetaType!="")htmlOut+="</div>";currentMetaType=item.type;htmlOut+="<h3><span class=\"accordionHead\">"+currentMetaType.charAt(0).toUpperCase()+currentMetaType.slice(1)+"<button class=\"accordionUpdate tiny brand ma-r-1\" style=\"display:none\">Update</button></span></h3><div>";}
htmlOut+="<div class=\"accordion-menu\">";htmlOut+="<label class = \"filterText\" data-id=\""+item.id+"\" data-value=\""+item.value+"\" data-type=\""+item.type+"\">";htmlOut+="<input type=\"checkbox\" id=\"chk"+item.id+"\" value=\""+item.id+"\"/>"+item.value+"</label><label id=\"lblFilterCount"+item.id+"\" class=\"cs-notification\">0</label>";htmlOut+="</div>";}
$("#dvSearchMetaFilters").empty().show().append("<div id=\"dvSearchFilterAccordion\" class=\"flex-column flex\"></div>");$("#dvSearchFilterAccordion").append(htmlOut).accordion({heightStyle:"content",active:false,collapsible:true});$(".filterText").click(function(){runSearch.currentPage=1;var id=$(this).data('id');var type=$(this).data('type');var value=$(this).data('value');if($("#chk"+id).prop("checked")==true){var obj={};obj.id=id;obj.type=type;obj.value=value;runSearch.appliedFilters.push(obj);}
else{runSearch.removeFilterFromArray(id)}
$("#dvSearchFilterAccordion").find(".accordionUpdate").hide();$(this).parent().parent().prev("h3").find(".accordionUpdate").show();});$('.accordionUpdate').click(function(){runSearch.updateFilterCounts();$(".accordionUpdate").hide();runSearch.currentPage=1;runSearch.createList(runSearch.currentSortBy,null);});runSearch.createList(runSearch.currentSortBy,null);}
runSearch.filterData=function(){for(var k=0;k<runSearch.allUniqueMetaAttributes.length;k++)
$("#chk"+runSearch.allUniqueMetaAttributes[k].id).prop("checked",false);$("#dvSearchSelectedMetaFilters").empty();var html="";var filterData=[];var item;if(runSearch.appliedFilters.length>0)
$("#searchReset_btn").show();else
$("#searchReset_btn").hide();for(var k=0;k<runSearch.appliedFilters.length;k++){item=runSearch.appliedFilters[k];if(k==0)html="Selected Filters: <br><br>";html+="<span class=\"tag\"><i class=\"icon-remove-sign\" title=\"Remove Filter\" onClick=\"runSearch.removeFilterFromPanel("+item.id+")\"></i><label onClick=\"runSearch.removeFilterFromPanel("+item.id+")\">";html+=" "+item.value;html+=" </span>";$("#chk"+item.id).prop("checked",true);html+="</label>";if(filterData[runSearch.appliedFilters[k].type]==undefined)
filterData[runSearch.appliedFilters[k].type]=[];filterData[runSearch.appliedFilters[k].type].push(runSearch.appliedFilters[k]);}
$("#dvSearchSelectedMetaFilters").html(html);var listCount=runSearch.currentList.length;var arrUniqueTypes=sd.Utils.removeObjectArrayDuplicates(runSearch.appliedFilters,"type");var uniqueTypes=arrUniqueTypes.length;runSearch.filteredList=[];runSearch.filteredMetaAttributes=[];for(var idx=0;idx<listCount;idx++){var match=false;item=runSearch.currentList[idx];if(runSearch.appliedFilters.length==0){match=true;}
else{var matchCount=0;var typeMatch;if(Object.keys(filterData).length>0){var filter;for(var key in filterData){typeMatch=false;for(var i=0;i<filterData[key].length;i++){filter=filterData[key][i];for(var j=0;j<runSearch.allMetaAttributes.length;j++){if((runSearch.allMetaAttributes[j].inode==item.id)&&(runSearch.allMetaAttributes[j].id==filter.id)){matchCount++;typeMatch=true;break;}}
if(typeMatch==true)break;}}
if(matchCount==uniqueTypes)match=true;}}
if(!match)continue;for(var i=0;i<runSearch.allMetaAttributes.length;i++){if(item.id==runSearch.allMetaAttributes[i].inode){var obj={};obj.id=runSearch.allMetaAttributes[i].id;obj.value=runSearch.allMetaAttributes[i].value;obj.type=runSearch.allMetaAttributes[i].type;runSearch.filteredMetaAttributes.push(obj);}}
runSearch.filteredList.push(item);}
runSearch.updateFilterCounts();}
runSearch.updateFilterCounts=function(){var filterText=$('#txtSearchTerm').val().toLowerCase();for(var k=0;k<runSearch.allUniqueMetaAttributes.length;k++){var count=0;if(runSearch.appliedFilters.length==0&&filterText=="")
count=sd.Utils.countObjectArrayValues(runSearch.allMetaAttributes,"id",runSearch.allUniqueMetaAttributes[k].id);else
count=sd.Utils.countObjectArrayValues(runSearch.filteredMetaAttributes,"id",runSearch.allUniqueMetaAttributes[k].id);if(count>0){$("#lblFilterCount"+runSearch.allUniqueMetaAttributes[k].id).parent().show();$("#lblFilterCount"+runSearch.allUniqueMetaAttributes[k].id).text(count);$("#lblFilterCount"+runSearch.allUniqueMetaAttributes[k].id).addClass('cs-notification light-grey self-end');}
else{$("#lblFilterCount"+runSearch.allUniqueMetaAttributes[k].id).parent().hide();}
$("#dvSearchFilterAccordion h3").each(function(index){var count=0;$(this).next("div").children().each(function(index){if($(this).css("display")=="none")count++;});if(count==$(this).next("div").children().length){$(this).hide();}
else{$(this).show();}});}}
runSearch.createList=function(sortBy,sortDirection){runSearch.filterData();var listCount=runSearch.filteredList.length;var countHeader=listCount;$("#dvSearchCount").html(countHeader);runSearch.pagingOptions={prev_text:"<i class=\"icon-double-angle-left\"></i> Prev",next_text:"Next <i class=\"icon-double-angle-right\"></i>",num_display_entries:9,current_page:runSearch.currentPage-1,num_edge_entries:1,callback:runSearch.changePage,items_per_page:runSearch.itemsPerPage}
var endIndex=(runSearch.currentPage)*runSearch.itemsPerPage;var startIndex=endIndex-runSearch.itemsPerPage;if(endIndex>listCount)endIndex=listCount;if(sortDirection!=null){if(runSearch.currentSortBy==sortBy){if(sortDirection!=runSearch.currentSortDirection){if(runSearch.currentSortDirection=="ASC")runSearch.currentSortDirection="DESC";else runSearch.currentSortDirection="ASC";}}
else{runSearch.currentSortBy=sortBy;runSearch.currentSortDirection=sortDirection||"ASC";}}
if(runSearch.currentSortBy=="name")sd.Utils.sortArrayByString(runSearch.filteredList,"name");else if(runSearch.currentSortBy=="location")sd.Utils.sortArrayByString(runSearch.filteredList,"location");else if(runSearch.currentSortBy=="createdby")sd.Utils.sortArrayByString(runSearch.filteredList,"createdby");else if(runSearch.currentSortBy=="createdate")sd.Utils.sortArrayByJSDate(runSearch.filteredList,"createdate");$('#dvSearch .icon-chevron-up').hide();$('#dvSearch .icon-chevron-down').hide();var sortArrow="icon-chevron-up";if(runSearch.currentSortDirection=="DESC")sortArrow="icon-chevron-down";if(runSearch.currentSortBy=="name")$('#dvSearch #dvNameSort > .'+sortArrow).show();if(runSearch.currentSortBy=="location")$('#dvSearch #dvLocationSort > .'+sortArrow).show();if(runSearch.currentSortBy=="createdby")$('#dvSearch #dvCreatorSort > .'+sortArrow).show();if(runSearch.currentSortBy=="createdate")$('#dvSearch #dvDateSort > .'+sortArrow).show();sd.Utils.killAllVideos();$("#dvSearchList").empty();runSearch.totalPages=Math.ceil(listCount/runSearch.itemsPerPage);$("#dvSearchHeaderPages").empty();$("#dvSearchFooterPages").empty();if(runSearch.totalPages>1){$("#dvSearchHeaderPages").pagination(listCount,runSearch.pagingOptions);$("#dvSearchFooterPages").pagination(listCount,runSearch.pagingOptions);}
if(listCount==0){$("#dvSearchList").html("<h6 class=\"quiet text-center pa-l-1 w-12\">"+sd.Configuration.searchNoResultsMessage+"</h6>");$('#loader').hide();}
else{if(runSearch.viewMode=="list")
runSearch.displayListView(startIndex,endIndex);else
runSearch.displayThumbView(startIndex,endIndex);}}
runSearch.displayListView=function(startIdx,endIdx){$("#searchThumb_btn").removeClass("view-as-selected ");$("#searchList_btn").addClass("view-as-selected");window.scrollTo(0,0);var fragment=document.createDocumentFragment();var clone;for(var idx=startIdx;idx<endIdx;idx++){var item=runSearch.filteredList[idx];if(runSearch.currentSortDirection=="DESC")item=runSearch.filteredList[runSearch.filteredList.length-(idx+1)];clone=$(".guide .searchListGuide").clone().appendTo(fragment);clone.data({"id":item.id,"type":item.type});if(item.type=="user"){clone.data({"username":item.createdby});clone.find(".js-file-name").html(item.name);clone.find(".js-file-location").html(item.location);clone.find(".js-field1").html(item.jobtitle);clone.find(".js-field2").html(item.email);if(item.csImage!=null&&item.csImage>0){if(String(item.csImage).indexOf("base64")>-1){clone.find(".js-image").css({'background-image':'url('+item.csImage+')','background-size':'cover'});}
else{clone.find(".js-image").css({'background-image':'url('+sd.Configuration.vault+"/"+item.csImage+"/bigthumb.jpg"+')','background-size':'cover'});}}
else if(item.image!=null&&item.image>0){if(String(item.image).indexOf("base64")>-1){clone.find(".js-image").css({'background-image':'url('+item.image+')','background-size':'cover'});}
else{clone.find(".js-image").css({'background-image':'url('+sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg"+')','background-size':'cover'});}}
else{var fullName=item.name.split(' ');if(item.ac==null){item.ac=users.UpdateColour(item.id);}
var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();clone.find(".js-image").html("<h2 class=\"user-no-image-small centerxy\">"+userInitials+"</h2>").css({"background-color":item.ac,"text-align":"center","color":"white","line-height":"35px"});}}
else if(item.type=="egnyte"){clone.data({"etype":item.etype,"epath":item.epath,"name":item.name});clone.find(".js-file-name").html(item.name);clone.find(".js-field1").html(item.description);clone.find(".js-file-location").html(item.location);clone.find(".js-file-author").html(item.createdby);if(item.etype=="file")
clone.find(".js-file-date").html(sd.Utils.formatDate(item.createdate,"dd mmm yy"));if(item.etype=="folder")
clone.find(".js-image").css({'background-image':'url(images/docicons/egnyte-folder.png)','background-size':'cover'});else
clone.find(".js-image").css({'background-image':'url(images/docicons/egnyte-doc.png)','background-size':'cover'});}
else{if(item.type=='link'){clone.data({"link":String(item.name).split("||")[1]});clone.find(".js-file-name").html(String(item.name).split("||")[0]);}else{clone.find(".js-file-name").html(item.name);}
clone.find(".js-field1").html(item.description);clone.find(".js-file-location").html(item.location);clone.find(".js-file-author").html(item.createdby);clone.find(".js-file-date").html(sd.Utils.formatDate(item.createdate,"dd mmm yy"));if(item.type=="map"){clone.find(".js-image").css({'background-image':'url(images/docicons/map-icon.png)','background-size':'cover'});}
else if(item.type=="article"){clone.find(".js-image").css({'background-image':'url(images/docicons/article-icon.png)','background-size':'cover'});}
else if(item.type=="newsletter"){var image=sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg";if(item.image!=null&&item.image>0)
clone.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});else
clone.find(".js-image").css({'background-image':'url(images/mccann/newsletter-default.png)','background-size':'cover'});}
else{if(sd.Utils.isVideo(item.format)){var html="<video class='videoClass' id='"+item.id+"' style=\"width: 100%; height: 100%;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.id+"/"+item.id+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";clone.find(".js-image").html(html);}
else{clone.find(".js-image").css({'background-image':'url('+sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg"+')','background-size':'cover'});}}}}
$("#dvSearchList").html(fragment);$("#dvSearchList .downloadEgnyte").unbind("click").bind("click",function(){var etype=$(this).closest(".searchListGuide").data('etype');var epath=$(this).closest(".searchListGuide").data('epath');var name=$(this).closest(".searchListGuide").data('name');if(etype=="file"){var url=sd.Configuration.ws+"/EgnyteDownload.aspx?action=DownloadFile&fPath="+epath+"&fName="+name;window.open(url,"_self");}
else{var url=sd.Configuration.egnyteFolderStub+epath;window.open(url);}});$("#dvSearchList .listHeaderClick").unbind("click").bind("click",function(){var type=$(this).closest(".searchListGuide").data("type");if(type=="user"){$("li").find("[data-template='team']").addClass("brand-current");LoadSection("team",true,{userID:$(this).closest(".searchListGuide").data("id"),userName:$(this).closest(".searchListGuide").data("username"),fromSearch:true});}
else if(type=="egnyte"){var etype=$(this).closest(".searchListGuide").data('etype');var epath=$(this).closest(".searchListGuide").data('epath');var name=$(this).closest(".searchListGuide").data('name');if(etype=="file"){var url=sd.Configuration.ws+"/EgnyteDownload.aspx?action=DownloadFile&fPath="+epath+"&fName="+name;window.open(url,"_self");}
else{var url=sd.Configuration.egnyteFolderStub+epath;window.open(url);}}
else if(type=="link"){var url=$(this).closest(".searchListGuide").data("link");window.open(url,'_blank');}
else if(type=="attachment"){previewer.open($(this).closest(".searchListGuide").data('id'));}
else{JumpToItem($(this).closest(".searchListGuide").data('id'),true);}});$("#dvSearchList .downloadClick").unbind("click").bind("click",function(){var now=new Date().getTime();var url=sd.Configuration.ws+'/DownloadFile.aspx?inode='+$(this).closest(".searchListGuide").data('id')+"&timestamp"+now;window.open(url);});$('#loader').hide();}
runSearch.displayThumbView=function(startIdx,endIdx){window.scrollTo(0,0);var fragment=document.createDocumentFragment();var clone;for(var idx=startIdx;idx<endIdx;idx++){var item=runSearch.filteredList[idx];if(runSearch.currentSortDirection=="DESC")item=runSearch.filteredList[runSearch.filteredList.length-(idx+1)];clone=$(".guide .searchThumbGuide").clone().appendTo(fragment);clone.data({"id":item.id,"type":item.type});clone.find(".js-file-name").html(item.name);if(item.type=='link'){clone.data({"link":String(item.name).split("||")[1]});clone.find(".js-file-name").html(String(item.name).split("||")[0]);}else{clone.find(".js-file-name").html(item.name);}
if(item.type=="user"){if(item.csImage!=null&&item.csImage>0){if(String(item.csImage).indexOf("base64")>-1){clone.find(".js-image").css({'background-image':'url('+item.csImage+')','background-size':'cover'});}
else{clone.find(".js-image").css({'background-image':'url('+sd.Configuration.vault+"/"+item.csImage+"/bigthumb.jpg"+')','background-size':'cover'});}}
else if(item.image!=null&&item.image>0){if(String(item.image).indexOf("base64")>-1){clone.find(".js-image").css({'background-image':'url('+item.image+')','background-size':'cover'});}
else{clone.find(".js-image").css({'background-image':'url('+sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg"+')','background-size':'cover'});}}
else{var fullName=item.name.split(' ');if(item.ac==null){item.ac=users.UpdateColour(item.id);}
var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();clone.find(".js-image").html("<span class=\"user-no-image-small\">"+userInitials+"</span>").css({"background-color":item.ac,"text-align":"center","color":"white","line-height":"35px"});}}
else if(item.type=="egnyte"){clone.data({"etype":item.etype,"epath":item.epath,"name":item.name});if(item.etype=="file")
clone.find(".js-file-date").html(sd.Utils.formatDate(item.createdate,"dd mmm yy"));if(item.etype=="folder")
clone.find(".js-image").css({'background-image':'url(images/docicons/egnyte-folder.png)','background-size':'cover'});else
clone.find(".js-image").css({'background-image':'url(images/docicons/egnyte-doc.png)','background-size':'cover'});}
else{if(item.type=="map"){clone.find(".js-image").css({'background-image':'url(images/docicons/map-icon.png)','background-size':'cover'});}
else if(item.type=="article"){clone.find(".js-image").css({'background-image':'url(images/docicons/article-icon.png)','background-size':'cover'});}
else if(item.type=="newsletter"){clone.find(".js-image").css({'background-image':'url(images/mccann/newsletter-default.png)','background-size':'cover'});}
else{if(sd.Utils.isVideo(item.format)){var html="<video class='videoClass' id='"+item.id+"' style=\"width: 100%; height: 100%;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.id+"/"+item.id+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";clone.find(".js-image").html(html);}
else{clone.find(".js-image").css({'background-image':'url('+sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg"+')','background-size':'cover'});}}}}
$("#dvSearchList").html(fragment);$("#dvSearchList .downloadEgnyte").unbind("click").bind("click",function(){var etype=$(this).closest(".searchThumbGuide").data('etype');var epath=$(this).closest(".searchThumbGuide").data('epath');var name=$(this).closest(".searchThumbGuide").data('name');if(etype=="file"){var url=sd.Configuration.ws+"/EgnyteDownload.aspx?action=DownloadFile&fPath="+epath+"&fName="+name;window.open(url,"_self");}
else{var url=sd.Configuration.egnyteFolderStub+epath;window.open(url);}});$("#dvSearchList .listHeaderClick").unbind("click").bind("click",function(){var type=$(this).closest(".searchThumbGuide").data("type");if(type=="user"){$("li").find("[data-template='team']").addClass("brand-current");LoadSection("team",true,{userID:$(this).closest(".searchThumbGuide").data("id"),userName:$(this).closest(".searchThumbGuide").data("username"),fromSearch:true});}
else if(type=="egnyte"){var etype=$(this).closest(".searchListGuide").data('etype');var epath=$(this).closest(".searchListGuide").data('epath');var name=$(this).closest(".searchListGuide").data('name');if(etype=="file"){var url=sd.Configuration.ws+"/EgnyteDownload.aspx?action=DownloadFile&fPath="+epath+"&fName="+name;window.open(url,"_self");}
else{var url=sd.Configuration.egnyteFolderStub+epath;window.open(url);}}
else if(type=="link"){var url=$(this).closest(".searchThumbGuide").data("link");window.open(url,'_blank');}
else if(type=="attachment"){previewer.open($(this).closest(".searchListGuide").data('id'));}
else{JumpToItem($(this).closest(".searchThumbGuide").data('id'),true);}});$("#dvSearchList .downloadClick").unbind("click").bind("click",function(){var now=new Date().getTime();var url=sd.Configuration.ws+'/DownloadFile.aspx?inode='+$(this).closest(".searchThumbGuide").data('id')+"&timestamp"+now;window.open(url);});$('#loader').hide();};runSearch.addEventListeners=function(){$("#searchList_btn").unbind("click").bind("click",function(){runSearch.viewMode="list";runSearch.createList(runSearch.currentSortBy,null);$("#searchThumb_btn").removeClass("view-as-selected ");$("#searchList_btn").addClass("view-as-selected ");});$("#searchThumb_btn").unbind("click").bind("click",function(){runSearch.viewMode="thumb";runSearch.createList(runSearch.currentSortBy,null);$("#searchList_btn").removeClass("view-as-selected ")
$("#searchThumb_btn").addClass("view-as-selected ");});$("#searchReset_btn").unbind("click").bind("click",function(){runSearch.appliedFilters=[];runSearch.createList(runSearch.currentSortBy,null);$("#searchReset_btn").hide();});$("#searchReset_btn").hide();$("#runSearch_btn").unbind("click").bind("click",function(){var searchString=$('#txtSearchTerm').val();sd.Utils.historyAdd({'section':'search','term':searchString,'mode':'simple'});runSearch.doSearch();});$("#txtSearchTerm").keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){var searchString=$('#txtSearchTerm').val();runSearch.AdvancedSearch(searchString);}});$("#dvSearch .js-runAdv").unbind("click").bind("click",function(){var searchString=$('#txtSearchTerm').val();runSearch.AdvancedSearch(searchString);});};runSearch.doSearch=function(){var searchString=$('#txtSearchTerm').val();var errMsg=runSearch.validSearchTerm(searchString);if(errMsg!=""){sd.component.messageBox.action({title:"Search",height:150,text:errMsg,btn1:"Ok"});return;}
$('#loader').show();runSearch.SimpleSearch(searchString);$('#hSearchString').text("Search Term ("+searchString+")");};runSearch.removeFilterFromArray=function(id){for(var j=0;j<runSearch.appliedFilters.length;j++){if(runSearch.appliedFilters[j].id==id){runSearch.appliedFilters.splice(j,1);break;}}};runSearch.changePage=function(newPage){runSearch.currentPage=newPage+1;runSearch.createList("name",null);};runSearch.handleError=function(error){console.log(error);};runSearch.validSearchTerm=function(searchTerm){if(searchTerm.length==0)
return"Please enter a search term.";if(searchTerm.length<3)
return"Your search term '"+searchTerm+"' must be greater than 2 characters.";return"";}
runSearch.removeFilterFromPanel=function(id){runSearch.currentPage=1;runSearch.removeFilterFromArray(id);runSearch.createList("sortname",null);}
runSearch.locationOptions=function(){var html="";html="<option value=\"0\" selected>All</option>";var topElements=$(".nav-top-a");for(var i=0;i<topElements.length;i++){html+="<option value=\""+topElements[i].attributes["data-inode"].value+"\"";html+=" data-template=\""+topElements[i].attributes["data-template"].value+"\">"+topElements[i].innerHTML+"</option>";if(topElements[i].attributes["data-template"].value=="egnyteEmbed"){$("#dvAdvancedSearchOptions .js-inclEgnyte").show();}}
$('#advSearchLocation').html(html);}
window.runSearch=runSearch;}(window));﻿(function(window){var sectionAdmins={};sectionAdmins.selectedItem=null;sectionAdmins.currentSortDirection="";sectionAdmins.currentSortBy="";sectionAdmins.currentList=[];sectionAdmins.init=function()
{sectionAdmins.selectedItem={};sectionAdmins.listItems();sectionAdmins.addEventListeners();}
sectionAdmins.listItems=function(){var sc=new sd.ServerCall("ListGroups");sc.go({onSuccess:sectionAdmins.handleList,onError:sectionAdmins.handleError});}
sectionAdmins.handleList=function(myData,status){sectionAdmins.currentList=[];for(var idx=0;idx<myData.length;idx++){if(myData[idx].sg=="1")
{var item={}
item.id=myData[idx].i;item.name=myData[idx].n;item.csid=myData[idx].ct;$('#saGroupsList').append('<option value="'+item.id+'">'+item.name+'</option>');sectionAdmins.currentList.push(item);}}
sectionAdmins.editGroupMembers();}
sectionAdmins.editGroupMembers=function(){$("#loader").show();sectionAdmins.selectedItem.id=$("#saGroupsList").val()
var obj={};obj.groupID=sectionAdmins.selectedItem.id
var sc=new sd.ServerCall("ListGroupMembers");sc.data(obj);sc.go({onSuccess:sectionAdmins.handleGroupMembers,onError:sectionAdmins.handleError});}
sectionAdmins.handleGroupMembers=function(myData,status){$("#saDialogID").val(sectionAdmins.selectedItem.id);$('#lstUsers').empty();var item;for(i=0;i<myData.length;i++){item=myData[i];if(item.m=="1")
$('#lstUsers').append('<option value="'+item.un+'" selected="selected" data-type="user">'+item.dn+'</option>');else
$('#lstUsers').append('<option value="'+item.un+'" data-type="user">'+item.dn+'</option>');}
$('#searchable-form').multiSelect({selectableHeader:'<input style="width:100%;" type="text" id="search" value="" autocomplete = "off"/>',width:250,backgroundHeight:296,selBackgroundHeight:296,height:271,selHeight:298,applyIcons:true});$('#searchable-form').multiSelect();$('#searchable-form').multiSelect('refresh');$('#search').focus();$('input#search').quicksearch('#ms-searchable-form .ms-selectable li');$("#loader").hide();}
sectionAdmins.updateSaveMembership=function(){var value=$('#searchable-form').find('select').val();var users=value?""+value+"":"";var obj={};obj.groupID=$("#saDialogID").val();obj.users=users;var sc=new sd.ServerCall("UpdateGroupMembers");sc.data(obj);sc.go({onSuccess:sectionAdmins.confirmSave,onError:groups.handleError});}
sectionAdmins.confirmSave=function(){sd.component.messageBox.action({title:"Success",text:"Update Successful",btn1:"OK",height:171});}
sectionAdmins.addEventListeners=function(){$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});$("#saCancelBtn").bind("click",function(){LoadSection("admin",false);});$("#saSaveBtn").bind("click",function(){sectionAdmins.updateSaveMembership();});$('select[id="saGroupsList"]').change(function(){sectionAdmins.editGroupMembers();});}
window.sectionAdmins=sectionAdmins;}(window));﻿(function(window){var sectionMetaAttributes={};sectionMetaAttributes.currentSortDirection="";sectionMetaAttributes.currentSortBy="";sectionMetaAttributes.sections=[];sectionMetaAttributes.types=[];sectionMetaAttributes.currentAttributes=[];sectionMetaAttributes.currentSection="";sectionMetaAttributes.init=function(){sectionMetaAttributes.currentSortDirection="ASC";sectionMetaAttributes.currentSortBy="label";sectionMetaAttributes.sections=[];sectionMetaAttributes.types=[];sectionMetaAttributes.currentAttributes=[];sectionMetaAttributes.currentSection="";var sc=new sd.ServerCall("ListMetaAttributeTypes");sc.go({onSuccess:sectionMetaAttributes.handleAttributeTypes,onError:metaAttributes.handleError});$("#loader").show();$("#dvSectionMetaList").empty();for(i=0;i<sd.Configuration.folderTemplates.length;i++){var item=sd.Configuration.folderTemplates[i];if(item.allowMeta){sectionMetaAttributes.sections.push({label:item.label,type:item.contentType});}}
sectionMetaAttributes.displayList();$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleName').click(function(){sectionMetaAttributes.displayList("label")});$('#metaFilterText').on('input',function(){sectionMetaAttributes.displayList(sectionMetaAttributes.currentSortBy,sectionMetaAttributes.currentSortDirection);});sectionMetaAttributes.addEventListeners();}
sectionMetaAttributes.handleAttributeTypes=function(myData,status){$("#loader").hide();sectionMetaAttributes.sectionAttributes=[];for(var idx=0;idx<myData.length;idx++){sectionMetaAttributes.sectionAttributes.push(myData[idx]);}}
sectionMetaAttributes.displayList=function(sortBy,sortDirection){if(sectionMetaAttributes.currentSortBy=="label")sd.Utils.sortArrayByString(sectionMetaAttributes.sections,"label");if(sectionMetaAttributes.currentSortBy==sortBy){if(sortDirection!=sectionMetaAttributes.currentSortDirection){if(sectionMetaAttributes.currentSortDirection=="ASC")sectionMetaAttributes.currentSortDirection="DESC";else sectionMetaAttributes.currentSortDirection="ASC";}}
else{sectionMetaAttributes.currentSortBy=sortBy;sectionMetaAttributes.currentSortDirection=sortDirection||"ASC";if(sectionMetaAttributes.currentSortBy=="label")sd.Utils.sortArrayByString(sectionMetaAttributes.currentList,"label");}
$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(sectionMetaAttributes.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(sectionMetaAttributes.currentSortBy=="label")$('#sectionContainer .sectionTitleName > .'+sortArrow).show();var htmlOut="";var listCount=sectionMetaAttributes.sections.length;var filterText=$('#metaFilterText').val().toLowerCase();for(var idx=0;idx<listCount;idx++){var item=sectionMetaAttributes.sections[idx];if(sectionMetaAttributes.currentSortDirection=="DESC")item=sectionMetaAttributes.sections[listCount-(idx+1)];if(filterText!=""&&item.label.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<div class='row grid' data-metatype='"+item.type+"' data-metalabel='"+item.label+"' data-metacsid='"+item.csid+"'>   \
                            <div class='yui3-u-3-5'><div class='section-list-field pa-l-1 brand-text'>"+item.label+"</div></div> \
                            <div class='yui3-u-1-5'><div class='section-list-field'> \
                            <button class=\"admin-edit-btn small-rnd brand ma-r-half\"><i class=\"icon-edit\"></i></button></div></div> \
                        </div>";}
$('#dvSectionMetaList').html(htmlOut);$("#loader").hide();$(".admin-edit-btn").click(function(){var label=$(this).parent().parent().parent().data('metalabel');var type=$(this).parent().parent().parent().data('metatype');sectionMetaAttributes.currentSection=type;sectionMetaAttributes.getSectionMetaTags({label:label,type:type});});}
sectionMetaAttributes.getSectionMetaTags=function(objMeta){var sc=new sd.ServerCall("ListSectionMetaTags");var obj={};obj.section=objMeta.type;sc.data(obj);sc.go({onSuccess:sectionMetaAttributes.editMeta,onError:sectionMetaAttributes.handleError});}
sectionMetaAttributes.editMeta=function(myData){sectionMetaAttributes.currentAttributes=myData;sd.component.messageBox.action({title:"Edit Section Tags - "+sectionMetaAttributes.currentSection,height:220,width:600,loadCallback:function(){var type;var optionHTML="";$("#sectionType").val(sectionMetaAttributes.currentSection);for(var t=0;t<sectionMetaAttributes.types.length;t++)
{type=sectionMetaAttributes.types[t];optionHTML='<option data-type ="'+type.type+'"  value="'+type.id+'" ';$.each(sectionMetaAttributes.currentAttributes,function(i,v){if($(this)[0].attrID==type.id)
optionHTML+=' selected ';})
optionHTML+='>'+type.label+'</option>';$('#lstTags').append(optionHTML);}
$('#lstTags').multiSelect();},template:sd.Configuration.templates.sectionMetaAttributeDetails,btn1callback:function(){sectionMetaAttributes.metaSave()},icon1:"icon-save",btn1:"Save",icon2:"icon-ban-circle",btn2:"Cancel"});}
sectionMetaAttributes.metaSave=function(){var obj={};obj.attrIDs=[];$('.ms-elem-selected').each(function(){obj.attrIDs.push($(this).attr("ms-value"));});obj.section=$("#sectionType").val();var sc=new sd.ServerCall("UpdateSectionMetaAttributes");sc.data(obj);sc.go({onSuccess:sectionMetaAttributes.onSuccess,onError:metaAttributes.handleError});}
sectionMetaAttributes.onSuccess=function(){sd.component.messageBox.close();}
sectionMetaAttributes.handleAttributeTypes=function(myData,status)
{$("#loader").hide();sectionMetaAttributes.types=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.id=myData[idx].id;item.label=myData[idx].label;item.type=myData[idx].type;item.csid=myData[idx].csid;item.disabled=myData[idx].disabled;sectionMetaAttributes.types.push(item);}}
sectionMetaAttributes.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:220,width:400,text:error,btn1:"Ok"});}
sectionMetaAttributes.handleSaveError=function(error){sd.component.messageBox.showError(error);}
sectionMetaAttributes.addEventListeners=function(){$("#metaAdminAdd_btn").bind("click",function(){sectionMetaAttributes.showDetailsDialog();});$("#metaAdminAddType_btn").bind("click",function(){sectionMetaAttributes.addTypeDialog();});$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});$("#cboAttributeType").bind("change",function(){sectionMetaAttributes.listItems($("#cboAttributeType").val());});}
window.sectionMetaAttributes=sectionMetaAttributes;}(window));﻿(function(window){var sendEmail={};sendEmail.users=[];sendEmail.groups=[];sendEmail.subject="";sendEmail.body="";sendEmail.type="site";sendEmail.callback="";sendEmail.init=function(options){sendEmail.users=(options==undefined)?[]:options.users;sendEmail.groups=(options==undefined)?[]:options.groups;sendEmail.subject=(options==undefined)?"":options.subject;sendEmail.body=(options==undefined)?"":options.body;sendEmail.type=(options==undefined)?"site":options.type;sendEmail.source=(options==undefined)?"":options.source;sendEmail.callback=(options==undefined)?function(){}:options.callback;sendEmail.addEventListeners();if(sendEmail.type=="site")
sendEmail.loadForm();else
sendEmail.loadFormSpecifiedUsers();}
sendEmail.loadFormSpecifiedUsers=function(){$('#sendEmailUserTable').hide();$('#txtSubject').val(sendEmail.subject);CKEDITOR.replace('txtBody');CKEDITOR.instances.txtBody.setData(sendEmail.body)
$('#txtSubject').focus();}
sendEmail.loadForm=function(){var sc=new sd.ServerCall("ListAllUsersAndGroups",0);sc.go({onSuccess:sendEmail.populateGroupsUsers,onError:sendEmail.handleError});}
sendEmail.populateGroupsUsers=function(myData,status){var item;for(i=0;i<myData.length;i++){item=myData[i];$('#lstUsers').append('<option data-type ="'+item.t+'"  value="'+item.i+'">'+item.n+'</option>');}
$('#searchable-form').multiSelect({selectableHeader:'<input class="box-sizing" placeholder="Select Users and Groups" style="width:100%;" type="text" id="search" value="" autocomplete = "off"/>',width:306,backgroundHeight:200,selBackgroundHeight:200,height:175,selHeight:198,applyIcons:true});$('input#search').quicksearch('#ms-searchable-form .ms-selectable li');$('#searchable-form').multiSelect();$('#search').focus();CKEDITOR.replace('txtBody');}
sendEmail.sendSiteEmail_Send=function(){var emailSubject=$.trim($("#dvSendSiteEmail input[name=txtSubject]").val());var emailBody=CKEDITOR.instances.txtBody.getData();var recipientUsers=[];var recipientGroups=[];if(sendEmail.type=="site")
{$('.ms-elem-selected').each(function(){if(($(this).attr('data-type')!=undefined)&&(($(this).attr('ms-value')!=undefined))){if($(this).attr('data-type')=="user")
recipientUsers.push($(this).attr("ms-value"));else
recipientGroups.push($(this).attr("ms-value"));}});}
else
{recipientGroups=sendEmail.groups;recipientUsers=sendEmail.users;}
if((emailSubject=="")||(emailBody=="")||(recipientGroups.length<1&&recipientUsers.length<1)){var errStr="<span class='errMsg'>";errStr+="Required Field(s) *, 'Subject', 'Body' and at least one 'Recipient' must be entered.";errStr+="</span>";$("#dvValidationError").show();$("#dvValidationError").html(errStr);}
else{var obj={};obj.subject=emailSubject;obj.body=emailBody;obj.recipientUsers=recipientUsers;obj.recipientGroups=recipientGroups;obj.emailFrom="";obj.source=sendEmail.source;var sc=new sd.ServerCall("SendEmail",0);sc.data(obj);sc.go({onSuccess:sendEmail.sendSiteEmail_EmailSent,onError:sendEmail.handleError});}}
sendEmail.sendSiteEmail_EmailSent=function(myData,status){sd.component.messageBox.action({title:"Sending Email",height:150,text:"Your email is currently processing and will be added to the queue. It will be sent shortly.",btn1:"Ok"});sendEmail.callback();}
sendEmail.handleError=function(error){sd.component.messageBox.action({title:"Action Unavilable",height:150,text:error,btn1:"Ok"});sendEmail.callback();}
sendEmail.addEventListeners=function(){$(".admin-close-btn").bind("click",function(){sd.component.messageBox.close();sendEmail.callback();});$("#send-mail-cancel").bind("click",function(){sd.component.messageBox.close();sendEmail.callback();});$("#send-site-email").bind("click",function(){sendEmail.sendSiteEmail_Send();});}
window.sendEmail=sendEmail;}(window));(function(window){var team={};team.currentSortDirection="";team.currentSortBy="";team.currentList=[];team.filteredList=[];team.viewMode="";team.itemsPerPage=16;team.totalPages=0;team.currentPage=0;team.title="";team.allMetaAttributes=[];team.allUniqueMetaAttributes=[];team.arrUniqueFilters=[];team.arrAllFilters=[];team.appliedFilters=[];team.globalList=[];team.globalListStartIdx=0;team.globalListEndIdx=0;team.globalListItemsPerPage=10;team.fromSearch=false;team.allPortalAttributes=[];team.pagingOptions={};team.options={};team.shuffle=false;team.init=function(options){$("#loader").show();team.currentList=[];team.filteredList=[];team.viewMode="thumb";team.totalPages=0;team.currentPage=1;team.appliedFilters=[];team.pagingOptions={};team.currentSortDirection="ASC";team.currentSortBy="sortname";team.shuffle=true;team.options=options;team.allMetaAttributes=[];team.allUniqueMetaAttributes=[];team.arrUniqueFilters=[];team.arrAllFilters=[];team.appliedFilters=[];team.allPortalAttributes=[];team.fromSearch=(options.fromSearch!=null)?options.fromSearch:false;$("#dvTeamListHeader").hide();$("#dvTeamHeaderDesc").hide();$('#sectionContainer #dvNameSort').click(function(){team.shuffle=false;team.createList("sortname","")});$('#teamContent #teamFilterText').on('input',function(){team.currentPage=1;team.shuffle=false;team.createList();});$('#teamContent #teamFilterText').keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'&&$("input:radio[name ='rdgTeamSearch']:checked").val()=="all"){team.runGlobalSearch();}});waitUntilExists("headerReady",function(){team.setTeamTitle();$('#teamHeader').html(team.title);$('#teamHeader').fadeIn("fast");$('#rdoTeamTxt').html(team.title);$('#rdoTeam').css('visibility','visible');$('#rdoTeamTxt').css('visibility','visible');});if(options.f_node!=null){var sc=new sd.ServerCall("GetFolderDetails");sc.data({inode:options.f_node});sc.go({onSuccess:function(myData,status){var folder=myData[0];if(folder.dsd==true){$('#dvTeamHeaderDesc').html(folder.sd);$('#dvTeamHeaderDesc').show();}
if(folder.dgc==true){$("#teamContent .js-searchOpt").show();}}});}
team.addEventListeners();if(options.userID&&options.userID!="")
LoadSection("userProfile",true,options);else
team.listItems();}
team.listItems=function(){$("#loader").show();$("#dvTeamList").empty();$("#dvTeamPages").empty();$("#teamThumb_btn").addClass("view-as-selected");var sc=new sd.ServerCall("ListActiveUsers");sc.go({onSuccess:team.handleList,onError:team.handleError});}
team.handleList=function(myData,status){team.currentList=[];var arrUserIDs=[];for(var idx=0;idx<myData.length;idx++){var item={};item.userid=myData[idx].i;item.username=myData[idx].un;arrUserIDs.push($.trim(myData[idx].i));item.firstname=myData[idx].fn;item.lastname=myData[idx].ln;item.fullname=myData[idx].fn+' '+myData[idx].ln;item.sortname=myData[idx].ln+myData[idx].fn;item.email=myData[idx].e;item.status=myData[idx].s;item.colour=myData[idx].cl;item.company=(myData[idx].c==null)?"":myData[idx].c;item.department=(myData[idx].d==null)?"":myData[idx].d;item.jobTitle=(myData[idx].t==null)?"":myData[idx].t;item.location=(myData[idx].l==null)?"":myData[idx].l;item.phone=(myData[idx].p==null)?"":myData[idx].p;item.mobile=(myData[idx].m==null)?"":myData[idx].m;item.facebook=(myData[idx].fb==null)?"":myData[idx].fb;item.twitter=(myData[idx].fb==null)?"":myData[idx].tw;item.website=(myData[idx].fb==null)?"":myData[idx].ws;item.linkedin=(myData[idx].fb==null)?"":myData[idx].li;if(myData[idx].im==null||myData[idx].im==0)
item.image=-1;else
item.image=myData[idx].im;item.address=(myData[idx].a==null)?"":myData[idx].a;item.keyuser=myData[idx].ku;item.bio=myData[idx].b;item.bizunit="-1";item.region="-1";item.role="-1";item.bizunitid="-1";item.regionid="-1";item.roleid="-1";team.currentList.push(item);}
var sc=new sd.ServerCall("GetCustomProfileFields");var obj={};obj.userids=arrUserIDs.join(",");obj.metaFields="'businessUnit', 'department', 'region', 'role'";sc.data(obj);sc.go({onSuccess:team.handleCustomFields,onError:team.handleError});}
team.handleCustomFields=function(myData,status){team.allMetaAttributes=[];team.allUniqueMetaAttributes=[];var obj;for(var idx=0;idx<myData.length;idx++){if(myData[idx].Field=="role"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Role";obj.id=-1;team.allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;team.allMetaAttributes.push(obj);for(var i=0;i<team.currentList.length;i++){if(myData[idx].UserName==team.currentList[i].username){team.currentList[i].role=myData[idx].Value;}}}
if(myData[idx].Field=="region"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;if(obj.value=="0")obj.value="N/A";obj.title="Country";obj.id=-1;team.allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;team.allMetaAttributes.push(obj);for(var i=0;i<team.currentList.length;i++){if(myData[idx].UserName==team.currentList[i].username){team.currentList[i].region=myData[idx].Value;}}}
if(myData[idx].Field=="businessUnit"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Business Unit";obj.id=-1;team.allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;team.allMetaAttributes.push(obj);for(var i=0;i<team.currentList.length;i++){if(myData[idx].UserName==team.currentList[i].username){team.currentList[i].bizunit=myData[idx].Value;}}}
if(myData[idx].Field=="department"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Department";obj.id=-1;team.allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;team.allMetaAttributes.push(obj);for(var i=0;i<team.currentList.length;i++){if(myData[idx].UserName==team.currentList[i].username){team.currentList[i].bizunit=myData[idx].Value;}}}
if(myData[idx].Field=="KeyUser"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Key Contact";obj.id=-1;team.allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;team.allMetaAttributes.push(obj);for(var i=0;i<team.currentList.length;i++){if(myData[idx].UserName==team.currentList[i].username){team.currentList[i].region=myData[idx].Value;}}}}
team.allUniqueMetaAttributes=sd.Utils.removeObjectArrayDuplicates(team.allUniqueMetaAttributes,"value");team.allUniqueMetaAttributes.sort(sd.Utils.dynamicSortMultiple("title","value"));for(var j=0;j<team.allUniqueMetaAttributes.length;j++){team.allUniqueMetaAttributes[j].id=j+1;}
for(var i=0;i<team.currentList.length;i++){for(var j=0;j<team.allUniqueMetaAttributes.length;j++){if((team.allUniqueMetaAttributes[j].type=="region")&&(team.currentList[i].region.toLowerCase()==team.allUniqueMetaAttributes[j].value.toLowerCase())){team.allUniqueMetaAttributes[j].id=j+1;}
if((team.allUniqueMetaAttributes[j].type=="businessUnit")&&(team.currentList[i].bizunit.toLowerCase()==team.allUniqueMetaAttributes[j].value.toLowerCase())){team.allUniqueMetaAttributes[j].id=j+1;}}}
for(var k=0;k<team.allMetaAttributes.length;k++){for(var j=0;j<team.allUniqueMetaAttributes.length;j++){if(team.allUniqueMetaAttributes[j].value.toLowerCase()==team.allMetaAttributes[k].value.toLowerCase()){team.allMetaAttributes[k].id=team.allUniqueMetaAttributes[j].id;}}}
team.buildFilterMenu();}
team.buildFilterMenu=function(){team.arrUniqueFilters=[];team.arrAllFilters=[];team.appliedFilters=[];var metaItem;var htmlOut="";var currentMetaType="";var item;for(var idx=0;idx<team.allUniqueMetaAttributes.length;idx++){item=team.allUniqueMetaAttributes[idx];if(item.type!=currentMetaType){if(currentMetaType!="")htmlOut+="</div>";currentMetaType=item.type;htmlOut+="<h3><span id=\"accordionHead"+item.id+"\">"+item.title+"</span></h3><div>";}
htmlOut+="<div class=\"accordion-menu\">";htmlOut+="<label class = \"filterText\" data-id=\""+item.id+"\" data-value=\""+item.value+"\" data-type=\""+item.type+"\">";htmlOut+="<input type=\"checkbox\" id=\"chk"+item.id+"\" value=\""+item.id+"\"/>"+item.value+"</label>";htmlOut+="</div>";}
$("#dvTeamFilters").empty();$("#dvTeamFilters").show();$("#dvTeamFilters").append("<div id=\"dvTeamFilterAccordion\"></div>");$("#dvTeamFilterAccordion").append(htmlOut);$("#dvTeamFilterAccordion").accordion({heightStyle:"content",active:false,collapsible:true});$(".filterText").click(function(){var id=$(this).data('id');var type=$(this).data('type');var value=$(this).data('value');team.shuffle=false;if($("#chk"+id).prop("checked")==true){var obj={};obj.id=id;obj.type=type;obj.value=value;team.appliedFilters.push(obj);}else{team.removeFilterFromArray(id)}
team.currentPage=1;team.createList("sortname",null);});team.createList("sortname",null);}
team.createList=function(sortBy,sortDirection){team.filterData();var listCount=team.filteredList.length;var countHeader=listCount;$("#dvTeamCount").html(countHeader);team.pagingOptions={prev_text:"<i class=\"icon-double-angle-left\"></i> Prev",next_text:"Next <i class=\"icon-double-angle-right\"></i>",num_display_entries:9,current_page:team.currentPage-1,num_edge_entries:1,callback:team.changePage,items_per_page:team.itemsPerPage}
var endIndex=(team.currentPage)*team.itemsPerPage;var startIndex=endIndex-team.itemsPerPage;if(endIndex>listCount)endIndex=listCount;if(sortDirection!=null){if(team.currentSortBy==sortBy){if(sortDirection!=team.currentSortDirection){if(team.currentSortDirection=="ASC")team.currentSortDirection="DESC";else team.currentSortDirection="ASC";}}else{team.currentSortBy=sortBy;team.currentSortDirection=sortDirection||"ASC";}}
if(team.currentSortBy=="sortname")sd.Utils.sortArrayByString(team.filteredList,"sortname");var sortArrow="icon-chevron-up";if(team.currentSortDirection=="DESC")sortArrow="icon-chevron-down";if(team.shuffle==false)
$('#teamContent .'+sortArrow).show();$("#dvTeamList").empty();if(team.shuffle==true){$(".teamShuffle_btn").removeClass("unselected");var arrRandom=[];for(var k=0;k<team.filteredList.length;k++){arrRandom.push(team.filteredList[k]);}
team.filteredList=[];for(var i=arrRandom.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=arrRandom[i];arrRandom[i]=arrRandom[j];arrRandom[j]=temp;}
for(var k=0;k<arrRandom.length;k++)
team.filteredList.push(arrRandom[k]);if(team.filteredList.length<endIndex)endIndex=team.filteredList.length;}else{$(".teamShuffle_btn").addClass("unselected");}
team.totalPages=Math.ceil(listCount/team.itemsPerPage);$("#dvTeamHeaderPages").empty();$("#dvTeamFooterPages").empty();if(team.totalPages>1){$("#dvTeamHeaderPages").pagination(listCount,team.pagingOptions);$("#dvTeamFooterPages").pagination(listCount,team.pagingOptions);}
if(team.viewMode=="list")
team.displayListView(startIndex,endIndex);else
team.displayThumbView(startIndex,endIndex);}
team.filterData=function(){for(var k=0;k<team.allUniqueMetaAttributes.length;k++)
$("#chk"+team.allUniqueMetaAttributes[k].id).prop("checked",false);$("#dvTeamSelectedMetaFilters").empty();var html="";var filterData=[];var listCount=team.currentList.length;var item;var filterText=$('#teamFilterText').val();if(filterText!=undefined){filterText=filterText.toLowerCase();}
team.filteredList=[];team.filteredMetaAttributes=[];if(team.shuffle==false){if(team.appliedFilters.length>0||filterText!="")
$("#teamReset_btn").closest("div").show();if(team.appliedFilters.length==0&&filterText=="")
$("#teamReset_btn").closest("div").hide();for(var k=0;k<team.appliedFilters.length;k++){item=team.appliedFilters[k];if(k==0){html="<div class='flex flex-1 pa-lr-half'><h4>Selected Filters:</h4></div>";}
html+="<div class='tag'>";html+="<i class='icon-remove-sign filter-remove' title='Remove Filter' onClick=\"team.removeFilterFromPanel("+item.id+")\"></i>";html+="<label onClick=\"team.removeFilterFromPanel("+item.id+")\">";html+=" "+item.value;html+="</label>";html+="</div>";$("#chk"+item.id).prop("checked",true);if(filterData[team.appliedFilters[k].type]==undefined)
filterData[team.appliedFilters[k].type]=[];filterData[team.appliedFilters[k].type].push(team.appliedFilters[k]);}
$("#dvTeamSelectedMetaFilters").html(html);var arrUniqueTypes=sd.Utils.removeObjectArrayDuplicates(team.appliedFilters,"type");var uniqueTypes=arrUniqueTypes.length;for(var idx=0;idx<listCount;idx++){var match=false;item=team.currentList[idx];if(filterText!=""&&item.fullname.toLowerCase().indexOf(filterText)<0)continue;if(team.appliedFilters.length==0){match=true;}else{var matchCount=0;var typeMatch;if(Object.keys(filterData).length>0){var filter;for(var key in filterData){typeMatch=false;for(var i=0;i<filterData[key].length;i++){filter=filterData[key][i];for(var j=0;j<team.allMetaAttributes.length;j++){if((team.allMetaAttributes[j].username.toLowerCase()==item.username.toLowerCase())&&(team.allMetaAttributes[j].id==filter.id)){matchCount++;typeMatch=true;break;}}
if(typeMatch==true)break;}}
if(matchCount==uniqueTypes)match=true;}}
if(!match)continue;for(var i=0;i<team.allMetaAttributes.length;i++){if(item.username.toUpperCase()==team.allMetaAttributes[i].username.toUpperCase()){var obj={};obj.id=team.allMetaAttributes[i].id;obj.value=team.allMetaAttributes[i].value;obj.type=team.allMetaAttributes[i].type;team.filteredMetaAttributes.push(obj);}}
team.filteredList.push(item);}}else{$("#teamReset_btn").closest("div").hide();filterText="";for(var idx=0;idx<team.currentList.length;idx++)
team.filteredList.push(team.currentList[idx]);}}
team.updateFilterCounts=function(){var filterText=$('#teamFilterText').val();if(filterText!=undefined){filterText=filterText.toLowerCase();}
for(var k=0;k<team.allUniqueMetaAttributes.length;k++){var count=0;if(team.appliedFilters.length==0&&filterText=="")
count=sd.Utils.countObjectArrayValues(team.allMetaAttributes,"id",team.allUniqueMetaAttributes[k].id);else
count=sd.Utils.countObjectArrayValues(team.filteredMetaAttributes,"id",team.allUniqueMetaAttributes[k].id);if(count>0){$("#lblFilterCount"+team.allUniqueMetaAttributes[k].id).parent().show();$("#lblFilterCount"+team.allUniqueMetaAttributes[k].id).text(" ("+count+")");}else{$("#lblFilterCount"+team.allUniqueMetaAttributes[k].id).parent().hide();}
$("#dvTeamFilterAccordion h3").each(function(index){var count=0;$(this).next("div").children().each(function(index){if($(this).css("display")=="none")count++;});if(count==$(this).next("div").children().length){$(this).hide();}else{$(this).show();}});}}
team.displayListView=function(startIdx,endIdx){var fragmentWrap=document.createDocumentFragment();$(".guide .teamGuideList .list-wrap").clone().appendTo(fragmentWrap);$("#dvTeamList").empty().show().html(fragmentWrap).foundation();$("#dvTeamListHeader").show();var imgSrc="";var fragmentTeam=document.createDocumentFragment();var cloneTeam;for(var idx=startIdx;idx<endIdx;idx++){var item=team.filteredList[idx];if(team.currentSortDirection=="DESC"){item=team.filteredList[team.filteredList.length-(idx+1)];}
cloneTeam=$(".guide .teamGuideList .user-list").clone().appendTo(fragmentTeam);cloneTeam.data({"userid":item.userid,"username":item.username});if(item.image!=-1){if(String(item.image).indexOf("base64")>-1){imgSrc=item.image;}
else{imgSrc=sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg"}
cloneTeam.find(".js-pic").css({"background-image":"url("+imgSrc+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}
else{var username=item.fullname.split(' ');var userInitials=username[0].substring(0,1).toUpperCase()+username[1].substring(0,1).toUpperCase();imgSrc="<span class=\"user-no-image-small\">"+userInitials+"</span>";if(item.colour==null){item.colour=users.UpdateColour(item.userid);}
cloneTeam.find(".js-pic").css("background-color",item.colour).html(imgSrc);}
cloneTeam.find(".description").remove();if(item.keyuser=="1")
cloneTeam.find(".key-user-list").show()
if(item.fullname!=undefined&&item.fullname.trim()!="")
cloneTeam.find(".list-username").html(item.fullname);else
cloneTeam.find(".list-username").html("&nbsp;");if(item.jobTitle!=undefined&&item.jobTitle.trim()!="")
cloneTeam.find(".userTitle").html(item.jobTitle);else
cloneTeam.find(".userTitle").html("&nbsp;");if(item.bizunit!=undefined&&item.bizunit!=""&&item.bizunit!="-1")
cloneTeam.find(".userDepartment").html(item.bizunit);else
cloneTeam.find(".userDepartment").html("&nbsp;");if(item.facebook!=undefined&&item.facebook!="")
{if(item.facebook.indexOf("http")<0)fb="http://"+item.facebook;cloneTeam.find(".facebook-list").show();cloneTeam.find(".facebook-list").unbind("click").bind("click",function(event){window.open(fb,"_blank");});}
if(item.twitter!=undefined&&item.twitter!=""){if(item.twitter.indexOf("http")<0)tw="http://"+item.twitter;cloneTeam.find(".twitter-list").show();cloneTeam.find(".twitter-list").unbind("click").bind("click",function(event){window.open(tw,"_blank");});}
if(item.website!=undefined&&item.website!=""){if(item.website.indexOf("http")<0)ws="http://"+item.website;cloneTeam.find(".website-list").show();cloneTeam.find(".website-list").unbind("click").bind("click",function(event){window.open(ws,"_blank");});}
if(item.email.trim()!=""){cloneTeam.find(".mail-list").show().attr("title",item.email).data({"email":item.email});}}
$("#dvTeamList .list-wrap").empty().show().html(fragmentTeam).foundation();$("#dvTeamList .js-act").click(function(){var userID=$(this).closest(".user-list").data('userid');var userName=$(this).closest(".user-list").data('username');LoadSection("userProfile",true,{userID:userID,userName:userName});});$("#dvTeamList .mail-thumb").unbind("click").bind("click",function(event){window.location.href="mailto:"+$(this).data('email');});$('#loader').hide();}
team.displayThumbView=function(startIdx,endIdx){var fragmentWrap=document.createDocumentFragment();$(".guide .userThumbGuide .list-thumb-wrap").clone().appendTo(fragmentWrap);$("#dvTeamList").empty().show().html(fragmentWrap).foundation();$("#dvTeamListHeader").hide();if(team.filteredList.length<endIdx)
endIdx=team.filteredList.length;var imgSrc="";var fragmentTeam=document.createDocumentFragment();var cloneTeam;for(var idx=startIdx;idx<endIdx;idx++){var item=team.filteredList[idx];if(team.currentSortDirection=="DESC")item=team.filteredList[team.filteredList.length-(idx+1)];cloneTeam=$(".guide .userThumbGuide .searchThumbItem").clone().appendTo(fragmentTeam);cloneTeam.data({"userid":item.userid,"username":item.username});cloneTeam.find(".js-pic").addClass("thumb-img");if(item.image!=-1){if(String(item.image).indexOf("base64")>-1){imgSrc=item.image;}
else{imgSrc=sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg";}
cloneTeam.find(".js-pic").css({"background-image":"url("+imgSrc+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}else{var username=item.fullname.split(' ');var userInitials=username[0].substring(0,1).toUpperCase()+username[1].substring(0,1).toUpperCase();imgSrc="<span class=\"user-no-image-big\">"+userInitials+"</span>";cloneTeam.find(".js-pic").append(imgSrc);if(item.colour==null){item.colour=users.UpdateColour(item.userid);}
cloneTeam.find(".user-no-image-big").css({"background-color":item.colour});}
cloneTeam.find(".description").remove();cloneTeam.find(".city").remove();cloneTeam.find(".country").remove();cloneTeam.find(".name").addClass("fullname");if(item.fullname!=undefined&&item.fullname.trim()!="")
cloneTeam.find(".name").html(item.fullname);else
cloneTeam.find(".name").html("&nbsp;");cloneTeam.find(".userTitle").attr("id","thumb-title-"+item.userid);if(item.jobTitle!=undefined&&item.jobTitle.trim()!="")
cloneTeam.find(".userTitle").html(item.jobTitle);else
cloneTeam.find(".userTitle").html("&nbsp;");cloneTeam.find(".userDepartment").attr("id","thumb-department-"+item.userid);if(item.bizunit!=undefined&&item.bizunit!=""&&item.bizunit!="-1")
cloneTeam.find(".userDepartment").html(item.bizunit);else
cloneTeam.find(".userDepartment").html("&nbsp;");if(item.facebook!=undefined&&item.facebook!=""){if(item.facebook.indexOf("http")<0)fb="http://"+item.facebook;cloneTeam.find(".facebook-thumb").show();cloneTeam.find(".facebook-thumb").unbind("click").bind("click",function(event){window.open(fb,"_blank");});}
if(item.twitter!=undefined&&item.twitter!=""){if(item.twitter.indexOf("http")<0)tw="http://"+item.twitter;cloneTeam.find(".twitter-thumb").show();cloneTeam.find(".twitter-thumb").unbind("click").bind("click",function(event){window.open(tw,"_blank");});}
if(item.website!=undefined&&item.website!=""){if(item.website.indexOf("http")<0)ws="http://"+item.website;cloneTeam.find(".website-thumb").show();cloneTeam.find(".website-thumb").unbind("click").bind("click",function(event){window.open(ws,"_blank");});}
if(item.keyuser=="1")
cloneTeam.find(".key-user-list").show();if(item.email.trim()!=""){cloneTeam.find(".mail-thumb").show().attr("title",item.email).data({"email":item.email});}}
$("#dvTeamList .list-thumb-wrap").empty().show().html(fragmentTeam).foundation();$("#dvTeamList .js-act").click(function(){var userID=$(this).closest(".searchThumbItem").data('userid');var userName=$(this).closest(".searchThumbItem").data('username');LoadSection("userProfile",true,{userID:userID,userName:userName});});$("#dvTeamList .mail-thumb").unbind("click").bind("click",function(event){window.location.href="mailto:"+$(this).data('email');});$('#loader').hide();}
team.changePage=function(newPage){team.shuffle=false;team.currentPage=newPage+1;team.createList("sortname",null);}
team.addEventListeners=function(){$("#teamList_btn").on("click",function(){team.shuffle=false;team.viewMode="list";team.createList();$("#teamThumb_btn").removeClass("view-as-selected")
$("#teamList_btn").addClass("view-as-selected");$("#dvTeamList").addClass("list-view");$("#dvTeamList").removeClass("frame-child");});$("#teamThumb_btn").on("click",function(){team.shuffle=false;team.viewMode="thumb";team.createList();$("#teamList_btn").removeClass("view-as-selected")
$("#teamThumb_btn").addClass("view-as-selected");});$(".teamShuffle_btn").on("click",function(){$('#teamFilterText').val("");team.currentPage=1;for(var k=0;k<team.arrUniqueFilters.length;k++)
$("#chk"+k).prop("checked",false);team.shuffle=true;team.createList();$(".teamShuffle_btn").removeClass("unselected");$("#teamList_btn").removeClass("view-as-selected");$("#teamThumb_btn").addClass("view-as-selected");});$("#teamReset_btn").on("click",function(){$('#loader').show();team.shuffle=false;team.appliedFilters=[];$('#teamFilterText').val("");team.createList("sortname",null);$("#teamReset_btn").closest("div").hide();});$("#teamReset_btn").closest("div").hide();$("#searchIcon").on("click",function(){team.runGlobalSearch();});$("#rdoAllCompany").on("click",function(){if($("input:radio[name ='rdgTeamSearch']:checked").val()=="all")
team.runGlobalSearch();});$('.toggle-filters').on("click",function(){$('.sidebar').toggleClass('toggled')});}
team.runGlobalSearch=function(){var globalString=$('#teamFilterText').val();if(globalString==""){sd.component.messageBox.action({title:"Search",height:150,text:"Please enter a search term before runnning an All Company search.",btn1:"Ok"});$('#rdoTeam').attr("checked","checked");$('#rdoAllCompany').removeAttr("checked");return;}
var arrTemp=globalString.split(" ");if(arrTemp[0].length<2){sd.component.messageBox.action({title:"Search",height:150,text:"Your first search term '"+arrTemp[0]+"' must be greater than 1 character.",btn1:"Ok"});$('#rdoTeam').attr("checked","checked");$('#rdoAllCompany').removeAttr("checked");return;}
if(arrTemp.length>1){if(arrTemp[1].length<2){sd.component.messageBox.action({title:"Search",height:150,text:"Your second search term '"+arrTemp[1]+"' must be greater than 1 character.",btn1:"Ok"});$('#rdoTeam').attr("checked","checked");$('#rdoAllCompany').removeAttr("checked");return;}}
LoadSection("mccannGlobalSearch",false,{searchString:globalString});}
team.showUser=function(objData){$("#editProfile_btn").hide();team.setTeamTitle();$('#profileHeader').html(team.title);var sc=new sd.ServerCall("GetUserDetails");var obj={};obj.uid=objData.userID;sc.data(obj);sc.go({onSuccess:team.handleUser,onError:team.handleError});}
team.handleUser=function(myData,status){var item=myData[0];$("#loader").hide();if(sd.Session.user.superAdmin==true||sd.Session.user.userID==item.userID||admin.adminUser()){$("#editProfile_btn").show();}
if(item.csImage!=null&&item.csImage!=0){item.Image=item.csImage;}
var imgSrc;if(item.Image==null||item.Image==0){var fullName=item.FullName.split(' ');var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();imgSrc="<span class=\"user-no-image-big\">"+userInitials+"</span>";if(item.colour==null){item.colour=users.UpdateColour(item.userid);}
$("#dvUserImage").css("background-color",item.colour).html(imgSrc);}
else{if(String(item.Image).indexOf("base64")>-1)
imgSrc=item.Image;else
imgSrc=sd.Configuration.vault+"/"+item.Image+"/bigthumb.jpg";$("#dvUserImage").css({"background-image":"url("+imgSrc+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}
$("#dvUserImage img").css({"height":"125px","width":"125px"}).show();$("#dvUserImage span").css({"height":"125px","width":"125px"}).show();if(item.KeyUser!="1"){$("#dvKeyContactLeft").hide();$("#dvKeyContactMain").hide();}else{$("#dvKeyContactLeft").show();$("#dvKeyContactMain").show();}
$("#dvFullName").html(item.FirstName+' '+item.LastName);$("#tdPhone").html(item.Phone);$("#tdMobile").html(item.Mobile);$("#tdEmail").html("<a class=\"pro-mail brand-color\" href = \"mailto:"+item.email+"\">"+item.email+"</a>");$("#dvUserProfile .js-twt").hide();$("#dvUserProfile .js-fb").hide();$("#dvUserProfile .js-lk").hide();$("#dvProfileTitle").html(item.JobTitle);$("#dvProfileAddress").html(item.Location);$("#dvProfileExperience").empty();if(item.Bio!=null&&item.Bio!=""){$("#dvProfileExperience").html(item.Bio.replace(/\n/g,"<br/>"));}
if(item.userID==sd.Session.user.userID)
sd.Session.userMetaFilters=$.parseJSON(item.metaPrefs);var jsonMeta=$.parseJSON(item.customFields);$("#dvProfileDept").html("");for(var i=0;i<jsonMeta.length;i++){var field=jsonMeta[i];switch(field.f){case"twitter":if(field.v!=""){if(field.v.indexOf("http")<0)field.v="http://"+field.v;$("#dvUserProfile .js-twt").data("link",field.v).show().unbind("click").bind("click",function(){var link=$(this).data("link");window.open(link,"_blank");});}
break;case"facebook":if(field.v!=""){if(field.v.indexOf("http")<0)field.v="http://"+field.v;$("#dvUserProfile .js-fb").data("link",field.v).show().unbind("click").bind("click",function(){var link=$(this).data("link");window.open(link,"_blank");});}
break;case"website":if(field.v!=""){if(field.v.indexOf("http")<0)field.v="http://"+field.v;$("#dvUserProfile .js-lk").data("link",field.v).show().unbind("click").bind("click",function(){var link=$(this).data("link");window.open(link,"_blank");});}
break;case"region":$("#tdCountry").html(field.v);break;case"businessUnit":$("#tdBU").html(field.v);break;case"department":$("#dvProfileDept").html(field.v);break;case"role":$("#dvProfileRole").html(field.v);break;default:}}
$("#dvUserProfile .edit").unbind("click").bind("click",function(){users.editMyProfile(item,team.allPortalAttributes);});$("#dvUserProfile .close").unbind("click").bind("click",function(){if(team.fromSearch){window.history.go(-1);}else{LoadSection("team",true);}});}
team.removeFilterFromArray=function(id){for(var j=0;j<team.appliedFilters.length;j++){if(team.appliedFilters[j].id==id){team.appliedFilters.splice(j,1);break;}}}
team.initMcCannGlobalSearch=function(searchString){team.globalList=[];team.globalListStartIdx=1;team.globalListEndIdx=team.globalListItemsPerPage;$(".globalPrev").hide();$(".globalNext").hide();$('#mcCannGlobalSearchText').val(searchString);$('#globalSearchContent input:radio[id=rdoAllCompany]').prop("checked",true);team.setTeamTitle();$('#rdoTeamTxt').html(team.title);team.mccannGlobalSearch();$("#globalHeaderPrev").bind("click",function(){team.globalListEndIdx-=team.globalListItemsPerPage;team.globalListStartIdx-=team.globalListItemsPerPage;team.mccannGlobalSearch();});$("#globalHeaderNext").bind("click",function(){team.globalListEndIdx+=team.globalListItemsPerPage;team.globalListStartIdx+=team.globalListItemsPerPage;team.mccannGlobalSearch();});$("#globalFooterPrev").bind("click",function(){team.globalListEndIdx-=team.globalListItemsPerPage;team.globalListStartIdx-=team.globalListItemsPerPage;team.mccannGlobalSearch();});$("#globalFooterNext").bind("click",function(){team.globalListEndIdx+=team.globalListItemsPerPage;team.globalListStartIdx+=team.globalListItemsPerPage;team.mccannGlobalSearch();});$("#rdoAllCompany").on("click",function(){if($("input:radio[name ='rdgTeamSearch']:checked").val()=="all"){team.globalList=[];team.globalListStartIdx=1;team.globalListEndIdx=team.globalListItemsPerPage;team.mccannGlobalSearch();}else{LoadSection("team",true);}});$("#rdoTeam").on("click",function(){if($("input:radio[name ='rdgTeamSearch']:checked").val()=="team"){var searchterm=$('#mcCannGlobalSearchText').val();LoadSection("team",true,{f_node:team.options.f_node});waitUntilExists("teamFilterText",function(){$('#teamFilterText').val(searchterm);});}});$(".js-gsearch").on("click",function(){team.globalList=[];team.globalListStartIdx=1;team.globalListEndIdx=team.globalListItemsPerPage;team.mccannGlobalSearch();});$("#closeGlobalSearch_btn").bind("click",function(){LoadSection("team",true);});$('#mcCannGlobalSearchText').keypress(function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){team.globalList=[];team.globalListStartIdx=1;team.globalListEndIdx=team.globalListItemsPerPage;team.mccannGlobalSearch();}});}
team.mccannGlobalSearch=function(){var globalString=$('#mcCannGlobalSearchText').val();if(globalString==""){sd.component.messageBox.action({title:"Search",height:150,text:"Please enter a search term before runnning an All Company search.",btn1:"Ok"});return;}
var arrTemp=globalString.split(" ");if(arrTemp[0].length<2){sd.component.messageBox.action({title:"Search",height:150,text:"Your first search term '"+arrTemp[0]+"' must be greater than 1 character.",btn1:"Ok"});return;}
if(arrTemp.length>1){if(arrTemp[1].length<2){sd.component.messageBox.action({title:"Search",height:150,text:"Your second search term '"+arrTemp[1]+"' must be greater than 1 character.",btn1:"Ok"});return;}}
var sc=new sd.ServerCall("McCannGlobalSearch");var obj={};obj.searchString=$('#mcCannGlobalSearchText').val();obj.startIndex=team.globalListStartIdx;obj.endIndex=team.globalListEndIdx;obj.showPhoto=true;sc.data(obj);sc.go({onSuccess:team.handleMcCannGlobalSearch,onError:team.handleError});}
team.handleMcCannGlobalSearch=function(myData,status){var count=myData.length;if(count==team.globalListItemsPerPage)
$(".globalNext").show();else
$(".globalNext").hide();if(team.globalListStartIdx>=team.globalListItemsPerPage)
$(".globalPrev").show();else
$(".globalPrev").hide();if(count==0)
$("#dvGlobalResultPage").html("0 Results");else{$("#dvGlobalResultPage").html("Showing Results "+team.globalListStartIdx+" to "+(team.globalListStartIdx+(count-1)));}
if(count==0)
$("#dvGlobalResultTotal").html("0");else{$("#dvGlobalResultTotal").html(count);}
$('#dvGlobalSearchList').empty();var img="";var fragment=document.createDocumentFragment();var clone;for(var i=0;i<count;i++){clone=$(".guide .teamGlobalSearchGuide").clone().appendTo(fragment);if(myData[i].im=="")
img="images/mccann/user_bust.png";else
img=myData[i].im;clone.find(".js-pic").css({'background-image':'url('+img+')','background-size':'cover'});clone.find(".js-name").html(myData[i].fn+" "+myData[i].ln);clone.find(".js-details").html(myData[i].t+" "+myData[i].a);clone.find(".js-email").text(myData[i].e).attr("href","mailto:"+myData[i].e);clone.find(".js-phone").html(myData[i].p);clone.find(".js-mobile").html(myData[i].m);}
$("#dvGlobalSearchList").html(fragment);}
team.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
team.removeFilterFromPanel=function(id){team.currentPage=1;team.removeFilterFromArray(id);team.createList("sortname",null);}
team.setTeamTitle=function(){var title=$('#nvHorizontalMenu').find("[data-template='team']").html();if(title!=undefined){team.title=title;}
else{team.title=(mccann.collabDetails.CS_Name.toLowerCase().indexOf("team")<0)?mccann.collabDetails.CS_Name:mccann.collabDetails.CS_Name+" Team";}}
window.team=team;}(window));﻿(function(window){var trainingOverlays={};trainingOverlays.updatedSpan;trainingOverlays.images;trainingOverlays.page;trainingOverlays.init=function(){$("#loader").show();var sc=new sd.ServerCall("GetOverlayDetails",0);sc.go({onSuccess:trainingOverlays.adminHandleOverlay,onError:trainingOverlays.handleError});$("#adminTOSave").bind("click",function(){var extension="";var file="";var validFiles=false;var metaData="<metadata>";var idx=1;$('#ulTODetails li .filename').each(function(){file=$(this).text();extension=file.split('.').pop().toLowerCase();if(extension!="png"){validFiles=false
return false;}
else{metaData+="<item><displayOrder><![CDATA["+idx+"]]></displayOrder><image><![CDATA["+file+"]]></image></item>";}
idx++;validFiles=true;});metaData+="</metadata>";if(!validFiles){sd.component.messageBox.action({title:"Training Overlay",height:150,text:"All training overlay images must be a png format and you must include at least one overlay image.",btn1:"Ok"});return;}
var sc=new sd.ServerCall("UpdateTrainingOverlay",0);var obj={};obj.metadata=metaData;obj.status=($('input:checkbox[name=chkOverlayStatus]:checked').length>0)?"active":"disabled";sc.data(obj);sc.go({onSuccess:trainingOverlays.adminUpdateComplete,onError:trainingOverlays.handleError});});$(".adminTOCancel").bind("click",function(){LoadSection("admin",false);});$("#btnUploadNewTO").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'uploadType':'trainingOverlay','onComplete':trainingOverlays.newUploadComplete,'onError':trainingOverlays.handleError});});$("#adminTOReset").bind("click",function(){var sc=new sd.ServerCall("ToggleOverlayOnAllUsers",0);sc.go({onSuccess:trainingOverlays.adminHandleReset,onError:trainingOverlays.handleError});});}
trainingOverlays.adminHandleReset=function(myData,status){sd.component.messageBox.action({title:"Training Overlay",height:150,text:"The Training Overlay has been reset for all users.",btn1:"Ok"});}
trainingOverlays.adminHandleOverlay=function(myData,status){$("#loader").hide();var data=myData[0];if(data.status=="active")
$('input:checkbox[name=chkOverlayStatus]').attr("checked",true);else
$('input:checkbox[name=chkOverlayStatus]').attr("checked",false);var xmlMeta=$.parseXML(data.metadata);if(xmlMeta.children.length>0){var htmlOut="";for(var idx=0;idx<xmlMeta.children[0].children.length;idx++){var image=$(xmlMeta.children[0].children[idx]).find("image").text();htmlOut+="<li>";htmlOut+="<span class=\"filename\">"+image+"</span>";htmlOut+="<button class=\"right toUpdate tiny brand-btn brand__outline\">Update</button>";htmlOut+="<button class=\"right toRemove tiny brand-btn brand__outline\">Remove</button>";htmlOut+="</li>";}
$("#ulTODetails").html(htmlOut);$(".toUpdate").click(function(){trainingOverlays.updatedSpan=$(this).prev("span");sd.FileUploader.browse({'destinationInode':-1,'uploadType':'trainingOverlay','onComplete':trainingOverlays.editUploadComplete,'onError':trainingOverlays.handleError});});$(".toRemove").click(function(){$(this).closest("li").remove();});$(".toPreview").click(function(){});$('#ulTODetails').sortable();}}
trainingOverlays.editUploadComplete=function(myData,status){$(trainingOverlays.updatedSpan).text(myData[0].name);}
trainingOverlays.newUploadComplete=function(myData,status){var image=myData[0].name;var htmlOut="";htmlOut+="<li draggable=\"true\">";htmlOut+="<span class=\"filename\">"+image+"</span>";htmlOut+="<button class=\"right toUpdate tiny brand-btn brand__outline\">Update</button>";htmlOut+="<button class=\"right toRemove tiny brand-btn brand__outline\">Remove</button>";htmlOut+="</li>";$("#ulTODetails").append(htmlOut);$('#ulTODetails').sortable();$('.toUpdate').unbind();$('.toRemove').unbind();$('.toPreview').unbind();$(".toUpdate").click(function(){trainingOverlays.updatedSpan=$(this).prev("span");sd.FileUploader.browse({'destinationInode':-1,'uploadType':'trainingOverlay','onComplete':trainingOverlays.editUploadComplete,'onError':trainingOverlays.handleError});});$(".toRemove").click(function(){$(this).closest("li").remove();});$(".toPreview").click(function(){});}
trainingOverlays.adminUpdateComplete=function(error){LoadSection("admin",false);}
trainingOverlays.getUserOverlay=function(){trainingOverlays.images=[];var sc=new sd.ServerCall("GetUserOverlay",0);sc.go({onSuccess:trainingOverlays.displayOverlay,onError:trainingOverlays.handleError});}
trainingOverlays.relaunchOverlay=function(){trainingOverlays.images=[];var sc=new sd.ServerCall("RelaunchOverlay",0);sc.go({onSuccess:trainingOverlays.displayOverlay,onError:trainingOverlays.handleError});}
trainingOverlays.displayOverlay=function(myData,status){var data=myData[0];trainingOverlays.page=0;if(data==undefined)
return;var xmlMeta=$.parseXML(data.metadata);if(xmlMeta.childNodes&&xmlMeta.childNodes[0].childNodes.length>0){for(var idx=0;idx<xmlMeta.childNodes[0].childNodes.length;idx++){var image=$(xmlMeta.childNodes[0].childNodes[idx]).find("image").text();trainingOverlays.images.push(image);}
$("html").css("overflow","hidden");$("body").css("overflow","hidden");trainingOverlays.displayOverlayPage();$("#overlay").show();$("#overlayPaging").unbind();$("#overlayCancel").unbind();$("#overlayClose").unbind();$("#overlayPaging").click(function(){trainingOverlays.page+=1;if((trainingOverlays.page+1)>trainingOverlays.images.length){trainingOverlays.hideOverlay();}
else
trainingOverlays.displayOverlayPage();});$("#overlayCancel").click(function(){trainingOverlays.optOut();});$("#overlayClose").click(function(){trainingOverlays.hideOverlay();});}}
trainingOverlays.displayOverlayPage=function(){$("#overlayBackground").css('background-image','url(images/trainingOverlay/'+trainingOverlays.images[trainingOverlays.page]+')');}
trainingOverlays.optOut=function(){var sc=new sd.ServerCall("ToggleOverlayOff",0);sc.go({onSuccess:trainingOverlays.hideOverlay,onError:trainingOverlays.handleError});}
trainingOverlays.hideOverlay=function(){$("html").css("overflow","auto");$("body").css("overflow","auto");$("#overlay").hide();}
trainingOverlays.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.trainingOverlays=trainingOverlays;}(window));﻿(function(window){var userManager={};userManager.userData={};userManager.saveMode={};userManager.currentListUsers=[];userManager.currentListGroups=[];userManager.init=function(options){options=options||{};userManager.container=options.container||"#adminContainer";$(userManager.container).fadeIn();$(userManager.container+" .userManager").hide();$(userManager.container).load(sd.Configuration.templates.userManager,function(){userManager.addEventListeners();userManager.reflowSection();userManager.listUserNames();});}
userManager.addEventListeners=function(){$(userManager.container+" .closeButton").click(function(){$(userManager.container).empty();$(userManager.container).hide();});$(".userAddBtn").click(function(){userManager.clearUserForm();$(".userChangeStatusBtn").hide();$(".userChangePasswordBtn").hide();$(".userManagerForm").show();$('.userManagerUserName').attr('readonly',false);userManager.saveMode="add";});$(".userCancelBtn").click(function(){userManager.removeAllErrorMessages();userManager.clearUserForm();$(".userManagerForm").hide();});$(".userChangePasswordBtn").click(function(){$('#userPasswordDialog').foundation('reveal','open');});$(".userStatusCancelBtn").click(function(){$('#userStatusChangeConfirmDialog').foundation('reveal','close');});$(".userPasswordCancelBtn").click(function(){$('#userPasswordDialog').foundation('reveal','close');});$(".userChangeStatusBtn").click(function(){$('#userStatusChangeConfirmDialog').foundation('reveal','open');});$(".userStatusConfirmBtn").click(function(){$('#userStatusChangeConfirmDialog').foundation('reveal','close');var sc=new sd.ServerCall("UpdateUserStatus");var obj={};obj.uid=userManager.userData[0].userID;obj.oldStatus=userManager.userData[0].status
sc.data(obj);sc.go({onSuccess:userManager.handleUserUpdate});});$('.userSaveBtn').click(function(){var validInput=true;if($('.userManagerUserName').val()==""){validInput=false;userManager.addErrorMessage('.userManagerUserName','Username cannot be empty');}
else{userManager.removeErrorMessage('.userManagerUserName');}
if($('.userManagerFirstName').val()==""){validInput=false;userManager.addErrorMessage('.userManagerFirstName','First name cannot be empty');}
else{userManager.removeErrorMessage('.userManagerFirstName');}
if($('.userManagerLastName').val()==""){validInput=false;userManager.addErrorMessage('.userManagerLastName','Last name cannot be empty');}
else{userManager.removeErrorMessage('.userManagerLastName');}
if($('.userManagerEmail').val()==""){validInput=false;userManager.addErrorMessage('.userManagerEmail','Email cannot be empty');}
else{userManager.removeErrorMessage('.userManagerEmail');}
if(validInput){userManager.removeAllErrorMessages();if(userManager.saveMode=="add"){$('#userPasswordDialog').foundation('reveal','open');}
else if(userManager.saveMode=="edit"){var userDetails={};userDetails.uid=userManager.userData[0].userID;userDetails.collabspace=1;userDetails.firstName=$('.userManagerFirstName').val();userDetails.lastName=$('.userManagerLastName').val();userDetails.address=$('.userManagerAddress').val();userDetails.title=$('.userManagerJobTitle').val();userDetails.department=$('.userManagerDepartment').val();userDetails.email=$('.userManagerEmail').val();userDetails.company=$('.userManagerCompany').val();userDetails.location=$('.userManagerLocation').val();userDetails.mobile=$('.userManagerMobile').val();userDetails.phone=$('.userManagerPhone').val();userDetails.status="active";userDetails.superAdmin=$('.superAdminCheckBox').prop("checked");var sc=new sd.ServerCall("EditUserDetails");var obj={};obj=userDetails;sc.data(obj);sc.go({onSuccess:userManager.handleUserEdit});}}});$(".userPasswordConfirmBtn").click(function(){if(($(".userManagerPasswordEnter").val()==$(".userManagerPasswordConfirm").val())&&$(".userManagerPasswordEnter").val()!=""&&$(".userManagerPasswordConfirm").val()!=""){if(userManager.saveMode=="add"){var userDetails={};userDetails.collabspace=1;userDetails.userName=$('.userManagerUserName').val();userDetails.firstName=$('.userManagerFirstName').val();userDetails.lastName=$('.userManagerLastName').val();userDetails.address=$('.userManagerAddress').val();userDetails.title=$('.userManagerJobTitle').val();userDetails.department=$('.userManagerDepartment').val();userDetails.email=$('.userManagerEmail').val();userDetails.company=$('.userManagerCompany').val();userDetails.location=$('.userManagerLocation').val();userDetails.mobile=$('.userManagerMobile').val();userDetails.phone=$('.userManagerPhone').val();userDetails.status="active";userDetails.superAdmin=$('.superAdminCheckBox').prop("checked");userDetails.userPassword=$(".userManagerPasswordEnter").val();$(".userManagerPasswordEnter").val("");$(".userManagerPasswordConfirm").val("");$('#userManagerErrorDialog').foundation('reveal','close');var sc=new sd.ServerCall("AddUserDetails");var obj={};obj=userDetails;sc.data(obj);sc.go({onSuccess:userManager.handleUserAdd});}
else if(userManager.saveMode=="edit"){var obj={};obj.uid=userManager.userData[0].userID;obj.userPassword=$(".userManagerPasswordEnter").val();$(".userManagerPasswordEnter").val("");$(".userManagerPasswordConfirm").val("");$('#userManagerErrorDialog').foundation('reveal','close');var sc=new sd.ServerCall("UpdateUserPassword");sc.data(obj);sc.go({onSuccess:userManager.handlePasswordUpdate});}}
else{$(".userManagerPasswordEnter").val("");$(".userManagerPasswordConfirm").val("");$('#userManagerErrorDialog h2').text("User Password");$('#userManagerErrorDialog p').text("Passwords do not match!");$('#userManagerErrorDialog').foundation('reveal','open');}});$('.groupAddBtn').click(function(){$('.groupSaveBtn').show();});}
userManager.listUserNames=function(){var sc=new sd.ServerCall("ListUserNames");sc.go({onSuccess:userManager.handleListUsers});}
userManager.handleListUsers=function(myData,status){userManager.currentListUsers=[];for(var i=0;i<myData.length;i++){var item={};item.userID=myData[i].userID;item.username=myData[i].FullName;item.status=myData[i].status;userManager.currentListUsers.push(item);}
userManager.displayUserList();}
userManager.reflowSection=function(){Foundation.libs.section.reflow();}
userManager.displayUserList=function(){var htmlOut="";var listCount=userManager.currentListUsers.length;var fragment=document.createDocumentFragment();var item;for(var i=0;i<listCount;i++){item=userManager.currentListUsers[i];var clone=$('.guide .adminUserNameRow').clone().appendTo(fragment);clone.data('userID',item.userID);if(item.status=="deleted")
clone.find(' .adminUserName').html("(Deleted) "+item.username);else
clone.find(' .adminUserName').html(item.username);}
$('#userManager .unityList').html(fragment);$('#userManager .unityList__row').click(function(){var selectedUserID=$(this).data('userID');userManager.removeAllErrorMessages();userManager.getUserInfo(selectedUserID);$('.userManagerUserName').attr('readonly',true);userManager.saveMode="edit";});userManager.listUserGroups();}
userManager.listUserGroups=function(){var sc=new sd.ServerCall("ListGroupNames");sc.go({onSuccess:userManager.handleListGroups});}
userManager.handleListGroups=function(myData,status){userManager.currentListGroups=[];for(var i=0;i<myData.length;i++){var item={};item.groupID=myData[i].GroupID;item.groupName=myData[i].GroupName;userManager.currentListGroups.push(item);}
userManager.displayGroupList();}
userManager.displayGroupList=function(){var listCount=userManager.currentListGroups.length;var fragment=document.createDocumentFragment();var item;for(var i=0;i<listCount;i++){item=userManager.currentListGroups[i];var clone=$('.guide .adminGroupNameRow').clone().appendTo(fragment);clone.data('groupID',item.groupID);clone.find(' .adminGroupName').html(item.groupName);}
$('#groupManager .unityList').html(fragment);$('#groupManager .unityList__row').click(function(){alert($(this).data('groupID'));$('.groupSaveBtn').show();$('.groupDeleteBtn').show();});}
userManager.getUserInfo=function(userID){var sc=new sd.ServerCall("GetUserInfo");var obj={};obj.uid=userID;sc.data(obj);sc.go({onSuccess:userManager.handleUserInfo});}
userManager.handleUserInfo=function(myData,status){userManager.clearUserForm();userManager.userData=myData;userManager.fillUserForm(userManager.userData);$(".userManagerForm").show();if(myData[0].status=="deleted"){$(".userChangeStatusBtn").text("Activate User");}
else{$(".userChangeStatusBtn").text("Deactivate User");}
$(".userChangeStatusBtn").show();$(".userChangePasswordBtn").show();}
userManager.handleUserUpdate=function(myData,status){userManager.listUserNames();userManager.getUserInfo(myData[0].userID);}
userManager.handlePasswordUpdate=function(myData,status){if(myData=="Password Updated!"){userManager.listUserNames();$(".userManagerForm").hide();}
$('#userManagerErrorDialog h2').text("User Password");$('#userManagerErrorDialog p').text(myData);$('#userManagerErrorDialog').foundation('reveal','open');}
userManager.handleUserAdd=function(myData,status){if(myData=="User Added!"){userManager.listUserNames();$(".userManagerForm").hide();}
$('#userManagerErrorDialog h2').text("User Creation");$('#userManagerErrorDialog p').text(myData);$('#userManagerErrorDialog').foundation('reveal','open');}
userManager.handleUserEdit=function(myData,status){if(myData=="User Updated!"){userManager.listUserNames();$(".userManagerForm").hide();}
$('#userManagerErrorDialog h2').text("User Update");$('#userManagerErrorDialog p').text(myData);$('#userManagerErrorDialog').foundation('reveal','open');}
userManager.clearUserForm=function(){$('.userManagerUserName').val("");$('.userManagerFirstName').val("");$('.userManagerLastName').val("");$('.userManagerAddress').val("");$('.userManagerJobTitle').val("");$('.userManagerDepartment').val("");$('.userManagerEmail').val("");$('.userManagerCompany').val("");$('.userManagerLocation').val("");$('.userManagerMobile').val("");$('.userManagerPhone').val("");$('.superAdminCheckBox').prop("checked",false);}
userManager.fillUserForm=function(userData){$('.userManagerUserName').val(userData[0].UserName);$('.userManagerFirstName').val(userData[0].FirstName);$('.userManagerLastName').val(userData[0].LastName);$('.userManagerAddress').val(userData[0].OfficeAddress);$('.userManagerJobTitle').val(userData[0].JobTitle);$('.userManagerDepartment').val(userData[0].Department);$('.userManagerEmail').val(userData[0].email);$('.userManagerCompany').val(userData[0].Company);$('.userManagerLocation').val(userData[0].Location);$('.userManagerMobile').val(userData[0].Mobile);$('.userManagerPhone').val(userData[0].Phone);$('.superAdminCheckBox').prop("checked",userData[0].SuperAdmin);}
userManager.removeErrorMessage=function(element){$(element).removeClass("error");$(element).next("small").removeClass("error").hide();}
userManager.removeAllErrorMessages=function(){$('.userManagerUserName').removeClass("error");$('.userManagerUserName').next("small").removeClass("error").hide();$('.userManagerFirstName').removeClass("error");$('.userManagerFirstName').next("small").removeClass("error").hide();$('.userManagerLastName').removeClass("error");$('.userManagerLastName').next("small").removeClass("error").hide();$('.userManagerEmail').removeClass("error");$('.userManagerEmail').next("small").removeClass("error").hide();}
userManager.addErrorMessage=function(element,message){$(element).addClass("error");$(element).next("small").addClass("error").text(message).show();}
window.userManager=userManager;}(window));﻿(function(window){var users={};users.selectedItem=null;users.currentSortDirection="";users.currentSortBy="";users.currentList=[];users.filteredList=[];users.gloablSearchList=[];users.adminAccessUpdate=[];users.activeMetaAttributes=[];users.allPortalAttributes={};users.chunkSize=50;users.startIdx=0;users.init=function(){users.selectedItem=null;users.currentList=[];users.currentSortDirection="ASC";users.currentSortBy="firstname";users.adminAccessUpdate=[];users.activeMetaAttributes=[];users.allPortalAttributes=[];$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();$('#sectionContainer .sectionTitleUsername').click(function(){users.filterList("username")});$('#sectionContainer .sectionTitleFirstName').click(function(){users.filterList("firstname")});$('#sectionContainer .sectionTitleLastName').click(function(){users.filterList("lastname")});$('#sectionContainer .sectionTitleEmail').click(function(){users.filterList("email")});$('#sectionContainer .sectionTitleStatus').click(function(){users.filterList("status")});$('#userFilterText').on('input',function(){users.filterList(users.currentSortBy,users.currentSortDirection);});users.addEventListeners();users.listItems();}
users.listItems=function(){$("#loader").show();$("#dvUsersList").empty();users.selectedItem=null;var sc=new sd.ServerCall("ListUsers");sc.go({onSuccess:users.handleList,onError:users.handleError});}
users.handleList=function(myData,status){$("#loader").fadeOut();users.currentList=[];for(var idx=0;idx<myData.length;idx++){var item={}
item.userid=myData[idx].i;item.username=myData[idx].un;item.firstname=myData[idx].fn;item.lastname=myData[idx].ln;item.email=myData[idx].e;item.status=myData[idx].s;item.pending=myData[idx].pcs;users.currentList.push(item);}
users.filterList(users.currentSortBy,users.currentSortDirection);}
users.filterList=function(sortBy,sortDirection){users.startIdx=0;users.filtedList=[];if(users.currentSortBy==sortBy){if(sortDirection!=users.currentSortDirection){if(users.currentSortDirection=="ASC")users.currentSortDirection="DESC";else users.currentSortDirection="ASC";}}else{users.currentSortBy=sortBy;users.currentSortDirection=sortDirection||"ASC";}
if(users.currentSortBy=="username")sd.Utils.sortArrayByString(users.currentList,"username");else if(users.currentSortBy=="firstname")sd.Utils.sortArrayByString(users.currentList,"firstname");else if(users.currentSortBy=="lastname")sd.Utils.sortArrayByString(users.currentList,"lastname");else if(users.currentSortBy=="email")sd.Utils.sortArrayByString(users.currentList,"email");else if(users.currentSortBy=="status")sd.Utils.sortArrayByString(users.currentList,"status");$('#sectionContainer .icon-chevron-up').hide();$('#sectionContainer .icon-chevron-down').hide();var sortArrow="icon-chevron-down";if(users.currentSortDirection=="DESC")sortArrow="icon-chevron-up";if(users.currentSortBy=="username")$('#sectionContainer .sectionTitleUsername > .'+sortArrow).show();if(users.currentSortBy=="firstname")$('#sectionContainer .sectionTitleFirstName > .'+sortArrow).show();if(users.currentSortBy=="lastname")$('#sectionContainer .sectionTitleLastName > .'+sortArrow).show();if(users.currentSortBy=="email")$('#sectionContainer .sectionTitleEmail > .'+sortArrow).show();if(users.currentSortBy=="status")$('#sectionContainer .sectionTitleStatus > .'+sortArrow).show();$('#dvUserList').empty();var filterText=$('#userFilterText').val().toLowerCase();var listCount=users.currentList.length;for(var i=0;i<listCount;i++){var item=users.currentList[i];if(users.currentSortDirection=="DESC")item=users.currentList[listCount-(i+1)];if(filterText!=""&&(item.firstname.toLowerCase().indexOf(filterText)<0&&item.lastname.toLowerCase().indexOf(filterText)<0))continue;users.filtedList.push(item);}
users.displayList();}
users.displayList=function(){var htmlOut="";var listCount=users.filtedList.length;for(var i=users.startIdx;i<listCount&&i<users.startIdx+users.chunkSize;i++){var item=users.filtedList[i];htmlOut+="<div class='row grid adminUserRecord' data-userid='"+item.userid+"'>";htmlOut+="    <div class='yui3-u-1-6'><div class='section-list-field pa-l-1 brand-text'>"+item.firstname+"</div></div>";htmlOut+="    <div class='yui3-u-1-6'><div class='section-list-field'>"+item.lastname+"</div></div>";htmlOut+="    <div class='yui3-u-1-6'><div class='section-list-field'>"+item.email+"</div></div>";htmlOut+="    <div class='yui3-u-1-6'><div class='section-list-field'>"+item.pending+"</div></div>";htmlOut+="    <div class='yui3-u-2-6'><div class='section-list-field'>";htmlOut+="    <button class=\"adminSection small-rnd brand ma-r-half editUser_btn\"><i class=\"icon-edit\"></i></button>";if(item.status=="active")
htmlOut+="<button class=\"admin-delete-btn small-rnd brand ma-r-half disableUser_btn\"><i class=\"icon-ban-circle\"></i></button>";else
htmlOut+="<button class=\"admin-delete-btn small-rnd brand ma-r-half enableUser_btn\"><i class=\"icon-check\"></i></button>";htmlOut+="<button class=\"admin-edit-btn small-rnd brand ma-r-half manageUser_btn\"><i class=\"icon-user\"></i></button>";htmlOut+="</div></div>";htmlOut+="</div>";}
$('#dvUserList').append(htmlOut).find(".js-loadmore").remove();users.startIdx=users.startIdx+users.chunkSize;if(users.startIdx<listCount){htmlOut="<div class=\" section-list-field pa-lr-1 ma-tb-half\"><button class=\"js-loadmore w-12 small brand__outline \">LOAD MORE</button></div>";$('#dvUserList').append(htmlOut);}
$(".editUser_btn").unbind("click").bind("click",function(){var userID=$(this).closest(".adminUserRecord").data("userid");var sc=new sd.ServerCall("GetUserDetails");sc.data({uid:userID});sc.go({onSuccess:users.handleEditUserData,onError:users.handleError});});$(".manageUser_btn").unbind("click").bind("click",function(){var userID=$(this).closest(".adminUserRecord").data("userid");var sc=new sd.ServerCall("GetUserDetails");sc.data({uid:userID});sc.go({onSuccess:users.handleManageUserData,onError:users.handleError});});$(".disableUser_btn").unbind("click").bind("click",function(){var userID=$(this).closest(".adminUserRecord").data("userid");sd.component.messageBox.action({title:"Disable User",text:"Are you sure you want to disable this user?",height:171,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:function(){var sc=new sd.ServerCall("DisableUser");sc.data({uid:userID});sc.go({onSuccess:users.refreshList,onError:users.handleFormError});},icon2:"icon-ban-circle",btn2:"No"});});$(".enableUser_btn").unbind("click").bind("click",function(){var userID=$(this).closest(".adminUserRecord").data("userid");sd.component.messageBox.action({title:"Enable User",text:"Are you sure you want to enable this user?",height:171,width:400,icon1:"icon-ok-sign",btn1:"Yes",btn1callback:function(){var sc=new sd.ServerCall("EnableUser");sc.data({uid:userID});sc.go({onSuccess:users.refreshList,onError:users.handleFormError});},icon2:"icon-ban-circle",btn2:"No"});});$(".js-loadmore").unbind("click").bind("click",function(){users.displayList();});}
users.handleEditUserData=function(myData,status){var user=myData[0];if(user.csImage!=null&&user.csImage!=0){user.Image=user.csImage;}
sd.component.messageBox.action({title:"Edit User",height:550,width:600,bodyClass:"update-pro",loadCallback:function(){$("#userID").val(user.userID);$("#txtUsername").val(user.UserName);$("#txtFirstName").val(user.FirstName);$("#txtLastName").val(user.LastName);$("#txtEmail").val(user.email);$("#txtJobTitle").val($.trim(user.JobTitle));$("#txtPhone").val($.trim(user.Phone));$("#txtMobile").val($.trim(user.Mobile));$("#txtAddress").val($.trim(user.Location));$("#cboUserStatus").val($.trim(user.status));},template:sd.Configuration.templates.editUserProfileBasic,btn2callback:users.saveUserProfile,icon1:"icon-ban-circle",btn1:"Cancel",icon2:"icon-save",btn2:"Save"});}
users.handleManageUserData=function(myData,status){var user=myData[0];if(user.csImage!=null&&user.csImage!=0){user.Image=user.csImage;}
sd.component.messageBox.action({title:"User Administration",height:500,width:800,bodyClass:"update-pro",loadCallback:function(){$("#uaUserID").val(user.userID);$("#uaFirstName").html(user.FirstName);$("#uaLastName").html(user.LastName);$("#uaEmail").html(user.email);$("#uaGuid").html(user.UserName);var sc=new sd.ServerCall("GetUserAccessDetails");sc.data({uid:user.userID});sc.go({onSuccess:users.handleManageUserAccessData,onError:users.handleError});},template:sd.Configuration.templates.manageUserAccess,btn2callback:users.saveUserAccessDetails,icon1:"icon-ban-circle",btn1:"Cancel",icon2:"icon-save",btn2:"Save"});}
users.handleManageUserAccessData=function(myData,status){var htmlOut="";var view;var admin;var none;for(var i=0;i<myData.length;i++){if(i>=1&&myData[i].csid==item.csid)continue;var item=myData[i];if(item.accesslevel==1){view="<input type=\"radio\" name=\""+item.csid+"\" value=\"1\" checked>";admin="<input type=\"radio\" name=\""+item.csid+"\" value=\"3\">";none="<input type=\"radio\" name=\""+item.csid+"\" value=\"0\">";}else if(item.accesslevel==3){view="<input type=\"radio\" name=\""+item.csid+"\" value=\"1\">";admin="<input type=\"radio\" name=\""+item.csid+"\" value=\"3\" checked>";none="<input type=\"radio\" name=\""+item.csid+"\" value=\"0\">";}else{view="<input type=\"radio\" name=\""+item.csid+"\" value=\"1\">";admin="<input type=\"radio\" name=\""+item.csid+"\" value=\"3\">";none="<input type=\"radio\" name=\""+item.csid+"\" value=\"0\" checked>";}
var status=(item.status==null)?"None":item.status;var lastModifiedName=(item.lastmodifiedname==null)?"None":item.lastmodifiedname;var lastModifiedTime=(item.lastmodifiedtime==null)?"-":sd.Utils.formatDate(item.lastmodifiedtime);htmlOut+="<div class='row grid manageUserAccessList'>   \
                <div class='mycol-one'><div class='section-list-field pa-l-half'>"+item.cs_name+"</div></div> \
                <div class='mycol-two'><div class='section-list-field pa-l-1'>"+view+"</div></div> \
                <div class='mycol-three'><div class='section-list-field pa-l-1'>"+admin+"</div></div> \
                <div class='mycol-four'><div class='section-list-field pa-l-1'>"+none+"</div></div> \
                <div class='mycol-five'><div class='section-list-field pa-l-1'>"+status+"</div></div> \
                <div class='mycol-six'><div class='section-list-field pa-l-1'>"+lastModifiedName+"</div></div> \
                <div class='mycol-seven'><div class='section-list-field pa-l-1'>"+lastModifiedTime+"</div></div> \
                </div> \
            </div>";}
$('#dvManageUserAccessList').html(htmlOut);users.adminAccessUpdate=[];$('#dvManageUserAccessList input:radio').bind('click',function(){var csid=$(this).attr('name');var value=$(this).val();for(var i=0;i<users.adminAccessUpdate.length;i++){if(users.adminAccessUpdate[i].csid===csid){users.adminAccessUpdate.splice(i,1);break;}}
users.adminAccessUpdate.push({csid:csid,accesslevel:value});});$("#uaAccessHistory").bind("click",function(){var now=new Date().getTime();var url=sd.Configuration.ws+"/ExcelExport.aspx?report=AccessHistoryExport&uid="+$("#uaUserID").val()+"&timestamp"+now;window.open(url);});}
users.saveUserAccessDetails=function(){var sc=new sd.ServerCall("UpdateUserCollabAccess");var obj={};obj.accessUpdates=users.adminAccessUpdate;obj.uid=$("#uaUserID").val();sc.data(obj);sc.go({onSuccess:users.saveUserAccessDetailsSuccess,onError:users.handleFormError});}
users.saveUserProfile=function(){var validForm=true;if($("#txtUsername").val()==""){validForm=false;}
if($("#txtFirstName").val()==""){validForm=false;}
if($("#txtLastName").val()==""){validForm=false;}
if($("#txtEmail").val()==""){validForm=false;}
if(!validForm){var message="GUID, First Name, Last Name and Email are required fields that must be completed before saving.";handleFormError(message);return;}
if($("#userID").val()==""){var sc=new sd.ServerCall("AddQuickUser");var obj={};obj.userName=$("#txtUsername").val();obj.firstName=$("#txtFirstName").val();obj.lastName=$("#txtLastName").val();obj.email=$("#txtEmail").val();obj.mobile=$("#txtMobile").val();obj.phone=$("#txtPhone").val();obj.title=$("#txtJobTitle").val();obj.address=$("#txtAddress").val();obj.status=$("#cboUserStatus").val();sc.data(obj);sc.go({onSuccess:users.refreshList,onError:users.handleFormError});}else{var sc=new sd.ServerCall("UpdateUserProfile");var obj={};obj.uid=$("#userID").val();obj.userName=$("#txtUsername").val();var standardFields=[];standardFields.push({field:"FirstName",value:$("#txtFirstName").val()});standardFields.push({field:"LastName",value:$("#txtLastName").val()});standardFields.push({field:"email",value:$("#txtEmail").val()});standardFields.push({field:"Phone",value:$("#txtPhone").val()});standardFields.push({field:"Mobile",value:$("#txtMobile").val()});standardFields.push({field:"Location",value:$("#txtAddress").val()});standardFields.push({field:"OfficeAddress",value:$("#txtAddress").val()});standardFields.push({field:"JobTitle",value:$("#txtJobTitle").val()});standardFields.push({field:"FullName",value:$("#txtFirstName").val()+' '+$("#txtLastName").val()});standardFields.push({field:"Status",value:$("#cboUserStatus").val()});obj.standardFields=standardFields;var customFields=[];obj.customFields=customFields;obj.metaAttributes="";sc.data(obj);sc.go({onSuccess:users.refreshList,onError:users.handleFormError});}}
users.refreshList=function(){$('#loader').show();var sc=new sd.ServerCall("ListUsers");sc.go({onSuccess:users.handleList,onError:users.handleError});}
users.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
users.addEventListeners=function(){$("#userAdminAdd_btn").bind("click",function(){if(sd.Configuration.site=="mccann"){users.showGlobalSearchDialog();}else
alert("TODO:Add User Manually. Wasn't required for McCann.....");});$(".admin-close-btn").bind("click",function(){LoadSection("admin",false);});}
users.showGlobalSearchDialog=function(){sd.component.messageBox.action({title:"Global User Search",height:569,width:655,loadCallback:function(){$("#userAdminGlobalSearch_btn").bind("click",function(){var globalString=$('#txtAdminGlobalSearch').val();if(globalString==""){users.handleFormError("Please enter a search term before running a search.");return;}
var arrTemp=globalString.split(" ");if(arrTemp[0].length<2){users.handleFormError("Your first search term '"+arrTemp[0]+"' must be greater than 1 character.");return;}
if(arrTemp.length>1){if(arrTemp[1].length<2){users.handleFormError("Your second search term '"+arrTemp[1]+"' must be greater than 1 character.");return;}}
users.runAdminGlobalSearch(globalString);});$("#userAdminGlobalManualAdd_btn").bind("click",function(){sd.component.messageBox.action({title:"Add New User",height:477,width:600,bodyClass:"update-pro",template:sd.Configuration.templates.editUserProfileBasic,btn2callback:users.saveUserProfile,icon1:"icon-ban-circle",btn1:"Cancel",icon2:"icon-save",btn2:"Save"});});$("#txtAdminGlobalSearch").keypress(function(){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){var globalString=$('#txtAdminGlobalSearch').val();if(globalString==""){users.handleFormError("Please enter a search term before runnning an search.");return;}
var arrTemp=globalString.split(" ");if(arrTemp[0].length<2){users.handleFormError("Your first search term '"+arrTemp[0]+"' must be greater than 1 character.");return;}
if(arrTemp.length>1){if(arrTemp[1].length<2){users.handleFormError("Your second search term '"+arrTemp[1]+"' must be greater than 1 character.");return;}}
users.runAdminGlobalSearch(globalString);}});},template:sd.Configuration.templates.adminGlobalSearch});}
users.runAdminGlobalSearch=function(searchTerm){users.gloablSearchList=[];var sc=new sd.ServerCall("McCannGlobalSearch");var obj={};obj.searchString=searchTerm;obj.startIndex=0;obj.endIndex=100;obj.showPhoto=false;sc.data(obj);sc.go({onSuccess:users.handleMcCannGlobalSearch,onError:users.handleFormError});}
users.handleMcCannGlobalSearch=function(myData,status){var count=myData.length;$('#dvAdminUserSearchList').empty();var htmlOut="";var item;for(var i=0;i<count;i++){item=myData[i];users.gloablSearchList.push(item);htmlOut+="<div class='row grid globalSearchResult' data-id='"+item.un+"'>   \
                            <div class='yui3-u-1-5'><div class='section-list-field pa-l-1'>"+item.fn+"</div></div> \
                            <div class='yui3-u-1-5'><div class='section-list-field'>"+item.ln+"</div></div> \
                            <div class='yui3-u-2-5'><div class='section-list-field'>"+item.e+"</div></div> \
                            <div class='yui3-u-1-5'><div class='section-list-field'> \
                            <button class=\"admin-edit-btn small-rnd brand ma-r-half addGlobalUser\"><i class='icon-plus'></i></button> \
                            </div></div> \
                        </div>";}
if(myData.length<1)
$('#dvAdminUserSearchList').html("<br/><br/>No results found");else
$('#dvAdminUserSearchList').html(htmlOut);$(".addGlobalUser").click(function(){var sc=new sd.ServerCall("AddQuickUser");var obj={};var user;var username=$(this).closest(".globalSearchResult").data("id");for(var i=0;i<count;i++){user=users.gloablSearchList[i];if(username==user.un)
break;}
obj.userName=user.un;obj.firstName=user.fn;obj.lastName=user.ln;obj.email=user.e;obj.mobile=user.m;obj.phone=user.p;obj.title=user.t;obj.address=user.a;obj.status="active";sc.data(obj);sc.go({onSuccess:function(){sd.component.messageBox.action({title:"Success",text:"User added successfully",btn1:"OK",height:171}),users.refreshList();},onError:users.handleFormError});});}
users.editMyProfile=function(objUser){users.selectedItem=objUser;users.getAllPortalAttributes();}
users.getAllPortalAttributes=function(){var sc=new sd.ServerCall("ListSectionMetaTags");var obj={};obj.section='*';sc.data(obj);sc.go({onSuccess:users.handleMeta,onError:team.handleError});}
users.handleMeta=function(myData){users.allPortalAttributes=[];var metaItem;for(var m=0;m<myData.length;m++){metaItem=myData[m];users.allPortalAttributes.push({attribute:metaItem.type,checklist:"dv"+metaItem.type+"List",title:metaItem.label,id:metaItem.id});}
users.formReady();}
users.formReady=function(){sd.component.messageBox.action({title:"Update My Profile",height:593,width:960,cssClass:"msg-box-update-pro",headerClass:"update-pro-front-header",bodyClass:"update-pro-front",loadCallback:function(){var sc=new sd.ServerCall("ListMetaAttributes");var obj={};obj.types='department,role';obj.returnAll=false;obj.userAttr=true;sc.data(obj);sc.go({onSuccess:function(myData,status){var item;var htmlOut="<option value=\"0\">Select Department</option>";for(var i=0;i<myData.length;i++){item=myData[i];if(item.t=="department"){htmlOut+="<option value = \""+item.v+"\"";if(item.v==users.selectedItem.department)htmlOut+=" selected ";htmlOut+=">"+item.v+"</option>";}}
$('#tdDialogDept').html(htmlOut);htmlOut="<option value=\"0\">Select Role</option>";for(var i=0;i<myData.length;i++){item=myData[i];if(item.t=="role"){htmlOut+="<option value = \""+item.v+"\"";if(item.v==users.selectedItem.role)htmlOut+=" selected ";htmlOut+=">"+item.v+"</option>";}}
$('#tdDialogRole').html(htmlOut);},onError:metaAttributes.handleError});$("#userID").val(users.selectedItem.userID);var imgSrc="";if(users.selectedItem.Image==null||users.selectedItem.Image==0){var fullName=users.selectedItem.FullName.split(' ');var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();imgSrc="<span class=\"user-no-image-big\">"+userInitials+"</span>";if(users.selectedItem.colour==null){users.selectedItem.colour=users.UpdateColour(item.userid);}
$("#dvDialogUserImage").css("background-color",users.selectedItem.colour).html(imgSrc);}
else{if(String(users.selectedItem.Image).indexOf("base64")>-1)
imgSrc=users.selectedItem.Image;else
imgSrc=sd.Configuration.vault+"/"+users.selectedItem.Image+"/bigthumb.jpg";$("#dvDialogUserImage").css({"background-image":"url("+imgSrc+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}
$("#tdDialogFullName").val(users.selectedItem.FirstName+' '+users.selectedItem.LastName);$("#tdDialogEmail").val(users.selectedItem.email);$("#txtJobTitle").val($.trim(users.selectedItem.JobTitle));$("#txtPhone").val($.trim(users.selectedItem.Phone));$("#txtMobile").val($.trim(users.selectedItem.Mobile));$("#txtAddress").val($.trim(users.selectedItem.Location));$("#txtExperience").val($.trim(users.selectedItem.Bio));if(users.selectedItem.KeyUser=="1"){$("#chkKeyUser").prop("checked",true);}else{$("#chkKeyUser").prop("checked",false);}
var jsonMeta=$.parseJSON(users.selectedItem.customFields);users.selectedItem.region="";for(var i=0;i<jsonMeta.length;i++){var field=jsonMeta[i];switch(field.f){case"region":users.selectedItem.region=field.v;$("#txtCountry").val(field.v);break;case"twitter":$("#txtTwitter").val(field.v);break;case"facebook":$("#txtFacebook").val(field.v);break;case"website":$("#txtWebsite").val(field.v);break;case"businessUnit":$("#txtBU").val(field.v);break;case"department":users.selectedItem.department=field.v;break;case"role":users.selectedItem.role=field.v;break;default:}}
if(users.allPortalAttributes.length==0)$('#dvEditUserProfile .chk-list').html("No Tags configured.");var fragment;var clone;for(i=0;i<users.allPortalAttributes.length;i++){fragment=document.createDocumentFragment();clone=$('#dvEditUserProfile .guide .checkListItem').clone().appendTo(fragment);clone.attr('id',"dv"+users.allPortalAttributes[i].attribute+"Container");clone.find('span').html(users.allPortalAttributes[i].title);clone.find('div').attr('id',users.allPortalAttributes[i].checklist);$('.chk-list').append(fragment);$('#'+users.allPortalAttributes[i].checklist).checkList({listItems:{},onChange:users.selChange});}
var types="";$.each(users.allPortalAttributes,function(){types+=$(this)[0].id+", ";})
if(types.length>2)types=types.substring(0,types.length-2);var sc=new sd.ServerCall("ListMetaAttributes");var obj={};obj.types=types;obj.returnAll=false;obj.userAttr=false;sc.data(obj);sc.go({onSuccess:users.populateEditChklists,onError:users.handleError});$("#uploadPhoto_btn").bind("click",function(){sd.FileUploader.browse({'destinationInode':-1,'onComplete':users.uploadMyProfileComplete});});},template:sd.Configuration.templates.editUserProfile,btn2callback:users.saveMyProfile,btn1:"Cancel",btn2:"Save"});}
users.populateEditChklists=function(myData,status){var title="";var item;var type,checklist,lstJSON;for(i=0;i<users.allPortalAttributes.length;i++){type=users.allPortalAttributes[i].attribute;chkList=users.allPortalAttributes[i].checklist;$('#'+chkList).checkList({listItems:{},onChange:users.selChange});lstJSON="[]";for(j=0;j<myData.length;j++){if(j==0)lstJSON="[";item=myData[j];if(item.t!=type)
continue;title=item.v.replace(/"/g,'\'');lstJSON+='{ text: "'+title+'", value: "'+item.i+'", ';var jsonMeta=$.parseJSON(users.selectedItem.metaPrefs);for(k=0;k<jsonMeta.length;k++){if(jsonMeta[k].id==item.i){lstJSON+='selected: "1" ';}}
lstJSON+='}';lstJSON+=',';}
lstJSON+=']';var obj=eval('('+lstJSON+')');if(lstJSON!="[]")$('#'+chkList).checkList('setData',obj);else $('#'+chkList).parent().remove();}}
users.saveMyProfile=function(){var sc=new sd.ServerCall("UpdateUserProfile");var obj={};obj.uid=$("#userID").val();obj.userName=users.selectedItem.UserName;var standardFields=[];standardFields.push({field:"Phone",value:$("#txtPhone").val()});standardFields.push({field:"Mobile",value:$("#txtMobile").val()});if(users.selectedItem.Image!=null)standardFields.push({field:"Image",value:users.selectedItem.Image});standardFields.push({field:"Location",value:$("#txtAddress").val()});standardFields.push({field:"OfficeAddress",value:$("#txtAddress").val()});standardFields.push({field:"Bio",value:$("#txtExperience").val()});standardFields.push({field:"JobTitle",value:$("#txtJobTitle").val()});if($("#chkKeyUser").prop("checked")==true)
standardFields.push({field:"KeyUser",value:"1"});else
standardFields.push({field:"KeyUser",value:"0"});obj.standardFields=standardFields;var customFields=[];customFields.push({field:"twitter",value:$("#txtTwitter").val()});customFields.push({field:"facebook",value:$("#txtFacebook").val()});customFields.push({field:"website",value:$("#txtWebsite").val()});customFields.push({field:"department",value:$('#tdDialogDept').val()});customFields.push({field:"role",value:$('#tdDialogRole').val()});obj.customFields=customFields;var lstData;var item;var meta="";for(i=0;i<users.allPortalAttributes.length;i++){lstData=$('#'+users.allPortalAttributes[i].checklist).checkList('getSelection');for(j=0;j<lstData.length;j++){item=lstData[j];meta+="<meta><type><![CDATA["+users.allPortalAttributes[i].attribute+"]]></type><value><![CDATA["+item.text+"]]></value><id><![CDATA["+item.value+"]]></id></meta>";}}
meta="<metadata>"+meta+"</metadata>";obj.metaAttributes=meta;sc.data(obj);sc.go({onSuccess:team.handleUser,onError:users.handleFormError});}
users.handleRegions=function(myData,status){var item;var htmlOut="";htmlOut+="<option value=\"0\">Select Region</option>";for(i=0;i<myData.length;i++){item=myData[i];htmlOut+="<option value=\""+item.v+"\"";if(users.selectedItem.region==item.v)
htmlOut+=" selected ";htmlOut+=">"+item.v+"</option>";}
$('#cboProfileRegion').html(htmlOut);}
users.uploadMyProfileComplete=function(fileData){users.selectedItem.Image=fileData[0].i_node;var fullName=users.selectedItem.FullName.split(' ');var userInitials=fullName[0].substring(0,1).toUpperCase()+fullName[1].substring(0,1).toUpperCase();imgSrc="<span class=\"user-no-image-big\">"+userInitials+"</span>";if(users.selectedItem.colour==null){users.selectedItem.colour=users.UpdateColour(item.userid);}
$("#dvDialogUserImage").css("background-color",users.selectedItem.colour).html(imgSrc);var message="Your profile image has successfully uploaded. It will appear on your profile page once saved and processed.";sd.component.messageBox.showMessage(message);}
users.handleFormError=function(error){sd.component.messageBox.showError(error);}
users.selChange=function(){}
users.saveUserAccessDetailsSuccess=function(){sd.component.messageBox.close();}
users.UpdateColour=function(userid){var userColour=sd.Configuration.profileColours[Math.floor(Math.random()*sd.Configuration.profileColours.length)];var sc=new sd.ServerCall("UpdateUserColour");var obj={};obj.uid=userid;obj.userColour=userColour
sc.data(obj);sc.go({onSuccess:function(){},onError:function(){}});return userColour;}
window.users=users;}(window));﻿(function(window,document){function Annotations(details){details=details||{};this.book=details.book||null;this.video=details.video||null;this.videoAnnotationContainer;this.annoList=null;this.displayStatus=false;this.addModeEnabled=false;this.isDrawing=false;this.stroke=5;}
Annotations.prototype.listItems=function(options){options=options||{};this.onListSuccess=options.onSuccess||function(){};this.onSelect=options.onSelect||function(){};var obj={};if(this.book)obj.inode=this.book.inode;else if(this.video)obj.inode=this.video.inode;var sc=new sd.ServerCall("ListAnnotations");sc.data(obj);sc.go({onSuccess:$.proxy(this.handleList,this)});};Annotations.prototype.handleList=function(myData,status){this.annoList=[];for(var idx=0;idx<myData.length;idx++){var anno=new Annotation(myData[idx]);this.annoList.push(anno);}
this.onListSuccess();};Annotations.prototype.getAnnotationbyId=function(id){for(var i=0;i<this.annoList.length;i++){if(this.annoList[i].id===id){return this.annoList[i];}}
return null;};Annotations.prototype.newAnnotation=function(drawCanvas,type,options){options=options||{};this.onEndHandler=options.onEndHandler||function(){};this.addModeEnabled=true;this.newItem={};this.newItem.type=type;this.newItem.page=options.page||0;this.newItem.zoom=options.zoom||0;this.newItem.pan=options.pan||{x:0,y:0};this.newItem.color=options.color||"rgba(254, 249, 132, 0.7)";this.newItem.timespan=options.timespan||"";this.newItem.drawCanvas=drawCanvas;$(this.newItem.drawCanvas).empty();$(this.newItem.drawCanvas).show();if('ontouchstart'in window){$('body').on('touchmove',this.preventDefaultTouchMove);$(this.newItem.drawCanvas).bind("touchstart",$.proxy(this.startHandler,this));$(this.newItem.drawCanvas).bind("touchmove",$.proxy(this.moveHandler,this));$(this.newItem.drawCanvas).bind("touchend",$.proxy(this.endHandler,this));this.newItem.touchSceen=true;}
else{$(this.newItem.drawCanvas).bind("mousedown",$.proxy(this.startHandler,this));$(this.newItem.drawCanvas).bind("mousemove",$.proxy(this.moveHandler,this));$(this.newItem.drawCanvas).bind("mouseup",$.proxy(this.endHandler,this));this.newItem.touchSceen=false;}};Annotations.prototype.clearNewAnnotation=function(){this.addModeEnabled=false;if(this.newItem!=null){$(this.newItem.drawCanvas).empty();$(this.newItem.drawCanvas).hide();if(!this.newItem.touchSceen){$(this.newItem.drawCanvas).unbind("mousedown",$.proxy(this.startHandler,this));$(this.newItem.drawCanvas).unbind("mousemove",$.proxy(this.moveHandler,this));$(this.newItem.drawCanvas).unbind("mouseup",$.proxy(this.endHandler,this));}
else{$(this.newItem.drawCanvas).unbind("touchstart",$.proxy(this.startHandler,this));$(this.newItem.drawCanvas).unbind("touchmove",$.proxy(this.moveHandler,this));$(this.newItem.drawCanvas).unbind("touchend",$.proxy(this.endHandler,this));$('body').off('touchmove',this.preventDefaultTouchMove);}}
this.newItem=null;};Annotations.prototype.startHandler=function(event){var pos=this.pointerCoordinates(event);this.isDrawing=true;if(this.newItem.type==="scribble"){if(this.newItem.points==null){$(this.newItem.drawCanvas).append("<div id='annotationCurrent_div' class='annotationScribbleCanvas'></div>");this.newItem.points=[];this.updateAnnotationStyle();}
this.newItem.points.push({'x':pos.x,'y':pos.y,'move':'1'});this.newItem.ctx.moveTo(pos.x,pos.y);}
else if(this.newItem.type==="rectangle"||this.newItem.type==="circle"){this.newItem.startX=pos.x;this.newItem.startY=pos.y;$(this.newItem.drawCanvas).append("<div id='annotationCurrent_div' class='annotationBaseAnnotation'></div>");$("#annotationCurrent_div").css({top:pos.y+'px',left:pos.x+"px",});if(this.newItem.type==="circle"){$("#annotationCurrent_div").addClass("annotationCircle");}
this.updateAnnotationStyle();}};Annotations.prototype.moveHandler=function(event){if(!this.isDrawing){$('#div_annotationsDrawCanvas').css({cursor:'default'});return;}
var pos=this.pointerCoordinates(event);if(this.newItem.type==="scribble"){this.newItem.ctx.lineTo(pos.x,pos.y);this.newItem.ctx.stroke();this.newItem.points.push({'x':pos.x,'y':pos.y,'move':'0'});}
else{$('#div_annotationsDrawCanvas').css({cursor:'se-resize'});if(pos.x>this.newItem.startX){$("#annotationCurrent_div").css({width:(pos.x-this.newItem.startX)+'px'});}
else{$("#annotationCurrent_div").css({left:pos.x+'px'});$("#annotationCurrent_div").css({width:(this.newItem.startX-pos.x)+'px'});}
if(pos.y>this.newItem.startY){$("#annotationCurrent_div").css({height:(pos.y-this.newItem.startY)+'px'});}
else{$("#annotationCurrent_div").css({top:pos.y+'px'});$("#annotationCurrent_div").css({height:(this.newItem.startY-pos.y)+'px'});}}};Annotations.prototype.endHandler=function(event){this.onEndHandler();this.isDrawing=false;};Annotations.prototype.updateAnnotationStyle=function(options){options=options||{};if($("#annotationCurrent_div")){this.newItem.color=options.color||this.newItem.color;if(this.newItem.type==="scribble"){$("#annotationCurrent_div").empty();this.newItem.canvas=document.createElement('canvas');this.newItem.canvas.width=$("#annotationCurrent_div").width();this.newItem.canvas.height=$("#annotationCurrent_div").height();$("#annotationCurrent_div").append(this.newItem.canvas);this.newItem.ctx=this.newItem.canvas.getContext("2d");this.newItem.ctx.beginPath();this.newItem.ctx.lineWidth=this.stroke;this.newItem.ctx.strokeStyle=this.newItem.color;this.newItem.ctx.globalCompositeOperation='destination-atop';for(var i=0;i<this.newItem.points.length;i++){if(this.newItem.points[i].move==="1"){this.newItem.ctx.moveTo(this.newItem.points[i].x,this.newItem.points[i].y);}
else{this.newItem.ctx.lineTo(this.newItem.points[i].x,this.newItem.points[i].y);}}
this.newItem.ctx.stroke();}
else{$("#annotationCurrent_div").css({'background-color':this.newItem.color});$("#annotationCurrent_div").css({'border-color':this.newItem.color});}}};Annotations.prototype.pointerCoordinates=function(event){var _offset=$(this.newItem.drawCanvas).offset();var obj={};if(this.newItem.touchSceen){var e=event.originalEvent;var touch=e.touches[0]||e.changedTouches[0];obj.x=touch.pageX-_offset.left;obj.y=touch.pageY-_offset.top;}
else{obj.x=event.pageX-_offset.left;obj.y=event.pageY-_offset.top;}
return obj;}
Annotations.prototype.preventDefaultTouchMove=function(event){event.preventDefault();};Annotations.prototype.saveCurrent=function(inputText,options){options=options||{}
this.onAnnotatioSave=options.onSave||{};var startpoint,endpoint,TopLeftPixel,BottomRightPixel;if(this.newItem.type==="scribble"){if(this.book){var newPoint=this.removeScribbleOffset();startpoint=this.book.pointFromPixel(this.newItem.page,newPoint.leftMost,newPoint.topMost);endpoint=this.book.pointFromPixel(this.newItem.page,newPoint.rightMost,newPoint.bottomMost);}
else if(this.video){var scale=this.video.scale(this.newItem.drawCanvas);var newPoint=this.removeScribbleOffset(1/scale);startpoint=this.video.pointFromPixel(this.newItem.drawCanvas,newPoint.leftMost*scale,newPoint.topMost*scale);endpoint=this.video.pointFromPixel(this.newItem.drawCanvas,newPoint.rightMost*scale,newPoint.bottomMost*scale);}
this.newItem.dataURL=this.newItem.canvas.toDataURL();}
else{var xPos,yPos;if($("#annotationCurrent_div").position()==undefined){xPos=0;yPos=0;}
else{xPos=$("#annotationCurrent_div").position().left;yPos=$("#annotationCurrent_div").position().top;}
if(this.book){startpoint=this.book.pointFromPixel(this.newItem.page,xPos,yPos);endpoint=this.book.pointFromPixel(this.newItem.page,xPos+$("#annotationCurrent_div").width(),yPos+$("#annotationCurrent_div").height());}
else if(this.video){startpoint=this.video.pointFromPixel(this.newItem.drawCanvas,xPos,yPos);endpoint=this.video.pointFromPixel(this.newItem.drawCanvas,xPos+$("#annotationCurrent_div").width(),yPos+$("#annotationCurrent_div").height());}}
var obj={};if(this.book)obj.inode=this.book.inode;else if(this.video)obj.inode=this.video.inode;obj.type=this.newItem.type;obj.page=this.newItem.page;obj.x=startpoint.x;obj.y=startpoint.y;obj.w=endpoint.x-startpoint.x;obj.h=endpoint.y-startpoint.y;obj.data=(this.newItem.dataURL==null)?"":encodeURIComponent(this.newItem.dataURL);obj.text=inputText;obj.pin="";obj.color=this.newItem.color;obj.border="";obj.zoom=this.newItem.zoom;obj.pan=this.newItem.pan.x+","+this.newItem.pan.y;obj.timespan=this.newItem.timespan;var sc=new sd.ServerCall("SaveAnnotation");sc.data(obj);sc.cbData({text:inputText});sc.go({onSuccess:$.proxy(this.handleAnnotationSave,this)});}
Annotations.prototype.updateCurrent=function(inputText,id,options){options=options||{}
this.onAnnotationUpdate=options.onUpdate||{};var obj={};obj.id=id
obj.text=inputText;var sc=new sd.ServerCall("UpdateAnnotation");sc.data(obj);sc.go({onSuccess:$.proxy(this.handleAnnotationUpdate,this)});}
Annotations.prototype.removeScribbleOffset=function(scale){scale=scale||1;var leftMost=this.newItem.points[0].x*scale;var rightMost=leftMost;var topMost=this.newItem.points[0].y*scale;var bottomMost=topMost;for(var i=0;i<this.newItem.points.length;i++){this.newItem.points[i].x*=scale;this.newItem.points[i].y*=scale;if(this.newItem.points[i].x<leftMost){leftMost=this.newItem.points[i].x;}
else if(this.newItem.points[i].x>rightMost){rightMost=this.newItem.points[i].x;}
if(this.newItem.points[i].y<topMost){topMost=this.newItem.points[i].y;}
else if(this.newItem.points[i].y>bottomMost){bottomMost=this.newItem.points[i].y;}}
this.newItem.startPos={'x':leftMost,'y':topMost};$("#annotationCurrent_div").empty();this.newItem.canvas=document.createElement("canvas");this.newItem.canvas.width=rightMost-leftMost;this.newItem.canvas.height=bottomMost-topMost;$("#annotationCurrent_div").append(this.newItem.canvas);var ctx=this.newItem.canvas.getContext("2d");ctx.beginPath();ctx.lineWidth=this.stroke;ctx.strokeStyle=this.newItem.color;ctx.globalCompositeOperation='destination-atop';for(var j=0;j<this.newItem.points.length;j++){if(this.newItem.points[j].move==="1"){ctx.moveTo(this.newItem.points[j].x-leftMost,this.newItem.points[j].y-topMost);}
else{ctx.lineTo(this.newItem.points[j].x-leftMost,this.newItem.points[j].y-topMost);}}
ctx.stroke();return{'leftMost':leftMost,'topMost':topMost,'rightMost':rightMost,'bottomMost':bottomMost};}
Annotations.prototype.handleAnnotationUpdate=function(event){this.onAnnotationUpdate();}
Annotations.prototype.handleAnnotationSave=function(myData,status,cbData){previewer.savedID=myData[0].id;this.onAnnotatioSave(cbData.text);}
Annotations.prototype.displayDeepZoomOverlays=function(display){if(display==null)display=this.displayStatus;this.displayStatus=display;var i;for(i=1;i<this.book.pageDetails.length;i++){if(this.book.pageDetails[i].viewer!=null&&this.book.pageDetails[i].viewer.isOpen()){this.book.pageDetails[i].viewer.drawer.clearOverlays();}}
if(this.displayStatus&&this.annoList!=null){for(i=0;i<this.annoList.length;i++){this.drawDeepZoomAnnotation(i);}}};Annotations.prototype.displayVideoAnnotations=function(event){if(this.displayStatus==false)return;var annoShown=false;for(i=0;i<this.annoList.length;i++){var anno=this.annoList[i];if(event.position>=anno.timespan[0]&&event.position<=anno.timespan[1]){annoShown=true;$("#videoAnnotation_div"+i).show();$("#annotationItemNum"+i).show();}
else{$("#videoAnnotation_div"+i).hide();$("#annotationItemNum"+i).hide();}}
$(this.videoAnnotationContainer).toggle(annoShown);}
Annotations.prototype.createVideoAnnotations=function(display,container){if(display==null)display=this.displayStatus;this.displayStatus=display;$(this.videoAnnotationContainer).empty();$(this.videoAnnotationContainer).hide();if(this.displayStatus){this.videoAnnotationContainer=container;var scale=this.video.scale(this.videoAnnotationContainer);var fragment=document.createDocumentFragment();var elem;for(i=0;i<this.annoList.length;i++){var anno=this.annoList[i];var pixel=this.video.pixelFromPoint(this.videoAnnotationContainer,this.annoList[i].x,this.annoList[i].y);var endpixel=this.video.pixelFromPoint(this.videoAnnotationContainer,this.annoList[i].x+this.annoList[i].w,this.annoList[i].y+this.annoList[i].h);if(anno.type==="scribble"){elem=$("<div id='videoAnnotation_div"+i+"'  class='annotationBaseAnnotation'><img src='"+anno.data+"' /></div>").appendTo(fragment);$(elem).css({top:pixel.y+'px',left:pixel.x+"px",height:'auto',width:'auto','transform':'scale('+scale+')','-ms-transform':'scale('+scale+')','-webkit-transform':'scale('+scale+')','-ransform-origin':'top left','-ms-transform-origin':'top left','-webkit-transform-origin':'top left'});}
else{elem=$("<div id='videoAnnotation_div"+i+"'  class='annotationBaseAnnotation'></div>").appendTo(fragment);$(elem).css({top:pixel.y+'px',left:pixel.x+"px",height:(endpixel.y-pixel.y)+'px',width:(endpixel.x-pixel.x)+'px','background-color':this.annoList[i].color});if(this.annoList[i].type==="circle"){$(elem).addClass("annotationCircle");}}
$(elem).hide();var pin=$("<div id='annotationItemNum"+i+"' class='annotationItemNum'></div>").appendTo(fragment);$(pin).css({'background-color':anno.color,top:pixel.y+'px',left:pixel.x+"px"});$(pin).html(anno.refNum);$(pin).attr('title',anno.text);$(pin).data('annotationid',anno.id);$(pin).click($.proxy(this.annoClicked,this));$(pin).hide();}
$(this.videoAnnotationContainer).html(fragment);}}
Annotations.prototype.drawDeepZoomAnnotation=function(index){var anno=this.annoList[index];var rect;if(this.book.pageDetails[anno.page].viewer==null||!this.book.pageDetails[anno.page].viewer.isOpen()){return;}
var annoElem;if(anno.type==="scribble"){annoElem=document.createElement("img");annoElem.src=anno.data;rect=new OpenSeadragon.Rect(anno.x,anno.y,anno.w,anno.h);this.book.pageDetails[anno.page].viewer.drawer.addOverlay(annoElem,rect);}
else if(anno.type==="rectangle"||anno.type==="circle"){rect=new OpenSeadragon.Rect(anno.x,anno.y,anno.w,anno.h);annoElem=document.createElement("div");$(annoElem).addClass("annotationBaseAnnotation");if(anno.type==="circle"){$(annoElem).addClass("annotationCircle");}
$(annoElem).css({'background-color':anno.color});$(annoElem).css({'border-color':anno.border});this.book.pageDetails[anno.page].viewer.drawer.addOverlay(annoElem,rect);}
var point=new OpenSeadragon.Point(anno.x,anno.y);var placement=OpenSeadragon.OverlayPlacement.TOP_LEFT;var pin=document.createElement('div');$(pin).addClass("annotationItemNum");$(pin).css({'background-color':anno.color});$(pin).html(anno.refNum);$(pin).attr('title',anno.text);$(pin).data('annotationid',anno.id);$(pin).click($.proxy(this.annoClicked,this));this.book.pageDetails[anno.page].viewer.drawer.addOverlay(pin,point,placement);};Annotations.prototype.annoClicked=function(event){this.onSelect($(event.target).data('annotationid'));}
Annotations.prototype.deleteAnnotation=function(id,options){options=options||{};this.onDeleteSuccess=options.onSuccess||function(){};var obj={};obj.id=id;var sc=new sd.ServerCall("DeleteAnnotation");sc.data(obj);sc.go({onSuccess:$.proxy(this.handleDelete,this)});};Annotations.prototype.handleDelete=function(){this.onDeleteSuccess()}
Annotations.prototype.postReply=function(id,details,options){options=options||{};this.onReplySuccess=options.onSuccess||function(){};var obj={};obj.id=id;obj.details=details;var sc=new sd.ServerCall("AddAnnotationReply");sc.data(obj);sc.go({onSuccess:$.proxy(this.handleReply,this)});};Annotations.prototype.handleReply=function(){this.onReplySuccess();}
function Annotation(details){this.id=details.id;this.page=Number(details.page);this.type=details.type;this.refNum=details.refNum;this.x=details.x;this.y=details.y;this.w=details.w;this.h=details.h;this.data=details.data;this.zoomPosition=details.zoom;this.timespan=(details.timespan)?details.timespan.split(":"):[];var pan=details.pan.split(",");this.panPosition=new OpenSeadragon.Point(Number(pan[0]),Number(pan[1]));this.text=details.text;this.creator=details.creator;this.createdTime=details.createdTime;this.color=details.color;this.border=details.border;}
window.sd=window.sd||{};window.sd.Annotations=Annotations;}(window,document));(function(window){var Configuration={};Configuration.site="http://localhost:49797";Configuration.ws=Configuration.site+"/ws";Configuration.vault="https://mccann.screendragon.net/vault";Configuration.tileSource="vault";Configuration.defaultDateFormat="dd-mm-yy";Configuration.searchNoResultsMessage="Sorry, no results were found. Please review your search criteria.";Configuration.adminModules=["GROUPS","COLLAB","METRICS","META","LINKS","ANNOUNCEMENTS","MENU","TRAINING OVERLAYS","EMAIL","USERSETTINGS","USERS","DISCLAIMERS","IFRAME","SECTIONMETA"];Configuration.sections=[{type:"projects",label:"PROJECTS",title:"The Latest Brand Projects"},{type:"workboxes",label:"FILES",title:"WORKBOX LIST"},{type:"meetings",label:"TABLE TOP",title:"MEETING ROOMS"},{type:"library",label:"ART LIBRARY",title:"Latest Art Library Assets"}];Configuration.libraryInode=0;Configuration.channelInode=1;Configuration.announcementsInode=3;Configuration.buildVersion="0.1";Configuration.defaultEgnyteDomain="mwgsandbox";Configuration.templates={};Configuration.templates.article="templates/article.htm";Configuration.templates.mccann="templates/mccann/home.htm";Configuration.templates.social="templates/mccann/home.htm";Configuration.templates.admin="templates/admin.htm";Configuration.templates.widgetsHome="templates/widgets-home.htm";Configuration.templates.newGuide="templates/new-guide.htm";Configuration.templates.adminMetaAttributes="templates/adminMetaAttributes.htm";Configuration.templates.adminSectionMetaAttributes="templates/adminSectionMetaAttributes.htm";Configuration.templates.adminGroups="templates/adminGroups.htm";Configuration.templates.adminUsers="templates/adminUsers.htm";Configuration.templates.adminGlobalSearch="templates/mccann/adminGlobalSearch.htm";Configuration.templates.editUserProfileBasic="templates/dialogs/editUserProfileBasic.htm";Configuration.templates.adminLinks="templates/adminLinks.htm";Configuration.templates.adminAnnouncements="templates/adminAnnouncements.htm";Configuration.templates.adminCollabSpaces="templates/adminCS.htm";Configuration.templates.adminUserSettings="templates/adminUserSettings.htm";Configuration.templates.adminEmail="templates/adminEmail.htm";Configuration.templates.adminMetrics="templates/adminMetrics.htm";Configuration.templates.adminTO="templates/adminTO.htm";Configuration.templates.header="templates/header.htm";Configuration.templates.previewer="templates/previewer.htm";Configuration.templates.tableTop="templates/tabletop.htm";Configuration.templates.library="templates/library.htm";Configuration.templates.libraryItem="templates/libraryItem.htm";Configuration.templates.fileUploadDialog="templates/dialogs/fileUploadDialog.htm";Configuration.templates.team="templates/team.htm";Configuration.templates.mccannGlobalSearch="templates/mccann/globalSearch.htm";Configuration.templates.userProfile="templates/userProfile.htm";Configuration.templates.emailNotification="templates/emailNotification.htm";Configuration.templates.bestCaseItem="templates/bestCaseItem.htm";Configuration.templates.boxEmbed="templates/boxEmbed.htm";Configuration.templates.egnyteEmbed="templates/egnyteEmbed.htm";Configuration.templates.search="templates/search.htm";Configuration.templates.folderDetails="templates/dialogs/folderDetails.htm";Configuration.templates.groupDetails="templates/dialogs/groupDetails.htm";Configuration.templates.groupMembers="templates/dialogs/groupMembers.htm";Configuration.templates.itemPermissions="templates/dialogs/permissionsForm.htm";Configuration.templates.metaAttributeDetails="templates/dialogs/metaAttributeDetails.htm";Configuration.templates.sectionMetaAttributeDetails="templates/dialogs/sectionMetaAttributeDetails.htm";Configuration.templates.channelList="templates/dialogs/channelList.htm";Configuration.templates.channelDetails="templates/dialogs/channelDetails.htm";Configuration.templates.rssDetails="templates/dialogs/rssDetails.htm";Configuration.templates.statusDetails="templates/dialogs/postDetails.htm";Configuration.templates.bestCaseForm="templates/dialogs/bestCaseForm.htm";Configuration.templates.libraryForm="templates/dialogs/libraryForm.htm";Configuration.templates.linksDetails="templates/dialogs/linksDetails.htm";Configuration.templates.linksList="templates/dialogs/linksList.htm";Configuration.templates.csDetails="templates/dialogs/collabSpaceDetails.htm";Configuration.templates.csAccess="templates/dialogs/collabSpaceAccess.htm";Configuration.templates.announcementDetails="templates/dialogs/announcementDetails.htm";Configuration.templates.announcementList="templates/dialogs/announcementAdmins.htm";Configuration.templates.adminMenu="templates/adminMenu.htm";Configuration.templates.adminMenuList="templates/dialogs/adminMenuList.htm";Configuration.templates.adminMenuDetails="templates/dialogs/adminMenuDetails.htm";Configuration.templates.adminMenuDisplayOrder="templates/editMenuDisplayOrder.htm";Configuration.templates.adminSA="templates/adminSA.htm";Configuration.templates.SADetails="templates/dialogs/saDetails.htm";Configuration.templates.SAMembers="templates/dialogs/saMembers.htm";Configuration.templates.adminTO="templates/adminTO.htm";Configuration.templates.videoPreview="templates/dialogs/videoPreview.htm";Configuration.templates.swfPreview="templates/dialogs/swfPreview.htm";Configuration.templates.shareResource="templates/dialogs/shareResource.htm";Configuration.templates.disclaimer="templates/dialogs/disclaimer.htm";Configuration.templates.clientList="templates/mccann/clientList.htm";Configuration.templates.sectionDetails="templates/dialogs/sectionDetails.htm";Configuration.templates.linkSectionDisplayOrder="templates/editLinkSectionDisplayOrder.htm";Configuration.templates.adminDisclaimers="templates/adminDisclaimers.htm";Configuration.templates.adminIFrame="templates/adminIFrame.htm";Configuration.templates.disclaimerDetails="templates/dialogs/disclaimerDetails.htm";Configuration.templates.expandedLinks="templates/expandedLinks.htm";Configuration.templates.manageUserAccess="templates/dialogs/manageUserAccess.htm";Configuration.templates.sendEmail="templates/dialogs/sendEmail.htm";Configuration.templates.jobList="templates/job.htm";Configuration.templates.jobItem="templates/jobItem.htm";Configuration.templates.jobForm="templates/dialogs/jobForm.htm";Configuration.templates.wysiwygDialog="templates/dialogs/wysiwyg.htm";Configuration.templates.newsletterForm="templates/dialogs/newsletterForm.htm";Configuration.templates.newsletter="templates/newsletter.htm";Configuration.templates.header="templates/menuInHeader.htm";Configuration.templates.crewForm="templates/mccann/crewForm.htm";Configuration.templates.crewList="templates/mccann/crewList.htm";Configuration.templates.crewItem="templates/mccann/crewItem.htm";Configuration.templates.userProfile="templates/mccann/userProfile.htm";Configuration.templates.editUserProfile="templates/mccann/editUserProfile.htm";Configuration.templates.googleMap="templates/googleMap.htm";Configuration.templates.dashboard="templates/myDashboard.htm";Configuration.templates.dashboardModule="templates/myDashboardModule.htm";Configuration.templates.recentlyAdded="templates/myRecentlyAdded.htm";Configuration.templates.quickLinks="templates/myQuickLinks.htm";Configuration.templates.bestCases="templates/myBestCases.htm";Configuration.templates.bestFolders="templates/myBestFolders.htm";Configuration.templates.dashboardDetails="templates/dialogs/dashboardDetails.htm";Configuration.previewerShowToolButton=false;Configuration.previewerShowAnnotationButtons=false;Configuration.previewerShowAddNoteButton=false;Configuration.previewerShowAnnotationLeftPanel=false;Configuration.backButtonEnabled=true;Configuration.messages={}
Configuration.messages.confirmExitMessage="You have attempted to exit the application, please ensure your changes have been saved.";Configuration.messages.confirmExitMessagePreviewEmail="An Email Notification for your changes has not been sent";Configuration.messages.confirmDeleteSelectedTitle="Delete Selected"
Configuration.messages.confirmDeleteSelected="<div class=\"alert\">Are you sure you want to delete the selected items?</div>";Configuration.messages.emailNewUploadSubject="I thought you'd find this interesting.";Configuration.messages.emailNewUploadBody="Here is some content I think you'll find interesting, just click the link to view it.";Configuration.messages.newsletterEmailSubject="New Newsletter Publication.";Configuration.messages.newsletterEmailBody="A new newsletter has been published, just click the link to view it.";Configuration.egnyteFolderStub="https://mwgsandbox.egnyte.com/SimpleUI/home.do#Files/0";Configuration.mapData=[];Configuration.blockEdit=[];Configuration.folderLink=[];Configuration.homepageLinks=[];Configuration.dashLayoutID=1;Configuration.widgetResultLimit=1;Configuration.profileColours=['rgba(250, 169, 22, 1)','rgba(46, 82, 102, 1)','rgba(123, 13, 30, 1)','rgba(110, 136, 152, 1)','rgba(159, 177, 188, 1)'];Configuration.footerAboutURL="http://support.mwgsolutions.com";window.sd=window.sd||{};window.sd.Configuration=Configuration;}(window));﻿(function(window){function DashboardItem(options){if(!options.container||!options.itemClass)return null;this.container=options.container;this.itemClass=options.itemClass;this.itemID=options.itemID||0;this.label=options.label||"";this.type=options.type||"";this.data=options.data||"";if(this.type=="myRecentlyAdded"||this.type=="myBestCases"||this.type=="myBestFolders"||this.type=="myBestArticle"||this.type=="myBestDreamTeam"||this.type=="myBestExpert"||this.type=="myBestNewsletter"||this.type=="homepage"||this.type=="myBestTeam"){this.data=(this.data)?$.parseJSON(this.data):{};}
switch(this.type){case"myBestCases":this.template="bestcase";this.section="library";break;case"myBestFolders":this.template="Document";this.section="library";break;case"myBestArticle":this.template="article";this.section="article";break;case"myBestDreamTeam":this.template="dreamteam";this.section="crew";break;case"myBestExpert":this.template="expert";this.section="crew";break;case"myBestNewsletter":this.template="newsletter";break;case"myBestTeam":this.template="team";this.section="team";break;}
if(this.type=="myBestCases"||this.type=="myBestFolders"||this.type=="myBestArticle"||this.type=="myBestDreamTeam"||this.type=="myBestExpert"||this.type=="myBestNewsletter"||this.type=="homepage"||this.type=="myBestTeam"){this.type+="-"+this.itemID;}
this.content
this.sortIndex=options.sortIndex||0;this.itemType=options.itemType||"";this.width=options.width||0;this.reportDetails={}
this.holder=null;this.itemList=[];this.startItem=options.startItem||0;this.endItem=sd.Configuration.widgetResultLimit;this.firstTime=options.firstTime||true;this.projectSections=options.projectSections||["Projects"];this.callback=(options.callback==null)?function(){}:options.callback;}
DashboardItem.prototype.draw=function(){if(this.itemType=="widget"){this.holder=$(this.itemClass).clone().appendTo(this.container);$(this.holder).addClass("medium-"+this.width+" large-"+this.width);if(this.type.indexOf("myRecentlyAdded")>=0){$(this.holder).load("templates/myRecentlyAdded.htm",$.proxy(this.handleDrawComplete,this));}
else if(this.type.indexOf("myBestCases")>=0||this.type.indexOf("myBestFolders")>=0||this.type.indexOf("myBestArticle")>=0||this.type.indexOf("myBestDreamTeam")>=0||this.type.indexOf("myBestExpert")>=0||this.type.indexOf("myBestNewsletter")>=0){$(this.holder).load("templates/myBestCases.htm",$.proxy(this.handleDrawComplete,this));}
else if(this.type.indexOf("myBestTeam")>=0||this.type.indexOf("myBestArtist")>=0){$(this.holder).load("templates/myBestFolders.htm",$.proxy(this.handleDrawComplete,this));}
else if(this.type=="myQuickLinks"){$(this.holder).load("templates/myQuickLinks.htm",$.proxy(this.handleDrawComplete,this));}
if(this.type!="myGenReport"){if(this.type.indexOf("myRecentlyAdded")>=0){$(this.holder).attr("id","myRecentlyAdded");}
else{$(this.holder).attr("id",this.type);}}}
else if(this.itemType=="tab"){this.holder=$(this.itemClass).clone().appendTo(this.container);if(this.sortIndex==0){$(this.holder).addClass("active")}
$(this.holder).find("a").html(this.label);if(this.type.indexOf("myRecentlyAdded")>=0){if(master.mobileSite){$(this.holder).load("mobile/templates/myRecentlyAddedMobile.htm",$.proxy(this.handleDrawComplete,this));}else{$(this.holder).find(".content").load("templates/myRecentlyAdded.htm",$.proxy(this.handleDrawComplete,this));}}
else{$(this.holder).find(".content").load("templates/"+this.type+".htm",$.proxy(this.handleDrawComplete,this));}}
else if(this.itemType=="homepage"){var callback=this.callback;var itemCallback=(this.data.callback)?eval(this.data.callback):function(){};console.log("Item callback: "+itemCallback);if(this.data.iFrame){var id="frame"+this.itemClass.replace(".","");$(this.container).html('<iframe id="'+id+'" name="myFrame" width="100%" frameBorder="0">');id="#"+id;$(id).attr('src',this.data.url);$(id).load(function(){$(this).height($(this).contents().height());$(this).closest(".homepage").height($(this).contents().height());callback();console.log("Calling itemCallback1: "+itemCallback+" "+data);itemCallback(this.data);});}
else{var thisObj=this;console.log("container:  "+this.container+" "+$(this.container).length+" "+this.data.url);$(this.container).load(this.data.url,function(){console.log("Item loaded");if($(this.parentElement).hasClass("topSection")){if(myDashboard.topInit){myDashboard.topInit();}}
else if($(this.parentElement).hasClass("leftSection")){if(myDashboard.leftInit){myDashboard.leftInit();}}
else if($(this.parentElement).hasClass("rightSection")){if(myDashboard.rightInit){myDashboard.rightInit();}}
else if($(this.parentElement).hasClass("bottomSection")){if(myDashboard.bottomInit){myDashboard.bottomInit();}}
callback();console.log("Calling itemCallback2: "+itemCallback+' '+thisObj.data);itemCallback({data:thisObj.data});});}}
else if(this.itemType=="singleItem"){this.holder=$(this.itemClass)
if(this.type.indexOf("myRecentlyAdded")>=0){if(master.mobileSite){$(this.holder).load("mobile/templates/myRecentlyAddedMobile.htm",$.proxy(this.handleDrawComplete,this));}else{$(this.container).load("templates/myRecentlyAdded.htm",$.proxy(this.handleDrawComplete,this));}}
else if(this.type.indexOf("resourceManager")>=0){this.handleDrawComplete();}
else{$(this.container).load("templates/"+this.type+".htm",$.proxy(this.handleDrawComplete,this));}}}
DashboardItem.prototype.handleDrawComplete=function(){if($(this.holder).find(".widgetBody").hasClass("myRecentlyAdded")){$(this.holder).find(".widgetBody").removeClass("myRecentlyAdded");$(this.holder).find(".widgetBody").addClass(this.type);if(this.data.fnode>0&&sd.Session.user.superAdmin&&this.data.types[0]=="Link"){$(this.holder).find(".widgetBody").data("fnode",this.data.fnode);}
else{}}
$(this.holder).find('.widgetBody div').first().attr("class",this.type);$(this.holder).find(".unityList__item").html(this.label);if(this.type.indexOf("myRecentlyAdded")>=0){var sc=new sd.ServerCall("ListSocialDashboard",0);var obj={};obj.f_node=sd.Configuration.discussionRoot;obj.limit=3;sc.data(obj);sc.go({onSuccess:$.proxy(this.handleRecentPosts,this),onError:$.proxy(this.handleError,this)});}
else if(this.type.indexOf("myBestCases")>=0){var sc=new sd.ServerCall("ListDashboardItems");var obj={};obj.depth="deep";obj.inode=this.data.inode;obj.limit=3;obj.type="bestcase";sc.data(obj);sc.go({onSuccess:$.proxy(this.handleBestCasesFolderItems,this),onError:$.proxy(this.handleError,this)});}
else if(this.type.indexOf("myBestFolders")>=0){var sc=new sd.ServerCall("ListDashboardItems");var obj={};obj.depth="deep";obj.inode=this.data.inode;obj.limit=3;obj.type="Document";sc.data(obj);sc.go({onSuccess:$.proxy(this.handleBestCasesFolderItems,this),onError:$.proxy(this.handleError,this)});}
else if(this.type.indexOf("myBestTeam")>=0){var sc=new sd.ServerCall("ListDashboardUsers");sc.go({onSuccess:$.proxy(this.handleTeamList,this),onError:$.proxy(this.handleError,this)});}
else if(this.type.indexOf("myBestArticle")>=0){var sc=new sd.ServerCall("ListDashboardItems");var obj={};obj.depth="deep";obj.inode=this.data.inode;obj.limit=3;obj.type="article";sc.data(obj);sc.go({onSuccess:$.proxy(this.handleArticles,this),onError:$.proxy(this.handleError,this)});}
else if(this.type=="myQuickLinks"){if(sd.Global.collabData.quickLinks!=null){var links=JSON.parse(sd.Global.collabData.quickLinks);var fragment=document.createDocumentFragment();for(i=0;i<links.length;i++){var clone=$("#myQuickLinks .guide .js-qLink").clone().appendTo(fragment);var link=links[i];clone.find(".js-info").attr({"title":link.description});link.image=encodeURI(link.image);var linkImage="images/mccann/quickLinks/"+link.image;clone.find("div").css({"background-image":"url("+linkImage+")"}).attr({"title":link.title});clone.find(".js-follow").data({"link":link.url});}
$("#myQuickLinks ul").append(fragment);$("#myQuickLinks .js-info").tooltip();$("#myQuickLinks .js-follow").unbind("click").bind("click",function(){window.open($(this).data("link"),"_blank");});}
else{$("#myQuickLinks ul").append("<li class=\"text-center;\">No Links Set</li>");}}
$("#myDashboard .admin-edit-btn").hide();if(sd.Session.user.superAdmin||admin.adminUser()){$("#myDashboard .admin-edit-btn").show();}
$(this.holder).find(".viewMore").click(function(){var obj={};obj.f_node=$(this).attr('data-id');obj.ParentID=$(this).attr('data-id');obj.type=$(this).attr('data-type');obj.template=$(this).attr('data-template');obj.section=$(this).attr('data-section');if(obj.template=="article"){obj.standalone=true;}
var sc=new sd.ServerCall("LogContentMetric");sc.data({inode:obj.f_node,metricType:"SECTION_OPEN"});sc.cbData({obj:obj});sc.go({onSuccess:myDashboard.handleAddMetric,onError:myDashboard.handleError});});}
DashboardItem.prototype.handleRecentPosts=function(myData,status){this.itemList=[];for(var i=0;i<myData[0].comments.length;i++){var comment=myData[0].comments[i];var tmpObj={};tmpObj.i=comment.i_node;tmpObj.f=comment.f_node;tmpObj.d=comment.description;tmpObj.dc=sd.Utils.formatDate(comment.createdTime,"dd mmm yy");tmpObj.t=comment.type;tmpObj.tle=comment.title;tmpObj.p=comment.preview;if(comment.attachments==0){tmpObj.a=[];}else{tmpObj.a=[];var arrTmp=$.grep(myData[0].attachments,function(e){return e.f_node==comment.i_node;});for(var j=0;j<arrTmp.length;j++){var tmpAttach={};tmpAttach.i=arrTmp[j].i_node;tmpAttach.f=arrTmp[j].fmt;tmpAttach.n=arrTmp[j].filename;tmpObj.a.push(tmpAttach);}}
this.itemList.push(tmpObj);}
this.displayRecentItemList();};DashboardItem.prototype.displayRecentItemList=function(){var recentItemFragment=document.createDocumentFragment();var item;var listCount=this.itemList.length;$(this.holder).find(".myRecentlyAddedDetails").html(this.label);if(listCount==0){if(sd.Configuration.DashHideNavButtons){$(this.holder).find('.widgetPageControls').hide();$(this.holder).find(".widgetList").html("<div class='flex pa-all-1 guide-row list-item' data-id="+this.data.inode+"> \
                                                            <p class='dashboardNoItem noValue'>There are no posts to display.</p> \
                                                        </div>");$(this.holder).find(".widgetContent").attr("data-id",this.itemID);$('.myRecentlyAdded .dashboardWidgetLoader').hide();}
else{$(this.holder).find('.widgetPageControls').show()
$(this.holder).find(".currentPage").html("1");$(this.holder).find(".numberOfPages").html("1");$(this.holder).find(".widgetList").html("<div class='flex pa-all-1 guide-row list-item' data-id="+this.data.inode+"> \
                                                            <p class='dashboardNoItem noValue'>There are no posts to display.</p> \
                                                        </div>");$(this.holder).find(".widgetContent").attr("data-id",this.itemID);$(this.holder).find(".widgetNextBtn").prop("disabled",true);$(this.holder).find(".widgetLastBtn").prop("disabled",true);$('.myRecentlyAdded .dashboardWidgetLoader').hide();var recentItemClone=$(this.holder).find(".guide .guide-row").clone().appendTo(recentItemFragment);}}
else{$(this.holder).find("#recentlyAdded_btn").attr("data-id",sd.Configuration.libraryInode);$(this.holder).find("#recentlyAdded_btn").attr("data-type","folder");$(this.holder).find("#recentlyAdded_btn").attr("data-template","social");if(this.firstTime){$(this.holder).find(".currentPage").html("1");}
var numberOfPages=Math.ceil(listCount/sd.Configuration.widgetResultLimit);$(this.holder).find(".numberOfPages").html(numberOfPages);$(this.holder).find(".widgetContent").attr("data-id",this.itemID);if(listCount<sd.Configuration.widgetResultLimit){this.endItem=listCount;}
else if(listCount<this.endItem){this.endItem=listCount;}
$(this.holder).find(".guide-row").attr("data-id",this.data);if(listCount<=sd.Configuration.widgetResultLimit){$(this.holder).find(".widgetNextBtn").prop("disabled",true);$(this.holder).find(".widgetLastBtn").prop("disabled",true);}
for(var i=this.startItem;i<this.endItem;i++){item=this.itemList[i];var recentItemClone=$(this.holder).find(".guide .guide-row").clone().appendTo(recentItemFragment);var newTitle=item.tle;try{newTitle=decodeURIComponent(item.tle);}catch(e){newTitle=item.tle;}
recentItemClone.find(".fullName").html(newTitle);recentItemClone.find(".js-file-date").html(item.dc);var newDescription=item.d;try{newDescription=decodeURIComponent(item.d);}catch(e){newDescription=item.d;}
recentItemClone.find(".sqr-scale").removeAttr("style");recentItemClone.find(".js-file-desc").attr("id",item.i);recentItemClone.find(".js-file-desc").html(this.formatEmbeddedLinks(newDescription,item.i,item.p,item.a).replace(/\n/g,"<br/>"));recentItemClone.find(".sqr-scale table").remove();if(item.a.length>0){var imgSrc="";if(sd.Utils.isVideo(item.a[0].f)){imgSrc=sd.Utils.buildAssetSource({prefix:"imgC",inode:item.a[0].i,format:item.a[0].f,thumbSize:"lge",thumbType:"smallthumb",height:250,width:250,title:item.a[0].n,videoSize:"full"});imgSrc+="<div class='vidOverlay'></div>";recentItemClone.find(".sqr-scale").html(imgSrc);recentItemClone.find(".sqr-scale").attr("data-inode",item.a[0].i);recentItemClone.find(".sqr-scale").removeClass("postImage").addClass("postVideo");recentItemClone.find(".sqr-scale").removeAttr("href");}else{imgSrc=sd.Configuration.vault+"/"+item.a[0].i+"/bigthumb.jpg";recentItemClone.find(".sqr-scale").css({"background-image":"url("+imgSrc+")","background-size":"cover","background-position":"center"});recentItemClone.find(".sqr-scale").attr("data-inode",item.a[0].i);recentItemClone.find(".sqr-scale").attr("href",imgSrc);recentItemClone.find(".sqr-scale").attr("data-filename",item.a[0].n);}
recentItemClone.find(".sqr-scale").find(".svg-icon-large").hide();}
if(recentItemClone.find(".sqr-scale").css('background-image')!=''){recentItemClone.find(".sqr-scale").find(".svg-icon-large").hide();}else{recentItemClone.find(".sqr-scale").find(".svg-icon-large").show();}
recentItemClone.find(".js-file-name").dotdotdot({ellipsis:'... ',wrap:'letter',fallbackToLetter:true,watch:true,height:25});recentItemClone.find(".js-file-desc").dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:300});}
$(this.holder).find(".widgetList").html(recentItemFragment);$('.myRecentlyAdded .dashboardWidgetLoader').hide();}
$(this.holder).find("#recentlyAdded_btn").click(function(){var obj={};obj.f_node=$(this).attr('data-id');obj.ParentID=$(this).attr('data-id');obj.type=$(this).attr('data-type');obj.template="social";obj.section="social";var sc=new sd.ServerCall("LogContentMetric");sc.data({inode:obj.f_node,metricType:"SECTION_OPEN"});sc.cbData({obj:obj});sc.go({onSuccess:myDashboard.handleAddMetric,onError:myDashboard.handleError});});if(this.firstTime){myDashboard.addEventListeners('myRecentlyAdded');this.callback();}}
DashboardItem.prototype.findNextLink=function(status,index){var urlPrefixes=new Array("http://","https://","mailto:","www.");var linkIndex=0;var minIndex=status.length+1;for(var i=0;i<urlPrefixes.length;i++){linkIndex=status.indexOf(urlPrefixes[i],index);if((linkIndex!=-1)&&(linkIndex<minIndex)){minIndex=linkIndex;}}
return(minIndex==status.length+1)?-1:minIndex;};DashboardItem.prototype.findLinkEnd=function(status,index){var linkEnd=status.replace(/\n/g," ").indexOf(" ",index);if(linkEnd==-1){linkEnd=status.length;}
return linkEnd;};DashboardItem.prototype.formatEmbeddedLinks=function(status,inode,preview,source,attachments){var newStatus="";var index=0;var linkStart;var linkEnd;var linkString;var linkCount;linkStart=this.findNextLink(status,index);linkCount=1;while(linkStart!=-1){linkEnd=this.findLinkEnd(status,linkStart);linkString=status.substring(linkStart,linkEnd);if(status.substring(linkStart-6,linkStart)!='href="'){newStatus+=status.substring(index,linkStart);if(linkCount>1)preview=0;newStatus=this.formatLink(newStatus,linkString,inode,preview,source,attachments);}else{newStatus+=status.substring(index,linkEnd);}
index=linkEnd;linkStart=this.findNextLink(status,index);linkCount++;}
newStatus+=status.substring(linkEnd,status.length);return newStatus;};DashboardItem.prototype.handleBestCasesFolderItems=function(myData,status){this.itemList=[];if(myData.length>0){for(var idx=0;idx<myData.length;idx++){var item={}
var timestamp=$.now();item.id=myData[idx].i;item.thumb=myData[idx].tb;item.name=myData[idx].t;item.description=myData[idx].d;item.createdate=myData[idx].ct;item.creator=myData[idx].a;item.type=myData[idx].tp;item.format=myData[idx].f;item.path=myData[idx].p;item.authorName=myData[idx].an;item.authorID=myData[idx].ai;item.disc=myData[idx].disc;item.featured=myData[idx].ft;item.expired=myData[idx].exp;this.itemList.push(item);}}else{var item={}
var timestamp=$.now();item.inode=this.data.inode;}
this.displayBestCases();}
DashboardItem.prototype.handleArticles=function(myData,status){this.itemList=[];var item={}
if(myData.length>0){for(var idx=0;idx<myData.length;idx++){var timestamp=$.now();item.content=myData[idx].c;this.itemList.push(item);}}else{item.inode=this.data.inode;}
this.displayBestCases();}
DashboardItem.prototype.displayBestCases=function(){var recentFileFragment=document.createDocumentFragment();var item;var listCount=this.itemList.length;$(this.holder).find(".myDashboardTitle").html(this.label);if(listCount==0){if(sd.Configuration.DashHideNavButtons){$(this.holder).find('.widgetPageControls').hide();$(this.holder).find(".widgetList").html("<div class='flex pa-all-1 guide-row list-item' data-id="+this.data.inode+"> \
                                                            <p class='dashboardNoItem noValue'>No results found.</p> \
                                                        </div>");$(this.holder).find(".widgetContent").attr("data-id",this.itemID);$('.myRecentlyVisitedList .dashboardWidgetLoader').hide();$(this.holder).find("#featuredContent_btn").attr("data-id",this.data.inode);$(this.holder).find("#featuredContent_btn").attr("data-template",this.template);$(this.holder).find("#featuredContent_btn").attr("data-section",this.section);$(this.holder).find("#featuredContent_btn span").html("VIEW MORE "+this.label.toUpperCase());}
else{$(this.holder).find('.widgetPageControls').show()
$(this.holder).find(".currentPage").html("1");$(this.holder).find(".numberOfPages").html("1");$(this.holder).find(".widgetList").html("<div class='flex pa-all-1 guide-row list-item' data-id="+this.data.inode+"> \
                                                            <p class='dashboardNoItem noValue'>No results found.</p> \
                                                        </div>");$(this.holder).find(".widgetContent").attr("data-id",this.itemID);$(this.holder).find(".widgetNextBtn").prop("disabled",true);$(this.holder).find(".widgetLastBtn").prop("disabled",true);$('.myRecentlyVisitedList .dashboardWidgetLoader').hide();$(this.holder).find("#featuredContent_btn").attr("data-id",this.data.inode);$(this.holder).find("#featuredContent_btn").attr("data-template",this.template);$(this.holder).find("#featuredContent_btn").attr("data-section",this.section);$(this.holder).find("#featuredContent_btn span").html("VIEW MORE "+this.label.toUpperCase());}}
else{$(this.holder).find("#featuredContent_btn").attr("data-id",this.data.inode);$(this.holder).find("#featuredContent_btn").attr("data-template",this.template);$(this.holder).find("#featuredContent_btn").attr("data-section",this.section);$(this.holder).find("#featuredContent_btn span").html("VIEW MORE "+this.label.toUpperCase());if(this.firstTime){$(this.holder).find(".currentPage").html("1");}
var numberOfPages=Math.ceil(listCount/sd.Configuration.widgetResultLimit);$(this.holder).find(".numberOfPages").html(numberOfPages);if(listCount<sd.Configuration.widgetResultLimit){this.endItem=listCount;}
else if(listCount<this.endItem){this.endItem=listCount;}
$(this.holder).find(".guide-row").attr("data-id",this.data.inode);if(this.type.indexOf("myBestFolders")>-1){$(this.holder).find(".guide-row").attr("data-type","Document");}else if(this.type.indexOf("myBestCases")>-1){$(this.holder).find(".guide-row").attr("data-type","bestcase");}else if(this.type.indexOf("myBestArticle")>-1){$(this.holder).find(".guide-row").attr("data-type","article");}
$(this.holder).find(".widgetContent").attr("data-id",this.itemID);if(listCount<=sd.Configuration.widgetResultLimit){$(this.holder).find(".widgetNextBtn").prop("disabled",true);$(this.holder).find(".widgetLastBtn").prop("disabled",true);}
var recentItemClone=$(this.holder).find(".guide .guide-row").clone().appendTo(recentFileFragment);if(this.type.indexOf("myBestFolders")>-1||this.type.indexOf("myBestCases")>-1){for(var i=this.startItem;i<this.endItem;i++){item=this.itemList[i];recentItemClone.data({"id":item.id,"type":item.type});recentItemClone.attr("data-type",item.type)
if(item.featured==1||(library.listTemplate=="newsletter"&&item.status=="draft")){if(item.featured==1)
recentItemClone.find(".libraryFavItem").attr("src",'images/mccann/featured_badge.png');if(library.listTemplate=="newsletter"&&item.status=="draft")
recentItemClone.find(".libraryFavItem").attr("src",'images/mccann/draftNewsletter.png');}else{recentItemClone.find(".libraryFavItem").remove();}
if(sd.Utils.isVideo(item.format)){var html="<video class='videoClass' id='"+item.thumb+"' style=\"width: 100%; height: 248px;\"> ";html+="<source src = '"+sd.Configuration.ws+"/"+item.thumb+"/"+item.thumb+"_thumb.mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";recentItemClone.find(".js-image").append(html);}
else{var image=sd.Configuration.vault+"/"+item.thumb+"/bigthumb.jpg";if(item.type=="Link"&&item.thumb==0){var url="https://api.embed.ly/1/oembed?key=9c59af118a744a588186e6264d1da748&url="+encodeURIComponent(String(item.name).split("||")[1]);$.getJSON(url,function(data){var img=data.thumbnail_url;var desc=data.description;var title=data.title;if(img==""){recentItemClone.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}else{recentItemClone.find(".js-image").css({"background-image":"url("+img+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;","background-color":"#ffffff"});}});}
else{recentItemClone.find(".js-image").css({"background-image":"url("+image+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}}
recentItemClone.find(".js-file-name").addClass("fullName");if(item.type=='Link'){recentItemClone.attr("data-link",String(item.name).split("||")[1])
recentItemClone.find(".js-file-name").html(String(item.name).split("||")[0]);}else{var name=(item.expired==0)?item.name:"(Expired) "+item.name;recentItemClone.find(".js-file-name").html(name);}
recentItemClone.find(".js-file-desc").html(item.description);recentItemClone.find(".js-file-date").html(item.createdate);}}else if(this.type.indexOf("myBestArticle")>-1){item=this.itemList[0];recentItemClone.empty();recentItemClone.append('<div class="flex-column-reverse" id="dvArticle">'+item.content+'</div>');}
recentItemClone.find(".js-file-name").dotdotdot({ellipsis:'... ',wrap:'letter',fallbackToLetter:true,watch:true,height:25});recentItemClone.find(".js-file-desc").dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:110});$(this.holder).find(".widgetList").html(recentFileFragment);$('.myRecentlyVisitedList .dashboardWidgetLoader').hide();}
if(this.firstTime){myDashboard.addEventListeners(this.type);this.callback();}}
DashboardItem.prototype.displayTeamFolders=function(){var recentFileFragment=document.createDocumentFragment();var item;var listCount=this.itemList.length;$(this.holder).find(".myDashboardTitle").html(this.label);if(listCount==0){if(sd.Configuration.DashHideNavButtons){$(this.holder).find('.widgetPageControls').hide();$(this.holder).find(".widgetList").html("<div class='flex pa-all-1 guide-row list-item' data-id="+this.data.inode+"> \
                                                            <p class='dashboardNoItem noValue'>No results found.</p> \
                                                        </div>");$(this.holder).find(".widgetContent").attr("data-id",this.itemID);$('.myRecentlyVisitedList .dashboardWidgetLoader').hide();$(this.holder).find("#featuredContent_btn").attr("data-id",this.data.inode);$(this.holder).find("#featuredContent_btn").attr("data-template",this.template);$(this.holder).find("#featuredContent_btn").attr("data-section",this.section);$(this.holder).find("#featuredContent_btn span").html("VIEW MORE "+this.label.toUpperCase());}
else{$(this.holder).find('.widgetPageControls').show()
$(this.holder).find(".currentPage").html("1");$(this.holder).find(".numberOfPages").html("1");$(this.holder).find(".widgetList").html("<div class='flex pa-all-1 guide-row list-item' data-id="+this.data.inode+"> \
                                                            <p class='dashboardNoItem noValue'>No results found.</p> \
                                                        </div>");$(this.holder).find(".widgetContent").attr("data-id",this.itemID);$(this.holder).find(".widgetNextBtn").prop("disabled",true);$(this.holder).find(".widgetLastBtn").prop("disabled",true);$('.myRecentlyVisitedList .dashboardWidgetLoader').hide();$(this.holder).find("#featuredContent_btn").attr("data-id",this.data.inode);$(this.holder).find("#featuredContent_btn").attr("data-template",this.template);$(this.holder).find("#featuredContent_btn").attr("data-section",this.section);$(this.holder).find("#featuredContent_btn span").html("VIEW MORE "+this.label.toUpperCase());}}
else{$(this.holder).find("#featuredContent_btn").attr("data-id",this.data.inode);$(this.holder).find("#featuredContent_btn").attr("data-template",this.template);$(this.holder).find("#featuredContent_btn").attr("data-section",this.section);$(this.holder).find("#featuredContent_btn span").html("VIEW MORE "+this.label.toUpperCase());if(this.firstTime){$(this.holder).find(".currentPage").html("1");}
var numberOfPages=Math.ceil(listCount/sd.Configuration.widgetResultLimit);$(this.holder).find(".numberOfPages").html(numberOfPages);if(listCount<sd.Configuration.widgetResultLimit){this.endItem=listCount;}
else if(listCount<this.endItem){this.endItem=listCount;}
$(this.holder).find(".guide-row").attr("data-id",this.data.inode);$(this.holder).find(".guide-row").attr("data-type",this.type);$(this.holder).find(".widgetContent").attr("data-id",this.itemID);if(listCount<=sd.Configuration.widgetResultLimit){$(this.holder).find(".widgetNextBtn").prop("disabled",true);$(this.holder).find(".widgetLastBtn").prop("disabled",true);}
for(var i=this.startItem;i<this.endItem;i++){item=this.itemList[i];var recentItemClone=$(this.holder).find(".guide .guide-row").clone().appendTo(recentFileFragment);recentItemClone.data({"userid":item.userid,"username":item.username});recentItemClone.attr("data-type","userProfile");recentItemClone.attr("data-id",item.userid);recentItemClone.find(".js-pic").addClass("thumb-img");if(item.image!=-1){if(String(item.image).indexOf("base64")>-1){imgSrc=item.image;}
else{imgSrc=sd.Configuration.vault+"/"+item.image+"/bigthumb.jpg";}
recentItemClone.find(".js-pic").css({"background-image":"url("+imgSrc+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","cursor":"pointer;"});}else{var username=item.fullname.split(' ');var userInitials=username[0].substring(0,1).toUpperCase()+username[1].substring(0,1).toUpperCase();imgSrc="<span class=\"user-no-image-big centerxy\">"+userInitials+"</span>";recentItemClone.find(".js-pic").append(imgSrc);if(item.colour==null){item.colour=users.UpdateColour(item.userid);}
recentItemClone.find(".user-no-image-big").css({"background-color":item.colour});}
recentItemClone.find(".description").remove();recentItemClone.find(".city").remove();recentItemClone.find(".country").remove();recentItemClone.find(".name").addClass("fullname");if(item.fullname!=undefined&&item.fullname.trim()!="")
recentItemClone.find(".name").html(item.fullname);else
recentItemClone.find(".name").html("&nbsp;");recentItemClone.find(".userTitle").attr("id","thumb-title-"+item.userid);if(item.jobTitle!=undefined&&item.jobTitle.trim()!="")
recentItemClone.find(".userTitle").html(item.jobTitle);else
recentItemClone.find(".userTitle").html("&nbsp;");recentItemClone.find(".userDepartment").attr("id","thumb-department-"+item.userid);if(item.bizunit!=undefined&&item.bizunit!=""&&item.bizunit!="-1")
recentItemClone.find(".userDepartment").html(item.bizunit);else
recentItemClone.find(".userDepartment").html("&nbsp;");if(item.facebook!=undefined&&item.facebook!=""){if(item.facebook.indexOf("http")<0)fb="http://"+item.facebook;recentItemClone.find(".facebook-thumb").show();recentItemClone.find(".facebook-thumb").unbind("click").bind("click",function(event){window.open(fb,"_blank");});}
if(item.twitter!=undefined&&item.twitter!=""){if(item.twitter.indexOf("http")<0)tw="http://"+item.twitter;recentItemClone.find(".twitter-thumb").show();recentItemClone.find(".twitter-thumb").unbind("click").bind("click",function(event){window.open(tw,"_blank");});}
if(item.website!=undefined&&item.website!=""){if(item.website.indexOf("http")<0)ws="http://"+item.website;recentItemClone.find(".website-thumb").show();recentItemClone.find(".website-thumb").unbind("click").bind("click",function(event){window.open(ws,"_blank");});}
if(item.keyuser=="1")
recentItemClone.find(".key-user-list").show();if(item.phone.trim()!=""){recentItemClone.find(".phone-thumb").show().attr("title",item.phone);}
if(item.mobile.trim()!=""){recentItemClone.find(".mobile-thumb").show().attr("title",item.mobile);}
if(item.email.trim()!=""){recentItemClone.find(".mail-thumb").show().attr("title",item.email).data({"email":item.email});}}
$(this.holder).find(".widgetList").html(recentFileFragment);$('.myRecentlyVisitedList .dashboardWidgetLoader').hide();}
if(this.firstTime){myDashboard.addEventListeners(this.type);this.callback();}}
DashboardItem.prototype.handleTeamList=function(myData,status){this.itemList=[];var arrUserIDs=[];for(var idx=0;idx<myData.length;idx++){var item={};item.userid=myData[idx].i;item.username=myData[idx].un;arrUserIDs.push($.trim(myData[idx].i));item.firstname=myData[idx].fn;item.lastname=myData[idx].ln;item.fullname=myData[idx].fn+' '+myData[idx].ln;item.sortname=myData[idx].ln+myData[idx].fn;item.email=myData[idx].e;item.status=myData[idx].s;item.colour=myData[idx].cl;item.company=(myData[idx].c==null)?"":myData[idx].c;item.department=(myData[idx].d==null)?"":myData[idx].d;item.jobTitle=(myData[idx].t==null)?"":myData[idx].t;item.location=(myData[idx].l==null)?"":myData[idx].l;item.phone=(myData[idx].p==null)?"":myData[idx].p;item.mobile=(myData[idx].m==null)?"":myData[idx].m;item.facebook=(myData[idx].fb==null)?"":myData[idx].fb;item.twitter=(myData[idx].fb==null)?"":myData[idx].tw;item.website=(myData[idx].fb==null)?"":myData[idx].ws;item.linkedin=(myData[idx].fb==null)?"":myData[idx].li;if(myData[idx].im==null||myData[idx].im==0)
item.image=-1;else
item.image=myData[idx].im;item.address=(myData[idx].a==null)?"":myData[idx].a;item.keyuser=myData[idx].ku;item.bio=myData[idx].b;item.bizunit="-1";item.region="-1";item.role="-1";item.bizunitid="-1";item.regionid="-1";item.roleid="-1";this.itemList.push(item);}
var sc=new sd.ServerCall("GetCustomProfileFields");var obj={};obj.userids=arrUserIDs.join(",");obj.metaFields="'businessUnit', 'department', 'region', 'role'";sc.data(obj);sc.go({onSuccess:$.proxy(this.handleCustomFields,this),onError:$.proxy(this.handleError,this)});}
DashboardItem.prototype.handleCustomFields=function(myData,status){var allMetaAttributes=[];var allUniqueMetaAttributes=[];var obj;for(var idx=0;idx<myData.length;idx++){if(myData[idx].Field=="role"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Role";obj.id=-1;allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;allMetaAttributes.push(obj);for(var i=0;i<this.itemList.length;i++){if(myData[idx].UserName==this.itemList[i].username){this.itemList[i].role=myData[idx].Value;}}}
if(myData[idx].Field=="region"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;if(obj.value=="0")obj.value="N/A";obj.title="Country";obj.id=-1;allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;allMetaAttributes.push(obj);for(var i=0;i<this.itemList.length;i++){if(myData[idx].UserName==this.itemList[i].username){this.itemList[i].region=myData[idx].Value;}}}
if(myData[idx].Field=="businessUnit"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Business Unit";obj.id=-1;allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;allMetaAttributes.push(obj);for(var i=0;i<this.itemList.length;i++){if(myData[idx].UserName==this.itemList[i].username){this.itemList[i].bizunit=myData[idx].Value;}}}
if(myData[idx].Field=="department"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Department";obj.id=-1;allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;allMetaAttributes.push(obj);for(var i=0;i<this.itemList.length;i++){if(myData[idx].UserName==this.itemList.username){this.itemList[i].bizunit=myData[idx].Value;}}}
if(myData[idx].Field=="KeyUser"){obj={};obj.type=myData[idx].Field;obj.value=myData[idx].Value;obj.title="Key Contact";obj.id=-1;allUniqueMetaAttributes.push(obj);obj.username=myData[idx].UserName;allMetaAttributes.push(obj);for(var i=0;i<this.itemList.length;i++){if(myData[idx].UserName==this.itemList[i].username){this.itemList[i].region=myData[idx].Value;}}}}
allUniqueMetaAttributes=sd.Utils.removeObjectArrayDuplicates(allUniqueMetaAttributes,"value");allUniqueMetaAttributes.sort(sd.Utils.dynamicSortMultiple("title","value"));for(var j=0;j<allUniqueMetaAttributes.length;j++){allUniqueMetaAttributes[j].id=j+1;}
for(var i=0;i<this.itemList.length;i++){for(var j=0;j<allUniqueMetaAttributes.length;j++){if((allUniqueMetaAttributes[j].type=="region")&&(this.itemList[i].region.toLowerCase()==allUniqueMetaAttributes[j].value.toLowerCase())){allUniqueMetaAttributes[j].id=j+1;}
if((allUniqueMetaAttributes[j].type=="businessUnit")&&(this.itemList[i].bizunit.toLowerCase()==allUniqueMetaAttributes[j].value.toLowerCase())){allUniqueMetaAttributes[j].id=j+1;}}}
for(var k=0;k<allMetaAttributes.length;k++){for(var j=0;j<allUniqueMetaAttributes.length;j++){if(allUniqueMetaAttributes[j].value.toLowerCase()==allMetaAttributes[k].value.toLowerCase()){allMetaAttributes[k].id=allUniqueMetaAttributes[j].id;}}}
this.displayTeamFolders();}
DashboardItem.prototype.displayDashboard=function(){var recentItemFragment=document.createDocumentFragment();var item;var listCount=this.itemList.length;if(listCount==0){if(sd.Configuration.DashHideNavButtons){$(this.holder).find('.widgetPageControls').hide();$(this.holder).find(".widgetList").html("<p class='dashboardNoItem noValue'>No results found.</p>");$('.myRecentlyAdded .dashboardWidgetLoader').hide();}
else{}}
if(this.firstTime){myDashboard.addEventListeners(this.type);this.callback();}}
DashboardItem.prototype.reDisplayList=function(){if(this.type.indexOf("myRecentlyAdded")>=0){this.displayRecentItemList();}
else if(this.type.indexOf("myBestCases")>=0||this.type.indexOf("myBestFolders")>=0||this.type.indexOf("myBestArticle")>=0||this.type.indexOf("myBestDreamTeam")>=0||this.type.indexOf("myBestExpert")>=0||this.type.indexOf("myBestNewsletter")>=0){this.displayBestCases();}
else if(this.type.indexOf("myBestTeam")>=0||this.type.indexOf("myBestArtist")>=0){this.displayTeamFolders();}}
DashboardItem.prototype.formatLink=function(newStatus,link,i,p,source){var length;if(source=="search")length=30;else length=90;var displayLink=link;if(displayLink.length>length)displayLink=displayLink.substring(0,length)+"...";var type="unknown";var vid="unknown";var apiURL="";var title="";var desc="";var thumb="";var output="";var img="";if(link.substring(0,3).toLowerCase()=="www"){link="http://"+link;}
var siteUrl="^"+window.location.protocol+"\/\/";siteUrl+=window.location.host+"*";var regex=new RegExp(siteUrl);if(link.match(regex)){type="local";}else{link.match(/^(http|https):\/\/(?:.*?\.?)(youtube|vimeo|youtu)\.(com|be)\/(watch\?[^#]*v=([a-zA-Z0-9\-_]+)|([a-zA-Z0-9\-_]+))*/);type=RegExp.$2;if(type=="youtube"){vid=RegExp.$5;}else if(type=="youtu"){vid=RegExp.$4;}else if(type=="vimeo"){vid=RegExp.$4;}else{vid="unknown";}}
if(type=="youtube"||type=="youtu"){if(p==1){apiURL="https://www.googleapis.com/youtube/v3/videos?id="+vid+"&key=AIzaSyDj92u8Rl055X3_p1tBB1w9bKJ83A3rHpo&part=snippet,statistics";$.getJSON(apiURL,function(data){title=data.items[0].snippet.title;desc=data.items[0].snippet.description;vid=data.items[0].id;if(desc==""||desc==null){desc="No Description Provided";}
output='<table data-vid="'+vid+'" data-type="youtube" class="external-video centerxy">';output+='<tr><td><br>';output+='<iframe style="pointer-events:none" allowtransparency="true" height="200" width="300" class="youtube-player" type="text/html" src="https://www.youtube.com/embed/'+vid+'" allowfullscreen frameborder="0"></iframe>';output+='</td></tr><tr><td><a href="javascript:"><u><span class="brand-youtube-link">'+title+'</span></u></a></td></tr><tr></tr></table>';if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-video').remove();$(document).find(".sqr-scale").append(output);$(document).find(".sqr-scale").find(".svg-icon-large").hide();}
$(".external-video").unbind();$(".external-video").bind("click",function(){var y=window.pageYOffset;var vid=$(this).data("vid");var type=$(this).data("type");var returnScroll=window.pageYOffset;sd.component.messageBox.action({containerClass:'fullscreen video',overlay:true,header:false,escape:false,height:410,width:810,bodyClass:"video-previewer",loadCallback:function(){$('#dvVideoDownload').hide();if(type=="youtube"){apiURL="https://www.googleapis.com/youtube/v3/videos?id="+vid+"&key=AIzaSyDj92u8Rl055X3_p1tBB1w9bKJ83A3rHpo&part=snippet,statistics";$.getJSON(apiURL,function(data){title=data.items[0].snippet.title;desc=data.items[0].snippet.description;vid=data.items[0].id;if(desc==""||desc==null){desc="No Description Provided";}
output='<table class="external-video centerxy"><tr><td><br><iframe allowtransparency="true" height="380px" width="780px" class="youtube-player" type="text/html" src="https://www.youtube.com/embed/'+vid+'?autoplay=1" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);$(document).find(".sqr-scale").find(".svg-icon-large").hide();});}else if(type=="vimeo"){apiURL="https://vimeo.com/api/oembed.json?url=https://vimeo.com/"+vid+"&callback=?";$.getJSON(apiURL,function(data){title=data.title;desc=data.description;vid=data.video_id;if(desc==""||desc==null){desc="No Description Provided";}
thumb=data.thumbnail_url;output='<table class="external-video centerxy"><tr><td><br><iframe style="height: 380px; width: 780px; block; margin: 0 auto;" src="https://player.vimeo.com/video/'+vid+'?autoplay=1" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);$(document).find(".sqr-scale").find(".svg-icon-large").hide();});}
$('#vidCloseItem').on('click',function(){sd.component.messageBox.close();});$(".video-previewer").parent().css("border","0");$(".video-previewer").parent().css("background","#000");},template:sd.Configuration.templates.videoPreview,closeCallback:function(){window.scrollTo(0,returnScroll);}});});});}else{newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}}else if(type=="vimeo"){if(p==1){apiURL="https://vimeo.com/api/oembed.json?url=https://vimeo.com/"+vid;$.getJSON(apiURL,function(data){title=data.title;desc=data.description;vid=data.video_id;if(desc==""||desc==null){desc="No Description Provided";}
thumb=data.thumbnail_url;output='<table data-vid="'+vid+'" data-type="vimeo" class="external-video centerxy"><tr><td><br><iframe style="pointer-events:none" style="display: height: 200px; width: 250px; block; margin: 0 auto;" src="https://player.vimeo.com/video/'+vid+'" allowfullscreen frameborder="0"></iframe></td></tr><tr><td><a href="javascript:" target="_blank"><u><font class="brand-color">'+title+'</font></u></a></td></tr><tr></tr></table>';if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-video').remove();$(document).find(".sqr-scale").append(output);$(document).find(".sqr-scale").find(".svg-icon-large").hide();}
$(".external-video").unbind();$(".external-video").bind("click",function(){var y=window.pageYOffset;var vid=$(this).data("vid");var type=$(this).data("type");var returnScroll=window.pageYOffset;sd.component.messageBox.action({header:false,escape:false,height:410,width:782,bodyClass:"video-previewer",loadCallback:function(){$('#dvVideoDownload').hide();if(type=="youtube"){apiURL="https://www.googleapis.com/youtube/v3/videos?id="+vid+"&key=AIzaSyDj92u8Rl055X3_p1tBB1w9bKJ83A3rHpo&part=snippet,statistics";$.getJSON(apiURL,function(data){title=data.items[0].snippet.title;desc=data.items[0].snippet.description;vid=data.items[0].id;if(desc==""||desc==null){desc="No Description Provided";}
output='<table class="external-video centerxy"><tr><td><br><iframe allowtransparency="true" height="380px" width="780px" class="youtube-player" type="text/html" src="https://www.youtube.com/embed/'+vid+'?autoplay=1" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);$(document).find(".sqr-scale").find(".svg-icon-large").hide();});}else if(type=="vimeo"){apiURL="https://vimeo.com/api/oembed.json?url=https://vimeo.com/"+vid;$.getJSON(apiURL,function(data){title=data.title;desc=data.description;vid=data.video_id;if(desc==""||desc==null){desc="No Description Provided";}
thumb=data.thumbnail_url;output='<table class="external-video centerxy"><tr><td><br><iframe style="height: 380px; width: 780px; block; margin: 0 auto;" src="https://player.vimeo.com/video/'+vid+'" allowfullscreen frameborder="0"></iframe></td></tr></table>';$("#dvVideoPreview").html(output);$(document).find(".sqr-scale").find(".svg-icon-large").hide();});}
$('#vidCloseItem').on('click',function(){sd.component.messageBox.close();});$(".video-previewer").parent().css("border","0");$(".video-previewer").parent().css("background","#000");},template:sd.Configuration.templates.videoPreview,closeCallback:function(){window.scrollTo(0,returnScroll);}});});});}else{newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}}else if(type=="local"){var sLink=link.split('?');var sURLVariables=sLink[1].split('&');var inode=0;for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split('=');if(sParameterName[0]=="inode"){inode=sParameterName[1];}}
inode=inode.toString().replace(/\D/g,'');if(inode>0){newStatus+='<a href="'+link+'"><u id="lnk'+inode+'">'+displayLink+'</u></a>';var sc=new sd.ServerCall("GetJumpToDetails",0);var obj={};obj.i_node=inode;sc.data(obj);sc.go({onSuccess:$.proxy(this.updateEmbeddedLink,this),onError:$.proxy(this.handleError,this)});}else{newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}}else{if(p==1){var parser=document.createElement('a');parser.href=link;var site=parser.protocol+"//"+parser.hostname;var maxHeight=100;var query="select * from html where url='"+link+"' AND xpath = \"//title|//head/meta\"";var url="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent(query)+"&format=json";$.getJSON(url,function(data){title=link;var imgFoundInMeta=false;if(data.query.results!=null){title=data.query.results.title;$.each(data.query.results.meta,function(key,val){if(val.content){if(val.name&&val.name=='description'){desc=val.content;}
var metaContentSeemsImage=(""+val.content).match("^http(s)?://.*(jpeg|jpg|png|gif)$");if(val.name=='image'||metaContentSeemsImage){if(val.content.substring(0,7)=='http://'&&val.content.charAt(val.content.length-4)=='.'){if(val.content!='undefined'){imgFoundInMeta=true;img=val.content;}}}}});}
if(imgFoundInMeta==false){var url="https://api.embed.ly/1/oembed?key=9c59af118a744a588186e6264d1da748&url="+encodeURIComponent(link);$.getJSON(url,function(data){var img=data.thumbnail_url;var desc=data.description;var title=data.title;var background=new Image();background.src=data.thumbnail_url;if(img==""||img==null){output='<table class="external-news theme-external-news test2"><tr><td><a href="'+link+'" target="_blank"><u><font class="brand-color">'+title+'</font></u></a></td></tr><tr><td>'+desc+'</td></tr></table>';}else{output='<div class="flex"> <div class="external-desc"> <strong><a href="'+link+'" target="_blank"> '+title+'</a></strong> <p>'+desc+'</p> </div> ';$(document).find(".sqr-scale").css({"background-image":"url("+img+")","background-repeat":"no-repeat ","background-size":"cover","background-position":"center","background-color":"#ffffff"});$(document).find(".sqr-scale").find(".svg-icon-large").hide();}
if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.jsPostPreview .external-news').find('td').eq(2).dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:35});$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-news').remove();console.log(output)
$('#'+i).append(output);var temp=$('#'+i).html();$('#'+i).html(temp);}
background.onload=function(){if((background.height>0&&background.height<330)||(background.width>0&&background.width<330)){$(document).find(".sqr-scale").css({"background-size":"contain"});}else{$(document).find(".sqr-scale").css({"background-size":"cover"});}};});}else{output='<table class="external-news theme-external-news test1"><tr><td class="external-img" rowspan="2"><img height="120px" width="150px" id="imgA'+i+'" src="'+img+'"></img></td><td><a href="'+link+'" target="_blank"><u><font class="brand-color">'+title+'</font></u></a></td></tr><tr><td>'+desc+'</td></tr></table>';if(i==0){$('.channel-add-post .jsPostPreview').html(output);$('.jsPostPreview .external-news').find('td').eq(2).dotdotdot({ellipsis:'... ',wrap:'word',fallbackToLetter:true,watch:true,height:35});$('.channel-add-post .postPreviewWrapper').show();}else{$('#'+i+' .external-news').remove();$('#'+i).append(output);var temp=$('#'+i).html();$('#'+i).html(temp);}}});}else
newStatus+='<a href="'+link+'" target="_blank"><u>'+displayLink+'</u></a>';}
return newStatus;};DashboardItem.prototype.handleError=function(error){myDashboard.handleError(error);}
window.sd=window.sd||{};window.sd.DashboardItem=DashboardItem;}(window));﻿(function(window){"use strict";function DeepZoomBook(pages,inode,options){this.pages=pages;this.inode=inode;this.currentPage=0;this.pageDetails=[];this.loadPageOrder=[];this.openingADeepZoomFile=false;options=options||{};this.minLevel=options.minLevel||11;this.onAnimationFinished=options.onAnimationFinished||function(){};this.onPageOpened=options.onPageOpened||function(){};this.onAllPagesLoaded;this.nextPageLoadDelay=1000;}
DeepZoomBook.prototype.clear=function(){for(var i=1;i<=this.pages;i++){if(this.pageDetails[i].viewer!=null)this.pageDetails[i].viewer.close();}}
DeepZoomBook.prototype.initPageContainers=function(bookContainer){this.pageDetails=[];var htmlOut="";var i;for(i=1;i<=this.pages;i++){this.pageDetails[i]={};this.pageDetails[i].loaded=false;this.pageDetails[i].viewer=null;this.pageDetails[i].rotation=0;htmlOut+='<div id="preview_deepZoomContainer_pg'+i+'" class="deepZoomContainer" style="width:1000px;height:1000px;"></div>';}
$(bookContainer).html(htmlOut);};DeepZoomBook.prototype.updateScrollPositions=function(){for(var i=1;i<=this.pages;i++){this.pageDetails[i].scrollPos=$("#preview_deepZoomContainer_pg"+i).position().top;}}
DeepZoomBook.prototype.currentPagePosition=function(){var pos=(this.currentPage==0)?0:this.pageDetails[this.currentPage].scrollPos;return pos;}
DeepZoomBook.prototype.loadPage=function(page){if(page>this.pages)this.currentPage=this.pages;else if(page<1)this.currentPage=1;else this.currentPage=page;for(var i=0;i<this.loadPageOrder.length;i++){if(Math.abs(this.currentPage-this.loadPageOrder[i])>2||this.loadPageOrder[i]===this.currentPage)this.loadPageOrder[i]=null;}
this.loadPageOrder=this.loadPageOrder.filter(Number);if(this.loadPageOrder.length==0){this.openingADeepZoomFile=false;}
if(this.pageDetails[page].viewer!=null){this.pageDetails[this.currentPage].viewer.viewport.goHome();this.onPageOpened(page);}
else this.loadPageOrder.push(this.currentPage);if(!this.openingADeepZoomFile){this.loadNextDeepZoomPage();}
var keepLoaded=5;var i;for(i=1;i<this.currentPage-keepLoaded;i++){if(this.pageDetails[i].viewer!=null){this.pageDetails[i].viewer.close();this.pageDetails[i].loaded=false;this.pageDetails[i].viewer=null;$("#preview_deepZoomContainer_pg"+i).empty();}}
for(i=this.currentPage+keepLoaded;i<=this.pages;i++){if(this.pageDetails[i].viewer!=null){this.pageDetails[i].viewer.close();this.pageDetails[i].loaded=false;this.pageDetails[i].viewer=null;$("#preview_deepZoomContainer_pg"+i).empty();}}
return this.currentPage;}
DeepZoomBook.prototype.loadNextDeepZoomPage=function(){if(this.loadPageOrder.length==0){this.openingADeepZoomFile=false;}
else{var page=this.loadPageOrder.pop();if(this.pageDetails[page].loaded==false){this.openingADeepZoomFile=true;this.pageDetails[page].viewer=new OpenSeadragon({id:"preview_deepZoomContainer_pg"+page,tileSources:sd.Configuration.tileSource+"/"+this.inode+"/"+page+"/deepzoom.dzi",springStiffness:10.0,zoomPerClick:1,showNavigationControl:false,maxZoomPixelRatio:5,minPixelRatio:0.5,immediateRender:true,visibilityRatio:1,constrainDuringPan:false});this.pageDetails[page].viewer.addHandler("error",$.proxy(this.pageOpenError,this));this.pageDetails[page].viewer.addHandler("open",$.proxy(this.pageOpened,this));this.pageDetails[page].viewer.addHandler("animationfinish",$.proxy(this.animationFinished,this));}
else{this.onPageOpened(page);this.loadNextDeepZoomPage();}}};DeepZoomBook.prototype.pageOpened=function(event){var page=event.id.replace("preview_deepZoomContainer_pg","");this.pageDetails[page].viewer.source.minLevel=(this.pageDetails[page].viewer.source.maxLevel>=this.minLevel)?this.minLevel:this.pageDetails[page].viewer.source.maxLevel;this.onPageOpened(page);this.checkPageFullyLoaded(page);$(".navigator").css({visibility:'hidden'});$(".displayregion").css({resize:'none',disabled:'disabled'});$(".displayregion").on("focus",function(event){$(this).blur();event.preventDefault();return;});$(".displayregion").on("click",function(event){event.preventDefault();return;});};DeepZoomBook.prototype.checkPageFullyLoaded=function(page){var viewer=this.pageDetails[page].viewer;if(viewer.drawer.needsUpdate()||viewer.drawer.downloading>0){setTimeout($.proxy(this.checkPageFullyLoaded,this,page),viewer.drawer.downloading*50);}
else{this.pageDetails[page].loaded=true;this.loadNextDeepZoomPage();}}
DeepZoomBook.prototype.loadAllPages=function(options){options=options||{};this.onAllPagesLoaded=options.onComplete||function(){};this.loadPageOrder=[];for(var page=1;page<=this.pages;page++){this.loadPageOrder.push(page);}
this.loadNextDeepZoomPage();this.loadCheckPagesFullyLoaded();}
DeepZoomBook.prototype.loadCheckPagesFullyLoaded=function(){var fullyLoaded=true;for(var page=1;page<=this.pages&&fullyLoaded;page++){if(this.pageDetails[page].loaded==false)fullyLoaded=false;}
if(fullyLoaded){this.onAllPagesLoaded();}
else{setTimeout($.proxy(this.loadCheckPagesFullyLoaded,this),1000);}}
DeepZoomBook.prototype.animationFinished=function(event){if(event.viewport.getZoom()>event.viewport.getHomeZoom()*1.3&&$(window).width()>800)$(".navigator").css({visibility:'visible'});else $(".navigator").css({visibility:'hidden'});this.onAnimationFinished(event.viewport.getZoom(true),event.viewport.getCenter(true))}
DeepZoomBook.prototype.pageOpenError=function(event){setTimeout($.proxy(this.loadNextDeepZoomPage,this),100);}
DeepZoomBook.prototype.jumpToPosition=function(panPosition,zoomPosition){this.pageDetails[this.currentPage].viewer.viewport.panTo(panPosition,true);this.pageDetails[this.currentPage].viewer.viewport.zoomBy(zoomPosition/this.pageDetails[this.currentPage].viewer.viewport.getZoom());};DeepZoomBook.prototype.zoomIn=function(){this.pageDetails[this.currentPage].viewer.viewport.zoomBy(1.3);};DeepZoomBook.prototype.zoomOut=function(){this.pageDetails[this.currentPage].viewer.viewport.zoomBy(0.7);};DeepZoomBook.prototype.zoomReset=function(){if(this.pageDetails[this.currentPage].viewer)this.pageDetails[this.currentPage].viewer.viewport.goHome();};DeepZoomBook.prototype.rotateRight=function(){this.rotateTo(this.pageDetails[this.currentPage].rotation+90);};DeepZoomBook.prototype.rotateLeft=function(){this.rotateTo(this.pageDetails[this.currentPage].rotation-90);};DeepZoomBook.prototype.rotateTo=function(rotation){if(rotation==360){rotation=0;}
else if(rotation==-90){rotation=270;}
this.pageDetails[this.currentPage].rotation=rotation;this.pageDetails[previewer.deepzoom.currentPage].viewer.viewport.setRotation(this.pageDetails[this.currentPage].rotation);}
DeepZoomBook.prototype.currentPan=function(){var currentCenter=this.pageDetails[this.currentPage].viewer.viewport.getCenter(true);return currentCenter;};DeepZoomBook.prototype.currentZoom=function(){var zoomVal=this.pageDetails[this.currentPage].viewer.viewport.getZoom(true);return zoomVal;};DeepZoomBook.prototype.pointFromPixel=function(page,x,y){var pixel=new OpenSeadragon.Point(x,y);var point=this.pageDetails[this.currentPage].viewer.viewport.pointFromPixel(pixel);return point;};window.sd=window.sd||{};window.sd.DeepZoomBook=DeepZoomBook;}(window));﻿(function(window){var FileUploader={};FileUploader.fileList=[];FileUploader.batchCount=0;FileUploader.dropZones=[];FileUploader.uploader=false;FileUploader.container=null;FileUploader.endpoint=null;FileUploader.currentUploadData=null;FileUploader.currentBatchCount=0;FileUploader.dropZoneDetails={};FileUploader.init=function(options){options=options||{};FileUploader.container=options.container||"#jquery-wrapped-fine-uploader";FileUploader.endpoint=options.endpoint||sd.Configuration.ws+"/FileHandler.ashx";FileUploader.uploader=$(FileUploader.container).fineUploader({button:null,autoUpload:false,request:{endpoint:FileUploader.endpoint},dragAndDrop:{disableDefaultDropzone:true,hideDropzones:false}}).on('validateBatch',function(event,items){FileUploader.currentBatchCount=items.length;}).on('submitted',function(event,id,name,response){if(qq.dropArea!=null){var dropID=$(qq.dropArea).attr("dropzoneid");FileUploader.currentUploadData=FileUploader.dropZones[dropID];console.log(FileUploader.currentUploadData);qq.dropArea=null;}
var uploadData=jQuery.extend(true,{},FileUploader.currentUploadData);uploadData.id=id;uploadData.name=name;uploadData.status='selected'
uploadData.onSelect=uploadData.onSelect||FileUploader.upload;uploadData.onComplete=uploadData.onComplete||function(){};uploadData.onError=uploadData.onError||function(){};FileUploader.fileList.push(uploadData);var submittedFileCount=$(FileUploader.container).fineUploader('getUploads',{status:qq.status.SUBMITTED}).length;if(submittedFileCount==FileUploader.currentBatchCount){uploadData.onSelect(uploadData);}
return true;}).on('complete',function(event,id,name,responseJSON){FileUploader.handleFileComplete(id,responseJSON.i_node);}).on('error',function(event,id,name,reason){console.log("upload error");$(".qq-upload-fail").fadeOut(2000);var currentItem;for(var i=0;i<FileUploader.fileList.length;i++){if(FileUploader.fileList[i].id==id){FileUploader.fileList[i].status="failed";FileUploader.fileList[i].failReason=reason;FileUploader.fileList[i].onError(name);break;}}}).on('progress',function(id,fileName,loaded,total){}).on('cancel',function(id,fileName){console.log("cancel "+fileName);});$(".qq-upload-button").hide();}
FileUploader.addDropZone=function(elem,details){$(FileUploader.container).fineUploader('addExtraDropzone',elem);var id=FileUploader.dropZones.length;$(elem).attr("dropzoneid",id);FileUploader.dropZones.push(details);}
FileUploader.removeDropZone=function(elem){$(FileUploader.container).fineUploader('removeExtraDropzone',elem);}
FileUploader.browse=function(uploadData){console.log("FileUploader.browse");FileUploader.currentUploadData=uploadData
var fileUploadInput=document.getElementsByName("qqfile")[0];$(fileUploadInput).show();$(fileUploadInput).trigger('click');$(fileUploadInput).hide();}
FileUploader.cancel=function(){for(var i=0;i<FileUploader.fileList.length;i++){if(FileUploader.fileList[i].status=="selected"){FileUploader.fileList[i].status="cancelled";$(FileUploader.container).fineUploader('cancel',FileUploader.fileList[i].id);}}}
FileUploader.cancelAll=function(){$(sd.FileUploader.container).data('fineuploader').uploader._handler.cancelAll();}
FileUploader.upload=function(fileDetails){console.log("upload");fileDetails=fileDetails||{};var batchID=++FileUploader.batchCount;for(var i=0;i<FileUploader.fileList.length;i++){if(FileUploader.fileList[i].status=="selected"){FileUploader.fileList[i].status="uploading";FileUploader.fileList[i].batchID=batchID;FileUploader.fileList[i].description=fileDetails.description||"";FileUploader.fileList[i].meta=fileDetails.meta||"";FileUploader.fileList[i].endDate=fileDetails.endDate||"";FileUploader.fileList[i].sendEmail=fileDetails.sendEmail;FileUploader.fileList[i].TableTopFile=fileDetails.TableTopFile||false;FileUploader.fileList[i].cbData=fileDetails.cbData||null;FileUploader.fileList[i].uploadType=fileDetails.uploadType||"vault";var uploadData={"destinationInode":FileUploader.fileList[i].destinationInode,"TableTopFile":FileUploader.fileList[i].TableTopFile,"description":FileUploader.fileList[i].description,"meta":FileUploader.fileList[i].meta,"endDate":FileUploader.fileList[i].endDate,"uploadType":FileUploader.fileList[i].uploadType};$(FileUploader.container).fineUploader('setParams',uploadData,FileUploader.fileList[i].id);}}
$(FileUploader.container).fineUploader('uploadStoredFiles');return true;}
FileUploader.handleFileComplete=function(id,i_node){console.log("handleFileComplete "+id);$(".qq-upload-success").fadeOut(2000);$(".qq-upload-fail").fadeOut(2000);var currentItem;for(var i=0;i<FileUploader.fileList.length&&currentItem==null;i++){if(FileUploader.fileList[i].id==id){if(FileUploader.fileList[i].status=="failed")
FileUploader.fileList[i].valid=false;else{FileUploader.fileList[i].valid=true;}
FileUploader.fileList[i].status="complete";FileUploader.fileList[i].i_node=i_node;currentItem=FileUploader.fileList[i];}}
console.log("currentItem.batchID "+currentItem.batchID);var newFiles=[];for(var i=0;i<FileUploader.fileList.length;i++){if(FileUploader.fileList[i].batchID==currentItem.batchID){if(FileUploader.fileList[i].status=="complete"){newFiles.push(FileUploader.fileList[i])}
else if(FileUploader.fileList[i].status=="failed"){}
else{return;}}}
if(currentItem.sendEmail){bodyStr="The Following files were uploaded <ul> ";for(var i=0;i<newFiles.length;i++){var link=sd.Configuration.site+'?i_node='+newFiles[i].i_node;bodyStr+="<li><a href='"+link+"'>"+newFiles[i].name+"</a>";}
bodyStr+="</ul> ";console.log("sendEmail AS all complete for this upload");emailNotification.init({'subject':"File Upload Complete",'inode':currentItem.destinationInode,'body':bodyStr});}
currentItem.onComplete(newFiles);}
window.sd=window.sd||{};window.sd.FileUploader=FileUploader;}(window));﻿(function(window){var Global={};Global.buffer=[];Global.bufferType="";Global.collabData={};Global.searchData=[];window.sd=window.sd||{};window.sd.Global=Global;}(window));﻿(function(window,document){function Lync(){}}(window,document));﻿(function(window){function Map(options){$("#loader").show();options=options||{};this.gMap=null;this.inode=(options.inode==null)?0:options.inode;this.height=(options.height==null)?500:options.height;this.width=(options.width==null)?500:options.width;this.container=options.container||'#mainSection';this.title=options.title||"";this.description=options.description||"";this.allowedBounds=new google.maps.LatLngBounds(new google.maps.LatLng(41.859,2.6),new google.maps.LatLng(41.859,19.475));if(sd.Configuration.mapData[sd.Configuration.csid]==undefined){this.mapFillColor='#5C93CE';this.offFillColor='#9cd8e8';this.mapStrokeColor='#9cd8e8';this.waterFillColor="#E7E8EA";this.pinIcon="images/mccann/g-map/yellow_pin.png";this.dataFile="";this.title="Office Locations";this.description="Navigate map tags to show location, lead and time zone";this.legends=[{pin:this.pinIcon,text:this.title}];}
else{this.mapFillColor=sd.Configuration.mapData[sd.Configuration.csid].mapFillColor;this.offFillColor=sd.Configuration.mapData[sd.Configuration.csid].offFillColor;this.mapStrokeColor=sd.Configuration.mapData[sd.Configuration.csid].mapStrokeColor;this.waterFillColor=sd.Configuration.mapData[sd.Configuration.csid].waterFillColor;this.pinIcon=sd.Configuration.mapData[sd.Configuration.csid].pinIcon;this.dataFile=sd.Configuration.mapData[sd.Configuration.csid].dataFile;this.title=sd.Configuration.mapData[sd.Configuration.csid].title;this.description=sd.Configuration.mapData[sd.Configuration.csid].description;this.legends=sd.Configuration.mapData[sd.Configuration.csid].legends;}
this.centerXCoord=options.centerXCoord||42.908160272718725;this.centerYCoord=options.centerXCoord||5.449218999999981;this.minZoom=options.minZoom||2;this.maxZoom=options.maxZoom||4;this.draggable=(options.draggable==null)?true:options.draggable;this.scrollwheel=(options.scrollwheel==null)?true:options.scrollwheel;this.panControl=(options.panControl==null)?false:options.panControl;this.zoomControl=(options.zoomControl==null)?true:options.zoomControl;this.mapTypeControl=(options.mapTypeControl==null)?false:options.mapTypeControl;this.scaleControl=(options.scaleControl==null)?false:options.scaleControl;this.streetViewControl=(options.streetViewControl==null)?false:options.streetViewControl;this.overviewMapControl=(options.overviewMapControl==null)?false:options.overviewMapControl;this.rotateControl=(options.rotateControl==null)?false:options.rotateControl;this.mapOptions={center:new google.maps.LatLng(this.centerXCoord,this.centerYCoord),zoom:this.minZoom,minZoom:this.minZoom,maxZoom:this.maxZoom,draggable:this.draggable,scrollwheel:this.scrollwheel,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,'map_style']},panControl:this.panControl,zoomControl:this.zoomControl,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:this.mapTypeControl,scaleControl:this.scaleControl,streetViewControl:this.streetViewControl,overviewMapControl:this.overviewMapControl,rotateControl:this.rotateControl};}
Map.prototype.load=function(){var objMap=this;objMap.logMetric();$(this.container).load(sd.Configuration.templates.googleMap,function(){$(objMap.container+" .gMap").css({height:objMap.height,width:'100%'});$(objMap.container).find(".js_mapTitle").text(objMap.title);$(objMap.container).find(".js_mapDescription").text(objMap.description);objMap.gMap=new google.maps.Map(document.getElementById('googlMapInstance'),objMap.mapOptions);var styles=[{featureType:"all",elementType:"geometry",stylers:[{color:objMap.mapFillColor},{visibility:"on"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{gamma:.01},{lightness:20}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{saturation:-31},{lightness:-33},{weight:2},{gamma:.8}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{visibility:"off"},{color:"#ff0000"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{weight:"1"},{visibility:"simplified"},{hue:"#00aaff"},{gamma:"1"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"on"},{saturation:"75"},{color:objMap.waterFillColor}]},{featureType:"administrative.country",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"geometry",stylers:[{lightness:30},{saturation:30}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{color:objMap.mapFillColor}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry",stylers:[{saturation:20}]},{featureType:"poi.park",elementType:"geometry",stylers:[{lightness:20},{saturation:-20}]},{featureType:"road",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:10},{saturation:-30}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{saturation:25},{lightness:25}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{lightness:-20}]},{featureType:"water",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:objMap.waterFillColor}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}]
var styledMap=new google.maps.StyledMapType(styles,{name:objMap.title});objMap.gMap.mapTypes.set('map_style',styledMap);objMap.gMap.setMapTypeId('map_style');google.maps.event.addListener(objMap.gMap,'idle',function(){google.maps.event.trigger(objMap.gMap,'resize');});google.maps.event.addListenerOnce(objMap.gMap,'idle',function(){objMap.gMap.setCenter(objMap.mapOptions.center)});google.maps.event.addListener(objMap.gMap,'click',function(){objMap.closeDialog();});google.maps.event.addListener(objMap.gMap,'drag',function(){objMap.closeDialog();});google.maps.event.addListener(objMap.gMap,'zoom_changed',function(){objMap.closeDialog();});google.maps.event.addDomListener(window,"resize",function(){objMap.closeDialog();});$(window).on('orientationchange',function(){objMap.closeDialog();});google.maps.event.addDomListener(window,"resize",function(){objMap.closeDialog();});$(objMap.container+" .js_close").unbind("click");$(objMap.container+" .js_close").bind("click",function(){if(objMap.gMap.getZoom()!==2){objMap.gMap.setZoom(2);}
objMap.closeDialog();});var fragment=document.createDocumentFragment();for(var i=0;i<objMap.legends.length;i++){var legend=objMap.legends[i];var clone=$(objMap.container+" .guide .js-legend").clone().appendTo(fragment);clone.find(".js_legPin").attr("src",legend.pin);clone.find("label").text(legend.text);clone.find("img").attr({"src":legend.pin});}
$(objMap.container+" .js-mapLegend").append(fragment);var pinDataLoader=objMap.getJSONData(objMap.dataFile,objMap.handlePinDataLoad,objMap);pinDataLoader=null;$('#libraryFilterText').unbind().bind("keypress",function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode=='13'){objMap.filter();}});$('#libraryContent .search-button').unbind("click").bind('click',function(){objMap.filter();});});};Map.prototype.handleDisabledDataLoad=function(data,objMap){var rows=data['rows'];for(var i=0;i<rows.length;i++){var newCoordinates=[];var geometries=rows[i][1]['geometries'];if(geometries){for(var j=0;j<geometries.length;j++){newCoordinates.push(objMap.constructNewCoordinates(geometries[j]));}}else{newCoordinates=objMap.constructNewCoordinates(rows[i][1]['geometry']);}
var country=new google.maps.Polygon({paths:newCoordinates,strokeColor:objMap.mapStrokeColor,strokeOpacity:0,strokeWeight:1,fillColor:objMap.offFillColor,fillOpacity:0.8});country.setMap(objMap.gMap);}}
Map.prototype.constructNewCoordinates=function(polygon){var newCoordinates=[];var coordinates=polygon['coordinates'][0];for(var i in coordinates){newCoordinates.push(new google.maps.LatLng(coordinates[i][1],coordinates[i][0]));}
return newCoordinates;};Map.prototype.handlePinDataLoad=function(data,objMap){var pins=data.pins;objMap.loadedPins=pins;for(var i=0;i<pins.length;i++){objMap.addMarkerWithTimeout(pins[i],i*1.2,objMap);}};Map.prototype.addMarkerWithTimeout=function(markerData,timeout,objMap){var markerContent=markerData;window.setTimeout(function(){var pin=new Pin(objMap,markerContent);},timeout);};Map.prototype.getJSONData=function(JSONLocation,onComplete,scope){$.ajax({url:JSONLocation,dataType:'text',success:function(string){data=$.parseJSON(string);if(onComplete&&typeof(onComplete)==="function")onComplete(data,scope);},error:function(xhr,ajaxOptions,thrownError){}});};Map.prototype.showDialog=function(pinData){$("#libraryContent .js-filt").fadeIn("fast");$(".js-filtc").empty().show().append("<ul></ul>");var fragment=document.createDocumentFragment();var clone=$(this.container+" .guide .js-loc").clone().appendTo(fragment);clone.find(".js-add").html(pinData.city+", "+pinData.country);clone.find("img").attr({"src":pinData.marker});$(".js-filtc ul").append(fragment);this.getLocationTime(pinData.latitude,pinData.longitude,$(".js-filtc .js-time"));var agency="";fragment=document.createDocumentFragment();for(var i=0;i<pinData.data.length;i++){clone=$(this.container+" .guide .js-agency").clone().appendTo(fragment);var item=pinData.data[i];if(agency!=item.agency){clone.find(".js-name").html(item.agency);}
else{clone.find(".js-name").hide();}
clone.find(".js-lead").html(item.lead);clone.find(".js-jtitle").html(item.jobTitle);clone.find(".js-email").html("<a href=\"mailto:"+item.email+"\">"+item.email+"</a>");agency=item.agency;}
$(".js-filtc .js-agencies").html(fragment);};Map.prototype.getLocationTime=function(latitude,longitude,element){var sc=new sd.ServerCall("GetLocationTime");sc.data({latitude:latitude,longitude:longitude});sc.cbData({elem:element});sc.go({onSuccess:$.proxy(this.handleLocationTime,this)});};Map.prototype.handleLocationTime=function(myData,status,cbData){$(cbData.elem).html(myData[0].currentTime+" ("+myData[0].timeZoneName+")");}
Map.prototype.closeDialog=function(pinData){$(this.container+" .mapContentWrapper").hide("slide",{direction:"right"},1000);};Map.prototype.logMetric=function(){var sc=new sd.ServerCall("LogContentMetric");sc.data({inode:this.inode,metricType:"GOOGLEMAP_VIEW"});sc.go();}
Map.prototype.filter=function(){var filterText=$.trim($("#libraryFilterText").val());var objMap=this;$(".js-filtc").empty().show().append("<ul></ul>")
if(filterText==""||filterText.length<3){return;}
$("#libraryContent .js-filt").fadeIn("fast");var found=false;for(var i=0;i<this.loadedPins.length;i++){var location=this.loadedPins[i];if(location.city.toLowerCase().indexOf(filterText.toLowerCase())>-1){found=true;var fragment=document.createDocumentFragment();var clone=$(this.container+" .guide .js-loc").clone().appendTo(fragment);clone.data({"lat":location.latitude,"long":location.longitude});clone.addClass("js-idx"+i);clone.find(".js-add").html(location.city+", "+location.country);clone.find("img").attr({"src":location.marker});$(".js-filtc ul").append(fragment);this.getLocationTime(location.latitude,location.longitude,$(".js-filtc .js-idx"+i+" .js-time"));var agency="";fragment=document.createDocumentFragment();for(var j=0;j<location.data.length;j++){clone=$(this.container+" .guide .js-agency").clone().appendTo(fragment);var item=location.data[j];if(agency!=item.agency){clone.find(".js-name").html(item.agency);}
else{clone.find(".js-name").hide();}
clone.find(".js-lead").html(item.lead);clone.find(".js-email").html("<a href=\"mailto:"+item.email+"\">"+item.email+"</a>");clone.find(".js-jtitle").html(item.jobTitle);agency=item.agency;}
$(".js-filtc .js-idx"+i+" .js-agencies").html(fragment);}}
if(!found){$(".js-filtc ul").append("<li>No matching city found.</li>");}else{$(".js-filtc .js-add").unbind("click").bind("click",function(){var latitude=$(this).closest(".js-loc").data("lat");var longitude=$(this).closest(".js-loc").data("long");if(objMap.gMap.getZoom()!==4){objMap.gMap.setZoom(4);}
var positon=new google.maps.LatLng(latitude,longitude);var offsetPoint=objMap.offsetCenter(positon,-228,0);objMap.gMap.panTo(offsetPoint);});}}
Map.prototype.offsetCenter=function(latlng,offsetx,offsety){var objMap=this;var scale=Math.pow(2,objMap.gMap.getZoom());var worldCoordinateCenter=objMap.gMap.getProjection().fromLatLngToPoint(latlng);var pixelOffset=new google.maps.Point((offsetx/scale)||0,(offsety/scale)||0)
var worldCoordinateNewCenter=new google.maps.Point(worldCoordinateCenter.x-pixelOffset.x,worldCoordinateCenter.y+pixelOffset.y);var newCenter=objMap.gMap.getProjection().fromPointToLatLng(worldCoordinateNewCenter);return newCenter;};function Pin(objMap,pin){pin.marker=pin.marker||objMap.pinIcon;var marker=new google.maps.Marker({position:new google.maps.LatLng(pin.latitude,pin.longitude),animation:google.maps.Animation.DROP,map:objMap.gMap,icon:pin.marker});google.maps.event.addListener(marker,"click",function(){if(objMap.gMap.getZoom()!==4){objMap.gMap.setZoom(4);}
var offsetPoint=objMap.offsetCenter(marker.position,-228,0);marker.offsetPoint=offsetPoint;objMap.gMap.panTo(marker.offsetPoint);objMap.showDialog(pin);});google.maps.event.addListener(marker,"mouseover",function(){marker.setZIndex(google.maps.Marker.MAX_ZINDEX+1)});google.maps.event.addListener(marker,"mouseout",function(){marker.setZIndex(google.maps.Marker.MAX_ZINDEX-1)});}
window.sd.Pin=Pin;window.sd.Map=Map;}(window));(function(window){var searchOptions={};function Search(options){this.searchOptions={};this.inodeList=[];this.onSuccess=options.onSuccess||function(){};this.onError=options.onError||function(){};this.searchOptions.op=options.op||"";this.searchOptions.searchString=options.searchString||"";this.searchOptions.searchMetaData=options.searchMetaData||"";this.searchOptions.searchType=options.searchType||"exact";this.searchOptions.metaOnlySearch=options.metaOnlySearch||false;this.searchOptions.searchTitleOnly=(options.searchTitleOnly==null)?true:options.searchTitleOnly;this.searchOptions.searchContent=options.searchContent||false;this.searchOptions.searchStartDate=options.searchStartDate||"";this.searchOptions.searchEndDate=options.searchEndDate||"";this.searchOptions.searchLimitResults=options.searchLimitResults||0;this.searchOptions.searchRootNode=options.searchRootNode||0;this.searchOptions.searchCategories=options.searchCategories||"";this.searchOptions.searchFormats=options.searchFormats||"";this.searchOptions.searchOrder=options.searchOrder||"item";this.searchOptions.searchOrderDirection=options.searchOrderDirection||"DESC";this.searchOptions.descriptionLength=options.descriptionLength||200;this.searchOptions.searchUsers=options.searchUsers||false;this.searchOptions.searchEgnyte=(options.searchEgnyte==null)?false:options.searchEgnyte;this.searchOptions.searchUsersOnly=options.searchUsersOnly||false;this.searchOptions.searchEgnyteOnly=options.searchEgnyteOnly||false;}
Search.prototype.runSearch=function(){var sc=new sd.ServerCall("RunSearch");sc.data({options:this.searchOptions});sc.go({onSuccess:$.proxy(this.handleSearchResults,this),onError:this.onError});};Search.prototype.handleSearchResults=function(myData,status){var arrResults=[];for(i=0;i<myData.length;i++){var item={};var title,description,path;myData[i].t=myData[i].t.toLowerCase();title=decodeURIComponent(myData[i].n);path=decodeURIComponent(myData[i].fp);item.type=myData[i].t;item.template=myData[i].tp;if(myData[i].t=="user"){item.name=title;item.email=myData[i].e;item.id=myData[i].uid;item.image=myData[i].ui;item.location="Team";item.createdby=myData[i].un;item.createdate="";item.format="jpg";item.jobtitle=myData[i].jt;item.csImage=myData[i].csImage;}
else if(myData[i].t=="egnyte"){item.id=myData[i].eid;item.etype=myData[i].eType;item.epath=myData[i].ePath;item.image="";item.fnode=0;item.name=title;item.description=myData[i].d;item.location="EGNYTE";if(myData[i].eType=="file"){var date=myData[i].eDate.substring(0,10).split("-");item.createdate=new Date(date[0],date[1],date[2]);item.createdby=myData[i].c;item.description=myData[i].d;}
else{item.createdate="";item.createdby="";item.description="";}}
else{var location="";if(path!=null){var arrPath=path.split('\\');if(arrPath.length>2)
location=arrPath[arrPath.length-2];else
location=arrPath[0];}
item.id=myData[i].i;item.image=myData[i].i;if(myData[i].t=="newsletter")
item.image=myData[i].th;item.fnode=myData[i].f;item.name=title;item.description=decodeURIComponent(myData[i].d);item.createdby=myData[i].c;item.createdbyid=myData[i].cid;item.createdate=myData[i].cd;item.location=location;if(item.type=="discussion")
item.format="discussion";else
item.format=myData[i].fmt;if(location=="Discussion Root")
item.location="Channels";if(location=="Library Root")
item.location="Site Root";if(item.type=="comment"){item.name=arrPath[arrPath.length-2];item.format="comment";item.location="Channels";}
if(item.type=="folder"){item.type=item.template;item.format=item.template;item.image="";}
this.inodeList.push(myData[i].i);}
arrResults.push(item);}
this.onSuccess(arrResults);};window.sd=window.sd||{};window.sd.Search=Search;}(window));﻿(function(window){function ServerCall(op){this.postData=null;this.callbackData=null;this.json;this.operation=op;this.moreItems=false;this.url=sd.Configuration.ws+"/"+ServerCall.webservice[op]+"/"+op;;}
ServerCall.webservice={};ServerCall.webservice["GetSessionDetails"]="Session.asmx";ServerCall.webservice["GetAdminDetails"]="Session.asmx";ServerCall.webservice["GetJumpToDetails"]="Search.asmx";ServerCall.webservice["RunSearch"]="Search.asmx";ServerCall.webservice["CreateFolder"]="FolderManager.asmx";ServerCall.webservice["EditFolder"]="FolderManager.asmx";ServerCall.webservice["DeleteFolder"]="FolderManager.asmx";ServerCall.webservice["ListWorkboxes"]="FolderManager.asmx";ServerCall.webservice["FilePreviewDetails"]="FolderManager.asmx";ServerCall.webservice["FileHistoryDetails"]="FolderManager.asmx";ServerCall.webservice["FileVersionHistory"]="FolderManager.asmx";ServerCall.webservice["FileAssociations"]="FolderManager.asmx";ServerCall.webservice["ListAnnotations"]="FolderManager.asmx";ServerCall.webservice["SaveAnnotation"]="FolderManager.asmx";ServerCall.webservice["DeleteAnnotation"]="FolderManager.asmx";ServerCall.webservice["AddAnnotationReply"]="FolderManager.asmx";ServerCall.webservice["UpdateAnnotation"]="FolderManager.asmx";ServerCall.webservice["OpenFolder"]="FolderManager.asmx";ServerCall.webservice["GetFolderDetails"]="FolderManager.asmx";ServerCall.webservice["CreateMenuFolder"]="FolderManager.asmx";ServerCall.webservice["EditMenuFolder"]="FolderManager.asmx";ServerCall.webservice["DeleteItems"]="FolderManager.asmx";ServerCall.webservice["FolderTraverse"]="FolderManager.asmx";ServerCall.webservice["UpdateFolderDisplayOrder"]="FolderManager.asmx";ServerCall.webservice["ListMenuFolders"]="FolderManager.asmx";ServerCall.webservice["UpdateCollablistItem"]="FolderManager.asmx";ServerCall.webservice["ListFolders"]="LibraryManager.asmx";ServerCall.webservice["ListItems"]="LibraryManager.asmx";ServerCall.webservice["GetLibraryItem"]="LibraryManager.asmx";ServerCall.webservice["AddFormLibraryItem"]="LibraryManager.asmx";ServerCall.webservice["UpdateFormLibraryItem"]="LibraryManager.asmx";ServerCall.webservice["CreateLink"]="LibraryManager.asmx";ServerCall.webservice["UpdateLink"]="LibraryManager.asmx";ServerCall.webservice["GetLinkDetails"]="LibraryManager.asmx";ServerCall.webservice["DeleteLink"]="LibraryManager.asmx";ServerCall.webservice["ListJobs"]="JobManager.asmx";ServerCall.webservice["GetJob"]="JobManager.asmx";ServerCall.webservice["AddJob"]="JobManager.asmx";ServerCall.webservice["UpdateJobItem"]="JobManager.asmx";ServerCall.webservice["AddFileComment"]="DiscussionManager.asmx";ServerCall.webservice["ListComments"]="DiscussionManager.asmx";ServerCall.webservice["ListChannelCommentByID"]="DiscussionManager.asmx";ServerCall.webservice["ListChannelComments"]="DiscussionManager.asmx";ServerCall.webservice["ListUserComments"]="DiscussionManager.asmx";ServerCall.webservice["AddLike"]="DiscussionManager.asmx";ServerCall.webservice["UnLike"]="DiscussionManager.asmx";ServerCall.webservice["ListPostLikes"]="DiscussionManager.asmx";ServerCall.webservice["AddDiscussion"]="DiscussionManager.asmx";ServerCall.webservice["DeleteComment"]="DiscussionManager.asmx";ServerCall.webservice["DeleteDiscussion"]="DiscussionManager.asmx";ServerCall.webservice["ListUserDiscussions"]="DiscussionManager.asmx";ServerCall.webservice["ListDiscussionShort"]="DiscussionManager.asmx";ServerCall.webservice["ListMostLiked"]="DiscussionManager.asmx";ServerCall.webservice["EditDiscussion"]="DiscussionManager.asmx";ServerCall.webservice["EditComment"]="DiscussionManager.asmx";ServerCall.webservice["DeleteAttachment"]="DiscussionManager.asmx";ServerCall.webservice["CreateComment"]="DiscussionManager.asmx";ServerCall.webservice["SaveChannelFilter"]="DiscussionManager.asmx";ServerCall.webservice["GetChannelFilter"]="DiscussionManager.asmx";ServerCall.webservice["ListAnnouncements"]="AnnouncementManager.asmx";ServerCall.webservice["ListAdminAnnouncements"]="AnnouncementManager.asmx";ServerCall.webservice["AddAnnouncement"]="AnnouncementManager.asmx";ServerCall.webservice["DisableAnnouncements"]="AnnouncementManager.asmx";ServerCall.webservice["EditAnnouncement"]="AnnouncementManager.asmx";ServerCall.webservice["UpdateAnnouncementsOptOut"]="AnnouncementManager.asmx";ServerCall.webservice["DeleteAnnouncement"]="AnnouncementManager.asmx";ServerCall.webservice["GetRecipientList"]="EmailNotification.asmx";ServerCall.webservice["SendEmailNotification"]="EmailNotification.asmx";ServerCall.webservice["ListGroups"]="GroupManager.asmx";ServerCall.webservice["AddGroup"]="GroupManager.asmx";ServerCall.webservice["EditGroup"]="GroupManager.asmx";ServerCall.webservice["DeleteGroup"]="GroupManager.asmx";ServerCall.webservice["ListGroupMembers"]="GroupManager.asmx";ServerCall.webservice["ListGroupMembersOnly"]="GroupManager.asmx";ServerCall.webservice["UpdateGroupMembers"]="GroupManager.asmx";ServerCall.webservice["SendEmail"]="SendSiteEmail.asmx";ServerCall.webservice["GetEmailList"]="SendSiteEmail.asmx";ServerCall.webservice["ListAllUsersAndGroups"]="PermissionManager.asmx";ServerCall.webservice["EditAccess"]="PermissionManager.asmx";ServerCall.webservice["ShowAccess"]="PermissionManager.asmx";ServerCall.webservice["InheritAccess"]="PermissionManager.asmx";ServerCall.webservice["GetItemAccess"]="PermissionManager.asmx";ServerCall.webservice["ListReports"]="ReportManager.asmx";ServerCall.webservice["SaveReport"]="ReportManager.asmx";ServerCall.webservice["GetReport"]="ReportManager.asmx";ServerCall.webservice["RunReport"]="ReportManager.asmx";ServerCall.webservice["ListMetaLabels"]="MetaDataManager.asmx";ServerCall.webservice["ListMetaAttributeTypes"]="MetaDataManager.asmx";ServerCall.webservice["ListMetaAttributes"]="MetaDataManager.asmx";ServerCall.webservice["AddMetaAttribute"]="MetaDataManager.asmx";ServerCall.webservice["EditMetaAttribute"]="MetaDataManager.asmx";ServerCall.webservice["GetItemMetaAttributes"]="MetaDataManager.asmx";ServerCall.webservice["GetItemMetaData"]="MetaDataManager.asmx";ServerCall.webservice["AddMetaType"]="MetaDataManager.asmx";ServerCall.webservice["EditMetaType"]="MetaDataManager.asmx";ServerCall.webservice["ListSectionMetaTags"]="MetaDataManager.asmx";ServerCall.webservice["UpdateSectionMetaAttributes"]="MetaDataManager.asmx";ServerCall.webservice["ListActiveUsers"]="UserManager.asmx";ServerCall.webservice["GetUserDetails"]="UserManager.asmx";ServerCall.webservice["McCannGlobalSearch"]="UserManager.asmx";ServerCall.webservice["GetCustomProfileFields"]="UserManager.asmx";ServerCall.webservice["ToggleEmailAlerts"]="UserManager.asmx";ServerCall.webservice["DisableUser"]="UserManager.asmx";ServerCall.webservice["ListUsers"]="UserManager.asmx";ServerCall.webservice["AddQuickUser"]="UserManager.asmx";ServerCall.webservice["EnableUser"]="UserManager.asmx";ServerCall.webservice["SaveUserSettings"]="UserManager.asmx";ServerCall.webservice["GetUserSettings"]="UserManager.asmx";ServerCall.webservice["UpdateUserProfile"]="UserManager.asmx";ServerCall.webservice["RemoveAllUserAccess"]="UserManager.asmx";ServerCall.webservice["GetUserAccessDetails"]="UserManager.asmx";ServerCall.webservice["UpdateUserCollabAccess"]="UserManager.asmx";ServerCall.webservice["GetUserMetaFilters"]="UserManager.asmx";ServerCall.webservice["UpdateUserColour"]="UserManager.asmx";ServerCall.webservice["ListUserNames"]="SuperAdmin.asmx";ServerCall.webservice["GetUserInfo"]="SuperAdmin.asmx";ServerCall.webservice["UpdateUserStatus"]="SuperAdmin.asmx";ServerCall.webservice["AddUserDetails"]="SuperAdmin.asmx";ServerCall.webservice["EditUserDetails"]="SuperAdmin.asmx";ServerCall.webservice["UpdateUserPassword"]="SuperAdmin.asmx";ServerCall.webservice["ListGroupNames"]="SuperAdmin.asmx";ServerCall.webservice["ListFavourites"]="FavouritesManager.asmx";ServerCall.webservice["AddFavourite"]="FavouritesManager.asmx";ServerCall.webservice["RemoveFavourite"]="FavouritesManager.asmx";ServerCall.webservice["ListLinks"]="LinksManager.asmx";ServerCall.webservice["AddLink"]="LinksManager.asmx";ServerCall.webservice["RemoveLink"]="LinksManager.asmx";ServerCall.webservice["EditLink"]="LinksManager.asmx";ServerCall.webservice["ListPortalLinks"]="LinksManager.asmx";ServerCall.webservice["ListPortalLinkSections"]="LinksManager.asmx";ServerCall.webservice["AddLinkSection"]="LinksManager.asmx";ServerCall.webservice["EditLinkSection"]="LinksManager.asmx";ServerCall.webservice["RemoveLinkSection"]="LinksManager.asmx";ServerCall.webservice["UpdateLinkSectionDisplayOrder"]="LinksManager.asmx";ServerCall.webservice["UpdateLinkDisplayOrder"]="LinksManager.asmx";ServerCall.webservice["ListCollabSpaces"]="CollaborationSpaceManager.asmx";ServerCall.webservice["ListUserCollabSpaces"]="CollaborationSpaceManager.asmx";ServerCall.webservice["GetCollabSpaceDetails"]="CollaborationSpaceManager.asmx";ServerCall.webservice["CreateCollabSpace"]="CollaborationSpaceManager.asmx";ServerCall.webservice["UpdateCollabSpace"]="CollaborationSpaceManager.asmx";ServerCall.webservice["DisableCollabSpace"]="CollaborationSpaceManager.asmx";ServerCall.webservice["EnableCollabSpace"]="CollaborationSpaceManager.asmx";ServerCall.webservice["ListCollabSpaceAccess"]="CollaborationSpaceManager.asmx";ServerCall.webservice["UpdateCollabSpaceAccess"]="CollaborationSpaceManager.asmx";ServerCall.webservice["CheckCollabSpaceAccess"]="CollaborationSpaceManager.asmx";ServerCall.webservice["ApproveUserRequest"]="CollaborationSpaceManager.asmx";ServerCall.webservice["RejectUserRequest"]="CollaborationSpaceManager.asmx";ServerCall.webservice["GetIFrameSettings"]="CollaborationSpaceManager.asmx";ServerCall.webservice["UpdateIFrameSettings"]="CollaborationSpaceManager.asmx";ServerCall.webservice["GenerateEmbedURL"]="CollaborationSpaceManager.asmx";ServerCall.webservice["LogMetric"]="MetricManager.asmx";ServerCall.webservice["LogContentMetric"]="MetricManager.asmx";ServerCall.webservice["TotalFavourites"]="MetricManager.asmx";ServerCall.webservice["TotalLikes"]="MetricManager.asmx";ServerCall.webservice["TotalPosts"]="MetricManager.asmx";ServerCall.webservice["TotalReplies"]="MetricManager.asmx";ServerCall.webservice["TotalLogons"]="MetricManager.asmx";ServerCall.webservice["UniqueLogons"]="MetricManager.asmx";ServerCall.webservice["ToggleOverlayOn"]="TrainingOverlayManager.asmx";ServerCall.webservice["ToggleOverlayOff"]="TrainingOverlayManager.asmx";ServerCall.webservice["ToggleOverlayOnAllUsers"]="TrainingOverlayManager.asmx";ServerCall.webservice["ToggleOverlayOffAllUsers"]="TrainingOverlayManager.asmx";ServerCall.webservice["UpdateTrainingOverlay"]="TrainingOverlayManager.asmx";ServerCall.webservice["GetOverlayDetails"]="TrainingOverlayManager.asmx";ServerCall.webservice["GetUserOverlay"]="TrainingOverlayManager.asmx";ServerCall.webservice["RelaunchOverlay"]="TrainingOverlayManager.asmx";ServerCall.webservice["ListCrew"]="CrewManager.asmx";ServerCall.webservice["AddCrewItem"]="CrewManager.asmx";ServerCall.webservice["EditCrewItem"]="CrewManager.asmx";ServerCall.webservice["GetCrewItem"]="CrewManager.asmx";ServerCall.webservice["DeleteCrewItem"]="CrewManager.asmx";ServerCall.webservice["ListClients"]="CrewManager.asmx";ServerCall.webservice["HandleImportFile"]="CrewManager.asmx";ServerCall.webservice["ReadRSS"]="rssManager.asmx";ServerCall.webservice["ListDisclaimers"]="DisclaimerManager.asmx";ServerCall.webservice["SetItemDisclaimer"]="DisclaimerManager.asmx";ServerCall.webservice["GetItemDisclaimer"]="LibraryManager.asmx";ServerCall.webservice["AddAuditTrail"]="DisclaimerManager.asmx";ServerCall.webservice["ListLoginDisclaimer"]="DisclaimerManager.asmx";ServerCall.webservice["AddDisclaimer"]="DisclaimerManager.asmx";ServerCall.webservice["EditDisclaimer"]="DisclaimerManager.asmx";ServerCall.webservice["RemoveDisclaimer"]="DisclaimerManager.asmx";ServerCall.webservice["CreateNewsletter"]="NewsletterManager.asmx";ServerCall.webservice["UpdateNewsletter"]="NewsletterManager.asmx";ServerCall.webservice["GetNewsletter"]="NewsletterManager.asmx";ServerCall.webservice["DeleteNewsletter"]="NewsletterManager.asmx";ServerCall.webservice["ListNewsletters"]="NewsletterManager.asmx";ServerCall.webservice["GetPageContent"]="LibraryManager.asmx";ServerCall.webservice["UpdatePageContent"]="LibraryManager.asmx";ServerCall.webservice["GetLocationTime"]="LibraryManager.asmx";ServerCall.webservice["GetDashboardLayout"]="MyDashboardManager.asmx";ServerCall.webservice["GetDashboardItems"]="MyDashboardManager.asmx";ServerCall.webservice["AddDashboardItem"]="MyDashboardManager.asmx";ServerCall.webservice["DeleteDashboardItem"]="MyDashboardManager.asmx";ServerCall.webservice["EditDashboardItem"]="MyDashboardManager.asmx";ServerCall.webservice["FolderTraverseDashboard"]="MyDashboardManager.asmx";ServerCall.webservice["ListSocialDashboard"]="DashboardManager.asmx";ServerCall.webservice["ListDashboardItems"]="DashboardManager.asmx";ServerCall.webservice["ListDashboardUsers"]="DashboardManager.asmx";ServerCall.prototype.data=function(dataObj){var now=new Date().getTime();dataObj.stamp=now;this.postData=dataObj;}
ServerCall.prototype.cbData=function(dataObj){this.callbackData=dataObj;}
ServerCall.prototype.go=function(options){if(this.url=="")return;this.options=options||{};this.options.onSuccess=this.options.onSuccess||function(){};this.options.onError=this.options.onError||function(){};this.options.localStorageTTL=this.options.localStorageTTL||0;this.options.localStorageTTL=0;this.options.count=this.options.count||0;this.options.start=0;this.loadNext();}
ServerCall.prototype.loadNext=function(){var thisInstance=this;if(thisInstance.options.count>0){thisInstance.postData=thisInstance.postData||{};thisInstance.postData.count=thisInstance.options.count+1;thisInstance.postData.start=thisInstance.options.start;thisInstance.options.start+=thisInstance.options.count;thisInstance.moreItems=false;}
var postData="";if(thisInstance.postData!=null)postData=JSON.stringify(thisInstance.postData);var lsKEY=thisInstance.operation+postData;var readFromStorage=false;if(thisInstance.options.localStorageTTL>0){var storageData=localStorage.getItem(lsKEY)
if(storageData!=null&&storageData.length>0){var now=new Date().getTime();var storageExpires=parseInt(localStorage.getItem("TIME_"+lsKEY))+(thisInstance.options.localStorageTTL*1000);if(now>storageExpires){localStorage.clear(lsKEY);localStorage.clear("TIME_"+lsKEY);}else{readFromStorage=true;my_timer=setTimeout(function(){cb(JSON.parse(storageData),"");},200);}}}
if(!readFromStorage){var cbData=thisInstance.callbackData;var CSRF_TOKEN=(sd.Session.user)?sd.Session.user.CSRF_TOKEN:"";$.ajax({type:"POST",contentType:'application/json; charset=utf-8',dataType:'json',url:thisInstance.url,data:postData,headers:{CSRF_TOKEN:CSRF_TOKEN},success:function(data,status){thisInstance.json=eval(data.d);if(thisInstance.json.length>0){var item=thisInstance.json[0];if(item.response=="Error"){if(item.message=="Session Invalid"){sd.component.messageBox.action({title:"Session Expired",text:"Your session has expired. <br> <br> Please click OK to login again.",btn1:"Ok",btn1callback:function(){var url=sd.Configuration.ws.replace("ws","login.aspx");window.location.replace(url);}});}
else{thisInstance.options.onError(String(item.message),cbData);}
return;}else{if(thisInstance.options.count>0&&thisInstance.json.length>thisInstance.options.count){thisInstance.json.pop();thisInstance.moreItems=true;}
thisInstance.options.onSuccess(thisInstance.json,status,cbData,thisInstance);}}else{thisInstance.options.onSuccess(thisInstance.json,status,cbData,thisInstance);}
if(thisInstance.options.localStorageTTL>0){localStorage.setItem(lsKEY,JSON.stringify(thisInstance.json));var now=new Date().getTime();localStorage.setItem("TIME_"+lsKEY,now);}},error:function(xhr,status,error){thisInstance.options.onError(xhr.message,cbData);}});}}
window.sd=window.sd||{};window.sd.ServerCall=ServerCall;}(window));﻿(function(window){var Session={};Session.user=null;Session.getUserDetails=function(callback){Session.callback=callback;if(Session.user==null){var sc=new sd.ServerCall("GetSessionDetails");sc.go({onSuccess:Session.handleUserDetails});}
else Session.callback();}
Session.handleUserDetails=function(myData,status){Session.user=myData[0];Session.callback();}
window.sd=window.sd||{};window.sd.Session=Session;}(window));﻿(function(window){function UserAssign(options){this.div=options.div;this.itemList=(options.itemList)?JSON.parse(JSON.stringify(options.itemList)):[];this.currentUsers=options.currentUsers||[];this.currentGroups=options.currentGroups||[];this.destTitle=options.destTitle||"";this.sourceTitle=options.sourceTitle||"";this.showView=(options.showView==null)?true:options.showView;this.viewTitle=options.viewTitle||"View";this.showEdit=(options.showEdit==null)?true:options.showEdit;this.editTitle=options.editTitle||"Edit";this.showAdmin=(options.showAdmin==null)?true:options.showAdmin;this.adminTitle=options.adminTitle||"Admin";this.images={"user":"images/selectList/user.png","group":"images/selectList/group.png"};this.listHeight=options.listHeight||200;this.idx=UserAssign.idx++;this.divID="#UserAssign"+this.idx;this.sourceFilter="All";this.destFilter="All";this.sourceFilterText="";this.destFilterText="";this.prev=-1;if(options.inode!=null){var sc=new sd.ServerCall("ShowAccess");sc.data({inode:options.inode});sc.go({onSuccess:$.proxy(this.handleAccess,this)});}
else{this.draw();}}
UserAssign.idx=0;UserAssign.prototype.handleAccess=function(myData){this.itemList=myData;this.draw();}
UserAssign.prototype.draw=function(){for(var i=0;i<this.itemList.length;i++){this.itemList[i].value=this.itemList[i].dn.toLowerCase().replace("'","&apos;");if(this.itemList[i].id==0)this.itemList[i].t="group";}
$(this.div).html("<div id='UserAssign"+this.idx+"' class='userAssign'></div>");$(this.divID).load("templates/dialogs/UserAssign.htm",$.proxy(this.drawComplete,this));}
UserAssign.prototype.drawComplete=function(){$(this.divID+" .userAssign__list[data-type='source']>.title").html(this.sourceTitle);$(this.divID+" .userAssign__list[data-type='dest']>.title").html(this.destTitle);$(this.div+" .assignmentListWrapper").css('height',this.listHeight+'px');var fragment=document.createDocumentFragment();var sectionCount=0;if(this.showView){var clone=$('.guide .destList').clone().appendTo(fragment);clone.attr("data-level","1");clone.find('.title').html(this.viewTitle);sectionCount++;}
if(this.showEdit){var clone=$('.guide .destList').clone().appendTo(fragment);clone.attr("data-level","2");clone.find('.title').html(this.editTitle);sectionCount++;}
if(this.showAdmin){var clone=$('.guide .destList').clone().appendTo(fragment);clone.attr("data-level","3");clone.find('.title').html(this.adminTitle);sectionCount++;}
$(this.divID+" .destLists").html(fragment);$(this.divID+" .destList .assignmentListWrapper").css('height',Math.floor(this.listHeight/sectionCount)+'px');$(this.divID+" dd").click($.proxy(this.updateFilterType,this));$(this.divID+" .permission-list-input").on('input',$.proxy(this.updateFilterText,this));$(this.divID+" .addSelected").click($.proxy(this.addSelected,this));$(this.divID+" .removeSelected").click($.proxy(this.removeSelected,this));$(this.divID+" .addAll").click($.proxy(this.addAll,this));$(this.divID+" .removeAll").click($.proxy(this.removeAll,this));$(this.divID+" .assignmentList").selectable({selecting:$.proxy(this.multiSelect,this)});this.updateListDisplay();}
UserAssign.prototype.selectedItems=function(){var items={};items.readusers=[];items.editusers=[];items.adminusers=[];items.readgroups=[];items.editgroups=[];items.admingroups=[];for(var i=0;i<this.itemList.length;i++){if(this.itemList[i].a>=1){if(this.itemList[i].t=="user"){if(this.itemList[i].a==1)items.readusers.push(this.itemList[i].id);else if(this.itemList[i].a==2)items.editusers.push(this.itemList[i].id);else if(this.itemList[i].a==3)items.adminusers.push(this.itemList[i].id);}
else if(this.itemList[i].t=="group"){if(this.itemList[i].a==1)items.readgroups.push(this.itemList[i].id);else if(this.itemList[i].a==2)items.editgroups.push(this.itemList[i].id);else if(this.itemList[i].a==3)items.admingroups.push(this.itemList[i].id);}}}
console.log(items);return items;}
UserAssign.prototype.multiSelect=function(e,ui){var curr=$(ui.selecting.tagName,e.target).index(ui.selecting);if(e.shiftKey&&this.prev>-1){$(ui.selecting.tagName,e.target).slice(Math.min(this.prev,curr),1+Math.max(this.prev,curr)).each(function(index){if($(this).is(":visible"))$(this).addClass('ui-selected');});this.prev=-1;}
else{this.prev=curr;}}
UserAssign.prototype.addAll=function(e){var list=this.itemList;var level=$(e.target).closest("div").data("level");$(this.divID+" .userAssign__list[data-type='source'] li:visible").each(function(index){var idx=$(this).data("idx");list[idx].a=level;$(this).remove();});this.updateListDisplay("dest");}
UserAssign.prototype.addSelected=function(e){var list=this.itemList;var level=$(e.target).closest("div").data("level");$(this.divID+" .userAssign__list[data-type='source'] .ui-selected:visible").each(function(index){var idx=$(this).data("idx");list[idx].a=level;$(this).remove();});this.updateListDisplay("dest");}
UserAssign.prototype.removeAll=function(e){var list=this.itemList;var level=$(e.target).closest("div").data("level");$(this.divID+" .destList[data-level='"+level+"'] li:visible").each(function(index){var idx=$(this).data("idx");list[idx].a=0;$(this).remove();});this.updateListDisplay("source");}
UserAssign.prototype.removeSelected=function(e){var list=this.itemList;var level=$(e.target).closest("div").data("level");$(this.divID+" .destList[data-level='"+level+"'] .ui-selected:visible").each(function(index){var idx=$(this).data("idx");list[idx].a=0;$(this).remove();});this.updateListDisplay("source");}
UserAssign.prototype.updateListDisplay=function(type){var htmlNone="";var htmlRead="";var htmlEdit="";var htmlAdmin="";for(var i=0;i<this.itemList.length;i++){var html="<li data-idx='"+i+"' data-value=\""+this.itemList[i].value+"\" data-type='"+this.itemList[i].t+"'><img src=\""+this.images[this.itemList[i].t]+"\" />"+this.itemList[i].dn+"</li>";if(this.itemList[i].a<=0)
htmlNone+=html;else if(this.itemList[i].a==1)
htmlRead+=html;else if(this.itemList[i].a==2)
htmlEdit+=html;else if(this.itemList[i].a==3)
htmlAdmin+=html;}
if(type==null||type=="source"){$(this.divID+" .userAssign__list[data-type='source'] .assignmentList").html(htmlNone);this.applyFilters("source");}
if(type==null||type=="dest"){$(this.divID+" .destList[data-level='1'] .assignmentList").html(htmlRead);$(this.divID+" .destList[data-level='2'] .assignmentList").html(htmlEdit);$(this.divID+" .destList[data-level='3'] .assignmentList").html(htmlAdmin);this.applyFilters("dest");}}
UserAssign.prototype.updateFilterType=function(e){console.log("updateFilterType");var section=$(e.currentTarget).closest(".userAssign__list");$(section).find("dd").removeClass("active");$(e.currentTarget).addClass("active");if(section.data("type")=="source"){this.sourceFilter=$(e.currentTarget).text();this.applyFilters("source");}
else{this.destFilter=$(e.currentTarget).text();this.applyFilters("dest");}};UserAssign.prototype.updateFilterText=function(e){console.log("updateFilterText");var type=$(e.currentTarget).closest(".userAssign__list").data("type");if(type=="source"){this.sourceFilterText=$(this.divID+" .userAssign__list[data-type='source'] .permission-list-input").val();this.sourceFilterText.replace("'","&apos;");this.applyFilters("source");}
else if(type=="dest"){this.destFilterText=$(this.divID+" .userAssign__list[data-type='dest'] .permission-list-input").val();this.destFilterText.replace("'","&apos;");this.applyFilters("dest");}}
UserAssign.prototype.applyFilters=function(type){console.log("applyFilters");if(type=="source"){$(this.divID+" .userAssign__list[data-type='source'] li").show();if(this.sourceFilter=="Groups")$(this.divID+" .userAssign__list[data-type='source'] li[data-type='user']").hide();else if(this.sourceFilter=="Users")$(this.divID+" .userAssign__list[data-type='source'] li[data-type='group']").hide();if(this.sourceFilterText!="")
$(this.divID+" .userAssign__list[data-type='source'] li").not("[data-value*=\""+this.sourceFilterText+"\"]").hide();}
else if(type=="dest"){$(this.divID+" .userAssign__list[data-type='dest'] li").show();if(this.destFilter=="Groups")$(this.divID+" .userAssign__list[data-type='dest'] li[data-type='user']").hide();else if(this.destFilter=="Users")$(this.divID+" .userAssign__list[data-type='dest'] li[data-type='group']").hide();if(this.destFilterText!="")
$(this.divID+" .userAssign__list[data-type='dest'] li").not("[data-value*=\""+this.destFilterText+"\"]").hide();}}
window.sd=window.sd||{};window.sd.UserAssign=UserAssign;}(window));﻿(function(window){var Utils={};Utils.popstateAdded=false;Utils.generateGUID=function(){var d=new Date().getTime();var guid='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=='x'?r:(r&0x7|0x8)).toString(16);});return guid;};Utils.toggleCheckbox=function(element,select){var span=element.parent().find("span");if(select==null){Foundation.libs.forms.toggle_checkbox(span);}
else{var isChecked=element.is(":checked");if((isChecked&&!select)||(!isChecked&&select)){Foundation.libs.forms.toggle_checkbox(span);}}}
Utils.toggleRadio=function(element,select){var span=element.parent().find("span");if(select==null){Foundation.libs.forms.toggle_radio(span);}
else{var isChecked=element.is(":checked");if((isChecked&&!select)||(!isChecked&&select)){Foundation.libs.forms.toggle_radio(span);}}}
Utils.initWYSIWYG=function(details){var id=details.id;var callback=details.callback||function(){};if($(id).val()=="")$(id).val("nbsp;");try{var editor=CKEDITOR.instances[id]
if(editor){delete CKEDITOR.instances[id];}
$("#cke_"+id).remove();}
catch(err){console.log("destroy ckeditor error");}
var loc=window.location.href;if(typeof(history.pushState)==="function"&&loc.substr(-1)==="#"){loc=loc.substr(0,loc.length-1);history.pushState("","",loc);}
var instance=CKEDITOR.replace(id,{toolbar:sd.Configuration.TextEditorToolbar,on:{instanceReady:function(){$(document).scrollTop(0);callback();}}});if(details.text!=null)instance.setData(details.text);return instance;}
Utils.historyAdd=function(options){if(sd.Configuration.backButtonEnabled){options=options||{};options.inode=options.inode||"";options.section=options.section||"";options.template=options.template||"";options.fnode=options.fnode||"";options.ParentID=options.ParentID||"";options.mode=options.mode||"";options.userID=options.userID||"";options.csid=options.csid||"";options.term=options.term||"";options.mode=options.mode||"";if(Utils.popstateAdded==false){window.addEventListener("popstate",function(e){if(e.state!="loadPage")
return;Utils.handlebackButton();});Utils.popstateAdded=true;}
var urlOptions="?section="+options.section;if(options.inode!=""&&options.inode!="undefined")urlOptions+="&inode="+options.inode;if(options.template!=""&&options.template!="undefined")urlOptions+="&template="+options.template;if(options.fnode!=""&&options.fnode!="undefined")urlOptions+="&fnode="+options.fnode;if(options.ParentID!=""&&options.ParentID!="undefined")urlOptions+="&ParentID="+options.ParentID;if(options.mode!=""&&options.mode!="undefined")urlOptions+="&mode="+options.mode;if(options.userID!=""&&options.userID!="undefined")urlOptions+="&userID="+options.userID;if(options.csid!=""&&options.csid!="undefined")urlOptions+="&csID="+options.csid;if(options.term!=""&&options.term!="undefined")urlOptions+="&term="+options.term;if(typeof(history.pushState)==="function")
{history.pushState("loadPage",null,urlOptions);}}}
Utils.handlebackButton=function(){var section=Utils.GetURLParameter("section");var inode=Utils.GetURLParameter("inode");var template=Utils.GetURLParameter("template");var fnode=Utils.GetURLParameter("fnode");var ParentID=Utils.GetURLParameter("ParentID");var mode=Utils.GetURLParameter("mode");var userID=Utils.GetURLParameter("userID");var csid=Utils.GetURLParameter("csID");var term=Utils.GetURLParameter("term");try{sd.component.messageBox.close();}catch(err){};try{previewer.close();}catch(err){};if(section=="search"&&term!=""){$('#headerSearchFieldInput').val(decodeURI(term));if(mode=='advanced'){var options=sd.Global.searchData.pop();$('input:radio[name=headerSearchType]').val(options.searchType);$('input:checkbox[name=headerSearchContent]').attr("checked",options.searchContent);$('input:checkbox[name=headerSearchTitle]').attr("checked",options.searchTitleOnly);$("#searchStartDate").val(options.searchStartDate);$("#searchEndDate").val(options.searchEndDate);$('#cboSearchLocation').val(options.location);var formats=options.searchFormats.split(',');$('input:checkbox[name=headerSearchVideo]').attr("checked",formats.indexOf("video")>=0);$('input:checkbox[name=headerSearchDoc]').attr("checked",formats.indexOf("document")>=0);$('input:checkbox[name=headerSearchPres]').attr("checked",formats.indexOf("presentation")>=0);$('input:checkbox[name=headerSearchImage]').attr("checked",formats.indexOf("image")>=0);if(options.searchBoxOnly)
$('input:checkbox[name=headerSearchBox]').attr("checked",options.searchBoxOnly);}
LoadSection("search",false,{mode:mode,searchRootNode:fnode,searchString:term})}
else{LoadSection(section,false,{csid:csid,f_node:fnode,template:template,i_node:inode,ParentID:ParentID,mode:mode,userID:userID});}}
Utils.GetURLParameter=function(sParam){var sPageURL=window.location.search.substring(1);var sURLVariables=sPageURL.split('&');for(var i=0;i<sURLVariables.length;i++){var sParameterName=sURLVariables[i].split('=');if(sParameterName[0]==sParam){return sParameterName[1];}}
return"";}
Utils.formatDate=function(theDate,dateFormat){dateFormat=dateFormat||sd.Configuration.defaultDateFormat;if(theDate==null)return"";if(typeof theDate=="string"){var date=Utils.jsonDateToDate(theDate);theDate=date;}
var month=Number(theDate.getMonth())+1;var monthString=month;if(month<10)monthString="0"+monthString;var shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var day=theDate.getDate();if(day<10)day="0"+day;var dateStr="";switch(dateFormat){case"dd-mm-yy":dateStr=day+"-"+monthString+"-"+theDate.getFullYear();break;case"mm-dd-yy":dateStr=monthString+"-"+day+"-"+theDate.getFullYear();break;case"dd mmm yy":dateStr=day+"-"+shortMonths[month-1]+"-"+theDate.getFullYear();break;default:dateStr=day+" "+monthString+" "+theDate.getFullYear();}
return dateStr;}
Utils.jsonDateToDate=function(theDate){var date=new Date(parseInt(theDate.substr(6)));return date;}
Utils.sortArrayByString=function(array,column){array.sort(function(a,b){var aVal=(a[column])?a[column].toLowerCase():"";var bVal=(b[column])?b[column].toLowerCase():"";return((aVal<bVal)?-1:((aVal>bVal)?1:0));});}
Utils.sortArrayByNumber=function(array,column){array.sort(function(a,b){var aVal=Number(a[column]);var bVal=Number(b[column]);return((aVal<bVal)?-1:((aVal>bVal)?1:0));});}
Utils.sortArrayByDate=function(array,column){array.sort(function(a,b){var aVal=(a[column].getMonth)?a[column]:Utils.jsonDateToDate(a[column]);var bVal=(b[column].getMonth)?b[column]:Utils.jsonDateToDate(b[column]);return((aVal<bVal)?-1:((aVal>bVal)?1:0));});}
Utils.sortArrayByJSDate=function(array,column){array.sort(function(a,b){var aVal=(a[column].getMonth)?a[column]:new Date(a[column]);var bVal=(b[column].getMonth)?b[column]:new Date(b[column]);return((aVal>bVal)?-1:((aVal<bVal)?1:0));});}
Utils.isEven=function(valueIn){if(valueIn%2==0)
return true;else
return false;}
Utils.getItemsFromObject=function(objIn,searchField,searchVal,returnVal){var arrOut=[];for(var i=0;i<objIn.length;i++){if(objIn[i][searchField]==searchVal){arrOut.push(objIn[i][returnVal]);}}
return arrOut;}
Utils.countObjectArrayValues=function(arrIn,type,value){var count=0;for(var i=0;i<arrIn.length;i++){if(arrIn[i][type]==value){count++;}}
return count;}
Utils.countArrayValues=function(arrIn,value){var count=0;for(var i=0;i<arrIn.length;i++){if(arrIn[i]==value){count++;}}
return count;}
Utils.removeArrayDuplicates=function(arrIn){var arrUnique=[];$.each(arrIn,function(i,e){if(($.inArray(e,arrUnique)==-1)&&(e!=""))arrUnique.push(e);});return arrUnique;}
Utils.removeObjectArrayDuplicates=function(arrIn,value){var arrUnique=[];var lookup={};for(var i in arrIn){lookup[String(arrIn[i][value]).toLowerCase()]=arrIn[i];}
for(i in lookup){arrUnique.push(lookup[i]);}
return arrUnique;}
Utils.dynamicSortMultiple=function(){var props=arguments;return function(field1,field2){var i=0,result=0,numberOfProperties=props.length;while(result===0&&i<2){result=Utils.dynamicSort(props[i])(field1,field2);i++;}
return result;}}
Utils.dynamicSort=function(property){var sortOrder=1;if(property[0]==="-"){sortOrder=-1;property=property.substr(1);}
return function(a,b){var aVal,bVal;if(property.toLowerCase()=="featured"){aVal=Number(a[property]);bVal=Number(b[property]);}
else if(property.toLowerCase()=="createdate"){aVal=new Date(a[property]);bVal=new Date(b[property]);}
else{aVal=String(a[property]).toLowerCase();bVal=String(b[property]).toLowerCase();}
var result=(aVal<bVal)?-1:(aVal>bVal)?1:0;return result*sortOrder;}}
Utils.moveBetweenLists=function(sortAttr,selectedClass,source,destination){var itemsSelected=$(source).children("."+selectedClass);var item;var htmlOut="";for(var idx=0;idx<itemsSelected.length;idx++){item=itemsSelected[idx];$(item).removeClass(selectedClass);htmlOut+=item.outerHTML;$(item).remove();}
$(destination).append(htmlOut);var lst=$(destination);var lstitems=lst.children('li').get();lstitems.sort(function(a,b){var aTestString=$(a).attr(sortAttr);var bTestString=$(b).attr(sortAttr);var aString=$(a).text().toUpperCase();var bString=$(b).text().toUpperCase();aString=aTestString+aString;bString=bTestString+bString;return aString.localeCompare(bString);})
$.each(lstitems,function(idx,itm){lst.append(itm);});}
Utils.getFileIcon=function(options){var fmtOut="";options.size=options.size||"med";options.fmt=String(options.fmt).toLowerCase()||"default";switch(options.fmt){case'discussion':case'comment':fmtOut="discussion"+options.size+".png";break;case'pdf':fmtOut="pdf"+options.size+".png";break;case'doc':case'docx':case'dotx':fmtOut="doc"+options.size+".png";break;case'ppt':case'pptx':fmtOut="ppt"+options.size+".png";break;case'xls':case'xlsx':case'xlb':case'xlsm':case'xltx':case'xlsb':fmtOut="xls"+options.size+".png";break;case'jpg':case'jpeg':case'png':case'gif':fmtOut="image"+options.size+".png";break;case'mp4':case'avi':case'wmv':case'mpg':case'mpeg':case'mov':case'rm':case'ram':case'flv':case'mkv':case'm4v':fmtOut="movie"+options.size+".png";break;case'zip':case'rar':fmtOut="zip"+options.size+".png";break;case'swf':fmtOut="swf"+options.size+".png";break;default:fmtOut="default"+options.size+".png";break;}
return fmtOut;}
Utils.sendEmailLink=function(details){details.title=details.title||"Mail Link";sd.component.messageBox.action({fade:false,height:450,width:700,title:details.title,template:"templates/mccann/email.htm",loadCallback:function(){$('#txtSubject').val(sd.Configuration.messages.emailNewUploadSubject);var url=encodeURIComponent(window.location.protocol)+"//";url+=encodeURIComponent(window.location.host);url+=encodeURIComponent(window.location.pathname);url+="?inode="+details.inode;var body=sd.Configuration.messages.emailNewUploadBody;body+="%0D%0A%0D%0A";body+=url+" %0D%0A%0D%0A";$('#txtBody').val(decodeURIComponent(body));var obj={};obj.inode=details.fnode;var sc=new sd.ServerCall("GetEmailList");sc.data(obj);sc.go({onSuccess:library.handleRecipients,onError:library.handleFormError});},btn1callback:library.sendEmail,btn1:"Send",icon1:"icon-mail-forward",btn2:"Cancel",icon2:"icon-ban-circle"});}
Utils.shareFileLink=function(inode){var url=window.location.protocol+"//";url+=window.location.host;url+=window.location.pathname;url+="?inode="+inode;sd.component.messageBox.action({title:"Share Link",height:420,bodyClass:"share-resources item-details",headerClass:"share-resources-head",width:600,loadCallback:function(){$("#shareResourceInode").val(inode);$("#inEmbedLink").val(url);$("#inShareLink").val(url);$('#embedLink_btn').hide();$('#shareLink_btn').hide();var sc=new sd.ServerCall("ListUserDiscussions",0);var obj=new Object();obj.f_node=sd.Configuration.discussionRoot;obj.fields="*";sc.data(obj);sc.go({onSuccess:$.proxy(function(myData){var htmlOut="";var count=0;for(i=0;i<myData.length;i++){var item=myData[i];var xmlMeta=$.parseXML(item.MetaData);var RSS=$(xmlMeta).find("RSS").text();if(RSS!="1"&&item.accesslevel>=2)
{htmlOut+='<option value="'+item.discussionID+'">'+decodeURIComponent(item.discussionName)+'</option>';count++;}}
if(count>0){$('#embedLink_btn').show();$('#shareLink_btn').show();}
$("#selEmbedLink").html(htmlOut);},this),onError:$.proxy(this.handleError,this)});$('#shareLink_btn').bind("click",function(){$('#dvShareLink').show();$('#dvEmbedLink').hide();});$('#embedLink_btn').bind("click",function(){$('#dvShareLink').hide();$('#dvEmbedLink').show();});$('#postLink_btn').bind("click",function(){var selectedChannel=$('#selEmbedLink').val();JumpToItem(selectedChannel);waitUntilExists("groupPostPrompt",function(){$('.channel-post-prompt').click();$('#Textarea1').val(url);});sd.component.messageBox.close();});},template:sd.Configuration.templates.shareResource,});}
Utils.imageResize=function(holderHeight,holderWidth,imgUniqueId){var imgId=imgUniqueId;var tmpImg=new Image();tmpImg.src=$('#'+imgId).attr('src');tmpImg.onload=function(){sd.Utils.scaleImage(imgId,this.height,this.width,holderHeight,holderWidth);};};Utils.scaleImage=function(item,itemHeight,itemWidth,divHeight,divWidth){var maxWidth=divWidth;var maxHeight=divHeight;var ratio=0;var width=itemWidth;var height=itemHeight;$("#"+item).css("width",width);$("#"+item).css("height",height);$("#"+item).css("verticalAlign","bottom");if(width>maxWidth){ratio=maxWidth/width;$("#"+item).css("width",maxWidth);$("#"+item).css("height",height*ratio);$("#"+item).css("verticalAlign","bottom");height=height*ratio;width=width*ratio;}
if(height>maxHeight){ratio=maxHeight/height;$("#"+item).css("height",maxHeight);$("#"+item).css("width",width*ratio);$("#"+item).css("verticalAlign","bottom");width=width*ratio;}
$("#"+item).css("margin-left","auto");$("#"+item).css("margin-right","auto");$("#"+item).fadeIn('fast');$("#"+item).css("display","block");}
Utils.isVideo=function(fileFormat){var fmt=String(fileFormat).toLowerCase();var videoFile=false;switch(fmt){case'mp4':case'avi':case'wmv':case'mpg':case'mpeg':case'mov':case'rm':case'ram':case'flv':case'mkv':case'm4v':case'3gp':videoFile=true;break;default:videoFile=false;}
return videoFile;};Utils.isDocument=function(fileFormat){var fmt=String(fileFormat).toLowerCase();var doc=true;switch(fmt){case'mp4':case'avi':case'wmv':case'mpg':case'mpeg':case'mov':case'rm':case'ram':case'flv':case'mkv':case'm4v':case'3gp':doc=false;break;default:doc=true;}
return doc;};Utils.isExcel=function(fileFormat){var fmt=String(fileFormat).toLowerCase();var excel=false;switch(fmt){case'xls':case'xlsx':case'xlb':case'xlsm':case'xltx':case'xlsb':excel=true;break;default:excel=false;}
return excel;};Utils.isZip=function(fileFormat){var fmt=String(fileFormat).toLowerCase();var zip=false;switch(fmt){case'zip':case'rar':zip=true;break;default:zip=false;}
return zip;};Utils.isAudio=function(fileFormat){var fmt=String(fileFormat).toLowerCase();var audioFile=false;switch(fmt){case'mp3':audioFile=true;break;default:audioFile=false;}
return audioFile;};Utils.isFlv=function(fileFormat){var fmt=String(fileFormat).toLowerCase();var flvFile=false;switch(fmt){case'flv':flvFile=true;break;default:flvFile=false;}
return flvFile;};Utils.isSwf=function(fileFormat){var fmt=String(fileFormat).toLowerCase();var swf=false;switch(fmt){case'swf':case'rar':swf=true;break;default:swf=false;}
return swf;};Utils.buildAssetSource=function(options){options.prefix=options.prefix||"";options.inode=options.inode||0;options.format=options.format||"document";options.height=options.height||60;options.width=options.width||60;options.thumbType=options.thumbType||"thumb";options.thumbSize=options.thumbSize||"lge";options.videoOptions=options.videoOptions||"";options.videoSize=options.videoSize||"full";options.className=options.className||"";options.title=options.title||"";options.id=options.id||options.inode;if(options.videoPoster==null)options.videoPoster="images\\mccann\\play-icon.png";var htmlOut="";if(sd.Utils.isVideo(options.format)){if(globalBrowserDetails.agent=="MSIE"&&globalBrowserDetails.version==9){htmlOut="<video poster=\""+options.videoPoster+"\" class=\""+options.className+"\" id=\""+options.prefix+options.id+"\" width=\""+options.width+"\" height=\""+options.height+"\" "+options.videoOptions+" preload=\"none\"> ";}
else
{htmlOut="<video poster=\""+options.videoPoster+"\" class=\""+options.className+"\" id=\""+options.prefix+options.id+"\" width=\""+options.width+"\" height=\""+options.height+"\" "+options.videoOptions+" > ";}
if(options.videoSize=="thumb")
htmlOut+="<source src = \""+sd.Configuration.ws+"/"+options.inode+"_thumb.mp4\" type=\"video/mp4\">";else
htmlOut+="<source src = \""+sd.Configuration.ws+"/"+options.inode+".mp4\" type=\"video/mp4\">";htmlOut+="Your browser does not support videos";htmlOut+="</video>";}
else if(sd.Utils.isExcel(options.format)){htmlOut="<img class=\""+options.className+"\" style=\"display:none;\" id=\""+options.prefix+options.id+"\" src = \"images/docIcons/"+sd.Utils.getFileIcon({size:options.thumbSize,fmt:options.format})+"\">";}
else if(sd.Utils.isSwf(options.format)){htmlOut="<div style=\"height:"+options.height+"px;width:"+options.width+"px;position:absolute;\"></div>";htmlOut+="<object width=\""+options.width+"\" height=\""+options.height+"\" type=\"application/x-shockwave-flash\" classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" codebase=\"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0\">";htmlOut+="                       <param name=\"SRC\" value=\""+sd.Configuration.ws+"/DownloadFile.aspx?inode="+options.inode+"\"/>";htmlOut+="                                <param name=\"wmode\" value=\"transparent\" />";htmlOut+="                       <embed type=\"application/x-shockwave-flash\" wmode=\"transparent\" src=\""+sd.Configuration.ws+"/DownloadFile.aspx?inode="+options.inode+"&sendSWF=true\" width=\""+options.width+"\"height=\""+options.height+"\"></embed> </object>";}
else if(sd.Utils.isZip(options.format)){htmlOut="<img class=\""+options.className+"\" style=\"display:none;\" id=\""+options.prefix+options.id+"\" src = \"images/docIcons/"+sd.Utils.getFileIcon({size:options.thumbSize,fmt:options.format})+"\">";}
else if(options.format=="discussion"||options.format=="comment"){htmlOut="<img title=\""+options.title+"\" class=\""+options.className+"\" style=\"display:none;\" id=\""+options.prefix+options.id+"\" src = \"images/docIcons/"+sd.Utils.getFileIcon({size:options.thumbSize,fmt:options.format})+"\">";}
else if(options.format=="ADImage")
{htmlOut="<img title=\""+options.title+"\" class=\""+options.className+"\" style=\"display:none;\" id=\""+options.prefix+options.id+"\" src =\""+options.inode+"\">";}
else{htmlOut="<img title=\""+options.title+"\" class=\""+options.className+"\" style=\"display:none;\" id=\""+options.prefix+options.id+"\" src =\""+sd.Configuration.vault+"/"+options.inode+"/"+options.thumbType+".jpg\">";}
return htmlOut;};Utils.getQueryStringParam=function(paramName){var match=RegExp('[?&]'+paramName+'=([^&]*)').exec(window.location.search);return match&&decodeURIComponent(match[1].replace(/\+/g,' '));};Utils.isValidURLFormat=function(url){var expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/i;var regexp=new RegExp(expression);if(url.match(regexp))
{return true;}
else{return false;}};Utils.killAllVideos=function(){var videoElems=document.getElementsByTagName('video').length
for(var i=0;i<videoElems;i++){var video=document.getElementsByTagName("video")[i];video.pause();video.src="";var FF=!(window.mozInnerScreenX==null);if(FF){video.load();}}}
Utils.getBrowserDetails=function(){var browser={};browser.tablet=false;var checker={ipad:navigator.userAgent.match(/(iPad)/),android:navigator.userAgent.match(/Android/)};if(checker.android){browser.device="android";browser.tablet=true;}
else if(checker.ipad){browser.device="ipad";browser.tablet=true;}
else{browser.device="desktop";}
if(/(chrome\/[0-9]{2})/i.test(navigator.userAgent)){browser.agent=navigator.userAgent.match(/(chrome\/[0-9]{2})/i)[0].split("/")[0];browser.version=parseInt(navigator.userAgent.match(/(chrome\/[0-9]{2})/i)[0].split("/")[1]);}else if(/(firefox\/[0-9]{2})/i.test(navigator.userAgent)){browser.agent=navigator.userAgent.match(/(firefox\/[0-9]{2})/i)[0].split("/")[0];browser.version=parseInt(navigator.userAgent.match(/(firefox\/[0-9]{2})/i)[0].split("/")[1]);}else if(/(MSIE\ [0-9]{1})/i.test(navigator.userAgent)){browser.agent=navigator.userAgent.match(/(MSIE\ [0-9]{1})/i)[0].split(" ")[0];browser.version=parseInt(navigator.userAgent.match(/(MSIE\ [0-9]{1})/i)[0].split(" ")[1]);}else if(/(Opera\/[0-9]{1})/i.test(navigator.userAgent)){browser.agent=navigator.userAgent.match(/(Opera\/[0-9]{1})/i)[0].split("/")[0];browser.version=parseInt(navigator.userAgent.match(/(Opera\/[0-9]{1})/i)[0].split("/")[1]);}else if(/(Trident\/[7]{1})/i.test(navigator.userAgent)){browser.agent="MSIE";browser.version=11;}else if(/(Safari\/[0-9]{2})/i.test(navigator.userAgent)){browser.agent=navigator.userAgent.match(/(Safari\/[0-9]{2})/i)[0].split("/")[0];browser.version=parseInt(navigator.userAgent.match(/(Safari\/[0-9]{2})/i)[0].split("/")[1]);}else{browser.agent=false;browser.version=false;}
if(/(Windows\ NT\ [0-9]{1}\.[0-9]{1})/.test(navigator.userAgent)){browser.os="Windows";switch(parseFloat(navigator.userAgent.match(/(Windows\ NT\ [0-9]{1}\.[0-9]{1})/)[0].split(" ")[2])){case 6.0:browser.osversion="Vista";break;case 6.1:browser.osversion="7";break;case 6.2:browser.osversion="8";break;default:browser.osversion=false;}}else if(/(OS\ X\ [0-9]{2}\.[0-9]{1})/.test(navigator.userAgent)){browser.os="OS X";browser.osversion=navigator.userAgent.match(/(OS\ X\ [0-9]{2}\.[0-9]{1})/)[0].split(" ")[2];}else if(/(Linux)/.test(navigator.userAgent)){browser.os="Linux";browser.osversion=false;}
return browser;};Utils.downloadZip=function(inodes){var url;if($.isArray(inodes)){url=sd.Configuration.ws+"/DownloadZip.aspx?inodes="+inodes.join(",");}
else{url=sd.Configuration.ws+"/DownloadZip.aspx?inodes="+inodes;}
window.open(url,"_parent");}
Utils.shuffleArray=function(arrayIn){for(var i=arrayIn.length-1;i>0;--i){var j=Math.floor(Math.random()*(i+1));var temp=arrayIn[i];arrayIn[i]=arrayIn[j];arrayIn[j]=temp;}
return arrayIn;}
window.sd=window.sd||{};window.sd.Utils=Utils;}(window));(function(window){var messageBox={};messageBox.action=function(options){messageBox.options=options||{};messageBox.options.container=messageBox.options.container||"#messageBox";messageBox.options.fullscreen=messageBox.options.fullscreen||null;messageBox.options.containerClass=messageBox.options.containerClass||"";messageBox.options.title=messageBox.options.title||"";messageBox.options.text=messageBox.options.text||"";messageBox.options.btn1=messageBox.options.btn1||"";messageBox.options.btn2=messageBox.options.btn2||"";messageBox.options.btn3=messageBox.options.btn3||"";messageBox.options.btn1callback=messageBox.options.btn1callback||function(){return true;};messageBox.options.btn2callback=messageBox.options.btn2callback||function(){};messageBox.options.btn3callback=messageBox.options.btn3callback||function(){};messageBox.options.btn2close=(messageBox.options.btn2close!=null)?messageBox.options.btn2close:true;messageBox.options.loadCallback=messageBox.options.loadCallback||function(){};messageBox.options.closeCallback=messageBox.options.closeCallback||function(){};messageBox.options.template=messageBox.options.template||null;messageBox.options.cancelUploadsOnClose=(messageBox.options.cancelUploadsOnClose!=null)?messageBox.options.cancelUploadsOnClose:true;messageBox.options.width=messageBox.options.width||300;messageBox.options.height=messageBox.options.height||"auto";messageBox.options.centered=(messageBox.options.centered!=null)?messageBox.options.centered:true;messageBox.options.cssClass=messageBox.options.cssClass||"messagebox";messageBox.options.header=(messageBox.options.header!=null)?messageBox.options.header:true;messageBox.options.headerClass=messageBox.options.headerClass||"messagebox-header";messageBox.options.bodyClass=messageBox.options.bodyClass||"messagebox-body";messageBox.options.topOffset=messageBox.options.topOffset||window.pageYOffset;messageBox.options.fade=messageBox.options.fade||true;messageBox.options.showOptions=messageBox.options.showOptions||true;messageBox.options.icon=messageBox.options.icon||true;messageBox.options.icon1=messageBox.options.icon1||"";messageBox.options.icon2=messageBox.options.icon2||"";messageBox.options.overlay=messageBox.options.overlay||true;messageBox.options.escape=messageBox.options.escape||true;messageBox.options.TxtFields=messageBox.options.TxtFields||null;$(messageBox.options.container).hide();$(messageBox.options.container).empty();var header=messageBox.options.title;if(messageBox.options.escape)
header=messageBox.options.title+"<div class='flex flex-auto justify-end'><a class='messagebox-escape' title=\"Close "+messageBox.options.title+" \"> <svg role='img' class='svg-icon-nano'><use xlink:href='#shape-mcann-thin-close-icon'></use></svg></a></div>";var headerWidth=messageBox.options.width-60;var messageBoxHTML="<dialogue class='border messageBoxContainer "+messageBox.options.cssClass+"'> ";if(messageBox.options.header)
messageBoxHTML+="<div class=''><header class='pa-all-1 dialogue-header "+messageBox.options.headerClass+"'><h6 class='flex flex-auto ma-all-0'>"+header+"</h6></header></div> ";messageBoxHTML+="<section class='messageBoxMainBody "+messageBox.options.bodyClass+"'><div>"+messageBox.options.text+"</div></section> \
                               </dialogue>";$(messageBox.options.container).html(messageBoxHTML);if(messageBox.options.containerClass!=null){$(messageBox.options.container).addClass(messageBox.options.containerClass);}
if(messageBox.options.fullscreen){$('body').addClass("noscroll");}
$(messageBox.options.container+' .messagebox-escape').on('click',function(){messageBox.close();});if(messageBox.options.template!=null){$(messageBox.options.container+' .messageBoxMainBody').load(messageBox.options.template,function(){if(messageBox.options.TxtFields!=null){for(var i=0;i<messageBox.options.TxtFields.length;i++){var fieldObj=messageBox.options.TxtFields[i];$('#'+fieldObj.fieldName).val(fieldObj.txtValue);}}
messageBox.addButtons();var errorMessageHTML="<div class='messagebox-error'></div>";$(" ."+messageBox.options.bodyClass+" #messageBox_buttons").prepend(errorMessageHTML);var messageHTML="<div class='messagebox-message'></div>";$(messageBox.options.container+" ."+messageBox.options.bodyClass).append(messageHTML);messageBox.options.loadCallback();});}
else
messageBox.addButtons();if(messageBox.showOptions==true){console.log('MessageBox Log',new Date())
console.group("Running Message Box");console.debug(options);console.groupEnd();}
if(messageBox.fade==true){$(messageBox.options.container).fadeIn('slow');}
else{$(messageBox.options.container).show();}
if(messageBox.options.overlay){$('body').css("overflow-y","hidden");$(".modalOverlay").hide().fadeIn('slow');$(".modalOverlay").on('click',function(){});}
else{$(".modalOverlay").hide();}
if(messageBox.options.centered==false){$(messageBox.options.container+" .messageBoxContainer").css({"position":"absolute","width":messageBox.options.width,"height":messageBox.options.height,"z-index":"10000"});}
else{windowWidth=document.documentElement.clientWidth;windowHeight=document.documentElement.clientHeight;$(messageBox.options.container+" .messageBoxContainer").css({"position":"absolute","width":messageBox.options.width,"height":messageBox.options.height,"top":messageBox.options.topOffset+(windowHeight/2-messageBox.options.height/2),"left":windowWidth/2-messageBox.options.width/2,"z-index":"10000"});}}
messageBox.addButtons=function(){var buttonHTML="";if(messageBox.options.icon){if(messageBox.options.btn1===""||messageBox.options.btn2===""){buttonHTML+="<div class='flex justify-center messagebox-buttons'  id='messageBox_buttons'>";}
else{buttonHTML+="<div class='flex justify-end frame-s' id='messageBox_buttons'>";}
if(messageBox.options.btn1!==""){buttonHTML+="<button class='messageBoxBtn1 small brand-btn brand__outline self-center'>"+messageBox.options.btn1+"</button>";}
if(messageBox.options.btn2!==""){buttonHTML+="<button class='messageBoxBtn2 small brand-btn brand__outline self-center ma-l-1'>"+messageBox.options.btn2+"</button>";}
if(messageBox.options.btn3!==""){buttonHTML+="<button class='messageBoxBtn3 small brand-btn brand__outline self-center ma-l-1'>"+messageBox.options.btn3+"</button>";}}
else{if(messageBox.options.btn1!==""){buttonHTML+="<button id=\"btn1\">"+messageBox.options.btn1+"</button>";}
if(messageBox.options.btn2!==""){buttonHTML+="<button id=\"btn2\">"+messageBox.options.btn2+"</button>";}
if(messageBox.options.btn3!==""){buttonHTML+="<button id=\"btn3\">"+messageBox.options.btn3+"</button>";}}
buttonHTML+="</div>";$(messageBox.options.container+" ."+messageBox.options.bodyClass).append(buttonHTML);$(messageBox.options.container+" .messageBoxBtn1").unbind();$(messageBox.options.container+" .messageBoxBtn2").unbind();$(messageBox.options.container+" .messageBoxBtn3").unbind();$(messageBox.options.container+" .messageBoxBtn1").on('click',function(event){messageBox.showError("");if(messageBox.options.btn1callback(event)||messageBox.options.template==null)
messageBox.close();});$(messageBox.options.container+" .messageBoxBtn2").on('click',function(){messageBox.options.btn2callback();if(messageBox.options.btn2close)
messageBox.close();});$(messageBox.options.container+" .messageBoxBtn3").on('click',function(){messageBox.options.btn3callback();if(messageBox.options.btn3close)
messageBox.close();});}
messageBox.showError=function(error){if(error==""){$(messageBox.options.container+" .messagebox-error").hide();}
else{$(messageBox.options.container+" .messagebox-error").html(error);$(messageBox.options.container+" .messagebox-error").fadeIn();}}
messageBox.showMessage=function(message){if(message==""){$(messageBox.options.container+" .messagebox-error").hide();}
else{$(messageBox.options.container+" .messagebox-message").html(message);$(messageBox.options.container+" .messagebox-message").fadeIn();}}
messageBox.close=function(){try{if($("#dvLibraryImage video").length){videoID=$("#dvLibraryImage video").attr("id");var html="<video class='videoClass' id='"+videoID+"' style=\"width: 100%; height: 100%;\" controls autoplay> ";html+="<source src = '"+sd.Configuration.ws+"/"+videoID+"/"+videoID+".mp4' type='video/mp4'>";html+="Your browser does not support videos";html+="</video>";$("#dvLibraryImage").html(html);$("#dvLibraryImage").find('video').bind("loadeddata",function(){$("#dvLibraryImage").find('video').attr('poster','');});}
if(messageBox.options.fade)
$(messageBox.options.container).fadeOut('slow');else
$(messageBox.options.container).hide();if(messageBox.options.overlay){$('body').css("position","static");$('body').css("overflow-y","scroll")
$(".modalOverlay").fadeOut('slow');}
else{$(".modalOverlay").hide();}
messageBox.options.closeCallback();$(messageBox.options.container+' .messageBoxMainBody').html("");if(messageBox.options.cancelUploadsOnClose)sd.FileUploader.cancelAll();tinyMCE.remove();if(messageBox.options.containerClass!=null){$(messageBox.options.container).removeClass(messageBox.options.containerClass);}
if(messagebox.options.fullscreen!=null){$("body").removeClass("noscroll");}}
catch(err){console.log("Unable to close message box.")}}
window.sd.component=window.sd.component||{};window.sd.component.messageBox=messageBox;}(window));﻿(function(window){var permissionsForm={};permissionsForm.noAccessList=[];permissionsForm.action=function(options){permissionsForm.options=options||{};permissionsForm.options.title=permissionsForm.options.title||"Update Permissions";permissionsForm.options.inode=permissionsForm.options.inode||null;permissionsForm.options.useDialog=(permissionsForm.options.useDialog==null)?true:permissionsForm.options.useDialog;permissionsForm.options.container=permissionsForm.options.container||null;permissionsForm.options.saveCallback=permissionsForm.options.saveCallback||function(){};permissionsForm.options.cancelCallback=permissionsForm.options.cancelCallback||function(){};permissionsForm.options.height=permissionsForm.options.height||550;permissionsForm.options.width=permissionsForm.options.width||550;permissionsForm.options.itemCreator=permissionsForm.options.itemCreator||"";permissionsForm.options.showView=(permissionsForm.options.showView==null)?true:permissionsForm.options.showView;permissionsForm.options.showEdit=(permissionsForm.options.showEdit==null)?true:permissionsForm.options.showEdit;permissionsForm.options.showAdmin=(permissionsForm.options.showAdmin==null)?true:permissionsForm.options.showAdmin;permissionsForm.options.viewLabel=permissionsForm.options.viewLabel||"View Access";permissionsForm.options.editLabel=permissionsForm.options.editLabel||"Edit Access";permissionsForm.options.adminLabel=permissionsForm.options.adminLabel||"Admin Access";permissionsForm.options.allowReset=(permissionsForm.options.allowReset==null)?false:permissionsForm.options.allowReset;permissionsForm.options.isSpecify=(permissionsForm.options.isSpecify==null)?true:permissionsForm.options.isSpecify;permissionsForm.options.populateNoAccess=(permissionsForm.options.populateNoAccess==null)?true:permissionsForm.options.populateNoAccess;if(permissionsForm.options.useDialog==true){permissionsForm.loadAsDialog();}
else{permissionsForm.loadInForm();}}
permissionsForm.loadAsDialog=function(){sd.component.messageBox.action({title:permissionsForm.options.title,height:permissionsForm.options.height+200,width:permissionsForm.options.width+200,loadCallback:function(){$("#permissionsID").val(permissionsForm.options.inode);var obj={};obj.inode=permissionsForm.options.inode;var sc=new sd.ServerCall("ShowAccess");sc.data(obj);sc.go({onSuccess:permissionsForm.handleItemPermissions,onError:permissionsForm.handleError});},template:sd.Configuration.templates.itemPermissions,btn1callback:$.proxy(this.saveItemPermissions,this),icon1:"icon-save",btn1:"Save",btn2callback:$.proxy(this.options.cancelCallback,this),icon2:"icon-ban-circle",btn2:"Cancel"});}
permissionsForm.loadInForm=function(){$(permissionsForm.options.container).hide()
$(permissionsForm.options.container).empty();$(permissionsForm.options.container).load(sd.Configuration.templates.itemPermissions,function(){$("#permissionsID").val(permissionsForm.options.inode);var obj={};obj.inode=permissionsForm.options.inode;var sc=new sd.ServerCall("ShowAccess");sc.data(obj);sc.go({onSuccess:permissionsForm.handleItemPermissions,onError:permissionsForm.handleError});});}
permissionsForm.handleItemPermissions=function(myData,status){var noAccess="";var viewAccess="";var editAccess="";var adminAccess="";var item;var image="";var sort="";permissionsForm.noAccessList=[];for(var idx=0;idx<myData.length;idx++){item=myData[idx];if(item.t=="user")
image="images/selectList/user.png";else
image="images/selectList/group.png";switch(item.a){case 1:viewAccess+="<li data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\"><img src=\""+image+"\" />"+item.dn+"</li>";break;case 2:editAccess+="<li data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\"><img src=\""+image+"\" />"+item.dn+"</li>";break;case 3:if(item.id.toLowerCase()!=permissionsForm.options.itemCreator.toLowerCase()&&item.id.toLowerCase()!=sd.Session.user.username.toLowerCase())
{adminAccess+="<li data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\"><img src=\""+image+"\" />"+item.dn+"</li>";}
break;default:if(permissionsForm.options.populateNoAccess)
noAccess+="<li data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\"><img src=\""+image+"\" />"+item.dn+"</li>";permissionsForm.noAccessList.push(item);break;}}
$("#ulNoAccess").append(noAccess);if(permissionsForm.options.showAdmin)
{$("#ulAdminAccess").append(adminAccess);$("#hdrAdmin").html(permissionsForm.options.adminLabel);$("#ulAdminAccess").selectable();$("#btnAddAdmin").bind("click",function(){permissionsForm.moveItem("#ulNoAccess","add");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulNoAccess","#ulAdminAccess");});$("#btnRemoveAdmin").bind("click",function(){permissionsForm.moveItem("#ulAdminAccess","remove");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulAdminAccess","#ulNoAccess");});$('#sectionAdmin').show();}
if(permissionsForm.options.showView)
{$("#ulViewAccess").append(viewAccess);$("#hdrView").html(permissionsForm.options.viewLabel);$("#ulViewAccess").selectable();$("#btnAddViewer").bind("click",function(){permissionsForm.moveItem("#ulNoAccess","add");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulNoAccess","#ulViewAccess");});$("#btnRemoveViewer").bind("click",function(){permissionsForm.moveItem("#ulViewAccess","remove");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulViewAccess","#ulNoAccess");});$('#sectionView').show();}
if(permissionsForm.options.showEdit)
{$("#ulEditAccess").append(editAccess);$("#hdrEdit").html(permissionsForm.options.editLabel);$("#ulEditAccess").selectable();$("#btnAddEditer").bind("click",function(){permissionsForm.moveItem("#ulNoAccess","add");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulNoAccess","#ulEditAccess");});$("#btnRemoveEditer").bind("click",function(){permissionsForm.moveItem("#ulEditAccess","remove");sd.Utils.moveBetweenLists("data-sort","ui-selected","#ulEditAccess","#ulNoAccess");});$('#sectionEdit').show();}
if(permissionsForm.options.allowReset)
{$('.resetPerms').show();$('#rdoPermsSpecify').prop('checked',permissionsForm.options.isSpecify);$('#rdoPermsInherit').prop('checked',!permissionsForm.options.isSpecify);if(permissionsForm.options.isSpecify)
{$('#dvPermissionBlocker').hide();}
else{$('#dvPermissionBlocker').show();$('#dvPermissionsHolder').fadeTo('slow',.6);}
$('#rdoPermsInherit').on("click",function(){$('#dvPermissionBlocker').show();$('#dvPermissionsHolder').fadeTo('slow',.6);});$('#rdoPermsSpecify').on("click",function(){$('#dvPermissionBlocker').hide();$('#dvPermissionsHolder ').fadeTo('slow',1);});}
$("#ulNoAccess").selectable();$("#ulViewAccess").selectable();$('#listFilterText').on('input',function(){permissionsForm.displayList();});}
permissionsForm.moveItem=function(container,type)
{var itemsSelected=$(container).children(".ui-selected");var item;for(var idx=0;idx<itemsSelected.length;idx++)
{item=itemsSelected[idx];if(type=="add")
{for(var i=0;i<permissionsForm.noAccessList.length;i++)
{if(item.getAttribute('data-id')==permissionsForm.noAccessList[i].id)
{permissionsForm.noAccessList.splice(i,1);}}}
else
{var id=item.getAttribute('data-id');var type=item.getAttribute('data-type');var name=item.innerText;var email=item.getAttribute('data-email');permissionsForm.noAccessList.push({a:-1,id:id,t:type,e:email,dn:name});sd.Utils.sortArrayByString(permissionsForm.noAccessList,"dn");}}}
permissionsForm.displayList=function(){var listCount=permissionsForm.noAccessList.length;var filterText=$('#listFilterText').val().toLowerCase();var htmlOut="";for(var idx=0;idx<listCount;idx++){var item=permissionsForm.noAccessList[idx];if(item.t=="user")
image="images/selectList/user.png";else
image="images/selectList/group.png";if(filterText!=""&&item.dn.toLowerCase().indexOf(filterText)<0)continue;htmlOut+="<li data-sort = \""+item.t+"\" data-id=\""+item.id+"\" data-type=\""+item.t+"\" data-email=\""+item.e+"\"><img src=\""+image+"\" />"+item.dn+"</li>";}
$("#ulNoAccess").html(htmlOut);}
permissionsForm.saveItemPermissions=function(){if($('#rdoPermsSpecify').is(':checked'))
{var arrAdminUsers=[];var arrEditUsers=[];var arrViewUsers=[];var arrAdminGroups=[];var arrEditGroups=[];var arrViewGroups=[];var li;$("#ulViewAccess li").each(function(){li=$(this);if($(li).attr("data-type")!=undefined){if($(li).attr("data-type")=="user")
arrViewUsers.push($(li).attr("data-id"));else
arrViewGroups.push($(li).attr("data-id"));}});$("#ulEditAccess li").each(function(){li=$(this);if($(li).attr("data-type")!=undefined){if($(li).attr("data-type")=="user")
arrEditUsers.push($(li).attr("data-id"));else
arrEditGroups.push($(li).attr("data-id"));}});$("#ulAdminAccess li").each(function(){li=$(this);if($(li).attr("data-type")!=undefined){if($(li).attr("data-type")=="user")
arrAdminUsers.push($(li).attr("data-id"));else
arrAdminGroups.push($(li).attr("data-id"));}
arrAdminUsers.push(permissionsForm.options.itemCreator);});var sc=new sd.ServerCall("EditAccess");var obj={};obj.inode=$("#permissionsID").val();obj.readAccessUsers=arrViewUsers.join(";");obj.writeAccessUsers=arrEditUsers.join(";");obj.adminAccessUsers=arrAdminUsers.join(";");obj.readAccessGroups=arrViewGroups.join(";");obj.writeAccessGroups=arrEditGroups.join(";");obj.adminAccessGroups=arrAdminGroups.join(";");sc.data(obj);sc.go({onSuccess:permissionsForm.options.saveCallback,onError:permissionsForm.handleSaveError});}
else{var sc=new sd.ServerCall("InheritAccess");var obj={};obj.inode=$("#permissionsID").val();sc.data(obj);sc.go({onSuccess:permissionsForm.options.saveCallback,onError:permissionsForm.handleSaveError});}}
permissionsForm.handleSaveError=function(error){sd.component.messageBox.showError(error);}
permissionsForm.handleError=function(error){sd.component.messageBox.action({title:"Action Unavailable",height:150,text:error,btn1:"Ok"});}
window.sd.component=window.sd.component||{};window.sd.component.permissionsForm=permissionsForm;}(window));